var fn_addin=function(a,o,e){var n=n||{};return n.styles=n.styles||{},n.commands=n.commands||{},n.dependencies=e||n.dependencies||{},n.styles.style=function(){},n.views=n.views||{},n.collect=n.collect||{},n.models=n.models||{},n.templates=n.templates||{},n.templates=n.templates||{},n.templates["quicklinks-item-template"]=Handlebars.template({1:function(e,t,i,n){return' class="local"'},3:function(e,t,i,n){var s;return'<img src="'+this.escapeExpression("function"==typeof(s=null!=(s=t.favicon_url||(null!=e?e.favicon_url:e))?s:t.helperMissing)?s.call(e,{name:"favicon_url",hash:{},data:n}):s)+'">'},5:function(e,t,i,n){return' <span class="link-icon-placeholder">&nbsp;</span>'},7:function(e,t,i,n){return'<div class="icon-wrapper destroy"><i draggable="false" class="icon">✕</i></div>'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,i,n){var s,l,a=t.helperMissing,o="function",r=this.escapeExpression;return'<div draggable="true" class="'+r(typeof(l=null!=(l=t.classes||(null!=e?e.classes:e))?l:a)===o?l.call(e,{name:"classes",hash:{},data:n}):l)+'">\n\t<a draggable="false" href="'+r(typeof(l=null!=(l=t.url||(null!=e?e.url:e))?l:a)===o?l.call(e,{name:"url",hash:{},data:n}):l)+'"'+(null!=(s=t.if.call(e,null!=e?e.local:e,{name:"if",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n}))?s:"")+">"+(null!=(s=t.if.call(e,null!=e?e.favicon_url:e,{name:"if",hash:{},fn:this.program(3,n,0),inverse:this.program(5,n,0),data:n}))?s:"")+' <span class="link-text">'+r(typeof(l=null!=(l=t.title||(null!=e?e.title:e))?l:a)===o?l.call(e,{name:"title",hash:{},data:n}):l)+"</span></a>\n\t"+(null!=(s=t.unless.call(e,null!=e?e.team:e,{name:"unless",hash:{},fn:this.program(7,n,0),inverse:this.noop,data:n}))?s:"")+"\n</div>\n"},useData:!0}),n.templates.quicklinks=Handlebars.template({1:function(e,t,i,n){var s;return null!=(s=t.if.call(e,null!=e?e.isChrome:e,{name:"if",hash:{},fn:this.program(2,n,0),inverse:this.noop,data:n}))?s:""},2:function(e,t,i,n){return'\t\t\t\t\t<li data-momo-id="chromeTab" data-place="links" class="optional-link"><a href="chrome-search://local-ntp/local-ntp.html" class="local"><svg class="icon-svg icon-chrome-tab" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 497.401 497.401"><g><path d="M478.742 154.382H320.714c28.366 21.765 47.111 55.717 47.111 94.307 0 30.63-14.345 56.386-30.933 79.445-28.322 39.41-95.817 168.878-95.817 168.878 2.567.043 5.026.388 7.636.388 137.341 0 248.69-111.348 248.69-248.69-.022-33.412-6.709-65.229-18.659-94.328z"/><path d="M248.172 129.619c54.402-.388 217.628-2.049 217.628-2.049C423.24 51.511 342.069 0 248.69 0 170.819 0 101.361 35.829 55.782 91.848l75.972 134.925c10.268-55.113 58.349-96.744 116.418-97.154z"/><path d="M248.668 367.825c-51.964 0-91.568-35.117-111.974-79.855-20.535-45.018-98.061-171.984-98.061-171.984C14.301 154.425 0 199.832 0 248.69c0 124.744 91.935 227.744 211.696 245.648l77.288-134.019c-12.641 4.615-26.101 7.506-40.316 7.506z"/><circle cx="248.668" cy="248.711" r="80.416"/></g></svg> Chrome Tab</a></li>\n\t\t\t\t\t<li data-momo-id="apps" class="optional-link" data-place="links"><a href="chrome://apps" id="app-return" class="local"><svg class="icon-svg icon-apps" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M3 3h6v6H3V3zm10 0h6v6h-6V3zm10 0h6v6h-6V3zM3 13h6v6H3v-6zm10 0h6v6h-6v-6zm10 0h6v6h-6v-6zM3 23h6v6H3v-6zm10 0h6v6h-6v-6zm10 0h6v6h-6v-6z"/></svg> Apps</a></li>\n'},4:function(e,t,i,n){return'\t\t\t<div class="empty">\n\t\t\t\t<div class="title">No links yet</div>\n\t\t\t\t<div class="description">Add your favorite links</div>\n\t\t\t\t<span class="button new-toggle empty-toggle">New Link</span>\n\t\t\t</div>\n\t\t\t<div class="footer-input new">\n\t\t\t\t<div class="icon-wrapper new-hide"><i class="icon">✕</i></div>\n\t\t\t\t<input type="text" id="new-title" class="new-title new-toggle" placeholder="New Link">\n\t\t\t\t<input type="text" id="new-url" class="new-url" placeholder="URL">\n\t\t\t</div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,i,n){var s;return'\n\t\t<div class="message"><i class="loading-icon"></i><span class="loading-label">Loading...</span></div>\n\t\t<ol class="links-list">\n'+(null!=(s=t.unless.call(e,null!=e?e.team:e,{name:"unless",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n}))?s:"")+"\t\t</ol>\n"+(null!=(s=t.unless.call(e,null!=e?e.team:e,{name:"unless",hash:{},fn:this.program(4,n,0),inverse:this.noop,data:n}))?s:"")},useData:!0}),n.templates.teamlinks=Handlebars.template({1:function(e,t,i,n){var s;return'<img class="team-logo" src="'+this.escapeExpression("function"==typeof(s=null!=(s=t.logo||(null!=e?e.logo:e))?s:t.helperMissing)?s.call(e,{name:"logo",hash:{},data:n}):s)+'">'},3:function(e,t,i,n){var s;return this.escapeExpression("function"==typeof(s=null!=(s=t.name||(null!=e?e.name:e))?s:t.helperMissing)?s.call(e,{name:"name",hash:{},data:n}):s)},5:function(e,t,i,n){return"<div><ol></ol></div>"},7:function(e,t,i,n){return'<span class="toggle" href=""> More</span>'},9:function(e,t,i,n){var s;return null!=(s=t.if.call(e,null!=e?e.isChrome:e,{name:"if",hash:{},fn:this.program(10,n,0),inverse:this.noop,data:n}))?s:""},10:function(e,t,i,n){return'\t\t\t\t\t<li data-momo-id="chromeTab" data-place="links" class="optional-link"><a href="chrome-search://local-ntp/local-ntp.html" class="local"><svg class="icon-svg icon-chrome-tab" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 497.401 497.401"><g><path d="M478.742 154.382H320.714c28.366 21.765 47.111 55.717 47.111 94.307 0 30.63-14.345 56.386-30.933 79.445-28.322 39.41-95.817 168.878-95.817 168.878 2.567.043 5.026.388 7.636.388 137.341 0 248.69-111.348 248.69-248.69-.022-33.412-6.709-65.229-18.659-94.328z"/><path d="M248.172 129.619c54.402-.388 217.628-2.049 217.628-2.049C423.24 51.511 342.069 0 248.69 0 170.819 0 101.361 35.829 55.782 91.848l75.972 134.925c10.268-55.113 58.349-96.744 116.418-97.154z"/><path d="M248.668 367.825c-51.964 0-91.568-35.117-111.974-79.855-20.535-45.018-98.061-171.984-98.061-171.984C14.301 154.425 0 199.832 0 248.69c0 124.744 91.935 227.744 211.696 245.648l77.288-134.019c-12.641 4.615-26.101 7.506-40.316 7.506z"/><circle cx="248.668" cy="248.711" r="80.416"/></g></svg> Chrome Tab</a></li>\n\t\t\t\t\t<li data-momo-id="apps" class="optional-link" data-place="links"><a href="chrome://apps" id="app-return" class="local"><svg class="icon-svg icon-apps" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M3 3h6v6H3V3zm10 0h6v6h-6V3zm10 0h6v6h-6V3zM3 13h6v6H3v-6zm10 0h6v6h-6v-6zm10 0h6v6h-6v-6zM3 23h6v6H3v-6zm10 0h6v6h-6v-6zm10 0h6v6h-6v-6z"/></svg> Apps</a></li>\n'},12:function(e,t,i,n){return'\t\t\t<div class="empty">\n\t\t\t\t<div class="title">No links yet</div>\n\t\t\t\t<div class="description">Add your favorite links</div>\n\t\t\t\t<span class="button new-toggle empty-toggle">New Link</span>\n\t\t\t</div>\n\t\t\t<div class="footer-input new">\n\t\t\t\t<div class="icon-wrapper new-hide"><i class="icon">✕</i></div>\n\t\t\t\t<input type="text" id="new-title" class="new-title new-toggle" placeholder="New Link">\n\t\t\t\t<input type="text" id="new-url" class="new-url" placeholder="URL">\n\t\t\t</div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,i,n){var s;return'<div class="app-dash" >\n\t<div class="toggle" href="">'+(null!=(s=t.if.call(e,null!=e?e.logo:e,{name:"if",hash:{},fn:this.program(1,n,0),inverse:this.program(3,n,0),data:n}))?s:"")+"</div>\n\t"+(null!=(s=t.if.call(e,null!=e?e.team:e,{name:"if",hash:{},fn:this.program(5,n,0),inverse:this.noop,data:n}))?s:"")+'\n</div>\n\n<div class="more-links">\n\t'+(null!=(s=t.if.call(e,null!=e?e.team:e,{name:"if",hash:{},fn:this.program(7,n,0),inverse:this.noop,data:n}))?s:"")+'\n\n</div>\n<div class="app-wrapper nipple-top-left">\n\t<div class="app links-app">\n\t\t<ol>\n'+(null!=(s=t.unless.call(e,null!=e?e.team:e,{name:"unless",hash:{},fn:this.program(9,n,0),inverse:this.noop,data:n}))?s:"")+"\t\t</ol>\n"+(null!=(s=t.unless.call(e,null!=e?e.team:e,{name:"unless",hash:{},fn:this.program(12,n,0),inverse:this.noop,data:n}))?s:"")+'\t\t<div class="add-error-message message">Connection required to add link. <span class="message-action retry-add">Retry</span></div>\n\n\t\t<div class="message-empty"><i class="loading-icon"></i>Loading...</div>\n\t</div>\n</div>\n'},useData:!0}),n.styles=n.styles||{},n.styles.style=function(){var e=document.createElement("style");e.type="text/css",e.innerHTML=".links{--padding-right:38px;--more-margin:100px}.links .toggle{padding:0 10px;cursor:pointer}.links .toggle:active{opacity:1}.links .toggle-icon{filter:drop-shadow(0 1px 5px rgba(0, 0, 0, .1));opacity:.7}.links .toggle-icon:hover{opacity:.85}.links .toggle-icon svg{height:18px;width:18px;margin:0;fill:#fff!important;vertical-align:-4%}.links-wrapper{position:absolute;top:100%;left:7px;display:none}.links-app{padding:0;min-width:240px}.links li{position:relative}.links li a{min-width:125px;padding:5px var(--app-padding);padding-right:var(--padding-right);display:block;cursor:pointer;font-size:15px;line-height:100%;opacity:.75;white-space:nowrap}.light .links li a{opacity:.8}.links li a:hover{opacity:1}.links .first-link a{padding-top:calc(var(--app-padding) - 1px)}.links.show-message .first-link a{margin-top:-20px}.links .first-link .destroy{top:auto;bottom:2px}.teamlinks .links-app{margin-left:var(--more-margin)}.teamlinks .nipple-top-left:before{border-bottom:6px solid transparent;border-top:6px solid transparent;border-right:6px solid rgba(15,15,15,.925);left:calc(var(--more-margin) - 6px);top:calc(50% + 14px)}.links .link-icon-placeholder,.links img,.links svg{height:16px;width:16px;margin:0 4px 0 -1px;vertical-align:top;display:inline-block}.links img.team-logo{height:auto;width:auto;max-height:48px;max-width:120px;padding-top:20px}.links .icon-svg{fill:#fff}.light .links .icon-svg{fill:#222}.links .icon-chrome-tab{height:14px;width:14px;margin-left:1px;margin-top:1px}.links .optional-link{display:none}.links li.optional-link.show{display:list-item}.links span.optional-link.show{display:inline-block}.links .icon-wrapper{position:absolute;top:1px;right:12px;z-index:10;opacity:0}.links .icon{font-size:11px;opacity:.4}.links li:hover .icon-wrapper{opacity:1}.links .icon-wrapper:hover .icon{opacity:.8}.links .icon-wrapper:active .icon,.links .new.open .icon-wrapper{opacity:1}.Firefox .links .destroy,.Firefox .links-new-hide{font-size:15px}.links .new{display:none}.links .new input{padding-top:4px;padding-left:calc(var(--app-padding) - 3px);padding-bottom:calc(var(--app-padding) - 2px);padding-right:var(--padding-right);cursor:text}.links .open.new>.new-title{padding-bottom:2px!important;display:block;text-align:left}.links .new-url{padding-top:3px!important;display:none}.links .open>.new-url{display:block}.links.is-empty .footer-input{position:absolute;right:0;bottom:0;left:0}.links.is-empty .footer-input .new-title{display:none}.links.is-empty .new.open .new-title{display:block}.links .new .icon-wrapper{top:2px}.links .message{margin:15px 0;display:none}.links.show-message .message{display:block}.links.show-message .empty{margin-top:-25px}.links.teamlinks li a{font-size:20px;opacity:1}.links.teamlinks li a .link-text{transition:all .2s ease;display:inline-block}.links.teamlinks li a:hover .link-text{transform:translateX(3px)}.links.teamlinks .more-links{padding-left:53px;display:none;position:absolute;width:600px}.links.teamlinks .more-links.active{display:inline-block}.links.teamlinks .more-links .app-wrapper,.links.teamlinks .more-links .toggle{display:inline-block;vertical-align:middle}.links.teamlinks .more-links .app{position:relative}",document.getElementsByTagName("head")[0].appendChild(e)},n.models.QuickLinks=Backbone.Model.extend({defaults:function(){return{title:"New Link",url:"",local:!1,order:0}},initialize:function(e){e=e||{},this.idAttribute=this.collection.idAttribute||"csid",Backbone.Model.prototype.initialize.call(this,e)},saveOptions:function(){return this.collection.saveOptions},saveNewOrder:function(e){this.save({order:e},this.saveOptions())},comparator:"order"}),a.models.TeamLink=n.models.QuickLinks.extend({}),n.collect.QuickLinksBase=Backbone.Collection.extend({model:n.models.QuickLinks,initialize:function(){this.listenTo(this,"reorder",this.reorderItem)},saveOptions:{},nextOrder:function(){return this.length?this.last().get("order")+100:100},comparator:"order",reorderItem:function(e){}}),n.collect.SyncedQuickLinksBase=a.collect.SyncedCollection.extend({initialize:function(e){(e=e||{}).name=e.name||"quicklinks",e.model=e.model||n.models.QuickLinks,e.apiUrl=a.globals.urlRoot+"links",this.listenTo(this,"reorder",this.reorderItem),a.collect.SyncedCollection.prototype.initialize.call(this,e)},saveOptions:{},nextOrder:function(){return this.length?this.last().get("order")+100:100},comparator:"order",reorderItem:function(e){}}),n.collect.QuickLinks=n.collect.SyncedQuickLinksBase.extend({saveOptions:{patch:!0},reorderItem:function(e){var t={operations:[{REORDER:{move_id:e.move_id,move_target_id:e.move_target_id,move_offset:e.move_offset}}]};o.ajax({type:"PATCH",contentType:"application/json",data:JSON.stringify(t),beforeSend:setMomentumAuthHeader,url:a.globals.urlRootApi+"links"}).done(function(e){}).fail(function(e,t){})}}),n.collect.QuickLinksLegacy=n.collect.QuickLinksBase.extend({localStorage:new Backbone.LocalStorage("momentum-quicklinks"),isLegacy:!0,fetch:function(e){return Backbone.Collection.prototype.fetch.call(this,e)},createOrderGaps:function(){var t=100;this.each(function(e){e.save({order:t},{silent:!0}),t+=100})},reorderItem:function(e){var t=this.get(e.move_id),i=this.get(e.move_target_id),n=0<e.move_offset?1:-1,s=this.indexOf(i),l=1;if(0<=s+n&&s+n<this.length){var a=this.at(s+n);(l=Math.abs(a.get("order")-i.get("order")))<=20&&(this.createOrderGaps(),l=Math.abs(a.get("order")-i.get("order")))}var o=i.get("order")+Math.ceil(l/2)*n;t.save({order:o},{silent:!0})}}),n.views.QuickLinks=Backbone.View.extend({attributes:{id:"quicklinks",class:"app-container"},offline:!0,initialFetchStarted:!1,events:{"click .toggle":"toggleShow","click .more-links .toggle":"toggleShowMore","click a":"handleClick","keypress #new-title":"createLink","keypress #new-url":"createLink","click .new-toggle":"showAdd","click .new-hide":"hideAdd","click .retry":"retryConnection","click .retry-add":"retryAdd","click .new":"inputsClicked",dragover:"dragover",dragend:"dragend",drop:"drop"},initialize:function(e){this.subViews=[],_.bindAll(this,"addOne","addAll","dragover","dragend","li_index"),this.renderedOnce=!1,this.name=this.options.name,this.linksOpenKey=this.name+"Open",this.team=this.options.team,this.template=this.team?n.templates.teamlinks:n.templates.quicklinks,this.linksLimit=5,this.logo=this.options.logo,this.attributes.id=this.options.id,this.$el.addClass(this.options.class),this.listenTo(a,"globalEvent:click globalEvent:esc",this.hidePopup),this.listenTo(a,"globalEvent:toggleQuickLinks",this.toggleShow),this.listenTo(this.collection,"remove",this.checkOptionalLinks),this.listenTo(this.collection,"add",this.added),this.listenTo(this.collection,"reset refresh",this.collectionReset),this.listenTo(this.collection,"error",this.collectionError),this.listenTo(a.models.customization,"change:linksVisible",this.visibleChanged),this.listenTo(a.models.customization,"change:linksKeepOpen",this.keepOpenChanged),this.listenTo(a.models.bookmarksSettings,"change:appsLocation",this.checkOptionalLinks),this.listenTo(a.models.bookmarksSettings,"change:chromeTabLocation",this.checkOptionalLinks);var t=this;this.render(),this.doFetchIfNeeded(),this.team&&(this.listenTo(a.models.teamInfo,"change",function(){var e=a.models.teamInfo.get("team").TeamLogoUrl;e!==t.logo&&(t.logo=e,t.$el.find(".team-logo").attr("src",e))}),this.showBase()),void 0!==getBrowser().topSites?o.ajax({url:"chrome://favicon/size/16@2x/http://notfoundurl.com"}).done(function(e){t.notFoundIcon=e}):this.notFoundIcon=""},checkOptionalLinks:function(){var i=this;this.$el.find("li").removeClass("first-link"),this.$el.find(".optional-link").each(function(e,t){i.checkInclusion(t)}),this.$el.find(".optional-link.show").first().addClass("first-link"),0==this.$el.find(".first-link").length&&this.$el.find("li").not(".optional-link").not(".placeholder").first().addClass("first-link"),i.toggleEmptyState(i.checkEmpty())},checkEmpty:function(){return 0==this.$el.find(".optional-link.show").length&&0==this.collection.size()},toggleEmptyState:function(e){this.$el.toggleClass("is-empty",e),this.hideAdd()},checkInclusion:function(e){var t=a.models.bookmarksSettings,i=o(e);i.toggleClass("show",t.get(i.attr("data-momo-id")+"Location")==i.attr("data-place"))},render:function(){return this.$placeholder=o("<li></li>").addClass("placeholder"),this.$placeholder.appendTo(this.el),this.$placeholder.hide(),this.isChrome=isChrome(),this.$el.hasClass("app")&&(this.$el.css("height","auto"),this.$el.css("width","auto"),this.$el=this.$el.closest(".quicklinks")),this.$app=this.$el.find(".app"),this.team?this.$el.html(this.template(this)):this.$(".app").html(this.template(this)),this.$connectionMessage=this.$(".message"),this.$connectionMessage.show(),this.$more=this.$(".more-links"),this.$baseLinks=this.$("ol").first(),this.$el.hasClass("app")?this.$app=this.$el:this.$app=this.$el.find(".app"),this.$app.css("height","auto"),this.$otherLinks=this.$app.find("ol"),this.$connectionmessage=this.$el.find(".connection-message"),this.$connectionmessage.show(),this.renderedOnce=!0,a.models.customization.get("linksKeepOpen")&&"true"===localStorage.getItem(this.linksOpenKey)&&this.showPopup(),this},destroy:function(){this.remove(),this.unbind()},keepOpenChanged:function(e){this.hidePopup()},visibleChanged:function(e){a.models.customization.get("linksVisible")?this.renderedOnce?this.$el.mFadeIn():this.render():this.$el.mFadeOut()},doFetch:function(){this.initialFetchStarted=!0,this.collection.fetch({reset:!0})},doFetchIfNeeded:function(){this.initialFetchStarted||this.doFetch()},collectionError:function(e,t,i){200!==t.status?this.failedConnection():this.successfulConnection()},showAdd:function(e){e.preventDefault(),e.stopPropagation();var t=this.$el.find(".new");t.is(":visible")||t.show(),o(e.target).hasClass("empty-toggle")&&o(e.target).css({opacity:0}),t.is(".open")||t.addClass("open"),this.$el.find(".new-title").attr("placeholder","Name").focus()},hideAdd:function(){this.$el.find(".new").removeClass("open"),this.$el.find(".new-title").val("").attr("placeholder","New Link"),this.$el.find(".new-url").val(""),this.checkEmpty()&&this.$el.find(".empty-toggle").css({opacity:1})},inputsClicked:function(e){e.stopPropagation()},retryConnection:function(e){e.preventDefault(),e.stopPropagation(),this.collection.fetch({reset:!0})},collectionReset:function(){this.addAll()},revealConnectionError:function(){this.$connectionMessage.mShow(),this.$el.addClass("show-message")},dismissConnectionError:function(){this.$connectionMessage.mHide(),this.$el.removeClass("show-message")},added:function(e){this.addOne(e),this.checkOptionalLinks()},addOne:function(e){var t=new n.views.QuickLink({model:e,parent:this});this.subViews.push(t);var i=null;this.team&&this.linksLimit>this.$baseLinks.children().length?i=this.$baseLinks:(i=this.$otherLinks,this.team&&!this.moreIsSet&&(this.$more.addClass("active"),this.$more.css("top",30+this.$el.outerHeight(!0)-this.$more.outerHeight(!0)/2+"px"))),i.append(t.render().$el)},addAll:function(){this.offline=!1,_.each(this.subViews,function(e){e&&e.destroy&&e.destroy()}),this.subViews=[],this.collection.each(this.addOne),this.successfulConnection(),this.checkOptionalLinks()},successfulConnection:function(){this.$el.find(".new").show(),this.dismissConnectionError()},failedConnection:function(e){var t=e?"retry-add":"retry";this.$connectionMessage.html('<span class="title">Trouble connecting…</span><span class="action '+t+'">Retry</span>'),this.revealConnectionError()},retryAdd:function(e){this.addLink()},createLink:function(e){13==e.keyCode&&this.addLink()},addLink:function(e){var t=this.$el.find("#new-title")[0].value,i=this.$el.find("#new-url")[0].value,n=this;if(!t)return this.$el.find("#new-title").addClass("pulse"),void _.delay(function(){n.$el.find("#new-title").removeClass("pulse")},1e3);if(!i)return this.$el.find("#new-url").addClass("pulse"),void _.delay(function(){n.$el.find("#new-url").removeClass("pulse")},1e3);if(this.offline)this.failedConnection(!0);else{var s=!1;/^chrome|chrome-extension|chrome-search:\/\//i.test(i)&&(s=!0),i=ensureUrlScheme(i),a.sendEvent("Quick Links","Add");var l=0;if(0<this.collection.length)l=this.collection.max(function(e){return e.get("order")}).get("order")+100;this.collection.create({title:t,url:i,local:s,order:l},{wait:!0,success:function(){n.successfulConnection(),n.$el.find(".new").addClass("open"),n.$el.find(".new input").val(""),n.$el.find(".new-title").attr("placeholder","Name").focus()},error:function(e,t,i){n.failedConnection(!0)}})}},dragover:function(e){return e.preventDefault(),e.stopPropagation(),!(e.originalEvent.dataTransfer.dropEffect="move")},drop:function(e){e.preventDefault(),e.stopPropagation()},dragend:function(e){return e.originalEvent.dataTransfer.dropEffect="move",e.preventDefault(),e.stopPropagation(),"quicklink"==this.dragmode&&(this.dragging.$el.show(),this.$placeholder.hide(),this.collection.trigger("reorder",{move_id:this.dragging.model.id,move_target_id:this.move_target_id,move_offset:this.move_offset})),this.checkOptionalLinks(),!1},toggleShowMore:function(e){this.toggleShow(e,!0)},toggleHandler:function(e){this.toggleShow(e)},toggleShow:function(e,t){this.team&&!t||(this.$el.hasClass("show")?this.forceHidePopup():this.showPopup(),this.doFetchIfNeeded(),this.setMaxWidgetHeight())},showBase:function(e){this.doFetchIfNeeded(),this.setMaxWidgetHeight()},showPopup:function(){this.$el.addClass("show").outerWidth(),this.$el.addClass("show-fade-in"),localStorage.setItem(this.linksOpenKey,"true")},forceHidePopup:function(){var t=this;this.hideAdd(),this.$el.removeClass("show-fade-in").one("transitionend webkitTransitionEnd",function(e){t.$el.removeClass("show")}),localStorage.setItem(this.linksOpenKey,"false")},hidePopup:function(e){e!=this&&(e&&e.originalEvent&&"click"==e.type&&e.target&&o.contains(this.$el[0],e.target)||(this.$el.find(".new").is(".open")?this.hideAdd():this.$el.hasClass("show")&&!a.models.customization.get("linksKeepOpen")&&this.forceHidePopup()))},handleClick:function(e){e.stopPropagation(),e.preventDefault();var t=e.currentTarget.href;a.models.bookmarksSettings.get("openInNewTab")||e.metaKey?getBrowser().tabs.create({url:t}):getBrowser().tabs.update({url:t})},li_index:function(e){return this.$("li").index(e)},urlInvalid:function(){var e=this;this.$el.find("#new-url").addClass("pulse"),_.delay(function(){e.$el.find("#new-url").removeClass("pulse")},1e3)},setMaxWidgetHeight:function(){var e=o(window).height()-125;this.$app.css("max-height",e)},checkUsageHint:function(){var e=a.models.customization.get("linksHintHidden");this.offline||e?this.$el.find(".link-hint").hide():this.$el.find(".link-hint").show()}}),n.views.QuickLink=Backbone.View.extend({tagName:"li",template:n.templates["quicklinks-item-template"],events:{"keypress .todo-input":"updateOnEnter","click .destroy":"delete",dragstart:"dragstart",dragenter:"dragenter","click a":"handleClick"},initialize:function(e){_.bindAll(this,"dragstart","dragenter"),this.parent=e.parent,this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"change:archive destroy",this.remove)},render:function(){var i=this,n=this.model.get("url");this.moreIsSet=!1;var s=new Image,l=getFavIcon(n);return this.loadLink(!1),isChrome()?getBrowser().permissions.contains(a.models.bookmarksSettings.permissions,function(e){if(e){var t="chrome://favicon/size/16@2x/"+n;o.ajax({url:t}).done(function(e){e===i.parent.notFoundIcon?s.src=l:i.loadLink(t)})}else s.src=l}):s.src=l,s.onload=function(){i.loadLink(l)},i},loadLink:function(e){var t={title:a.utils.captionFormatter(this.model.get("title")),url:this.model.get("url"),local:this.model.get("local"),favicon_url:e,team:this.parent.team};this.$el.html(this.template(t)),this.$el.prop("draggable","true")},destroy:function(){this.remove(),this.unbind()},delete:function(e){e.stopPropagation(),a.sendEvent("Quick Links","Delete"),this.model.destroy()},dragstart:function(e){e.originalEvent.dataTransfer.effectAllowed="move",e.originalEvent.dataTransfer.setData("text","dummy"),this.parent.dragmode="quicklink",this.parent.dragging=this},dragenter:function(e){if("quicklink"==this.parent.dragmode){this.parent.dragging.$el.hide(),this.parent.li_index(this.parent.$placeholder)<this.parent.li_index(this.$el)?(this.$el.after(this.parent.$placeholder),this.parent.move_target_id=this.model.id,this.parent.move_offset=1):(this.$el.before(this.parent.$placeholder),this.parent.move_target_id=this.model.id,this.parent.move_offset=-1);var t=this.parent.$placeholder;this.parent.$placeholder.css("display","list-item"),t.height(this.$el.height()),t.after(this.parent.dragging.$el)}},handleClick:function(e){e.stopPropagation(),e.preventDefault(),a.models.bookmarksSettings.get("openInNewTab")||e.metaKey?getBrowser().tabs.create({url:e.currentTarget.href}):getBrowser().tabs.update({url:e.currentTarget.href})},updateOnEnter:function(e){13==e.keyCode&&this.close(o(e.currentTarget).data("field"))}}),n.styles.style(),n};m.addinManager&&m.addinManager.registerAddinFn("3b23bf88-bde9-40df-bfca-bf20add886c9",fn_addin);