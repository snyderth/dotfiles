var fn_addin=function(a,s,e){var r=r||{};return r.styles=r.styles||{},r.commands=r.commands||{},r.dependencies=e||r.dependencies||{},r.styles.style=function(){},r.views=r.views||{},r.collect=r.collect||{},r.models=r.models||{},r.templates=r.templates||{},r.templates=r.templates||{},r.templates["introduction-button-template"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var o;return'<button class="button">'+this.escapeExpression("function"==typeof(o=null!=(o=t.value||(null!=e?e.value:e))?o:t.helperMissing)?o.call(e,{name:"value",hash:{},data:i}):o)+"</button>"},useData:!0}),r.templates["introduction-content-template"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var o;return'<div class="prompt">\n\t<div class="question"><span class="question-title">'+this.escapeExpression("function"==typeof(o=null!=(o=t.message||(null!=e?e.message:e))?o:t.helperMissing)?o.call(e,{name:"message",hash:{},data:i}):o)+'</span></div>\n\t<div class="tip"></div>\n</div>\n<div class="buttons"></div>\n'},useData:!0}),r.templates["introduction-template"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<p class="logo"><img src="img/logo-white.svg"></p>\n<p class=content></p>\n'},useData:!0}),r.templates["introduction-tip-template"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var o;return"<div>"+this.escapeExpression("function"==typeof(o=null!=(o=t.value||(null!=e?e.value:e))?o:t.helperMissing)?o.call(e,{name:"value",hash:{},data:i}):o)+"</div>"},useData:!0}),r.styles=r.styles||{},r.styles.style=function(){var e=document.createElement("style");e.type="text/css",e.innerHTML=".intro,.intro .buttons,.intro .tip,.intro input{text-align:center}.intro .input,.intro input{color:#fff;font-weight:500;outline:0}.intro{height:100%;opacity:0;background:url(../img/overlay-center.png) center center no-repeat;background-size:cover;line-height:1.7em}.intro input{width:50%;margin:0 auto;padding-top:15px;display:block;background:0;border:0;border-bottom:3px solid #fff}.intro p{margin:0}.intro .logo{padding-top:20px}.intro img{width:80px;border-radius:100%;box-shadow:0 0 50px rgba(0,0,0,.1)}.intro .tip{margin:2rem 20px 0;font-size:17px;line-height:1.5;white-space:normal}.intro .tip a{text-decoration:underline}.intro .buttons{width:100%;position:absolute;bottom:0;font-size:18px}.intro .button{margin-left:18px;padding:12px;font-size:83.33333%}.intro .prompt{height:150px;position:absolute;top:50%;right:0;left:0;transform:translateY(-50%)}.intro .question{line-height:120%;white-space:normal}.intro .input{min-width:50%;max-width:90%;margin:0 auto;padding-top:15px;display:inline-block!important;border-bottom:3px solid #fff;line-height:normal;overflow:hidden}.intro .loading-icon{vertical-align:baseline}",document.getElementsByTagName("head")[0].appendChild(e)},r.views.ExpandableInput=Backbone.View.extend({attributes:{class:"width-dynamic input",spellcheck:"false"},tagName:"input",initialize:function(){},render:function(){function t(e){var t=e.val()||e.text()||e.attr("placeholder");return t||(t=""),t}this.fakeEl=s("<span>").hide().appendTo(document.body),this.fakeEl.text(t(this.$el)).css("font",this.$el.css("font"));var n=this;return this.$el.on("input",function(){n.fakeEl.text(t(n.$el)).css("font",n.$el.css("font"));var e=n.fakeEl.width();n.$el.css({width:e+20})}).trigger("input"),this}}),r.views.Introduction=Backbone.View.extend({attributes:{id:"introduction",class:"intro"},template:r.templates["introduction-template"],initialize:function(){this.activeView=null,localStorage.removeItem("doLoginOnNextLoad"),this.render()},render:function(){a.widgetManager.hideAppsExcept(".apps .full",!0);var e=(this.options.order||"append")+"To";this.$el[e]("."+this.options.region).fadeTo(0,0).html(this.template()).fadeTo(1e3,1),a.models.customization.get("displayname")?this.promptForEmail():this.promptForName()},promptForName:function(){a.sendEvent("Introduction","Name","Show"),r.views.namePrompt=new r.views.NamePrompt,this.activeView=r.views.namePrompt,this.$el.find(".content").append(r.views.namePrompt.render().$el.fadeTo(1e3,1)),this.$el.find("#introduction-input").focus()},promptForEmail:function(){r.views.emailPrompt=new r.views.EmailPrompt,this.activeView=r.views.emailPrompt,this.$el.find(".content").append(r.views.emailPrompt.render().$el.fadeTo(1e3,1)),this.$el.find("#introduction-input").focus()},promptForPasswordLogin:function(){a.sendEvent("Introduction","Password For Login","Show"),r.views.loginPasswordPrompt=new r.views.LoginPasswordPrompt,this.activeView=r.views.loginPasswordPrompt,this.$el.find(".content").append(r.views.loginPasswordPrompt.render().$el.fadeTo(1e3,1)),this.$el.find("#introduction-input").focus()},promptForPasswordCreate:function(){a.sendEvent("Introduction","Password For Create","Show"),r.views.createPasswordPrompt=new r.views.CreatePasswordPrompt,this.activeView=r.views.createPasswordPrompt,this.$el.find(".content").append(r.views.createPasswordPrompt.render().$el.fadeTo(1e3,1)),this.$el.find("#introduction-input").focus()},promptForPasswordReset:function(){a.sendEvent("Introduction","Password For Reset","Show"),r.views.resetPasswordPrompt=new r.views.ResetPasswordPrompt,this.activeView=r.views.resetPasswordPrompt,this.$el.find(".content").append(r.views.resetPasswordPrompt.render().$el.fadeTo(1e3,1)),this.$el.find("#introduction-input").focus()},doneIntroductionWithMessage:function(){var e=this;this.handledDone||(this.handledDone=!0,localStorage.removeItem("doLoginOnNextLoad"),a.readyForWidgets=!0,a.trigger("readyForWidgets"),this.$el.fadeTo(1e3,0,function(){a.appView.render(!0,function(){a.widgetManager.showApps(!0)}),e.destroy()}))},showLoading:function(){var e=this.$el.find(".tip"),t=0;e.html()&&(t=500),e.fadeTo(t,0,function(){e.html('<div class="loading"><span class="loading-icon"></span>Loading...</div>').css("opacity","0").fadeTo(500,1)})},hideLoading:function(){},destroy:function(){this.undelegateEvents(),this.$el.removeData().unbind(),this.remove()}}),r.views.NamePrompt=Backbone.View.extend({tagName:"span",template:r.templates["introduction-content-template"],events:{"keydown input":"updateOnEnter"},render:function(){var e={message:"Hello, what's your name?"};this.$el.html(this.template(e));var t=new r.views.ExpandableInput;this.$(".question").after(t.render().$el),t.$el.attr("id","introduction-input");var n=this;return setTimeout(function(){var e=n.$el.find(".question-title").outerWidth();n.$el.find(".input").css({"min-width":e}).focus()},10),this},updateOnEnter:function(e){13!=e.keyCode&&9!=e.keyCode||(e.preventDefault(),this.save())},save:function(){a.sendEvent("Introduction","Name","Submit");var e=this,t=this.$el.find("input")[0].value.trim();t.length<1||(a.models.customization.save({displayname:t}),this.$el.fadeTo(1e3,0,function(){e.remove(),r.views.introduction.promptForEmail()}))}}),r.views.EmailPrompt=Backbone.View.extend({tagName:"span",template:r.templates["introduction-content-template"],events:{"keydown .input":"updateOnEnter"},initialize:function(){this.listenTo(a,"globalEvent:esc",this.handleBack),this.loading=!1},render:function(){var e=this,t={message:"What's your email, "+a.models.customization.get("displayname")+"?"},n=new r.views.IntroductionButton({value:"Stay logged out",clicked:function(){return e.stayOffline()}});this.$el.html(this.template(t)),this.$el.find(".buttons").append("Or would you rather stay logged out?").append(n.render().$el);var i=new r.views.ExpandableInput;this.$el.find(".question").after(i.render().$el),i.$el.attr("id","introduction-input");var o=this;return setTimeout(function(){var e=o.$el.find(".question-title").outerWidth();o.$el.find(".input").css({"min-width":e}).focus()},10),this},handleBack:function(e){a.sendEvent("Introduction","Email","Escape Pressed"),this.stayOffline()},updateOnEnter:function(e){13!==e.keyCode&&9!==e.keyCode||(e.preventDefault(),this.checkEmail())},stayOffline:function(){a.widgetManager.hideAppsExcept(".apps .full",!0),a.sendEvent("Introduction","Email","Stay Offline Clicked"),localStorage.stayOffline=!0,r.views.introduction.doneIntroductionWithMessage()},checkEmail:function(){a.sendEvent("Introduction","Email","Submit");var n=this,e=this.$el.find(".input").val().trim();if(e&&!(e.length<1))if(validateEmail(e))n.loading||(n.loading=!0,localStorage.email=e,r.views.introduction.showLoading(),s.ajax({type:"GET",beforeSend:function(e){e.overrideMimeType("application/text")},url:a.globals.urlRootApi+"user-search?email="+encodeURIComponent(e)}).done(function(e){n.$el.fadeTo(1e3,0,function(){n.remove(),r.views.introduction.promptForPasswordLogin()}),r.views.introduction.hideLoading(),n.loading=!1}).fail(function(e,t){404===e.status?(n.$el.fadeTo(1e3,0,function(){n.remove(),r.views.introduction.promptForPasswordCreate()}),n.loading=!1,r.views.introduction.hideLoading()):(n.loading=!1,n.$el.find(".tip").html('<div class="loading">Sorry, we\'re having trouble connecting to our server. Please try again.</div>').css("opacity","0").fadeTo(500,1))}));else{var t=new r.views.IntroductionTip({value:"Sorry, "+e+" doesn't seem to be a valid email address. Please try again."});this.$el.find(".tip").html(t.render().$el.fadeTo(500,1))}}}),r.views.LoginPasswordPrompt=Backbone.View.extend({tagName:"span",template:r.templates["introduction-content-template"],events:{"keydown input":"updateOnEnter"},initialize:function(){this.listenTo(a,"globalEvent:esc",this.handleBack),this.loading=!1},render:function(){var e=this,t={message:"What's your password?"},n=new r.views.IntroductionButton({value:"Use a different email address",clicked:function(){return e.changeEmail()}}),i=new r.views.IntroductionButton({value:"Change your password",clicked:function(){return e.resetPassword()}});this.$el.html(this.template(t)),this.$el.find(".buttons").append(n.render().$el),this.$el.find(".buttons").append(i.render().$el);var o=new r.views.ExpandableInput;this.$el.find(".question").after(o.render().$el),o.$el.attr("id","introduction-input"),this.$el.find(".input").attr("type","password").focus();var a=this;return setTimeout(function(){var e=a.$el.find(".question-title").outerWidth();a.$el.find(".input").css({"min-width":e}).focus()},10),this},handleBack:function(e){a.sendEvent("Introduction","Password For Login","Escape Pressed"),this.changeEmail(e)},updateOnEnter:function(e){13!=e.keyCode&&9!=e.keyCode||this.login()},changeEmail:function(e){a.sendEvent("Introduction","Password For Login","Change Email Clicked");var t=this;t.$el.fadeTo(1e3,0,function(){t.remove(),r.views.introduction.promptForEmail()})},resetPassword:function(e){a.sendEvent("Introduction","Password For Login","Reset Password Clicked");var t=this;t.$el.fadeTo(1e3,0,function(){t.remove(),r.views.introduction.promptForPasswordReset()})},login:function(){a.sendEvent("Introduction","Password For Login","Submit");var i=this,e=localStorage.email,t=this.$el.find("input")[0].value;if(t.length<6){var n=new r.views.IntroductionTip({value:"Passwords need to be at least 6 characters long."});i.$el.find(".tip").html(n.render().$el.fadeTo(500,1))}else i.loading||(i.loading=!0,r.views.introduction.showLoading(),s.ajax({type:"POST",contentType:"application/json",data:JSON.stringify({username:e,password:t}),beforeSend:setMomentumAuthHeader,url:a.globals.urlRootLogin+"user/authenticate"}).done(function(e){i.loading=!1,e.token&&(a.commandManager.execute("notification.dismiss"),localStorage.token=e.token,e.token_uuid&&(localStorage.token_uuid=e.token_uuid),e.features&&a.conditionalFeatures.setFeatures(e.features),a.widgetManager.hideAppsExcept(".apps .full",!0),a.trigger("user:successfulLogin",function(){localStorage.setItem("loggedIn",Date.now()),r.views.introduction.doneIntroductionWithMessage()}),r.views.introduction.hideLoading())}).fail(function(e,t){if(400===e.status||401===e.status){var n=new r.views.IntroductionTip({value:"The password you entered for the email "+localStorage.email+" isn't right."});i.$el.find(".tip").html(n.render().$el.fadeTo(500,1)),i.loading=!1,r.views.introduction.hideLoading()}else i.loading=!1,i.$el.find(".tip").html('<div class="loading">Sorry, we\'re having trouble connecting to our server. Please try again.</div>').css("opacity","0").fadeTo(500,1)}))}}),r.views.CreatePasswordPrompt=Backbone.View.extend({tagName:"span",template:r.templates["introduction-content-template"],events:{"keydown input":"updateOnEnter"},initialize:function(){this.listenTo(a,"globalEvent:esc",this.handleBack),this.loading=!1},render:function(){var e=this,t={message:"Please choose a password."},n=new r.views.IntroductionButton({value:"Use a different email address",clicked:function(){return e.changeEmail()}});this.$el.html(this.template(t));var i=new r.views.ExpandableInput;this.$el.find(".question").after(i.render().$el),i.$el.attr("id","introduction-input"),this.$el.find("input").attr("type","password").focus(),this.$el.find(".buttons").append(n.render().$el),this.$(".tip").html('Your privacy is important. Learn more about how we&lsquo;re protecting you in our <a href="https://momentumdash.com/terms" target="_blank">Terms</a> and <a href="https://momentumdash.com/privacy" target="_blank">Privacy</a> policies.');var o=this;return setTimeout(function(){var e=o.$el.find(".question-title").outerWidth();o.$el.find(".input").css({"min-width":e}).focus()},10),this},updateOnEnter:function(e){13!=e.keyCode&&9!=e.keyCode||this.create()},handleBack:function(e){a.sendEvent("Introduction","Password For Create","Escape Pressed"),this.changeEmail(e)},changeEmail:function(e){a.sendEvent("Introduction","Password For Create","Change Email Clicked");var t=this;t.$el.fadeTo(1e3,0,function(){t.remove(),r.views.introduction.promptForEmail()})},create:function(){a.sendEvent("Introduction","Password For Create","Submit");var o=this,e=localStorage.email,t=this.$el.find("input")[0].value;if(t.length<6){var n=new r.views.IntroductionTip({value:"Passwords need to be at least 6 characters long."});o.$el.find(".tip").html(n.render().$el.fadeTo(500,1))}else o.loading||(o.loading=!0,r.views.introduction.showLoading(),s.ajax({type:"POST",contentType:"application/json",beforeSend:setMomentumAuthHeader,data:JSON.stringify({name:a.models.customization.get("displayname"),email:e,password:t,version:a.globals.version}),url:a.globals.urlRootLogin+"user/register"}).done(function(e){e.token?(localStorage.token=e.token,e.token_uuid&&(localStorage.token_uuid=e.token_uuid),e.features&&a.conditionalFeatures.setFeatures(e.features)):e.first_time_key&&(localStorage.first_time_key=e.first_time_key,localStorage.next_login_attempt=Date.now(),e.token_uuid&&(localStorage.token_uuid=e.token_uuid)),a.widgetManager.hideAppsExcept(".apps .full",!0),r.views.introduction.doneIntroductionWithMessage()}).fail(function(e,t){var n="An error occurred during registration - please try again shortly.";e.responseJSON&&e.responseJSON.msg&&(n=e.responseJSON.msg);var i=new r.views.IntroductionTip({value:n});o.$el.find(".tip").html(i.render().$el.fadeTo(500,1))}).always(function(){r.views.introduction.hideLoading(),o.loading=!1}))}}),r.views.ResetPasswordPrompt=Backbone.View.extend({tagName:"span",template:r.templates["introduction-content-template"],events:{"keydown input":"updateOnEnter"},initialize:function(){this.listenTo(a,"globalEvent:esc",this.handleBack),this.loading=!1},render:function(e){var t=this,n={message:"What would you like your new password to be?"},i=new r.views.IntroductionButton({value:"Use a different email address",clicked:function(){return t.changeEmail()}});this.$el.html(this.template(n));var o=new r.views.ExpandableInput;this.$el.find(".question").after(o.render().$el),o.$el.attr("id","introduction-input"),this.$el.find(".buttons").append("Changing password for "+localStorage.email).append(i.render().$el),this.$el.find("input").attr("type","password").focus();var a=this;return setTimeout(function(){var e=a.$el.find(".question-title").outerWidth();a.$el.find(".input").css({"min-width":e}).focus()},10),this},handleBack:function(e){a.sendEvent("Introduction","Password For Reset","Escape Pressed"),this.changeEmail(e)},changeEmail:function(e){a.sendEvent("Introduction","Password For Reset","Change Email Clicked");var t=this;t.$el.fadeTo(1e3,0,function(){t.remove(),r.views.introduction.promptForEmail()})},updateOnEnter:function(e){13!=e.keyCode&&9!=e.keyCode||this.reset()},reset:function(){a.sendEvent("Introduction","Password For Reset","Submit");var n=this,e=localStorage.email,t=this.$el.find("input")[0].value;if(t.length<6){var i=new r.views.IntroductionTip({value:"Passwords need to be at least 6 characters long."});n.$el.find(".tip").html(i.render().$el.fadeTo(500,1))}else n.loading||(n.loading=!0,r.views.introduction.showLoading(),s.ajax({type:"POST",contentType:"application/json",data:JSON.stringify({name:a.models.customization.get("displayname"),email:e,password:t}),beforeSend:setMomentumAuthHeader,url:a.globals.urlRootLogin+"user/forgot"}).done(function(e){a.commandManager.execute("notification.show","Password change started","Check your email to change your password. Your password change email may take a few moments to arrive."),a.widgetManager.hideAppsExcept(".apps .full",!0),r.views.introduction.doneIntroductionWithMessage()}).fail(function(e,t){n.$el.find(".tip").html('<div class="loading">Sorry, we\'re having trouble connecting to our server. Please try again.</div>').css("opacity","0").fadeTo(500,1)}).always(function(){n.loading=!1,r.views.introduction.hideLoading()}))}}),r.views.IntroductionTip=Backbone.View.extend({template:r.templates["introduction-tip-template"],render:function(){var e={value:this.options.value};return this.setElement(s(s.trim(this.template(e)))),this}}),r.views.IntroductionButton=Backbone.View.extend({template:r.templates["introduction-button-template"],events:{click:"clicked"},render:function(){var e={value:this.options.value};return this.setElement(s(s.trim(this.template(e)))),this},clicked:function(e){this.options.clicked()}}),r.styles.style(),r.views.introduction=new r.views.Introduction({region:"full"}),r};m.addinManager&&m.addinManager.registerAddinFn("986f6801-ce61-46f7-b309-06daa735dd7f",fn_addin);