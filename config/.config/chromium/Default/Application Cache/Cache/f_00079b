/**** v5.3.14, build: 03/21/2018 ****/
!function(e,t){function n(){this.anchorPoint=void 0;this.reverse=!1;this.points=[]}function a(e,t){if(a.hooks[e])return t?a.hooks[e].apply(null,t):a.hooks[e].apply();if(0===e.indexOf("draw.")||0===e.indexOf("place.")){yt(e);return!0}var r=a.wildcardHooks;for(var n in r)if(new RegExp(n).test(e))return r[n](e,t);return!1}function o(e){return navigator.userAgent.indexOf(e)}function c(e,t){this.x=+e||0;this.y=+t||0}function d(e){return e?t.getElementById(e):null}function h(e,r){if(!e||"#"==e)return[];try{return(r||t).querySelectorAll(e)}catch(e){return[]}}function u(e,r){if(!e||"#"==e)return null;try{return(r||t).querySelector(e)}catch(e){return null}}function p(e,t,r){if(e&&t){var n,i,a,o,s;a=t?t.split(/\s+/):[],s=r?"add":!1===r?"remove":"toggle";if(e.classList&&e.classList.toggle)for(n=0;n<a.length;n++)a[n]&&e.classList[s](a[n]);else{var l="object"==typeof e.className,c=l?e.className.baseVal:e.className;i=c?c.split(/\s+/):[];for(n=0;n<a.length;n++)if(a[n]){o=i.indexOf(a[n]);o<0?"remove"!=s&&i.push(a[n]):"add"!=s&&i.splice(o,1)}c=i.join(" ");l?e.className.baseVal=c:e.className=c}}}function f(e,t){if(e.classList)return e.classList.contains(t);var r="object"==typeof e.className?e.className.baseVal:e.className;return t&&r&&r.split(/\s+/).indexOf(t)>=0}function g(e,t){if(e&&t){var r,n=t?t.split(/\s+/):[];if(e.classList)for(r=0;r<n.length;r++)n[r]&&e.classList.add(n[r]);else{var i="object"==typeof e.className,a=i?e.className.baseVal:e.className,o=a?a.trim().split(/\s+/):[];for(r=0;r<n.length;r++)n[r]&&o.indexOf(n[r])<0&&o.push(n[r]);a=o.join(" ");i?e.className.baseVal=a:e.className=a}}}function y(e,t){var r,n,i=t?t.split(/\s+/):[];if(e.classList)for(r=0;r<i.length;r++)i[r]&&e.classList.remove(i[r]);else{var a="object"==typeof e.className,o=a?e.className.baseVal:e.className,s=o?o.trim().split(/\s+/):[];for(r=0;r<i.length;r++){n=s.indexOf(i[r]);n>=0&&s.splice(n,1)}o=s.join(" ");a?e.className.baseVal=o:e.className=o}}function v(e){if(e&&e.parentNode)return e.parentNode.removeChild(e)}function m(e,t,r){if(!e)return null;var n,i,a,o,s=arguments.length;if(e.tagName){if("string"==typeof t){if(2===s)return e.getAttribute(t);if(t.indexOf(":")>0){i=t.substr(0,t.indexOf(":"));if(i in Mn){a=t.substr(i.length+1);ni?e.setAttributeNS(Mn[i],t,r):e.setAttributeNS(Mn[i],a,r)}}else{e.setAttribute(t,r);if(""===r||null===r||void 0===r){"transform"===t&&e.setAttribute(t,"");e.removeAttribute(t)}}return e}for(n in t)if(A(t,n))if(n.indexOf(":")>0){i=n.substr(0,n.indexOf(":"));if(i in Mn){a=n.substr(i.length+1);""===t[n]?e.hasAttributeNS(Mn[i],a)&&e.removeAttributeNS(Mn[i],a):ni?e.setAttributeNS(Mn[i],n,t[n]):e.setAttributeNS(Mn[i],a,t[n])}}else if(""===t[n]){if(e.hasAttribute(n)){"transform"===n&&e.setAttribute(n,"");e.removeAttribute(n)}}else e.setAttribute(n,t[n]);return e}if(Array.isArray(e)||e instanceof NodeList||e instanceof HTMLCollection||ti&&"number"==typeof e.length){if("string"==typeof t&&2==s)return e[0]?m(e[0],t):null;if(2==s)for(o=0;o<e.length;o++)m(e[o],t);else if(s>=3)for(o=0;o<e.length;o++)m(e[o],t,r);return e}}function x(e,t){e&&e.removeAttribute&&e.removeAttribute(t)}function _(e){return e?ai.toFixed(e.x,1)+"_"+ai.toFixed(e.y,1):""}function P(e){var t,r,n;for(t=e.childNodes,r=t.length-1,n="";r>=0;r--){n=t[r].tagName;if(!n||n.indexOf(":")>0||"script"===n||"metadata"===n)e.removeChild(t[r]);else{S(t[r]);t[r].childNodes.length>0&&"text"!==n&&"tspan"!==n&&P(t[r])}}}function S(e){var t,r=e.attributes,n=r.length,i={};for(t=n-1;t>=0;t--)if(r[t].nodeName.indexOf(":")>0){var a=r[t].namespaceURI;r[t].localName;if(a in Mn){if(!1===/^c:|^xlink:|^xml:|^xmlns:/.test(r[t].nodeName))try{if(a===NS_c){if(r[t].prefix!==Mn[NS_c]){i[Mn[NS_c]+":"+r[t].localName]=r[t].nodeValue;e.removeAttributeNode(r[t])}}else e.removeAttributeNode(r[t])}catch(e){parent.$.messager.alert(e.message)}}else e.removeAttributeNode(r[t])}else if(0===r[t].nodeName.indexOf("on"))try{e.removeAttributeNode(r[t])}catch(e){parent.$.messager.alert(e.description)}m(e,i)}function b(e){return t.createTextNode(e||"")}function C(r,n){if(t.createEvent)try{var i=t.createEvent("CustomEvent");i.initCustomEvent(r,!1,!0,n);return i}catch(e){}if(!Qn&&e.CustomEvent)try{return new CustomEvent(r,n)}catch(e){}throw"Your browser does not support CustomEvent"}function A(e,t){return!!e&&e.hasOwnProperty(t)}function I(e){try{return JSON.parse(e)}catch(e){return null}}function L(e){return e?JSON.parse(JSON.stringify(e)):e}function E(e,t){if(!e)return null;t=!0===t;try{var r=(new DOMParser).parseFromString(e,"text/xml");if(!r||r.querySelector("parsererror")){!t&&(parent.$||self.$).messager.error("ERROR: svg parsererror");return null}return r}catch(e){!t&&(parent.$||self.$).messager.error("ERROR: svg parsererror");return null}}function O(){for(var e=[],t=Gi.children,r=Qi==Dn.PCB||Qi==Dn.PCBLIB||Qi==Dn.PCBMODULE,n=0,i=t.length;n<i;n++){var a=t[n];if(1===a.nodeType&&a.id){if(r){var o=ai.getPCBCmdKey(a);if(!o||"RATLINE"==o)continue}e.push(a.id)}}return e}function T(){for(var e=h("[id]",Gi),t=0,r=/^[^\d]*(\d+)$/,n=0,i=e.length;n<i;n++)if(r.test(e[n].id)){var a=+RegExp.$1;a&&(t=Math.max(t,a))}return t}function w(e){return(e||"").replace(/[ ,]{2,}| /g,",").split(",")}function R(e){for(var t=[],r=w(e),n=r.length-1,i=0;i<n;i+=2)t[i/2]=new c(ai.toFixed(+r[i],3),ai.toFixed(+r[i+1],3));return t}function N(e){if(e&&e.length>=2){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(ai.toFixed(e[r].x,3),ai.toFixed(e[r].y,3));return t.join(" ")}return""}function k(){}function B(e){return Array.isArray(e)||e&&"object"==typeof e&&"[object String]"!=Object.prototype.toString.call(e)&&"number"==typeof e.length&&e.length>=0&&e.length<4294967296&&e.length%1==0}function M(e){return Array.isArray(e)}function V(e){return e?e.trim?e.trim():e.replace(/^\s+|\s+$/g,""):""}function G(e){for(var t,r=e;r!=t;){t=r;r=t.replace(/~|\^\^|#@\$|`|#sheet#/gi,"")}return r}function F(e){return!/~|\^\^|#@\$|`|#sheet#/i.test(e)}function D(e){function t(e){return r[e]}var r={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;","&":"&amp;"};return(void 0===e||null===e?"":e+"").replace(/[<>'"&]/g,t)}function H(e){function t(e){return navigator.userAgent.indexOf(e)}return t("chromeframe")>0||t("x-clock")>0?"chromeframe":t("MSIE")>0||t("Trident")>=0?"ie":t("Edge/")>0?"edge":t("Electron/")>0?"electron":t("Firefox/")>0?"firefox":0===t("Opera/")?"opera":0===t("Chrome/")?"chrome":0===t("Safari/")?"safari":"other"}function j(e,t,r){return"M"+(e-r-1)+","+(t-r-1)+"L"+(e+r+1)+","+(t+r+1)+"M"+(e-r-1)+","+(t+r+1)+"L"+(e+r+1)+","+(t-r-1)}function U(e,t){var r=+e;t="-"!=t?"+":"-";if(r<=0||isNaN(r))return"100";if(r<.1||.1==r&&"-"==t)return"0.1";if(r>1e5||1e5==r&&"+"==t)return"100000";e=r<1?(10+r+"").substr(1):r+"";e=e.replace(/([1-9]\.?\d)(.*)/,function(e,t,r){return t+r.replace(/[1-9]/g,"0")});e.match(/[1-9]$/)&&(e=e.indexOf(".")<0?e+".0":e+"0");var n,i,a=e.match(/([1-9])\.?(\d)/),o=(a[1],a[2],a[1]+a[2]),s="--,10,14,20,27,38,54,75,AA".split(",");qn&&(s="--,10,12,15,17,20,25,30,35,40,50,60,80,90,AA".split(","));for(n=1;n<s.length;n++){if(o==s[n]){i=s["+"==t?n+1:n-1];break}if(o<s[n]){i=s["+"==t?n:n-1];break}}if("AA"==i){i=s[1];e=e.replace(/([1-9])(\.?)(\d)/,i[0]+"$2"+i[1]);e=function(e){return e.indexOf(".")<0?e+"0":e.replace(/\.(\d)/,"$1.").replace(/^0+(?!\.)/,"").replace(/\.$/,"")}(e)}else if("--"==i){i=s[s.length-2];e=e.replace(/([1-9])(\.?)(\d)/,i[0]+"$2"+i[1]);e=function(e){return e.indexOf(".")<0?e.replace(/\d$/,".$&").replace(/^\./,"0."):e.replace(/(\d)\./,".$1").replace(/^\./,"0.")}(e)}else e=e.replace(/([1-9])(\.?)(\d)/,i[0]+"$2"+i[1]);return function(e){return e.indexOf(".")>0?e.replace(/\.?0*$/,""):e}(e)}function Y(e,t,r){var n=e.x,i=e.y,a=t.x,o=t.y,s=r.x,l=r.y,c=a-n,d=o-i,h=c*c+d*d,u=((s-n)*c+(l-i)*d)/h;return{x:n+u*c,y:i+u*d}}function z(e,t,r){var n=e.x,i=e.y,a=t.x,o=t.y,s=r.x,l=r.y,c=a-n,d=o-i,h=c*c+d*d,u=((s-n)*c+(l-i)*d)/h;if(!(u>=1||u<=0)){var p=n+u*c,f=i+u*d,g=p-s,y=f-l;return{point:{x:p,y:f},distance2:g*g+y*y}}}function J(e,t,r){var n=e.x,i=e.y,a=t.x,o=t.y,s=r.x,l=r.y,c=a-n,d=o-i,h=c*c+d*d;if(0===h)return(s-n)*(s-n)+(l-i)*(l-i);var u=((s-n)*c+(l-i)*d)/h,p=n+u*c,f=i+u*d,g=p-s,y=f-l;return g*g+y*y}function X(e,t,r,n){var i=e.x,a=e.y,o=t.x,s=t.y,l=r.x,c=r.y,d=n.x,h=n.y,u=o-i,p=s-a,f=l-d,g=c-h,y=p*f-u*g;return y?{x:(u*f*(c-a)-l*u*g+i*p*f)/y,y:(p*g*(l-i)-c*p*f+a*u*g)/-y}:null}function K(e,t){var r,n,i,a,o=e.x,s=e.y,l=-1,c=t.getAttribute("stroke-width")/2,d=c*c,h=t.points,u=h.numberOfItems;i=h.getItem(0);if(o==i.x&&s==i.y)return 0;for(var p=0;p<u-1;p++){i=h.getItem(p);a=h.getItem(p+1);if(o==a.x&&s==a.y)return 2*(p+1);if(i.x!=a.x||i.y!=a.y){r=z(i,a,e);if(r&&r.distance2<=d&&(void 0===n||r.distance2<n)){n=r.distance2;l=2*p+1}}}return l}function W(e,t){var r={x:+e.x,y:+e.y};gridX=t||+m(d("gridPattern"),"width"),gridY=t||+m(d("gridPattern"),"height"),modx=e.x%gridX,mody=e.y%gridY;if(!gridX||!gridY)return r;if(modx){modx<0&&(modx+=gridX);r.x+=-modx+(modx<gridX/2?0:gridX)}if(mody){mody<0&&(mody+=gridY);r.y+=-mody+(mody<gridY/2?0:gridY)}r.x=ai.toFixed(r.x,2);r.y=ai.toFixed(r.y,2);return r}function q(e,t,r){if(!t)return null;var n,i,a,o=t.length,s=null,l=t[0].x,c=t[0].y,d=l,h=c,u=e.x,p=e.y;for(n=1;n<o;n++){i=t[n].x;a=t[n].y;l>i&&(l=i);c>a&&(c=a);d<i&&(d=i);h<a&&(h=a)}if(u<l-r||p<c-r||u>d+r||p>h+r)return null;for(n=1;n<o;n++){s=Q(e,t[n-1],t[n]);if(s.d<r)return s}return null}function Q(e,t,r){var n,i,a,o,s,l,c,d=t.x,h=t.y,u=r.x,p=r.y,f=e.x,g=e.y,y=u-d,v=p-h,m=f-d,x=g-h;if(0===y&&0===v)return{d:Math.sqrt(m*m+x*x),point:{x:d,y:h}};n=(m*y+x*v)/(y*y+v*v);if(n<0)return{d:Math.sqrt(m*m+x*x),point:{x:d,y:h}};if(n>1){i=f-u;a=g-p;return{d:Math.sqrt(i*i+a*a),point:{x:u,y:p}}}l=d+n*y;c=h+n*v;o=f-l;s=g-c;return{d:Math.sqrt(o*o+s*s),point:{x:l,y:c}}}function Z(e,t,r,n){var i=r-e,a=n-t,o=Math.atan2(a,i);o=o<0?o+Math.PI+Math.PI:o;return o}function ee(e,t,r,n){var i=e-r,a=t-n;return i*i+a*a}function te(e,t,r,n){return Math.sqrt(ee(e,t,r,n))}function re(e,t,r,n){t=+t;r=+r;n=+n;if(void 0===r||void 0===n)return e.slice(0);t=oe(t);for(var i=e.slice(0),a=i.length,o=0;o<a;o++)"number"!=typeof i[o]&&(i[o]-=0);if(!Nn.hasOwnProperty(t)){Nn[t]=Math.sin(t*Math.PI/180);kn[t]=Math.cos(t*Math.PI/180)}var s=Nn[t],l=kn[t];for(o=0;o<a;o+=2){var c=i[o],d=i[o+1],h=c-r,u=d-n;i[o]=r+l*h-s*u;i[o+1]=n+l*u+s*h}return i}function ne(e,t,r,n){var i=[e.x,e.y,e.x+e.width,e.y,e.x,e.y+e.height,e.x+e.width,e.y+e.height];i=re(i,t,r,n);var a={x:Math.min(i[0],i[2],i[4],i[6]),y:Math.min(i[1],i[3],i[5],i[7])};a.width=Math.max(i[0],i[2],i[4],i[6])-a.x;a.height=Math.max(i[1],i[3],i[5],i[7])-a.y;return a}function ie(e,t){var r,n=m(e,"transform");if(!n||n.indexOf("rotate")<0)return 0;r=t?n.match(/rotate\(([\-\+]?[\d\.]+)(?:[,\s]+([\-\+]?[\d\.]+)[,\s]+([\-\+]?[\d\.]+))?\)/):n.match(/rotate\(([\-\+]?[\d\.]+).*?\)/);if(!r)return 0;var i=r[1]%360;i<0&&(i+=360);return t?{ang:i,ox:+r[2],oy:+r[3]}:i}function ae(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=e[0]-t[0],o=e[1]-t[1];return[a*i-o*n+t[0],o*i+a*n+t[1]]}function oe(e){return e<0?(360+e%360)%360:e>=360?e%360:e}function se(e,t){var r=e-t;return(r>0?r:-r)<1e-10}function le(e,t){var r=e.x-t.x,n=e.y-t.y;return(r>0?r:-r)<.001&&(n>0?n:-n)<.001}function ce(e,t){var r=e-t;return(r>0?r:-r)<.1}function de(e,t){function r(e,t){return[e[0]-t[0],e[1]-t[1]]}function n(e,t){return e[0]*t[0]+e[1]*t[1]}function i(e){return e[0]*e[0]+e[1]*e[1]}function a(e,t){return i(r(e,t))}function o(e,t,s,l,c){if(!(l<=s+1)){for(var d,h,u,p,f,g=s,y=0,v=e*e,m=[t[s],t[l]],x=r(m[1],m[0]),_=i(x,x),P=s+1;P<l;P++){d=r(t[P],m[0]);p=n(d,x);if(p<=0)f=a(t[P],m[0]);else if(_<=p)f=a(t[P],m[1]);else{u=p/_;h=[m[0][0]+u*x[0],m[0][1]+u*x[1]];f=a(t[P],h)}if(!(f<=y)){g=P;y=f}}if(y>v){c[g]=1;o(e,t,s,g,c);o(e,t,g,l,c)}}}var s,l,c,d,h=e.length,u=[],p=t*t,f=[],g=[];f[0]=e[0];for(s=l=1,d=0;s<h;s++)if(!(a(e[s],e[d])<p)){f[l++]=e[s];d=s}d<h-1&&(f[l++]=e[h-1]);g[0]=g[l-1]=1;o(t,f,0,l-1,g);for(s=c=0;s<l;s++)g[s]&&(u[c++]=f[s]);return u}function he(e,t,r){if(e&&!(t.length<=4)){for(var n,i,a=[],o=[],s=[],l=0,c=0,d=t.length;l<d;l+=2){a[c]=[t[l],t[l+1]];o[c]=t[l];s[c]=t[l+1];c++}r<0&&(r=0);if(void 0===r){n=Math.max.apply(null,o)-Math.min.apply(null,o);i=Math.max.apply(null,s)-Math.min.apply(null,s);r=Math.min(.1/ci,Math.max(.01*n,.01*i));if(!r)return}var h=de(a,r);if(2*h.length!==d){var u=h.slice(1).join(" ").replace(/,/g," ");"path"===e.tagName?m(e,"d","M"+t[0]+" "+t[1]+" L"+u):"polyline"!==e.tagName&&"polygon"!==e.tagName||m(e,"points",t[0]+" "+t[1]+" "+u)}}}function ue(e){return ai.svg.getViewBBox(e)}function pe(e,t){if(t%360==0)return"";var r=" rotate("+t+","+e.x+","+e.y+")";return 90==t?"translate("+e.height+",0)"+r:180==t?"translate("+e.width+","+e.height+")"+r:270==t?"translate(0,"+e.width+")"+r:""}function fe(e){return{x:+m(e,"x"),y:+m(e,"y"),width:+m(e,"width"),height:+m(e,"height")}}function ge(e,t){var r=ie(e),n=oe(r+(t||0));m(e,"transform",n?pe(fe(e),n):"");m(e,"c_rotation",n?360-n:0)}function ye(e){"string"==typeof e||e.tagName&&(e=m(e,"d"));return e.replace(/\,/g," ").replace(/(?=\S)([\+\-A-Z])/gi,"  $1").replace(/([A-Za-z])(?=\S)/g,"$1 ").replace(/^\s+|\s+$/g,"").split(/\s+/g)}function ve(e){var t=e.match(/M\s*([^,\sA-DF-Z]+)[,\s]+([^,\sA-DF-Z]+)/),r=e.match(/A\s*(?:[^,\sA-DF-Z]+[,\s]+){5}([^,\sA-DF-Z]+)[,\s]+([^,\sA-DF-Z]+)/);return[{x:+t[1],y:+t[2]},{x:+r[1],y:+r[2]}]}function me(e){for(var t,r=[],n=e.numberOfItems,i=0;i<n;i++){t=e.getItem(i);r[i]=new c(ai.toFixed(t.x,3),ai.toFixed(t.y,3))}return r}function xe(e){var t=Ui.getViewBox();return{x:t[0]+e.x/ci,y:t[1]+e.y/ci}}function _e(e){return Pe(e)}function Pe(e){if(e&&e.points){var t,r,n,i,a,o,s,l,c=e.points,d=c.numberOfItems;for(i=d-2;i>=0;i--){t=c.getItem(i);r=c.getItem(i+1);ce(t.x,r.x)&&ce(t.y,r.y)&&(0===i?c.removeItem(i+1):c.removeItem(i))}d=c.numberOfItems;for(i=d-2;i>=1;i--){t=c.getItem(i-1);n=c.getItem(i);r=c.getItem(i+1);if(ce(t.x,n.x)&&ce(r.x,n.x)){a=t.x+r.x+n.x;o=Math.abs(a-3*r.x);s=Math.abs(a-3*n.x);a=Math.abs(a-3*t.x);l=Math.min(a,o,s);l==a?r.x=n.x=t.x:t.x=l==o?n.x=r.x:r.x=n.x;c.removeItem(i)}else if(ce(t.y,n.y)&&ce(r.y,n.y)){a=t.y+r.y+n.y;o=Math.abs(a-3*r.y);s=Math.abs(a-3*n.y);a=Math.abs(a-3*t.y);l=Math.min(a,o,s);l==a?r.y=n.y=t.y:t.y=l==o?n.y=r.y:r.y=n.y;c.removeItem(i)}else{a=Math.atan((t.y-n.y)/(t.x-n.x));o=Math.atan((r.y-n.y)/(r.x-n.x));Math.abs(a-o)<Math.PI/180&&c.removeItem(i)}}}}function Se(e,t){var r,n,i=[],a=e.points,o=a.numberOfItems;for(n=0;n<o;n++){r=a.getItem(n);switch(t){case 1:i.push(r.x,r.y);break;case 2:i[n]=[r.x,r.y];break;default:i[n]={x:r.x,y:r.y}}}return i}function be(e){var t=fi.createSVGPoint();t.x=e.x;t.y=e.y;return t}function Ce(e){if(e&&(e.length||e.tagName)){e.tagName&&(e=[e]);var t,r,n,i,a,o=e.length;for(n=0;n<o;n++){t=m(e[n],"c_origin");if(t){r=t.split(",");return{x:+r[0],y:+r[1]}}}for(n=0;n<o;n++){a=e[n];switch(a.tagName){case"polyline":case"polygon":var s=w(m(a,"points"));if(s.length>=4)return{x:+s[0],y:+s[1]};break;case"rect":case"image":return{x:+m(a,"x"),y:+m(a,"y")};case"circle":case"ellipse":return{x:+m(a,"cx"),y:+m(a,"cy")};case"line":return{x:+m(a,"x1"),y:+m(a,"y1")}}}for(n=0;n<o;n++){a=e[n];if("path"==a.tagName&&a.pathSegList.numberOfItems){i=a.pathSegList.getItem(0);if(i&&"M"==i.pathSegTypeAsLetter)return{x:ai.toFixed(i.x,4),y:ai.toFixed(i.y,4)}}}for(n=0;n<o;n++)if("text"==e[n].tagName)return{x:+m(e[n],"x"),y:+m(e[n],"y")};for(n=0;n<o;n++)if(e[n]&&e[n].children){var l=Ce(h("*",e[n]));if(l)return l}}}function Ae(e){var t=ai.svg.getBBox(e);return{x:t.x,y:t.y}}function Ie(e){var t=bi.canvas.originX,r=bi.canvas.originY,n=Bi.getSanpSize("X"),i=Bi.getSanpSize("Y"),a=Math.round((e.x-t)/n)*n+t,o=Math.round((e.y-r)/i)*i+r;return{x:ai.toFixed(a,3),y:ai.toFixed(o,3)}}function Le(e,t,r){var n=Bi.getSanpSize("X"),i=Bi.getSanpSize("Y"),a=Ie(e);t>0&&a.x<e.x?a.x+=n:t<0&&a.x>e.x&&(a.x-=n);r>0&&a.y<e.y?a.y+=i:r<0&&a.y>e.y&&(a.y-=i);return a}function Ee(e,t,r){wi[e.tagName]&&wi[e.tagName](e,t,r)}function Oe(e,t,r){if(!e||!e.length)return!1;for(var n=0;n<e.length;n++)(wi[e[n].tagName]||k)(e[n],t,r);return!0}function Te(e,t,r){if(e&&"text"==e.tagName&&"string"==typeof t){t.indexOf("\r")>=0&&(t=t.indexOf("\n")>=0?t.replace(/\r/g,""):t.replace(/\r/g,"\n"));void 0===r&&(r="\n");var n,i,a,o="line"==m(e,"c_shapetype")||e.parentNode&&"part_annotation"==m(e.parentNode,"c_partid");if(o){n=t.split(r);i=n.length;a=i>1}else{t=t.replace(/\n/g," ");n=[t];i=1;a=!1}var s=h("tspan",e),l=s.length,c=m(e,"x");if(a){0===l&&e.childNodes[0]&&e.removeChild(e.childNodes[0]);for(;l<i;){e.appendChild(Ue("tspan",{x:c,dy:l?"1em":"0","xml:space":"preserve"}));l++}for(;l>i;){l--;s[l].parentNode.removeChild(s[l])}for(;i--;)e.childNodes[i].textContent=n[i]||" ";ni&&a&&setTimeout(function(){for(var t=h("tspan",e),r=t.length,n=0;n<r;n++)t[n].textContent=t[n].textContent},1)}else{for(;e.lastChild;)e.removeChild(e.lastChild);ai.node.setTextContent(e,t)}}}function we(e){function t(e){return ai.toFixed(e,3)+""}if(!e)return null;var r,n=e.attributes,i=n?n.length:0,a={},o=/\d+\.\d{9,}/g,s=/^(?:points|d|x|y|width|height|cx|cy|r|rx|ry|x1|y1|x2|y2|dx|dy|transform|stroke-width|viewBox|c_origin|c_rotation)/;for(r=0;r<i;r++){var l=n[r].name;l.match(/[a-z]/)||(l=l.toLowerCase());s.test(l)?a[l]=n[r].value.replace(o,t):a[l]=n[r].value}return a}function Re(t,r){if(!t)return!1;var n,i,a,o,s=[],l=e.frameElement,c=l&&l.parentNode,d=c&&"none"!=c.style.display;c&&!d&&(c.style.display="");if(t!=Gi){a=h("[c_note]",t);i=a.length;for(n=0;n<i;n++){s[n]=a[n].style.display;"none"!=s[n]&&(a[n].style.display="none")}o=ai.svg.getBBox(t);for(n=0;n<i;n++)a[n].style.display=s[n]}else{o=ai.svg.getBBox(t);if(!o.width&&!o.height){c=e.frameElement&&e.frameElement.parentNode;if(c){if(!(c.style&&"none"!=c.style.display)){c.style.display="";o=ai.svg.getBBox(t);c.style.display="none"}}}if(!o.width&&!o.height){if(ai.fileType.isLib(Qi))ke(bi.canvas.originX,bi.canvas.originY);else{var u=Ui.getViewBox();u[0]=bi.canvas.originX;u[1]=bi.canvas.originY;Ui.setViewBox(u)}return}}c&&!d&&(c.style.display="none");o&&(o.width||o.height)&&Ne(o,r)}function Ne(e,r){if(e&&(e.x||e.y||e.width||e.height)){!r||e.width||e.height||(r=0);var n=e.x+e.width/2,i=e.y+e.height/2,a=t.body.clientWidth||9,o=t.body.clientHeight||9,s=r?Math.min(a/e.width,o/e.height):ci,l=r&&isFinite(s)?U(99*s,"-"):100*ci,c=l/100,d=c!=ci,h=Ui.getViewBox();if(l<.1){l=.1;c=l/100}else if(l>1e5){l=1e5;c=l/100}h[0]=n-h[2]/2;h[1]=i-h[3]/2;Ui.setViewBox(h);di=l;ci=di/100;d&&tt("zoom",[l])}}function ke(e,t){var r=Ui.getViewBox();r[0]+=e-(r[0]+r[2]/2);r[1]+=t-(r[1]+r[3]/2);Ui.setViewBox(r)}function Be(e,t){if(e&&e.length){var r,n,i,a,o=Ui.getViewBox(),s="getBoundingClientRect";for(r=0;r<e.length;r++){n=e[r];if(n){if(n[s]){i=n[s]();if(!i.width&&!i.height)continue;i=[o[0]+i.left/ci,o[1]+i.top/ci,o[0]+i.right/ci,o[1]+i.bottom/ci]}else{i=ai.svg.getBBox(n);if(!i.width&&!i.height)continue;i=[i.x,i.y,i.x+i.width,i.y+i.height]}a=a?[Math.min(a[0],i[0]),Math.min(a[1],i[1]),Math.max(a[2],i[2]),Math.max(a[3],i[3])]:i.slice(0,4)}}if(a){Me({x:a[0],y:a[1],width:a[2]-a[0],height:a[3]-a[1]},t)}}}function Me(e,t){var r=e.x,n=e.y,i=r+e.width,a=n+e.height,o=Ui.getViewBox();t=isFinite(t)?t/ci:20/ci;r-=t;n-=t;i+=t;a+=t;var s,l;s=r<=o[0]==i>=o[0]+o[2]?0:r<=o[0]?r-o[0]:i-o[0]-o[2];l=n<=o[1]==a>=o[1]+o[3]?0:n<=o[1]?n-o[1]:a-o[1]-o[3];if(s||l){o[0]+=s;o[1]+=l;Ui.setViewBox(o)}}function Ve(){Re(Gi,1)}function Ge(e,t,r){var n,i,a,o=m(e,"c_para")||"",s=o.split("`"),l=s.length;l%2&&(s[l-1]?s[l++]="":s.length=--l);t=t.replace(/[`\^~\\"]/gi,"");for(var c=0;c<l-1;c+=2){n=s[c];i=s[c+1];if(t==n){a=1;if(r==i)return o;s[c+1]=r;break}}a||s.push(t,r);var d=s.join("`");m(e,"c_para",d);pi.updateOne(e);var h={},u={};h.c_para=o;u.c_para=d;Pi.save(["attr",e.id,h,u]);tt("updateAttrPanel");return d}function Fe(e){function t(e){var t=e.id;t?e.id="":t=ai.newId();if(t.match(/^(frame_\w*?)([_\?\d]*)$/)){var r=RegExp.$1,n=1;"_"!=r.substr(-1)&&(r+="_");t=r+n;for(;d(t);)t=r+ ++n}else for(;d(t);)t=ai.newId();e.id==t?t.match(/^gge(\d+)$/)&&+RegExp.$1>hi&&(hi=+RegExp.$1):e.id=t}t(e);[].forEach.call(h("*",e),t)}function De(e,t){for(var r,n,i,a,o=e.points,s=o.numberOfItems,l=-1,c=e.getAttribute("stroke-width"),d=c*c,h=s-1;h>=1;h--){r=function(e,t,r){var n=e.x,i=e.y,a=t.x,o=t.y,s=r.x,l=r.y,c=a-n,d=o-i,h=c*c+d*d,u=((s-n)*c+(l-i)*d)/h;if(!(u>=1||u<=0)){var p=n+u*c,f=i+u*d,g=p-s,y=f-l;return{point:{x:p,y:f},d2:g*g+y*y}}}(o.getItem(h),o.getItem(h-1),t);if(r&&r.d2<=d&&(void 0===n||n>r.d2)){n=r.d2;l=h;i=r.point.x;a=r.point.y}}if(l>=1){var u=e.viewportElement.createSVGPoint();u.x=ai.toFixed(i,2);u.y=ai.toFixed(a,2);o.insertItemBefore(u,l);return!0}}function He(e,t){var r,n,i=e.points,a=i.numberOfItems,o=-1,s=e.getAttribute("stroke-width"),l=s*s;if(a<3)return!1;for(var c=a-1;c>=1;c--){r=function(e,t,r){var n=e.x,i=e.y,a=t.x,o=t.y,s=r.x,l=r.y,c=a-n,d=o-i,h=c*c+d*d,u=((s-n)*c+(l-i)*d)/h;if(!(u>=1||u<=0)){var p=n+u*c,f=i+u*d,g=p-s,y=f-l;return{point:{x:p,y:f},d2:g*g+y*y}}}(i.getItem(c),i.getItem(c-1),t);if(r&&r.d2<=l&&(void 0===n||n>r.d2)){n=r.d2;o=c;r.point.x;r.point.y}}if(1===o){i.removeItem(0);return!0}if(o===a-1){i.removeItem(o);return!0}if(o>1){var d=e.cloneNode(!0);m(d,"class","");d.id=ai.newId();for(c=a-1;c>=o;c--)i.removeItem(c);for(c=o-1;c>=0;c--)d.points.removeItem(c);e.parentNode&&e.parentNode.insertBefore(d,e.nextSibling);return[e,d]}}function je(e){for(var t=[],r=0,n=e.length;r<n;r++)t.push(["node",e[r].id,e[r].cloneNode(!0)]);this.hist=t;this.nodes=[].slice.call(e)}function Ue(e,r){var n=t.createElementNS("http://www.w3.org/2000/svg",e);r&&m(n,r);return n}function Ye(e){if(e){e='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+e.trim()+"</svg>";var r=E(e);if(r){var n=t.importNode(r.documentElement,!0);return n.removeChild(n.childNodes[0])}}}function ze(e){var t=Xt();if(!t.length)return!1;var r=t[0],n=m(r,"c_para")||"";if(0===n.length)return!1;var i=r.cloneNode(!0),a=r.children,o=ai.c_paraToJson(n);e.spicePre&&(o.spicePre=e.spicePre);e.package&&(o.package=e.package);e.Supplier&&(o.BOM_Supplier=e.Supplier);e.Manufacturer&&(o.BOM_Manufacturer=e.Manufacturer);e["Manufacturer Part"]&&(o["BOM_Manufacturer Part"]=e["Manufacturer Part"]);e.LCSC&&(o.BOM_LCSC=e.LCSC);e.Value&&(o.Value=e.Value);n=ai.jsonToC_para(o);m(r,{c_para:n});e.pre&&(ut("pre",r).childNodes[0].textContent=e.pre);if(e.data){var s,l=e.data;for(var c in l)if(l.hasOwnProperty(c)){s=a[l[c].id];if(s){m(s,{c_spicepin:l[c].spiceNum});ai.node.setTextContent(s.children[2],l[c].name);ai.node.setTextContent(s.children[3],l[c].num)}e.hiddenPin&&"4"==m(s,"c_elec")?m(s,{c_show:"none",display:"none"}):e.hiddenPin||m(s,{c_show:"show",display:""})}}var d=r.cloneNode(!0);pi.updateOne(r);Pi.save(["node",r.id,i,d])}function Je(e,t){var r=!t&&e.target==fi,n=e.target,i="cdot"==m(n,"c_shapetype"),a=Hn[Qi].match(/^PCB/),o=t&&(t==gi||f(t,"selected"));if(t&&!o){Ct();!function(e){if(e){gi=e;p(gi,"active",!0);tt("triggerEvent",["select_change"]);"line"==m(e,"c_shapetype")&&it(e)}}(t)}var s,l;if(r){Ct();tt("triggerEvent",["select_change"]);s="";l="canvas"}else if(i&&"light"!=m(n,"class")){s="cdot";l=n.id}else if(t){s=a?ai.getPCBCmdKey(t):ai.getSCHCmdKey(t);l=t.id;if(!s)return}else{if("part_import_frame_lib"!=m(t,"c_partid"))return;s="sheet";l=n.id}Yn.contextmenuDisableOnce||tt("showEditorContextMenu",[{targetId:l,docType:Qi,cmdKey:s,locked:m(t,"locked"),clientX:e.clientX,clientY:e.clientY}])}function Xe(){if(e.frameElement){var r=frameElement.getAttribute("c_para");r&&m(Gi,{c_para:r});var n=frameElement.getAttribute("winzoom");if(ai.fileType.isLib(Qi)){St(+n,{clientX:(t.documentElement.clientWidth||9)>>1,clientY:(t.documentElement.clientHeight||9)>>1})}else St(+n,{clientX:0,clientY:0});m(d("gridOH"),{y1:bi.canvas.originY,y2:bi.canvas.originY});m(d("gridOV"),{x1:bi.canvas.originX,x2:bi.canvas.originX})}}function Ke(e){var t,r=e.childNodes;if(r&&r.length>0)for(t=r.length-1;t>=0;t--)1==r[t].nodeType?"text"!=r[t].tagName&&"tspan"!=r[t].tagName&&Ke(r[t]):e.removeChild(r[t])}function We(){var e=Ui.getViewBox();tt("updateRuler",[{zoom:ci,unit:bi.canvas.unit,vbX:e[0],vbY:e[1],originX:bi.canvas.originX,originY:bi.canvas.originY}])}function qe(e){tt("updateRuler",[{clientX:e.clientX,clientY:e.clientY}])}function $e(){var e=t.body,r=t.documentElement;return{zoom:di,scrollLeft:Math.max(e.scrollLeft,r.scrollLeft),scrollTop:Math.max(e.scrollTop,r.scrollTop),scrollWidth:Math.max(e.scrollWidth,r.scrollWidth),scrollHeight:Math.max(e.scrollHeight,r.scrollHeight),clientWidth:r.clientWidth,clientHeight:r.clientHeight,width:Math.max(e.scrollWidth,r.scrollWidth),height:Math.max(e.scrollHeight,r.scrollHeight),canvasWidth:+m(fi,"width"),canvasHeight:+m(fi,"height"),viewBox:m(fi,"viewBox")}}function Qe(e,t){var r=xe({x:e.clientX,y:e.clientY}),n=r.x,i=r.y;return!0===t||!1!==t&&bi.adsorbGrid.enabled?Ie(r):{x:ai.toFixed(n,3),y:ai.toFixed(i,3)}}function Ze(e){if("TEXTAREA"!=e.target.tagName&&"INPUT"!=e.target.tagName){e.preventDefault();""===xi&&(zn&&zn.ready||Yn.dragpanning||Yn.drawing||si&&si.on||Yn.contextmenuDisableOnce&&(Yn.contextmenuDisableOnce=!1))}}function et(e){if(!("TEXTAREA"==e.target.tagName||qn&&Yn.dragpanning)){e.preventDefault();if(e.detail||e.deltaX||e.deltaY){var t,r,n,i,a=1===e.deltaMode,o=100;r=e.deltaX||e.wheelDeltaX/-3||0;n=e.deltaY||e.wheelDeltaY/-3||0;!e.detail||r||n||(n=e.detail);a&&(o=3);Yn.wheelData=Yn.wheelData||{x:0,y:0,lastFire:0,lastRealHandle:0};var s=Yn.wheelData;if(Date.now()-s.lastFire>500){s.x=0;s.y=0}s.x+=r;s.y+=n;s.lastFire=Date.now();if(!(Math.abs(s.x)<o&&Math.abs(s.y)<o)){s.lastRealHandle=Date.now();i=Math.abs(s.x)>Math.abs(s.y);Math.abs(s.x)<Math.abs(s.y);if(i){t=s.x>0;s.x+=s.x>0?-o:o;s.y=0}else{t=s.y>0;s.y+=s.y>0?-o:o;s.x=0}if(e.shiftKey||e.ctrlKey||e.altKey||e.metaKey||i){var l;l=i||e.shiftKey?t?[1,0]:[-1,0]:t?[0,1]:[0,-1];var c=Ui.getViewBox(),d=20/ci;c[0]+=d*l[0];c[1]+=d*l[1];Ui.setViewBox(c)}else if(!e.altKey)try{var h=U(di,t?"-":"+");St(h,{clientX:e.clientX,clientY:e.clientY});tt("setZoomText",[h+"%"])}catch(e){}}}}}function tt(t,r){var n=parent;if(n!=e){var i=r||[];i.unshift(t);return n.callByEditor.apply(e,i)}}function rt(e,t,r){if(e||t){var n,i,a,o,s=e.length,l="x"==t?"y":"x";for(n=s-1;n>=0;n--)for(i=s-n;i>=0;i--)if(e[i]&&e[i-1]&&e[i][t]<e[i-1][t]){a=e[i];e[i]=e[i-1];e[i-1]=a;o=r[i];r[i]=r[i-1];r[i-1]=o}else if(e[i]&&e[i-1]&&e[i][t]==e[i-1][t]&&e[i][l]<e[i-1][l]){a=e[i];e[i]=e[i-1];e[i-1]=a;o=r[i];r[i]=r[i-1];r[i-1]=o}return{os:e,objs:r}}}function nt(){m(Di,{visibility:"hidden"});m(Hi,{visibility:"hidden"});m(ji,{visibility:"hidden"})}function it(e){if("pinpart"!=m(e,"c_etype")&&!m(e,"c_partid")&&d(e.id)){var t=ki.get(e);t.length>=2&&Yt(t)}}function at(e,t){function r(e,t){if(!1===e||arguments.length<2){m(d("gPointError"),"visibility","hidden");m(d("gMarkError"),"visibility","hidden")}else{m(d("gPointError"),{x2:e,y2:t,visibility:"yes","stroke-width":1.2/ci});m(d("gMarkError"),{cx:e,cy:t,visibility:"yes","stroke-width":2/ci});setTimeout(r,1e3)}}if(e.pin){var n=e.pin.gId,i=d(n);if(i&&"pin"==ai.getSCHCmdKey(i)){var a=ai.numberlistToArray(m(i,"c_origin"));r(a[0],a[1])}}else{if((Qi==Dn.PCB||Qi==Dn.PCBMODULE)&&e.pad){var o=e.pad,s=pi.gJsonCache.FOOTPRINT[o.fid],l=s&&s.PAD&&s.PAD[o.gId];o.number==l.number&&r(l.x,l.y)}else if(M(e)){Wt();Ct();for(var c,h=[],u=0,f=e.length;u<f;u++){c=d(e[u]);if(c){p(c,"selected",!0);h.push(c)}}t&&!1===t.scroll||Be(h);tt("triggerEvent",["select_change"])}}}function ot(){for(var e,r=d("gCursors").childNodes,n=r.length,i=0;i<n;i++)(e=r[i].id)&&(Si[e]={trs:m(r[i],"transform")||"",width:m(r[i],"width"),height:m(r[i],"height")});t.addEventListener("mousemove",ct,!1)}function st(e,t,r){var n=/^(grab|grabbing|row-resize|col-resize)$/;_i&&("cross-red"==_i?lt(!1):n.test(_i)?y(fi,"cursor-"+_i):m(d(_i),{display:"none"}));if(e&&n.test(e)){g(fi,"cursor-"+e);_i=e}else{var i=!1;if(e&&Si[e])if("cross-red"==e)if(!1===tt("getCrossCursor")){lt(!1);i=!0}else if(arguments.length>=3){lt(t,r);i=!0}else if(_i&&!0===t)lt(!1);else{lt(!1);i=!0}else if(arguments.length>=3)m(d(e),{x:t,y:r,display:""});else if(_i&&!0===t)m(d(e),{display:""});else{m(d(e),{x:-1e5,y:-1e5,display:""});i=!0}else i=!0;p(fi,"cursor-none",!i);_i=e||""}}function lt(e,t){if(!1===e||isFinite(e)&&isFinite(t)){var r=d("cross-x-big"),n=d("cross-y-big");if(!1!==e&&!1!==tt("getCrossCursor")){var i=Ui.getViewBox(),a=1/ci,o=a/2,s=e%a,l=t%a;e=e-s+o;t=t-l+o;e=Math.round(1e6*e)/1e6;t=Math.round(1e6*t)/1e6;m(r,"d","M"+e+" "+i[1]+" v"+i[3]);m(n,"d","M"+i[0]+" "+t+" h"+i[2])}else{m(r,"d","M0 0 v0");m(n,"d","M0 0 h0")}}}function ct(e){if(_i)if(e.target!=t.documentElement&&e.target!=t.body||ti){var r,n;if(!bi.adsorbGrid.enabled&&Yi.forcedPixelSnap){r=ai.extend({},bi.adsorbGrid);ai.extend(bi.adsorbGrid,{distanceX:1,distanceY:1,enabled:!0});n=function(){ai.extend(bi.adsorbGrid,r)}}var i,a;if(bi.adsorbGrid.enabled&&"cursor-hand"!=_i&&"cursor-grab"!=_i&&"cursor-freedraw"!=_i){Bi.altKeyEnabled=e.altKey;var o=Ie(Qe(e));i=o.x;a=o.y}else{var s=Qe(e,!1);i=s.x;a=s.y}"cross-red"==_i?lt(i,a):m(d(_i),{x:i,y:a,display:""});n&&n()}else"cross-red"==_i?lt(!1):m(d(_i),{display:"none"})}function dt(e,t,r){if(e){var n="string"==typeof e?d(e):e;if(3==arguments.length){m(n,{display:""});var i=m(n,"c_origin"),a=i?i.split(","):[0,0];wi.g(n,t-a[0],r-a[1]);m(n,{c_origin:t+","+r,display:""})}else m(n,{display:"none"})}}function ht(e){var t=[];e=e||Xt();for(var r=0,n=e.length;r<n;r++)t.push(e[r].id);return t.join(",")}function ut(e,t){var r="name"==e?"note_name":"note_pre",n=t.querySelector("[c_note="+r+"]");if(!n){var i=t.firstElementChild&&f(t.firstElementChild,"hitbox")?t.firstElementChild:null,a=i?i.nextElementSibling:t.firstElementChild,o=(m(t,"c_origin")||"0,0").split(","),s=null;if(Qi==Dn.PCB){s=Ue("g",{c_partid:"part_pcbtext",id:ai.newId(),c_origin:m(t,"c_origin")||"0,0",layerid:Fn.TOPSILKLAYER,display:"none"});n=Ue("path",{c_note:r,c_fontSize:"4.5",c_text:"void",fill:"none","text-anchor":"start","stroke-width":"0.7",d:"M"+o[0]+" "+o[1]+"L"+o[0]+" "+parseInt(o[1],10)+".09"});s.appendChild(n);t.insertBefore(s,a||null)}else{s=Ue("g",{c_partid:"part_annotation",id:ai.newId()});n=Ue("text",{c_note:r,"font-family":"Arial","font-size":"7pt",fill:"#000080","text-anchor":"start",x:o[0],y:o[1]});s.appendChild(n);t.insertBefore(s,a||null);"name"==e?resetPositionOfPreAndName(null,n):resetPositionOfPreAndName(n,null)}}return n.parentNode}function pt(e){var r=/pcb/.test(ai.fileType.getAbstractFileType(Qi));e||(e=gi);var n,i=function(e){if(e==t)return null;for(;e&&e.parentNode;){if(e.parentNode==Gi||"g"===e.tagName)return e;e=e.parentNode}return null}(e),a="cdot"==m(e,"c_shapetype"),o=!i&&(e==fi||"bodyPlaceholder"===e.id);n=a&&"light"!=m(e,"class")?"cdot":"part_import_frame_lib"==m(i,"c_partid")?"sheet":r?ai.getPCBCmdKey(i):ai.getSCHCmdKey(i);tt("showAttrDialog",[{cmdKey:n,docType:Qi,targetId:o?"canvas":e.id}])}function ft(){for(var e="S$"+ ++hi;Gi&&Gi.querySelector('[net="'+e+'"]');)e="S$"+ ++hi;return e}function gt(e){var t;t=ai.fileType.getAbstractFileType(Qi).match(/^pcb/)?3:6;if("mousemove"==e.type||"mouseup"==e.type){var r=Qe(e,!1);if(Qi!=Dn.WAVEFORM){var n=e.target,i=bi.canvas,a=gt.data;a.clientX=e.clientX;a.clientY=e.clientY;if(null===a.lastUpX){a.lastUpX=i.originX;a.lastUpY=i.originY}var o=r.x,s=r.y,l=o-a.lastUpX,c=s-a.lastUpY;if("mouseup"==e.type&&(n==fi||n==Gi||Gi.contains(n))){a.lastUpX=o;a.lastUpY=s;a.uplock=!0;a.clientX>0&&a.clientY>0&&a.clientX<e.view.innerWidth&&a.clientY<e.view.innerHeight&&(a.uplock=!1)}var d=i.unit,h=!d||"pixel"==d,u=h?null:function(e){return ai.units.convert(e,"pixel",d)},p={x:o-i.originX,y:s-i.originY};p.x=ai.toFixed(u?u(p.x):p.x,2)+(h?"":d);p.y=ai.toFixed(u?u(p.y):p.y,2)+(h?"":d);a.uplock&&"mousemove"==e.type&&(Math.abs(l)*ci>t||Math.abs(c)*ci>t)&&(a.uplock=!1);if(!a.uplock){p.dx=ai.toFixed(u?u(l):l,2)+(h?"":d);p.dy=ai.toFixed(u?u(c):c,2)+(h?"":d)}tt("updateMouseXY",[p])}else waveFormMgr.updateMessageBarInfo(r)}}function yt(e){if(xi!=e&&!(Xn&&Xn.start||Kn&&Kn.start||Wn&&Wn.start)){""!==xi&&xt();if(e){if(gi){Ct();tt("triggerEvent",["select_change"])}a("dragMoveSwitch",[!1]);vt(e);Yi.ready()}}}function vt(e){return""===xi?xi=e:xi}function mt(){tt("endToolbarCmd",[xi]);xi=""}function xt(){if(""!==xi){Yi.end();xi=""}}function _t(e){
if("mousedown"==e.type){tt("checkActiveChange");tt("hideMenuOnMouseDown");Pi.lastMergeSource=""}if(""===xi&&!(Xn&&Xn.start||Kn&&Kn.start||Wn&&Wn.start||tn&&tn.instance.start)){var r=e.target,n=e.type,i=e.button,o=i===Vn,s=i===Gn,l=qn?e.metaKey:e.ctrlKey,c=Qe(e,!1);if(fi.contains(r)){var d,u,g=At(r),y=g,v="cdot"==m(r,"c_shapetype");if(!y&&v){if("mousedown"==e.type&&!l&&o){Xn.mdown(e);return}y=gi}!y&&oi&&oi.target&&(y=oi.target);if(y&&"mouseover"==n){if(!g)return;if(oi){p(oi.target,"hover",!1);oi=null}if(Pt._on){Pt._on=0;t.removeEventListener("mousemove",Pt,!1)}p(y,"hover",!(Qi==Dn.PCB&&Gi.contains(r)&&function(e){var t=e.parentNode,r=t&&t.parentNode;return r&&r.parentNode==Gi&&"part_pad"==m(t,"c_partid")}(r)));Qi==Dn.PCB&&Gi.contains(r)&&Qt(r);"path"==r.tagName&&null!==m(r,"c_text")&&"TEXT"==ai.getPCBCmdKey(r.parentNode)&&(r.nextElementSibling||Zt(r.parentNode))}else if("mouseout"==n){var x=e.relatedTarget||e.toElement,_=e.target||e.fromElement;if(x&&"cdot"==m(x,"c_shapetype")){if(oi){p(oi.target,"hover",!1);oi=null}if(Pt._on){Pt._on=0;t.removeEventListener("mousemove",Pt,!1)}}else if(_&&Gi.contains(_)){y=At(_);if(y){oi={x:c.x,y:c.y,target:y,evtTarget:_};if(!Pt._on){Pt._on=1;t.addEventListener("mousemove",Pt,!1)}}}}else if(y||"mousedown"!=n||l||!o){if(y&&"mousedown"==n&&!l&&o){var P=m(y,"c_shapetype"),S=r==fi?y:r;if("group"==P&&S.parentNode!=Gi){u=S.parentNode;d=ai.getPCBCmdKey(u);if("TEXT"==d){if(gi!=u){if(gi){p(gi,"active",!1);p(gi,"selected",!1);"line"==m(gi,"c_shapetype")&&nt()}gi=u;p(gi,"active",!0);tt("triggerEvent",["select_change"])}return}}if((y==gi||f(y,"selected"))&&1!==Xt().length)return;Wt();gi&&gi!=y&&"cdot"!=P&&p(gi,"active",!1);if(!gi||gi!=y&&"cdot"!=P){gi=y;p(gi,"active",!0)}"line"==P?it(y):pi.gJsonCache.DIMENSION&&A(pi.gJsonCache.DIMENSION,m(y,"id"))?it(y):pi.gJsonCache.PROTRACTOR&&A(pi.gJsonCache.PROTRACTOR,m(y,"id"))?it(y):"group"==P&&nt();"cdot"!=P&&tt("triggerEvent",["select_change"])}else if(y&&"mousedown"==n&&l&&o){if(gi){p(gi,"active",!1);p(gi,"selected",!0);gi=null;nt()}if(Qi==Dn.PCB){u=r.parentNode;!g&&oi&&(u=oi.evtTarget.parentNode);d=ai.getPCBCmdKey(u);if("PAD"!=d&&"TEXT"!=d||u.parentNode.parentNode!=Gi)p(y,"selected");else{p(y,"selected",!1);p(u,"selected")}}else p(y,"selected");var b=h(".selected .selected",Gi).toArray();b.forEach(function(e){p(e,"selected",!1)});tt("triggerEvent",["select_change"])}else if(y&&"mouseup"==n&&!l&&o){if(si.on&&!si.bind){a("dragMoveCheck",[e,[y]]);return}if(Qi==Dn.PCB){var C;u=r.parentNode;!g&&oi&&(u=oi.evtTarget.parentNode);d=ai.getPCBCmdKey(u);"PAD"==d?C="gPad":"TEXT"==d&&u.parentNode.parentNode==Gi&&(C="gPre");if(C){Ct();p(u,"active",!0);gi=u;u.parentNode!=Gi&&tt("noneselected")}}tt("triggerEvent",["select_change"])}else if("mousedown"==n&&s)si.on&&(Yn.contextmenuDisableOnce=!0);else if("mouseup"==n&&!l&&s){if(si.on){Yn.contextmenuDisableOnce=!0;si.bind||a("dragMoveSwitch",[!1]);return}if(Yn.dragpanning)return;if(xi)return;Je(e,y)}}else{if(gi){Ct();tt("triggerEvent",["select_change"])}else Wt()>0&&tt("triggerEvent",["select_change"]);Wn.e.mdown(e)}}}}function Pt(e){if(oi){var r=Qe(e,!1);if(Math.pow((r.x-oi.x)*ci,2)+Math.pow((r.y-oi.y)*ci,2)>81){p(oi.target,"hover",!1);if(Pt._on){Pt._on=0;t.removeEventListener("mousemove",Pt,!1)}oi=null}else{Qi==Dn.PCB&&Gi.contains(oi.evtTarget)&&function(e){var t=e.parentNode,r=t&&t.parentNode;return r&&r.parentNode==Gi&&"part_pad"==m(t,"c_partid")}(oi.evtTarget)||p(oi.target,"hover",!0)}}}function St(t,r){t=+t;if(!(!t||t<.1||t>1e5)){t=function(e){var t=e+"",r=t.match(/[1-9]\.?\d/);if(!r)return e;var n=t.indexOf(r[0])+r[0].length;t=t.substr(0,n)+t.substr(n).replace(/[1-9]/g,"0");return+t}(t);var n=ci,i=t>di?1:t<di?-1:0;di=t;ci=t/100;var a,o,s=ai.toFixed(100/t+1e-5,5),l=(gt.data.clientX,gt.data.clientY,$e()),c=Ui.getViewBox(),u=Math.round(l.clientWidth),p=Math.round(l.clientHeight);if(r&&A(r,"clientX")&&!r.uplock){var f=1/n-1/ci;o=[c[0]+r.clientX*f,c[1]+r.clientY*f,u/ci,p/ci]}else{var g=ai.svg.getBBox(Gi);a={x:g.width?g.x+g.width/2:g.x||c[0]+c[2]/2,y:g.height?g.y+g.height/2:g.y||c[1]+c[3]/2};o=[a.x-u/ci/2,a.y-p/ci/2,u/ci,p/ci]}Ui.setViewBox(o);var y=+bi.adsorbGrid.gridSize;(!y||y<.1)&&(y=.1);for(;y*ci<5;)y*=y*ci*2>=5?2:y*ci*5>=5?5:10;var v=.5/ci,x=void 0!==Fi.style.vectorEffect,_=function(e){return e/ci},P=h("#gCursors>image");We();setTimeout(function(){m(d("gridPattern"),{x:bi.canvas.originX,y:bi.canvas.originY});m(d("gridPattern2"),{x:bi.canvas.originX+s,y:bi.canvas.originY+s});m(d("gridCell"),{width:s,height:s});m(d("gridCell2"),"stroke-width",s);m([d("gridPattern"),d("gridPattern2")],{width:y,height:y});m(d("gridCell2"),{d:"M10 0V10H-10".replace(/10/g,y)});m(d("gridOH"),{"stroke-width":s,y1:bi.canvas.originY+v,y2:bi.canvas.originY+v});m(d("gridOV"),{"stroke-width":s,x1:bi.canvas.originX+v,x2:bi.canvas.originX+v});m(h("circle.pindot, #gPinDots circle"),{r:4*s});if(!x){var r=ai.toFixed(3*s,2);m(Fi,"stroke-width",s);Fi.style.strokeDasharray=r+","+r;var a=d("cross-x-big"),o=d("cross-y-big");m([a,o],{"stroke-width":s,"stroke-dasharray":r+","+r});a.style.strokeDasharray=r+","+r;o.style.strokeDasharray=r+","+r;if(2==a.pathSegList.numberOfItems&&a.pathSegList.getItem(1).y){var l=50/t,u=a.pathSegList.getItem(0).x,p=o.pathSegList.getItem(0).y;u=u-u%(100/t)+l;p=p-p%(100/t)+l;u=Math.round(1e6*u)/1e6;p=Math.round(1e6*p)/1e6;m(a,"d","M"+u+" "+c[1]+" v"+c[3]);m(o,"d","M"+c[0]+" "+p+" h"+c[2])}m(ji.children,{"stroke-width":s,"stroke-dasharray":r+","+r});m(Hi.children,{"stroke-width":s,"stroke-dasharray":r+","+r});m(h("#gControlDots>*"),{"stroke-width":s})}var f;for(f=0;f<yi.length;f++)m(yi[f],{r:4*s});!function(e,t){if(e){var r=e.sheet.cssRules[0];r&&(r.style.strokeWidth=t)}}(d("px1Style"),s);!function(e,t,r){if(e)if(r<1){var n,i=e.sheet,a=i.cssRules,o=a.length,s=1/r;for(n=o-1;n>=0;n--)i.deleteRule(n);var l="";for(n=1;n<s;n++)l+=',#g1 [stroke-width="'+n+'"]';l=l.substr(1);l+=x?"{stroke-width:1;vector-effect:non-scaling-stroke;}":"{stroke-width:"+ai.toFixed(s+99e-7,5)+";}";i.insertRule(l,0);e.disabled=!1}else e.disabled=!0}(d("thinLineStyle"),0,ci);for(f=0;f<P.length;f++){var g=Si[P[f].id];if(g&&g.trs){var S=1==ci?g.trs:g.trs.replace(/\-?[\d\.]+/g,_);m(P[f],{width:g.width/ci,height:g.height/ci,transform:S})}}e.frameElement&&e.frameElement.setAttribute("winzoom",t);if(d("ratlineStyle")){d("ratlineStyle").sheet.cssRules[0].style.strokeWidth=ni?1.04*s:s}!function(){var e=d("gNets"),t="none"!=m(e,"display"),r=ci>=8&&!1!==Yn.pcbNetTextVisible,a=(Math.min(40/n,Math.max(1,10/n)),Math.min(40/ci,Math.max(1,10/ci)));m(e,"font-size",a);m(e,"stroke-width",Math.min(s,.02)+"");var o=d("gNetsTextRuler");m(o.viewportElement,"viewBox",[0,0,100/ci,20/ci].join(" "));m(o,"font-size",a);Yn.netTextCharWidth=ai.svg.getBBox(o).width/8;if(i){m(e,"display",r?"":"none");r!=t&&m(e.children,"display","none");jr(void 0,void 0,i)}}();Mi.resize();x||m(h("#gControlLocks rect"),{"stroke-width":s,"stroke-dasharray":r+","+r})},1e3/60)}}function bt(){for(var e=Xt(),t=!1,r=0,n=e.length;r<n;r++)if("FOOTPRINT"!=ai.getPCBCmdKey(e[r])){t=!0;break}return{newModified:!0,canUndo:Pi.canUndo(),canRedo:Pi.canRedo(),selected:e.length>0,canPaste:gClipboard.childNodes.length>0,canFlip:t,zoom:di,toolbars:"",visible_grid:bi.adsorbGrid.visible,snap_grid:bi.adsorbGrid.enabled,pcbNetTextVisible:!1!==Yn.pcbNetTextVisible}}function Ct(e){if(gi){p(gi,"active",!1);gi=null;nt()}for(var t=h("#g1>.hover"),r=t.length-1;r>=0;r--)p(t[r],"hover",!1);Wt(e)}function At(e){if(e==t)return null;for(;e&&e.parentNode;){if(e.parentNode==Gi)return e;e=e.parentNode}return null}function It(){var e=[],t=pi.gJsonCache.FOOTPRINT,r=pi.gJsonCache.preference.hideFootprints||[];for(var n in t)if(t.hasOwnProperty(n)){var i="",a=!1;for(var o in t[n].TEXT)if(t[n].TEXT.hasOwnProperty(o)){var s=t[n].TEXT[o]||{};if("P"==s.type){i=s.text||"NO";break}}for(var l=0;l<r.length;l++)if(r[l]==n){a=!0;break}var c=ai.c_paraToJson(t[n].head.c_para).value||"";e.push({pre:i,label:V(i+(c?" ("+c+")":"")),hide:a,gId:n})}return e}function Lt(e){function t(){parent.$.messager.alert("Not found")}if(e&&"string"==typeof e){for(var r,n,i=h("#g1>g>g path[c_note]",Gi),a=0;a<i.length;a++){n=m(i[a],"c_text");if(V(n||"").toUpperCase()==e.toUpperCase()){r=i[a].parentNode.parentNode;break}}if(r){Wt();p(r,"selected",!0);Re(r);tt("triggerEvent",["select_change"])}else t();return r}t()}function Et(e,t){if(!(Xn&&Xn.start||Kn&&Kn.start||Wn&&Wn.start)){var r,n,i=Math.max(.01,Math.round(10/ci)/10),a=Bi.getSanpSize("X"),o=Bi.getSanpSize("Y"),s=Xt();!s.length&&gi&&(s=[gi]);for(var l=0,c=s.length;l<c;l++)s[l]&&s[l].parentNode!=Gi&&"PAD"==ai.getPCBCmdKey(s[l])&&(s[l]=s[l].parentNode);var d=bi.adsorbGrid.enabled&&Ce(s),h=d&&Le(d,e,t);if(d&&h){r=h.x-d.x;n=h.y-d.y}if(!r&&!n){r=e*(bi.adsorbGrid.enabled?a:i);n=t*(bi.adsorbGrid.enabled?o:i)}r=+ai.toFixed(r,4);n=+ai.toFixed(n,4);if((r||n)&&!1!==Oe(s,r,n)){Qi!=Dn.PCB&&Qi!=Dn.PCBLIB||pi.updateMore(s);Qi==Dn.PCB&&Ei.buildRatLinesOfPCBLib(s);Pi.save(["move",ht(s),r,n]);gi&&it(gi);return!0}return!1}}function Ot(e,t,r){if("number"==typeof arguments[0]){r=arguments[1];t=arguments[0];e=Xt()}else e=e?[].map.call(e,function(e){return"string"==typeof e?d(e):e.gId?d(e.gId):e}):Xt();isFinite(t)||(t=0);isFinite(r)||(r=0);for(var n=0,i=e.length;n<i;n++)e[n]&&e[n].parentNode!=Gi&&"PAD"==ai.getPCBCmdKey(e[n])&&(e[n]=e[n].parentNode);e=e.filter(Vr);if(e&&e.length){var a=[].map.call(e,function(e){return e.id||""}).join(",");if(!1!==Oe(e,t,r)){Qi!=Dn.PCB&&Qi!=Dn.PCBLIB||pi.updateMore(e);Qi==Dn.PCB&&Ei.buildRatLinesOfPCBLib(e);Pi.save(["move",a,t,r]);gi&&it(gi);return!0}return!1}}function Tt(e,t,r){if("number"==typeof arguments[0]){r=arguments[1];t=arguments[0];e=Xt()}else e=e?[].map.call(e,function(e){return"string"==typeof e?d(e):e.gId?d(e.gId):e}):Xt();for(var n=0,i=e.length;n<i;n++)e[n]&&e[n].parentNode!=Gi&&"PAD"==ai.getPCBCmdKey(e[n])&&(e[n]=e[n].parentNode);e=e.filter(Vr);if(e&&e.length){Pi.startBatch();var a=isFinite(t),o=isFinite(r);for(n=0,i=e.length;n<i;n++){var s=e[n],l=s&&s.id,c=s&&ai.getPCBCmdKey(s),h=0,u=0;if(l){var p=pi.gJsonCache[c]&&pi.gJsonCache[c][l];switch(c){case"PAD":case"VIA":case"HOLE":if(p){a&&(h=t-p.x);o&&(u=r-p.y)}break;case"CIRCLE":if(p){a&&(h=t-p.cx);o&&(u=r-p.cy)}break;case"FOOTPRINT":if(p&&p.head){a&&(h=t-p.head.x);o&&(u=r-p.head.y)}break;default:var f=ai.svg.getBBox(s);a&&(h=t-(f.x+f.width/2));o&&(u=r-(f.y+f.height/2))}Ot([s],h,u)}}Pi.saveBatch();Qi!=Dn.PCB&&Qi!=Dn.PCBLIB||pi.updateMore(e);Qi==Dn.PCB&&Ei.buildRatLinesOfPCBLib(e);gi&&it(gi)}}function wt(e){var t,r,n=(e||Xt()).filter(Vr),i=n.length,a=[];if(i>0){var o=[];Ct();Qi==Dn.PCB&&(a=nr(n));for(t=0;t<i;t++){r=n[t];o[t]=["del",r.id,ai.node.getRefId(r)];pi.removeOne(r);li.appendChild(r)}Pi.save(o);tt("triggerEvent",["select_change"]);Qi==Dn.PCB&&a.length&&Ei.buildGroupNets(a)}}function Rt(){var t=Xt().filter(Vr),r=t.length;if(0!==r){gClipboard.childNodes.length>0?ai.node.clearChildNodes(gClipboard):tt("triggerEvent",["enable_paste"]);Ct();var n,i,a=[];for(n=0;n<r;n++){i=t[n];pi.removeOne(i);a[n]=["del",i.id,ai.node.getRefId(i)];gClipboard.appendChild(i.cloneNode(!0));li.appendChild(i)}Pi.save(a);tt("triggerEvent",["select_change"]);parent.globalEditorClipboard=[Qi,e.frameElement.id,+new Date]}}function Nt(){var t,r,n,i=Xt(),a=i.length;if((1!==a||"gPre"!=i[0].id&&"gPad"!=i[0].id)&&a>0){n=gClipboard.childNodes.length>0;n&&ai.node.clearChildNodes(gClipboard);for(t=0;t<a;t++){r=i[t].cloneNode(!0);p(r,"active",!1);p(r,"hover",!1);p(r,"selected",!1);gClipboard.appendChild(r)}n||tt("triggerEvent",["enable_paste"]);parent.globalEditorClipboard=[Qi,e.frameElement.id,+new Date]}}function kt(){var e,t=gClipboard.childNodes,r=t.length,n=[];if(r){for(var i=0;i<r;i++){e=t[i];"none"==m(e,"display")||f(e,"hitbox")||n.push(t[i].cloneNode(!0))}Mt(n)}}function Bt(){var r=parent.globalEditorClipboard;if(r){var n=ai.fileType.getAbstractFileType(r[0]),i=ai.fileType.getAbstractFileType(Qi);if("pcb"===n||"pcblib"===n)if(r[1]!=e.frameElement.id){var a=e.frameElement.ownerDocument.getElementById(r[1]),o=a&&a.contentWindow;o=o&&o.gClipboard;o=o&&o.childNodes;if(o&&o.length){var s,l,c,d=function(e){x(e,"style");x(e,"class");x(e,"id")},u=[];for(s=0,l=o.length;s<l;s++){c=t.importNode(o[s],!0);m(h("*[id]",c),"id","");n==i?u[s]=c:u=u.concat(function e(t){if("none"==m(t,"display")||f(t,"hitbox"))return[];var r=ai.getPCBCmdKey(t),n=[];d(t);switch(r){case"FOOTPRINT":for(var i=0,a=t.children,o=a.length;i<o;i++){var s=e(a[i]);s.length&&(n=n.concat(s))}t=null;break;case"PAD":case"VIA":case"HOLE":case"TEXT":case"SVGNODE":case"TRACK":case"COPPERAREA":case"SOLIDREGION":case"DIMENSION":case"PROTRACTOR":case"ARC":case"RECT":case"CIRCLE":break;case"RATLINE":default:t=null}t&&n.push(t);return n}(c))}u.length&&Mt(u)}}else kt()}}function Mt(e){if(e&&e.length){var t,r,n,i=e.length,a="";Ct();var o=Ue("g");for(t=-1;++t<i;)o.appendChild(e[t]);fi.appendChild(o);var s,l,c,p,f,y,v,x,_=o.getBBox(),P={x:_.x+_.width/2,y:_.y+_.height/2},S=$e();s=xe({x:gt.data.clientX||S.clientWidth/2,y:gt.data.clientY||S.clientHeight/2});l=s.x-P.x;c=s.y-P.y;p=u('g[c_partid="part_pad"]',o);p||(p=u("g[c_origin]",o));v=p?ai.numberlistToArray(m(p,"c_origin")):[_.x,_.y];x=[v[0]+l,v[1]+c];f=+m(d("gridPattern"),"width");y=+m(d("gridPattern"),"height");x[0]-=x[0]%f;x[1]-=x[1]%y;l=x[0]-v[0];c=x[1]-v[1];l=ai.toFixed(l,2);c=ai.toFixed(c,2);Ee(o,l,c);for(t=0,i=e.length;t<i;t++){r=e[t];zi.appendElement(r);g(r,"selected");n=m(r,"c_etype");if("pinpart"==n){var b=r.querySelector("path[c_note=note_pre]");if(b){var C=(m(b,"c_text")||"").replace(/\d+/,"?");if(C&&C.indexOf("?")>=0){var A=ui.getNewPre(C);_n(b.parentNode,{text:A})}}if("PAD"==ai.getPCBCmdKey(r)&&Qi==Dn.PCBLIB){var I,L,E=h("g[c_partid=part_pad]",Gi),O=E.length;for(I=0;I<E.length;I++){L=m(E[I],"number");if(L){L=parseInt(L,10);!isNaN(L)&&L>O&&(O=L+1)}}m(r,{number:O})}}Fe(r);a+=","+r.id}fi.removeChild(o);Wr(!0);$r({targets:e,x:s.x,y:s.y,bbox:{x:_.x+l,y:_.y+c,width:_.width,height:_.height},hasPin:!!p});tt("triggerEvent",["select_change"])}}function Vt(e){if(e&&e.length){var t=e.map(function(e){var t=e.cloneNode(!0);e.parentNode.insertBefore(t,e.nextSibling);"object"==typeof t.className?t.className.baseVal="":t.className="";Fe(t);return t});pi.updateMore(t);Qi==Dn.PCB&&Ei.buildRatLinesOfPCBLib(t);var r=t.map(function(e){return e.id}),n=r.join(",");Pi.save(["add",n]);return r}}function Gt(e,t){if(!(_i&&xi||Xr())){t=t||Xt();t=t.filter(function(e){return e&&e.parentNode==Gi&&["ARC","COPPERAREA","CIRCLE","RECT","SOLIDREGION","TRACK","SVGNODE"].indexOf(ai.getPCBCmdKey(e))>=0});t=t.filter(Vr);if(t.length){var r=new je(t);e?Ni.flipH(t):Ni.flipV(t);gi&&it(gi);pi.updateMore(t);Qi==Dn.PCB&&Ei.buildRatLinesOfPCBLib(t);r.updateAndSave()}}}function Ft(e,t){t=t&&t.ids?t.ids:t;if(!t||Array.isArray(t)){t=t?[].map.call(t,function(e){return"string"==typeof e?d(e):e.gId?d(e.gId):e}).filter(function(e){return e&&e.parentNode==Gi}):Xt();t=t.filter(Vr);if(t.length){var r,n,i,a,o,s,l,c,h,u,p,f=new je(t),g=[],y=0,v=bi.adsorbGrid.gridSize;for(i=0,a=t.length;i<a;i++){var m=ai.svg.getBBoxFixed(t[i],{excludeText:!0});if(m.width||m.height){g[i]=m;if(0===i){r=m.x;n=m.y;l=m.x;c=m.y;h=m.x+m.width;u=m.y+m.height}switch(e){case"align_left":r=void 0===r?m.x:Math.min(r,m.x);break;case"align_right":r=void 0===r?m.x+m.width:Math.max(r,m.x+m.width);break;case"align_top":n=void 0===n?m.y:Math.min(n,m.y);break;case"align_bottom":n=void 0===n?m.y+m.height:Math.max(n,m.y+m.height);break;case"align_horizontal_center":n=void 0===n?m.y:Math.min(n,m.y);u=Math.max(u,m.y+m.height);i==a-1&&(n=(u+n)/2);break;case"align_vertical_center":r=void 0===r?m.x:Math.min(r,m.x);h=Math.max(h,m.x+m.width);i==a-1&&(r=(h+r)/2);break;case"align_horizontal_equidistant":r=void 0===r?m.x:Math.min(r,m.x);h=Math.max(h,m.x+m.width);break;case"align_vertical_equidistant":n=void 0===n?m.y:Math.min(n,m.y);u=Math.max(u,m.y+m.height);break;case"align_left_side_edge_equidistant":r=void 0===r?m.x:Math.min(r,m.x);l=void 0===r?m.x:Math.max(l,m.x);break;case"align_top_side_edge_equidistant":n=void 0===n?m.y:Math.min(n,m.y);c=void 0===n?m.y:Math.max(c,m.y);break;case"align_grid":r=void 0===r?m.x:Math.min(r,m.x);i==a-1&&(r=Math.round(r/v)*v);break;default:return}}}if((void 0!==r||"align_left"!=e&&"align_right"!=e)&&(void 0!==n||"align_top"!=e&&"align_bottom"!=e)){if("align_vertical_center"==e||"align_top_side_edge_equidistant"==e||"align_vertical_equidistant"==e){var x=rt(g,"y",t);t=x.objs;g=x.os}else if("align_horizontal_center"==e||"align_left_side_edge_equidistant"==e||"align_horizontal_equidistant"==e){var _=rt(g,"x",t);t=_.objs;g=_.os}"align_left_side_edge_equidistant"==e?p=Math.abs(l-r)/(t.length-1):"align_top_side_edge_equidistant"==e&&(p=Math.abs(c-n)/(t.length-1));if("align_horizontal_equidistant"==e){p=h-r;if(g.length<=2)return;for(i=0;i<g.length;i++){p-=g[i].width;i==g.length-1&&(p/=g.length-1)}}else if("align_vertical_equidistant"==e){p=u-n;if(g.length<=2)return;for(i=0;i<g.length;i++){p-=g[i].height;i==g.length-1&&(p/=g.length-1)}}for(i=0,a=t.length;i<a;i++)if(g[i]){o=0;s=0;switch(e){case"align_left":o=r-g[i].x;break;case"align_right":o=r-g[i].x-g[i].width;break;case"align_top":s=n-g[i].y;break;case"align_bottom":s=n-g[i].y-g[i].height;break;case"align_horizontal_center":s=n-g[i].y-g[i].height/2;break;case"align_vertical_center":o=r-g[i].x-g[i].width/2;break;case"align_horizontal_equidistant":if(g[i].x+g[i].width===h)break;o=r-g[i].x;r=r+g[i].width+p;break;case"align_vertical_equidistant":if(g[i].x+g[i].height===u)break;s=n-g[i].y;n=n+g[i].height+p;break;case"align_left_side_edge_equidistant":o=Math.round(r-g[i].x);r+=p;break;case"align_top_side_edge_equidistant":s=Math.round(n-g[i].y);n+=p;break;case"align_grid":var P=t[i].getAttribute("c_origin");P&&(P=P.split(","));var S=t[i].children;S.length&&"text"==S[0].tagName&&(P="");if(P&&P.length){o=Math.round(P[0]/v)*v-P[0];s=Math.round(P[1]/v)*v-P[1]}else if("path"==t[i].tagName){var b=ye(t[i].getAttribute("d"));o=Math.round(Number(b[1])/v)*v-b[1];s=Math.round(Number(b[2])/v)*v-b[2]}else if("ellipse"==t[i].tagName||"circle"==t[i].tagName){var C=t[i].getAttribute("cx"),A=t[i].getAttribute("cy");o=Math.round(C/v)*v-g[i].x;s=Math.round(A/v)*v-g[i].y}else if("polygon"==t[i].tagName||"polyline"==t[i].tagName){var I=Se(t[i],1);o=Math.round(Number(I[0])/v)*v-I[0];s=Math.round(Number(I[1])/v)*v-I[1]}else{o=Math.round(g[i].x/v)*v-g[i].x;s=Math.round(g[i].y/v)*v-g[i].y}}if(o||s){wi.move(t[i],o,s);y++}else f.deleteItemAt(i)}else f.deleteItemAt(i);if(y){f.updateAndSave();pi.updateMore(t);Qi==Dn.PCB&&Ei.buildRatLinesOfPCBLib(t);gi&&it(gi)}}}}}function Dt(e,t,r){void 0===t?t=270:"string"==typeof t&&(t=+t);for(var n=0,i=0,a=e.length;n<a;n++){var o=e[n],s=m(o,"c_origin"),l=+m(o,"c_rotation")||0;if(s){s=ai.numberlistToArray(s);if(!0===r){var c=t-l;c<0&&(c+=360);Ri[o.tagName](o,c,s[0],s[1])}else Ri[o.tagName](o,t,s[0],s[1]);i++}pi.updateOne(o)}return i>0}function Ht(){var e,t,r=arguments;e="object"==typeof r[0]?r[0]:Xt();e.length>1&&(e=e.filter(Vr));if(!e||!e.length)return!1;t="number"==typeof r[0]?r[0]:"number"==typeof r[1]?r[1]:270;if(e.length>1){var n=ai.svg.getElementsCenter(e,!0);n=W(n);for(var i=0,a=e.length;i<a;i++){ai.svg.fixOrigin(e[i]);Ri.rotate(e[i],t,n.x,n.y);xr(e[i])}}else{ai.svg.fixOrigin(e[0]);Ri.rotate(e[0],t);xr(e[0])}pi.updateMore(e);Qi==Dn.PCB&&Ei.buildRatLinesOfPCBLib(e);gi&&it(gi);return a>0}function jt(){var e,t,r,n,i=Xt().filter(Vr),a=i.length,o=[];if(a){for(e=a-1;e>=0;e--){t=i[e];r=r||function(e){var t=e.parentNode;if(t==Gi){for(var r=e.nextSibling;r&&(!r.id||0!==r.id.indexOf("layer_"));)r=r.nextSibling;return r}return t.lastElementChild}(t)||null;if(t.nextSibling!=r){n=ai.node.getRefId(t);o.push(["del",t.id,n]);t.parentNode.insertBefore(t,r);n=ai.node.getRefId(t);o.push(["add",t.id,n])}r=t}o.length&&Pi.save(o)}}function Ut(){var e,t,r,n,i=Xt().filter(Vr),a=i.length,o=[];if(a){for(e=0;e<a;e++){t=i[e];r=r||function(e){var t=e.parentNode;if(t==Gi){for(var r=e.previousSibling;r&&(!r.id||0!==r.id.indexOf("layer_"));)r=r.previousSibling;return r}return t.firstElementChild}(t)||null;if(t.previousSibling!=r){n=ai.node.getRefId(t);o.push(["del",t.id,n]);t.parentNode.insertBefore(t,r.nextSibling);n=ai.node.getRefId(t);o.push(["add",t.id,n])}r=t}o.length&&Pi.save(o)}}function Yt(e,t){if(Qi!=Dn.PHOTOVIEW){m(Di,{visibility:"visible"});m(Hi,{visibility:"visible"});m(ji,{visibility:"visible"});var r=e.length/2,n=yi.length;if(0===n){yi[0]=d("cdot0");yi[1]=d("cdot1");n=2}var i,a,o={},s={},l={};o.transform=s.transform=l.transform=t||"";o.visibility=s.visibility=l.visibility="";o.r=4/ci;if(!e.onlyLines)for(i=0,a=Math.max(r,n);i<a;i++){o.visibility="";if(i<r&&i<n);else{if(i>=r){m(yi[i],{visibility:"hidden"});continue}yi[i]=yi[0].cloneNode(!0);o.id="cdot"+i;Di.appendChild(yi[i])}o.cx=e[2*i];o.cy=e[2*i+1];var c=Xt()[0];c&&"TRACK"==ai.getPCBCmdKey(c)&&Mr(m(c,"layerid"))?o.visibility="odd"==e.lightDots&&i%2?"hidden":"":o.class="odd"==e.lightDots&&i%2?"light":"";m(yi[i],o)}var h=e.c_helper_lines;if(h){var u=mi.length,p=vi.length;if(0===u){mi[0]=d("cline0");u=1}if(0===p){vi[0]=d("crect0");p=1}i=-1;for(var f,g,y,v=-1,x=-1;++i<h.length;)if("rect_center_corner"==h[i].type){x++;if(!vi[x]){vi[x]=vi[0].cloneNode(!0);m(vi[x],{id:"crect"+x});Hi.appendChild(vi[x])}f=h[i].center;g=h[i].corner;y=[e[2*f],e[2*f+1],e[2*g],e[2*g+1]];m(vi[x],s);m(vi[x],{x:Math.min(2*y[0]-y[2],y[2]),y:Math.min(2*y[1]-y[3],y[3]),width:2*Math.abs(y[0]-y[2]),height:2*Math.abs(y[1]-y[3])})}else if("rect_corner_corner"==h[i].type){x++;if(!vi[x]){vi[x]=vi[0].cloneNode(!0);m(vi[x],{id:"crect"+x});Hi.appendChild(vi[x])}f=h[i].corner1;g=h[i].corner2;y=[e[2*f],e[2*f+1],e[2*g],e[2*g+1]];m(vi[x],s);m(vi[x],{x:Math.min(y[0],y[2]),y:Math.min(y[1],y[3]),width:Math.abs(y[0]-y[2]),height:Math.abs(y[1]-y[3])})}else if("rect"==h[i].type){x++;m(vi[x],s);m(vi[x],h[i].data)}else{v++;if(!mi[v]){mi[v]=mi[0].cloneNode(!0);m(mi[v],{id:"cline"+v});ji.appendChild(mi[v])}f=h[i].from;g=h[i].to;m(mi[v],l);m(mi[v],{x1:e[2*f],y1:e[2*f+1],x2:e[2*g],y2:e[2*g+1]})}for(i=v+1;i<u;i++)m(mi[i],{visibility:"hidden"});for(i=x+1;i<p;i++)m(vi[i],{visibility:"hidden"})}else{m(Hi,{visibility:"hidden"});m(ji,{visibility:"hidden"})}}}function zt(e){var t,r,n,i,a,o="check-group"==e&&1===arguments.length,s=Xt(),l=[],c=[],h=[];if(0===s.length)return"group fail";if(1===s.length){n=s[0];if("group"==m(n,"c_shapetype")&&u('g[c_partid="part_pcbtext"] path[c_note="note_pre"]',n)){pi.removeOne(n);var p,f=n.childNodes;for(t=0,r=f.length;t<r;t++)if(1===f[t].nodeType){p=n.childNodes[t].cloneNode(!0);i="g"==p.tagName?"group":"line";m(p,"c_shapetype",i);zi.appendElement(p);p.id||Fe(p);pi.updateOne(p);h.push(p.id)}h.length>0&&c.push(["add",h.join(",")]);c.push(["del",n.id]);li.appendChild(n);Pi.save(c);return"ungroup ok"}return"ungroup fail"}var g,y,v={PAD:1,VIA:1,TRACK:1,TEXT:1,ARC:1,DIMENSION:1,CIRCLE:1,SOLIDREGION:1,HOLE:1};for(t=0,r=s.length;t<r;t++){n=s[t];m(n,"c_partid");i=m(n,"c_shapetype");m(n,"c_etype");y=ai.getPCBCmdKey(n);if(v.hasOwnProperty(y)){if("TEXT"==y&&"note_pre"==m(n.childNodes[0],"c_note")){g=!0;l.unshift(n);continue}l.push(n)}}if(l.length<2)return"group fail";if(o){e=g?m(l[0].firstChild,"c_text"):"none";return[e]}var _=d("part_import_tmpl").cloneNode(!0);_.id="gge"+ ++hi;for(t=0,r=l.length;t<r;t++){n=l[t];x(n,"class");p=n.cloneNode(!0);x(p,"c_shapetype");pi.removeOne(p);_.appendChild(p);li.appendChild(n);h.push(n.id)}h.length>0&&c.push(["del",h.join(",")]);m(_,{c_para:"package`",display:""});zi.appendElement(_);Fe(_);c.push(["add",_.id]);Pi.save(c);var P=_.removeChild(_.childNodes[0]),S=P.firstChild;S.style.display="";var b,C=[],A={};if(g){P=_.childNodes[0];var I=m(P,"c_origin")||"0,0",L=I.split(",");A={text:e,x:L[0],y:L[1],fontSize:+m(P,"c_fontSize"),fontFamily:""};b=tt("getFontPath",[A]);m(_.firstChild.firstChild,{d:b,c_text:e});C=_.getBBox()}else{C=_.getBBox();e=e||"none";A={text:e,x:C.x+C.width/2,y:C.y-5,fontSize:4.5,fontFamily:""};b=tt("getFontPath",[A])||"M0,0";m(S,{d:b,c_text:e});m(P,"c_origin",A.x+","+A.y);_.insertBefore(P,_.firstChild)}a={x:C.x+C.width/2,y:C.y+C.height/2};m(_,"c_origin",a.x+","+a.y);pi.updateOne(_);return"group ok"}function Jt(){var e=E(Ti);if(e)for(var r,n,i=t.adoptNode(e.documentElement),a=i.childNodes,o=a.length-1;o>=0;o--){r=m(n=a[o],"c_partid");if(r&&!d(r)){m(n,{id:r,display:"none"});d("gCurParts").appendChild(n)}}}function Xt(e){var t=h("#g1>.active,#g1 .selected,#g1 .active",Gi).toArray();t=t.filter(function(e){var t=e.parentNode;return t==Gi||t.parentNode==Gi&&!f(t,"selected")&&!f(t,"active")});if(!e)return t;for(var r={},n=0,i=t.length;n<i;n++){var a=ai.getPCBCmdKey(t[n]),o=t[n].id;if(a&&o){r[a]||(r[a]={});r[a][o]=pi.gJsonCache[a][o]}}return r}function Kt(){return Gi.querySelector("#g1>.active,#g1>.selected")}function Wt(e){var t=e||Xt(),r=t.length;if(r>0){for(var n=r;--n>=0;)p(t[n],"selected",!1);nt()}Qi==Dn.PCB&&Ei.cancelHighlightNets();return r}function qt(){if(gi){p(gi,"active",!1);gi=null;nt()}var e,t,r,n=h("#g1 .hover",Gi);for(e=n.length-1;e>=0;e--){p(n[e],"hover",!1);p(n[e],"wire-hover",!1)}t=h("#g1 .selected",Gi);for(e=0;e<t.length;e++)p(t[e],"selected",!1);t=h('#g1 > [c_shapetype]:not(.selected):not(.events-none):not([d=""]):not([locked]):not([display="none"])',Gi);t=[].filter.call(t,function(e){var t=getComputedStyle(e);return t&&"none"!=t.display});r=t.length;if(r>0){e=r;for(;--e>=0;)p(t[e],"selected",!0)}tt("triggerEvent",["select_change"]);return r}function $t(e){if(e){var t,r,n,i,a=gi;if(a&&a.parentNode==Gi){t=d(e);if(t&&t.parentNode==Di&&"light"!=m(t,"class")&&("path"==a.tagName||"polyline"==a.tagName||"polygon"==a.tagName)){r=+e.substr(4);n=Di.children[1];!n||"light"!=m(n,"class")&&"hidden"!=m(n,"visibility")||(r>>=1);if("path"!=a.tagName){var o=a,s=o.points,l=s.numberOfItems;if(l<=2){pi.removeOne(o);Pi.save(["del",o.id,ai.node.getRefId(o)]);li.appendChild(o);net=m(o,"net");net&&Ei.buildOneNet(net,!1);Ct();tt("triggerEvent",["select_change"])}else if(r>=0&&r<l){i=["attr",o.id,{points:m(o,"points")}],cmdKey=ai.getPCBCmdKey(o);s.removeItem(r);it(o);pi.updateOne(o);i[3]={points:m(o,"points")};Pi.save(i);if("TRACK"==cmdKey||"ARC"==cmdKey){net=m(o,"net");net&&Ei.buildOneNet(net,!1)}}}else{if(pi.gJsonCache.DIMENSION&&A(pi.gJsonCache.DIMENSION,m(a,"id")))return;i=["attr",a.id,{d:m(a,"d")}];ai.svg.deletePathPointAtCdot(a,r);i[3]={d:m(a,"d")};if(i[2].d!=i[3].d)if(a.getTotalLength(a)<.01){m(a,"d",i[2].d);wt([a])}else{pi.updateOne(a);it(a);Pi.save(i)}}}}}}function Qt(e){var t,r,n;if("polyline"!=e.tagName&&"path"!=e.tagName||!m(e,"layerid")){var i=e.parentNode;if("g"==i.tagName&&i!=Gi){n=ai.getPCBCmdKey(i);"PAD"==n&&(t=i)}}else{n=ai.getPCBCmdKey(e);r="TRACK"==n||"ARC"==n;r&&(t=e)}if(t){var a,o=m(t,"net"),s="",l=bi.canvas.unit;if(o)if(r){a=ai.units.convert(+m(t,"stroke-width"),"pixel",l)+" "+l;s=o+"\n width = "+a}else s=o;ai.svg.setTooltip(t,s)}}function Zt(e){if(e&&"g"==e.tagName){var t=e.children[0],r=e.children[1];if(t&&"path"==t.tagName&&(!r||"path"==r.tagName)){var i=t.getPathData();if(i.length<2)r&&v(r);else{for(var a=new n,o=0;o<i.length;o++){var s=i[o],l=s.values;switch(s.type){case"M":case"L":a.addPoint(l[0],l[1]);break;case"C":a.addPoint(l[4],l[5]);break;case"Q":a.addPoint(l[2],l[3])}}var c=a.getHull();if(c<3)r&&v(r);else{for(var d="M"+c[0].x+" "+c[0].y+"L",h=1;h<c.length;h++)d+=" "+c[h].x+" "+c[h].y;d+="Z";if(r)m(r,"d",d);else{r=Ue("path",{stroke:"none","fill-opacity":0,fill:"black",d:d});e.appendChild(r)}}}}}}function er(){var e=pi.gJsonCache.FOOTPRINT,t=[],r={};for(var n in e){var i=[],a=e[n].TEXT;for(var o in a)i.push(a[o].text);var s=e[n].head.c_para,l=ai.c_paraToJson(s),c=l.Value||l.value||"",d=l.package||"",h=c+"`"+d;if(A(r,h)){r[h].components+=","+i.join(",");r[h].quantity++}else r[h]={components:i.join(","),package:d,quantity:1,value:c,customPara:{LCSC:l.BOM_LCSC||"",Manufacturer:l.BOM_Manufacturer||"","Manufacturer Part":l["BOM_Manufacturer Part"]||"",Supplier:l.BOM_Supplier||""}}}for(var u in r)t.push(r[u]);return t}function tr(e){var t=pi.gJsonCache.FOOTPRINT[e],r=t&&t.PAD,n=[];for(var i in r)if(r.hasOwnProperty(i)){var a=r[i];n.push({gId:a.gId,number:a.number,net:a.net})}return n}function rr(e){for(var t=pi.gJsonCache.SIGNALS[e],r=[],n=0,i=t.length;n<i;n++){var a=t[n];if(a&&"PAD"==a.cmd&&a.fid&&a.gId){var o=function(e,t){var r=pi.gJsonCache.FOOTPRINT[e],n=r.PAD,i=r.TEXT,a="",o="";for(var s in n)if(n.hasOwnProperty(s)&&n[s].gId==t){a=n[s].number;break}for(var l in i)if(i.hasOwnProperty(l)&&"P"==i[l].type){o=i[l].text;break}return{pre:o,number:a}}(a.fid,a.gId);ai.extend(o,a);o.net=e;r.push(o)}}return r}function nr(e){if(!e||!e.length)return[];for(var t={},r=0;r<e.length;r++){var n=m(e[r],"net");n&&Mr(m(e[r],"layerid"))&&(t[n]=!0);for(var i=h("[net]",e[r]),a=0;a<i.length;a++){n=m(i[a],"net");n&&Mr(m(i[a],"layerid"))&&(t[n]=!0)}}return Object.keys(t)}function ir(){var e,t,r,n,i={},a=pi.getAllNetName(),o=pi.gJsonCache.preference.hideNets||[];for(e=0,r=a.length;e<r;e++){n=!1;var s=a[e];if(s){for(t=0;t<o.length;t++)if(o[t]==s){n=!0;break}if(!i[s]){i[s]={connect:[],pads:rr(s),checked:!n,isRouted:Ei.isRoutedOfOneNet(s)};pi.gJsonCache.SIGNALS[s].forEach(function(e){return function(t){"PAD"==t.cmd&&t.fid||i[e].connect.push(ai.extend({},t))}}(s))}}}return i}function ar(e,t){var r,n,i,a,o,s,l,c=!1,h=pi.gJsonCache.preference||{};if("component"==t){var u=h.hideFootprints||[];for(r=0,n=u.length;r<n;r++)if(e.id==u[r]){c=!0;delete u[r];break}if(c)m(d(e.id),"display","");else{m(d(e.id),"display","none");u.push(e.id)}}else if("net"==t){var p=h.hideNets||[];for(r=0,n=p.length;r<n;r++)if(e.text==p[r]){c=!0;delete p[r];break}c||p.push(e.text);a=d("pcbNetStyle").sheet;o=a.cssRules;s=null;l='line[net="'+e.text+'"], polyline[net="'+e.text+'"], path[net="'+e.text+'"]';for(r=0,i=o.length;r<i;r++)if(0===o[r].selectorText.indexOf('line[net="'+e.text+'"]')||0===o[r].selectorText.indexOf("line[net='"+e.text+"']")){s=o[r];break}var f=!c;!s&&f?a.insertRule(l+"{display:none;}",o.length):s&&(s.style.display=f?"none":"");gi&&m(gi,"net")==e.text&&(f?nt():it(gi))}}function or(e){if(Qi!=Dn.PCBLIB&&d("pcbNetStyle")){for(var t,r=d("pcbNetStyle").sheet,n=r.cssRules,i=0,a=n.length;i<a;i++)if(0===n[i].selectorText.indexOf("line[net]:not([net=")){t=n[i];break}if(e){var o='line[net]:not([net="'+e+'"])',s='line[net="'+e+'"][layerid="9"]:not([c_para])';if(t)t.selectorText=o;else{r.insertRule(o+"{display:none;}",i);r.insertRule(s+"{stroke: #fff;}",i+1)}}else if(t){r.deleteRule(i);r.deleteRule(i)}}}function sr(){var e,t,r,n=pi.gJsonCache.FOOTPRINT,i={};for(var a in n)if(A(n,a)){e=n[a];r=ai.c_paraToJson(e.head.c_para).package;t="";for(var o in e.TEXT)if(A(e.TEXT,o)&&"P"==e.TEXT[o].type){t=e.TEXT[o].text;break}if(t){i[t]={package:r,uuid:e.head.uuid||"",utime:e.head.utime||"",netNode:{}};for(o in e.PAD)A(e.PAD,o)&&(i[t].netNode[e.PAD[o].number]=e.PAD[o].net)}}return i}function lr(e){for(var t,r,n=pi.gJsonCache.SIGNALS[e]||[],i=0,a=[],o=[],s=[],l=0,c=n.length;l<c;l++){r=n[l];if(r)if("TRACK"==r.cmd||"VIA"==r.cmd||"ARC"==r.cmd){t=d(r.gId);if(t){o.push(t);a.push(["del",t.id,ai.node.getRefId(t)]);i++}}else"COPPERAREA"==r.cmd&&s.push(r.gId)}s.forEach(function(e){Ai.resetActiveCopperPolygons(pi.gJsonCache.COPPERAREA[e])});if(i>0){for(l=0;l<a.length;l++){t=o[l];pi.removeOne(t);li.appendChild(t)}Pi.save(a);Ei.buildOneNet(e,!1)}return!0}function cr(e){Pi.startBatch();var t=pi.getAllNetName()||[];M(e)&&(t=t.filter(function(t){return-1===e.indexOf(t)}));var r=t.every(lr);Pi.saveBatch();return r}function dr(){var e={unit:bi.canvas.unit};for(var t in pi.gJsonCache.DRCRULE)A(pi.gJsonCache.DRCRULE,t)&&(e[t]="isRealtime"==t?pi.gJsonCache.DRCRULE[t]:ai.toFixed(function(e){return ai.units.convert(e,"pixel",bi.canvas.unit)}(pi.gJsonCache.DRCRULE[t]),3));return e}function hr(e){for(var t in e)if(A(e,t))if("isRealtime"==t)pi.gJsonCache.DRCRULE[t]=e[t];else{var r=ai.toFixed(function(e){return ai.units.convert(e,bi.canvas.unit,"pixel")}(e[t]),3);if(r<.1){parent.$.messager.alert(t+" is too small!");return!1}pi.gJsonCache.DRCRULE[t]=r}}function ur(){if(Ci&&Ci.init&&Ci.doDRC){Oi.rebuild();Ci.init();return Ci.doDRC()}}function pr(e){e&&Ci&&Ci._markError&&Ci._markError(e)}function fr(e,r,n){
var i=E(e);if(i){var a=i.documentElement,o={};Gi.insertBefore(a,d("layer_other_end"));a.id=ai.newId();n=ai.svg.getBBox(a);var s=[n.x,n.y,n.width,n.height],l=Math.round(+s[0]+s[2]/2),c=Math.round(+s[1]-5);o.area=n.width*n.height;o.footprintBBox=n;o.preObj={node:a,id:a.id};var u={text:r,x:l,y:c,fontSize:4.5,fontFamily:""},p=tt("getFontPath",[u])||"M0,0",f='<g xmlns="http://www.w3.org/2000/svg" id="'+ai.newId()+'" c_partid="part_pcbtext" c_origin="'+l+","+c+'" c_shapetype="group" layerid="3"><path c_note="note_pre" c_fontSize="4.5" c_text="'+D(r)+'" d="'+p+'" fill="none" stroke-width="0.7"/></g>',g=E(f);if(g){var y=t.importNode(g.documentElement,!0);a.insertBefore(y,a.firstChild)}m(h("*[id]",a),"id","");Fe(a);ui.ini(r);return[o,a,n]}}function gr(e){pi.gJsonCache.DRCRULE.isRealtime=!0;hi=T();var t,r,n,i,a,o,s,l,c,d,h={},u=0;n=/.*?(?=\d+$)/;for(t in e)if(e.hasOwnProperty(t)){if("maxGgei"===t)continue;try{s=e[t].footprint;o=h[s];a=o&&o.footprintBBox?o.footprintBBox:void 0;i=fr(e[t].svgStr,t,a);u+=i[0].area;o||(h[s]={BBox:i[0].footprintBBox,footprints:[]});i[0].preObj.pre=t;r=+t.replace(n,"");i[0].preObj.preNumber=r;l=h[s].footprints;if(l.length){for(c=0,d=l.length;c<d;c++)if(r<l[c].preNumber){l.splice(c,0,i[0].preObj);break}c===d&&l.push(i[0].preObj)}else l.push(i[0].preObj)}catch(e){}}Oi.init();yr(h,u);pi.calAll();Ei.buildAllNet();zi.show(Fn.RATLINES,!0);tt("triggerEvent",["layer_update"]);Pi.clear({saved:!1})}function yr(e,t){var r=Ui.getViewBox(),n=r[0]+100/ci|0,i=r[1]+100/ci|0,a=0|Math.sqrt(2*t),o=1.5*a|0;!function(e,t,r,n,i){var a,o,s=" ",l="A"+i+s+i+" 0 0 1 ",c={"stroke-width":"1",fill:"none",c_shapetype:"line",c_etype:"wire",net:"",layerid:Fn.BOARDOUTLINE};if(i&&i>0){a=[e+i+s+t,e+r+s+t,e+r+s+(t+n),e+s+(t+n),e+s+(t+i)];o=[Ue("polyline",{id:ai.newId(),points:a.join(s)}),Ue("path",{id:ai.newId(),d:"M"+a[4]+l+a[0]})]}else{a=[e,t,e+r,t,e+r,t+n,e,t+n,e,t];o=[Ue("polyline",{id:ai.newId(),points:a.join(s)})]}m(o,c);for(var d=0;d<o.length;d++)zi.appendElement(o[d])}(n,i,o,a,0);var s,l,c,h,p,f,g,y,v,x,_,P,S,b,C,A,I=0,L=0;P=+m(d("gridPattern"),"width");P<10&&(P=Math.ceil(10/P)*P);s=n;l=i+a+P;for(var E in e)if(e.hasOwnProperty(E)){c=e[E];h=c.footprints;v=!0;for(x=0,_=h.length;x<_;x++){p=h[x].node;f=ai.svg.getBBox(p);C=s-f.x;A=l-f.y;I=0;L=0;g=u('g[c_partid="part_pad"][c_origin]',p);g||(g=u("g[c_origin]",p));if(g){y=m(g,"c_origin");if(y){y=ai.numberlistToArray(y);S=(y[0]+C)%P;if(S){S<0&&(S+=P);I=P-S}b=(y[1]+A)%P;if(b){b<0&&(b+=P);L=v&&b<P/2?-b:P-b}}}wi.move(p,ai.toFixed(C+I,2),ai.toFixed(A+L,2));l+=f.height+L;v=!1}l=i+a+P;s+=f.width+P/2+I}}function vr(t){function r(e){var t=b&&b[e];return t&&C[t]}function n(e,t){var r=b&&b[e];r&&t&&(C[r]=t)}function i(e){return Math.ceil(e/I+.5)*I}function a(e,t){var r=fr(e,t,null),a=r[2];_.push({w:i(a.width),h:i(a.height+7.675),x:a.x,y:a.y,pre:t,elem:r[1]});n(t,a)}function o(e){var t=_[e],r=t.elem,n=m(r,"c_origin").split(",");n={x:+n[0],y:+n[1]};var i=Ie({x:n.x+t.moveX,y:n.y+t.moveY});Ee(r,i.x-n.x,i.y-n.y)}function s(e){for(var t,r=h("#g1>g>g path[c_note]",Gi),n=0;n<r.length;n++){t=m(r[n],"c_text");if(V(t||"").toUpperCase()==e.toUpperCase())return r[n].parentNode.parentNode}}function l(e){var t=Date.now(),i=s(e),a=y.packageSVG[e];if(i&&a&&a.svgStr){var o=r(e),l=fr(a.svgStr,e,o);o||n(e,l[2]);if(Array.isArray(l)){var c=l[1],d=(m(i,"c_origin")||"0,0").split(","),p=(m(c,"c_origin")||"0,0").split(","),f=m(i,"c_rotation")||0;d[0]-=0;d[1]-=0;p[0]-=0;p[1]-=0;var g=d[0]-p[0],v=d[1]-p[1];if(m(i,"layerid")==Fn.BOTTOMLAYER){Sn(c,Fn.BOTTOMLAYER);zi.moveElementToLayer(c,Fn.BOTTOMLAYER)}f%360&&Ri.g(c,360-f,p[0],p[1]);!function(){var e=function(e,t){var r=u('[c_partid="part_pad"]',e),n=r&&m(r,"layerid"),i=n&&u('[c_partid="part_pad"][layerid="'+n+'"]',t);if(r&&i){var a=m(r,"c_origin").split(","),o=m(i,"c_origin").split(","),s=[o[0]-a[0],o[1]-a[1]];if(!isNaN(s[0])&&!isNaN(s[1]))return s}var l=ut("pre",e),c=ut("pre",t);l&&(l.style.display="none");c&&(c.style.display="none");var d=e.getBBox(),h=t.getBBox();l&&(l.style.display="");c&&(c.style.display="");return[h.x-d.x,h.y-d.y]}(c,i);if(e){g=e[0];v=e[1]}}();g=ai.toFixed(g,2);v=ai.toFixed(v,2);wi.move(c,g,v);for(var x=h("[id]",i),_=0;_<x.length;_++){var P=u('#gNets > text[for="'+x[_].id+'"]');P&&m(P,{for:"",display:"none"})}var S=u("path[c_note=note_pre]",i);if(S){S=S.parentNode;c.replaceChild(S,c.children[0])}Gi.removeChild(i);E.findAndReplaceComponent+=Date.now()-t}}}var c,d,p,f,g,y=t[0],v=t[1],x=/^(.*?)(\d+(?:\.\d+)?)$/,_=[],P=0;Pi.clear({saved:!1});gClipboard.childNodes.length>0&&ai.node.clearChildNodes(gClipboard);var S=parent.globalEditorClipboard;S&&S[1]==e.frameElement.id&&(parent.globalEditorClipboard=null);Ct();tt("triggerEvent",["select_change"]);m(h("#gNets > text[for^=gge]",gNets),{for:"",display:"none"});tt("importChangesProgressUpdate",[.01]);var b=y.prePackageMap,C={},I=Math.max(bi.adsorbGrid.gridSize,bi.adsorbGrid.distanceX);I<10&&(I=Math.ceil(10/I)*I);var L=function(){function e(){for(var a=Date.now();r.length&&Date.now()-a<100;)r.shift()();if(t){var o=r.length&&i?1-r.length/i:1;t(o)}r.length?setTimeout(e,0):n="idle"}var t,r=[],n="idle",i=0;return{addTask:function(e){r.push(e);return L},run:function(){if("idle"==n){n="running";i=r.length;e()}},onProgress:function(e){t=e}}}();L.addTask(function(){for(var e in y.remove)if(A(y.remove,e)){var t=s(e);t&&Gi.removeChild(t)}d=Gi.getBBox();p=d.x+d.width+2*bi.adsorbGrid.distanceX;f=d.y+d.height+2*bi.adsorbGrid.distanceY});for(c in y.add)if(A(y.add,c)&&y.packageSVG[c]&&y.packageSVG[c].svgStr){L.addTask(a.bind(null,y.packageSVG[c].svgStr,c));P++}L.addTask(function(){if(_.length){g=new GrowingPacker;_.sort(function(e,t){if(e.h!=t.h)return t.h-e.h;if(e.w!=t.w)return t.w-e.w;if(e.pre[0]!=t.pre[0])return e.pre<t.pre?-1:1;var r=e.pre.match(x),n=t.pre.match(x);return r&&n&&r[1]==n[1]?r[2]-n[2]:e.pre<t.pre?-1:1});g.fit(_);_.forEach(function(e){e.moveX=p+e.fit.x-e.x;e.moveY=f+e.fit.y-e.y})}});for(;P--;)L.addTask(o.bind(null,P));for(c in y.replace)A(y.replace,c)&&L.addTask(l.bind(null,c));L.addTask(function(){Ei.removeAllRatline()});v&&L.addTask(function(){for(var e in v)if(A(v,e)){var t=v[e];e=e.replace(/\\\"/g,"\\$&");var r=h('#g1 [net="'+e+'"]');r.length&&m(r,"net",t)}});L.addTask(function(){hi=1;[].forEach.call(h("#g1 [id^=gge]"),function(e){e.id=ai.newId()});var e=Date.now();pi.calAll();E.calAll+=Date.now()-e});L.addTask(function(){var e=Date.now();Ei.buildAllNet();E.buildAllNet+=Date.now()-e});L.addTask(function(){C=null;Oi.rebuild();if(bi.isForceShowDRC)parent.$.messager.show({title:"OK",width:"150",msg:"Done",timeout:7e3,showType:"slide"});else{bi.isForceShowDRC=!0;tt("pcb_DRC")}});var E={findAndReplaceComponent:0,calAll:0,buildAllNet:0};L.onProgress(function(e){e=Math.min(1,Math.max(e,.01));tt("importChangesProgressUpdate",[e])});L.run()}function mr(){return pi.gJsonCache.systemColor}function xr(e,t){for(var r=null,n=e.childNodes,i=null,a=null,o=0;o<n.length;o++)if("part_pcbtext"==m(n[o],"c_partid")){r=n[o];break}if(r){t&&(i=e.cloneNode(!0));var s=Number(m(e,"c_rotation")),l=Number(m(r,"c_rotation")),c=0;s>=315&&s<360||s>=0&&s<=45?c=0:s>45&&s<=135?c=90:s>135&&s<=225?c=0:s>225&&s<315&&(c=90);if(l!=c){var d=oe(360-(parseInt(c,10)-parseInt(l,10)));Ri.rotate(r,d);m(r,"c_rotation",c);if(t&&i){a=e.cloneNode(!0);Pi.save(["node",e.id,i,a])}}}}function _r(e,t){if(Mr(e)){var r='polyline[layerid="*"], path[layerid="*"], g[c_partid="part_pad"][layerid="*"]';r=r.replace(/\*/g,e);jr(h(r,Gi),void 0,t)}}function Pr(e){var t=e.points,r=t.numberOfItems;if(r<2)return null;for(var n=[],i=[],a=0;a<r;a++){n[a]=t.getItem(a);a>0?n[a].y==n[a-1].y?i[a]=i[a-1]+Math.abs(n[a].x-n[a-1].x):n[a].x==n[a-1].x?i[a]=i[a-1]+Math.abs(n[a].y-n[a-1].y):i[a]=i[a-1]+te(n[a].x,n[a].y,n[a-1].x,n[a-1].y):i[a]=0}var o=i[r-1],s=o/2;for(a=1;a<r;a++)if(i[a]>=s&&i[a]>i[a-1]){var l=i[a]==s?.5:(i[a]-s)/(i[a]-i[a-1]),c=n[a].x-(n[a].x-n[a-1].x)*l,d=n[a].y-(n[a].y-n[a-1].y)*l,h=180*Math.atan2(n[a].y-n[a-1].y,n[a].x-n[a-1].x)/Math.PI|0;return{x:c,y:d,angle:h,len:s}}return null}function Sr(){tt("updatePCBSnapSizeList",[Bi.getPCBSnapSizeList()])}function br(e,t){var r=[];r=(pi.gJsonCache.SIGNALS[e]||[]).map(function(e){return e.gId});at(r,t);Qi==Dn.PCB&&Ei.highlightNets([e]);var n=Vi.getWholeNetLength(e);n>0&&parent.$.messager.show({title:"Net Length",width:"150",msg:n+bi.canvas.unit,timeout:7e3,showType:"slide"})}function Cr(e){var t=function(e){return ai.units.convert(e,"pixel",bi.canvas.unit)},r="";e=e||u(".active",Gi);if(e&&"PAD"==ai.getPCBCmdKey(e)&&"POLYGON"==m(e,"c_shape")){var n=w(m(e.childNodes[0],"points"));if(n.length>1&&n.length%2==0){for(var i=0,a=n.length;i<a;i++)n[i]=i%2==1?ai.toFixed(t(n[i]-bi.canvas.originY),3):ai.toFixed(t(n[i]-bi.canvas.originX),3);r=n.join(" ")}}return r}function Ar(e,t){var r=function(e){return ai.units.convert(e,bi.canvas.unit,"pixel")},n=w(e),i=n.length;t=t||u(".active",Gi);if(t&&"PAD"==ai.getPCBCmdKey(t)&&"POLYGON"==m(t,"c_shape")&&i>=6){for(var a=0;a<i-1;a+=2){n[a]=ai.toFixed(r(n[a])+bi.canvas.originX,2);n[a+1]=ai.toFixed(r(n[a+1])+bi.canvas.originY,2)}e=n.join(" ");var o=t.cloneNode(!0);m(t.childNodes[0],"points",e);var s=ai.svg.getBBox(t);m(t,{c_width:s.width,c_height:s.height});pi.updateOne(t);Ei.buildOneNet(m(t,"net"),!1);var l=t.cloneNode(!0);Pi.save(["node",t.id,o,l]);return!0}return!1}function Ir(e){if("object"!=typeof e){var t=pi.gJsonCache.routerRule;t=t?I(JSON.stringify(t)):{};var r={},n=bi.canvas.unit||t.unit,i=function(e){return ai.units.convert(e,"pixel",n)};r.unit=n;r.trackWidth=ai.toFixed(i(.8),3);r.trackClearance=ai.toFixed(i(.7),3);r.viaHoleD=ai.toFixed(i(1.2),3);r.viaDiameter=ai.toFixed(i(2.4),3);r.routerLayers="ALL";var a=dr(),o=Math.min(a.track2Pad||0,a.pad2Pad||0);o=ai.units.convert(o,bi.canvas.unit,n);r.smdClearance=o;for(var s in r)A(r,s)&&!A(t,s)&&(t[s]=r[s]);if(r.unit!=t.unit){i=function(e){return ai.toFixed(ai.units.convert(e,t.unit,r.unit),3)};t.trackWidth=i(t.trackWidth);t.trackClearance=i(t.trackClearance);t.viaHoleD=i(t.viaHoleD);t.smdClearance=i(t.smdClearance);t.viaDiameter=i(t.viaDiameter);if(M(t.specialNets)&&t.specialNets.length)for(var l=0;l<t.specialNets.length;l++){t.specialNets[l].width=i(t.specialNets[l].width);t.specialNets[l].clearance=i(t.specialNets[l].clearance)}t.unit=n}t.nets=(pi.getAllNetName()||[]).sort();t.padsCount=function(){function e(e){"PAD"==e.cmd&&n++}var t,r,n=0;r=pi.gJsonCache.SIGNALS;for(t in r)A(r,t)&&r[t].forEach(e);return n}();return t}pi.gJsonCache.routerRule||(pi.gJsonCache.routerRule={});for(var c in e)A(e,c)&&("object"==typeof e[c]?pi.gJsonCache.routerRule[c]=I(JSON.stringify(e[c])):pi.gJsonCache.routerRule[c]=e[c])}function Lr(e){var t,r,n=Yi,i=n.line;if("draw.track"===xi&&i){var a,o,s,l,c=n.dots.length;t=zi.getActiveLayer();if(c<4)m(i,"layerid",t);else{r=m(i,"layerid");var d=i.tagName;if("polyline"==d){var h=i.points.numberOfItems;if(2*h>c){o=i.cloneNode(!0);m(o,"points",n.dots.join(" "));m(o,"id",ai.newId());if(!m(o,"net")){s=ft();m(o,"net",s);x(o,"c_auto_net");m(i,"net",s);m(i,"c_auto_net","1")}zi.appendElement(o);pi.updateOne(o);n.dots.splice(0,c-2);for(a=c/2-2;a>=0;a--)i.points.removeItem(a);m(i,"c_need_via",r);m(i,"layerid",t);m(i,"id",ai.newId());n.certainPath="";Pi.save(["add",o.id,ai.node.getRefId(o)])}else if(2*h==c){n.dots.splice(0,c-2);n.line=null;zi.appendElement(i);s=m(i,"net")||"";if(!s){s=ft();m(i,"net",s)}l=Or(n.dots[0],n.dots[1],s);pi.updateOne(l);pi.updateOne(i);n.certainPath="";Pi.save(["add",i.id+","+l.id,ai.node.getRefId(l)])}else m(i,"layerid",t)}else if("path"==d)if(n.certainPath){m(i,"d",n.certainPath);n.certainPath="";s=m(i,"net");if(r&&!s){m(i,"net",ft());s=m(i,"net")}var u=ai.node.getRefId(i),p=Fr(i),f=p.map(function(e){return e.id}).join(",");pi.updateMore(p);Ei.buildOneNet(s,!1);var g=["add",f,u];Pi.save(g);var y=Yi.routedRealRatLine,v=n.dots.slice(-2);n.dots.length=0;n.line=null;n.draw(v[0],v[1],!0);n.draw(n.mockX,n.mockY,!1);i=n.line;if(i){m(i,"c_need_via",r);m(i,"layerid",t);m(i,"net",s);n.draw(n.mockX,n.mockY,!1)}else{l=Or(v[0],v[1],s);pi.updateOne(l);pi.updateOne(i)}if(y){Yi.routedRealRatLine=y;2==Yi.routedRealRatLine[1]?m(Yi.routedRealRatLine[0],{x2:n.mockX,y2:n.mockY}):m(Yi.routedRealRatLine[0],{x1:n.mockX,y1:n.mockY})}}else m(i,"layerid",t)}}if(("draw.copperArea"===xi||"draw.copperArea"===xi)&&i){t=zi.getActiveLayer();m(i,"layerid",t);zi.appendElement(i)}}function Er(e,t,r){var n=pi.ifFind(t,r,"",Fn.ALL,"TRACK");if("TRACK"==n.type||"ARC"==n.type){dt(e,n.X,n.Y);m(e,"net",n.net)}if("TRACK"==n.type){var i=Vi.splitPloylineByPoint({x:n.X,y:n.Y},n.gId);if("object"==typeof i){var a=d(n.gId),o=a.cloneNode(!0),s=[];s[0]=["node",n.gId,a.cloneNode(!0),null];s[1]=["add","gge"+(hi+1)];m(a,"points",i[0]);m(o,{id:"gge"+ ++hi,points:i[1]});a.parentNode.insertBefore(o,a.nextSibling);pi.updateOne(a);pi.updateOne(o);s[0][3]=a.cloneNode(!0);return{history:s}}}}function Or(e,t,r){var n=d("part_via").cloneNode(!0);m(n,{id:"gge"+ ++hi,c_shapetype:"group",c_etype:"pinpart",net:r||""});x(n,"pointer-events");x(n,"display");zi.appendElement(n);dt(n,e,t);return n}function Tr(e,t){var r=e.querySelector('g path[c_note="note_pre"]');if(r){var n=m(r,"c_text");if(n&&n.indexOf("?")>0){var i=m(r.parentNode,"c_origin")||"0,0",a=i.split(",");n=ui.getNewPre(n);var o=m(r,"c_fontSize");m(r,"d",tt("getFontPath",[{text:n,x:a[0],y:a[1],fontSize:+o,fontFamily:""}]));m(r,"c_text",n);var s=[Fn.BOTTOMLAYER,Fn.BOTTOMSILKLAYER,Fn.BOTTOMPASTERLAYER,Fn.BOTTOMSOLDERLAYER],l=r.parentNode,c=+m(l,"c_rotation")||0,d=+m(l,"layerid");s.indexOf(d)>=0&&Ni.flipH(l);if(c){m(l,"c_rotation",0);Ri.rotate(r,360-c);m(l,"c_rotation",c)}}}}function wr(){var e,t,r=h('g[c_partid="part_pad"]',Gi),n=r.length;for(e=0;e<r.length;e++){t=m(r[e],"number");if(t){t=parseInt(t,10);!isNaN(t)&&t>n&&(n=t)}}m(d("part_pad"),{number:n+1})}function Rr(){var e=h("[layerid='"+Fn.BOARDOUTLINE+"']",Gi),t=d("part_board_frame");if(!t)return ai.svg.getBBox(Gi);m(t,"display","");for(var r=0,n=e.length;r<n;r++){var i=e[r].cloneNode(!0);t.appendChild(i)}var a=ai.svg.getBBox(t);ai.node.clearChildNodes(t);m(t,"display","none");return a}function Nr(e){function t(e,t){return ee(e.x,e.y,t.x,t.y)}var r,n,i,a,o,s,l,c=e.id,h=m(e,"layerid"),u=e.points.getItem(0),p=e.points.getItem(e.points.numberOfItems-1),f=pi.gJsonCache.TRACK;if(!le(u,p)){for(a in f)if(f.hasOwnProperty(a)&&a!=c&&f[a].layerid==h){o=f[a].pointArr;l=o.length-1;if(o&&l>0&&(le(o[0],u)&&le(o[l],p)||le(o[l],u)&&le(o[0],p)))return{type:"replace",track:d(a)}}var g,y,v=ai.svg.getBBox(e);v={x:v.x-1e-4,y:v.y-1e-4,width:v.width+2e-4,height:v.height+2e-4};for(a in f)if(f.hasOwnProperty(a)&&a!=c&&f[a].layerid==h){r=d(a);if(!r||!ai.isRectTouchRect(v,ai.svg.getBBox(r)))continue;g=K(u,r);if(g<0)continue;y=K(p,r);if(y<0)continue;var x=[].slice.call(e.points,0);if(g>y){g=[y,y=g][0];x.reverse()}else if(g==y&&g%2){var _=r.points.getItem(g-1>>1);if(t(p,_)<t(u,_)){g=[y,y=g][0];x.reverse()}}g%2<1&&x.shift();y%2<1&&x.pop();if(!x.length&&(Math.abs(g-y)<2||y%2<1&&2==Math.abs(g-y)))return{type:"cancel"};n=[].slice.call(r.points,0,1+(g>>1)).concat(x,[].slice.call(r.points,y+1>>1));i=[];for(s=0;s<n.length;s++)i.push(n[s].x,n[s].y);n=ai.toFixedString(i.join(" "));return{type:"merge",track:r,points:n}}}}function kr(){if("draw.track"==xi&&Yi.line&&"0"!=bi.canvas.angle){var e,t,r=bi.canvas.angle,n=Yi.trackPreference[r];if(n){var i=["45-90","90-45","arc-90","90-arc","h-v","v-h","arc+","arc-"];e=i.indexOf(n);if(!(e<0)){t=e%2?i[e-1]:i[e+1];Yi.trackPreference[r]=t;Yi.draw(Yi.lastX,Yi.lastY,!1)}}}}function Br(){return h("[layerid='"+Fn.BOARDOUTLINE+"']",Gi)}function Mr(e){e=+e;return e<Fn.TOPSILKLAYER||e>=Fn.INNER1||e==Fn.ALL}function Vr(e){return!!e&&e.parentNode==Gi}function Gr(e){return"circle"==e.childNodes[1].tagName?"round":"slot"}function Fr(e){for(var t,r,n,i,a,o=[],s={"stroke-width":m(e,"stroke-width"),fill:"none",c_shapetype:"line",layerid:m(e,"layerid"),net:m(e,"net")},l=e.pathSegList,c=l.numberOfItems,d=[],h=0;h<c;h++){t=l.getItem(h);r=t.pathSegTypeAsLetter;if("M"==r)d=[t.x,t.y];else if("L"==r)d.push(t.x,t.y);else{if("A"!=r)throw"breakTrackPathElement invalid arguments";if(!n)throw"breakTrackPathElement invalid arguments";if(d.length>=4){i=Ue("polyline",s);m(i,"points",d.join(" "));m(i,"id",ai.newId());e.parentNode.insertBefore(i,e);o.push(i)}a="M"+n.x+" "+n.y+"A"+t.r1+" "+t.r2+" "+t.angle+" "+ +t.largeArcFlag+" "+ +t.sweepFlag+" "+t.x+" "+t.y;i=Ue("path",{d:a});m(i,s);m(i,"id",ai.newId());e.parentNode.insertBefore(i,e);o.push(i);d=[t.x,t.y]}n=t}if(d.length>=4){i=Ue("polyline",s);m(i,"points",d.join(" "));m(i,"id",ai.newId());e.parentNode.insertBefore(i,e);o.push(i)}v(e);return o}function Dr(e,t){var r=e instanceof SVGPathElement,n="convertArcToTrackPoints invalid arguments",i=3;if(r||e.d){for(var a,o,s,l=r?e:Ue("path",{d:e.d}),c=[],d=l.pathSegList,h=d.numberOfItems,u=0;u<h;u++){a=d.getItem(u);o=a.pathSegTypeAsLetter;if("M"==o||"L"==o)c.push({x:ai.toFixed(a.x,2),y:ai.toFixed(a.y,2)});else{if("A"!=o)throw n;if(!s)throw n;!function(e,t,r){var a=+e.x,o=+e.y,s=ai.arc.getCenterParam(a,o,t.x,t.y,+t.largeArcFlag,+t.sweepFlag,t.r1,t.r2,t.angle);if(!s)throw n;var l=Math.PI/Ai._scaleFactor;s.delta_theta<0&&(l=-l);for(var c,d,h=s.startAngle+s.delta_theta,u=s.cx,p=s.cy,f=t.r1,g=a,y=o,v=s.startAngle+l;l>0==v<h;v+=l){c=ai.toFixed(u+f*Math.cos(v),i);d=ai.toFixed(p+f*Math.sin(v),i);if(c!=g||d!=y){r.push({x:c,y:d});g=c;y=d}}r.push({x:ai.toFixed(t.x,i),y:ai.toFixed(t.y,i)})}(s,a,c)}s=a}t&&(c=c.map(Ai.zoomInPoint));return c}if(A(e,"centerPoint")){var p=Math.PI,f=p+p,g=(e.endAngle-e.startAngle)%f,y=e.centerPoint,v=y.x,m=y.y,x=e.r;if(!g)return[];e.clockwise?g<0&&(g+=f):g>0&&(g-=f);var _=(Math.cos(p/8),Math.PI/Ai._scaleFactor),P=[],S=e.startAngle,b=S+g,C=function(e,t){var r=e.length;r&&e[r-1].x==t.x&&e[r-1].y==t.y||e.push(t)};if(g<0)for(;S>b;S-=_)C(P,{x:ai.toFixed(v+x*Math.cos(S),i),y:ai.toFixed(m+x*Math.sin(S),i)});else for(;S<b;S+=_)C(P,{x:ai.toFixed(v+x*Math.cos(S),i),y:ai.toFixed(m+x*Math.sin(S),i)});C(P,{x:ai.toFixed(v+x*Math.cos(b),i),y:ai.toFixed(m+x*Math.sin(b),i)});return P}return[]}function Hr(e,t){return(e+"").replace(/[^a-zA-Z]+/,"").toLocaleLowerCase()||t}function _r(e,t){if(Mr(e)){var r='polyline[layerid="*"], path[layerid="*"], g[c_partid="part_pad"][layerid="*"]';r=r.replace(/\*/g,e);jr(h(r,Gi),void 0,t)}}function jr(e,t,r){var n=d("gNets"),i="none"!=m(n,"display");if(!1===Yn.pcbNetTextVisible||ci<8)m(n,"display","none");else{if(!i){m(n,"display","");i=!0}if(void 0!==e||""!==t){var a,o,s,l,c,u=[],p=[],f=[],g='polyline[layerid], path[layerid], g[c_partid="part_pad"][layerid]';void 0===e&&(e=h(g,Gi));if(e){B(e)||(e=[e]);for(a=0,s=e.length;a<s;a++){c=e[a];if(c&&c.id&&(c.parentNode||""===t)){l=ai.getPCBCmdKey(c);if("FOOTPRINT"==l){var y=h(g,c);for(o=0;o<y.length;o++)if(y[o].id){l=ai.getPCBCmdKey(y[o]);if("TRACK"==l||"PAD"==l||"ARC"==l){p.push(l);u.push(y[o]);f.push(y[o].id)}}}else if("TRACK"==l||"PAD"==l||"ARC"==l){p.push(l);u.push(c);f.push(c.id)}}}Qi==Dn.PHOTOVIEW&&m(n,"transform",m(Gi,"transform"));var v=ci>=8&&!1!==Yn.pcbNetTextVisible,x={},_=zi.getLayersCache();for(a in _)A(_,a)&&(x[a]=zi.isVisible(a)&&Mr(a));_=null;var P=n.children,S={},b=[],C=[];for(a=0,s=P.length;a<s;a++){var I=m(P[a],"for");I?S[I]=a:b.push(a)}for(a=0,s=u.length;a<s;a++){l=p[a];e=u[a];var L=f[a],E=void 0===t?m(e,"net")||m(e,"number")||"":t,O=E.length*Yn.netTextCharWidth||0,T=!!E&&v;if(T){T=x[m(e,"layerid")]}var w=e.netTextCache,R=!!w;o=S[L];textNode=void 0===o?null:P[o];if(T){var N=!0;if(textNode){N="none"!=m(textNode,"display");if(!0===r){N||m(textNode,"display","");continue}}else{if(C.length)textNode=C.pop();else if(b.length){o=b.pop();textNode=P[o]}if(textNode){m(textNode,"for",L);m(textNode,"display","")}else{textNode=Ue("text");m(textNode,"for",L);m(textNode,"dy","0.35em");n.appendChild(textNode)}}var k,M,V=0,G=!1;if(R){k=w.x;M=w.y;V=w.angle}if("PAD"==l){if(!w){var F=+m(e,"c_width"),D=+m(e,"c_height"),H=m(e,"c_origin").split(","),j=+m(e,"c_rotation")||0;k=+H[0];M=+H[1];if("ELLIPSE"==m(e,"c_shape"))V=0;else{V=F>=D?0:90;j&&(V-=j)}w={x:k,y:M,angle:V,len:Math.max(F,D)};e.netTextCache=w}G=(w.len-O)*ci<20}else if("TRACK"==l&&e.points)if(w)G=!w.len||2*w.len<O;else{var U=Pr(e);if(U){k=U.x;M=U.y;V=U.angle;G=!U.len||2*U.len<O}else{k=0;M=0;V=0;G=!0}w={x:k,y:M,angle:V,len:U&&U.len||0};e.netTextCache=w}else{if("ARC"!=l){m(textNode,{for:"",display:"none",transform:""});C.push(textNode);continue}if(w)G=w.len<O;else{var Y=e.getTotalLength(),z=e.getPointAtLength(Y/2);k=z.x;M=z.y;var J=e.getPointAtLength(.48*Y);V=180*Math.atan2(z.y-J.y,z.x-J.x)/Math.PI|0;G=Y<O;w={x:k,y:M,angle:V,len:Y};e.netTextCache=w}}V&&(V>90?V-=180:V<=-90&&(V+=180));if(!R){textNode.textContent=E;var X=V?"rotate("+V+","+k+","+M+")":"";m(textNode,{x:k,y:M,transform:X})}N==G&&m(textNode,"display",G?"none":"");if(ni&&!G){var K=textNode.nextSibling;n.removeChild(textNode);n.insertBefore(textNode,K)}}else if(textNode){m(textNode,{for:"",display:"none",transform:""});C.push(textNode)}}}}else m(n.children,"display","none")}}function Ur(){function e(e){var t=e.target;t&&1!==t.nodeType&&t.parentNode&&(t=t.parentNode);if(!t||!t.tagName||"TEXTAREA"!=t.tagName.toUpperCase()){e.preventDefault();e.stopPropagation();return!1}}for(var r=["selectstart","drag","draggesture","dragstart","dragover"],n=0;n<r.length;n++)t.addEventListener(r[n],e,!1);void 0!==ti&&ti&&t.addEventListener("mousedown",function(e){if((qn?e.metaKey:e.ctrlKey)&&0===e.button){fi.currentScale=1;fi.currentTranslate.x=0;fi.currentTranslate.y=0}},!1)}function Yr(e){this.x0=0;this.y0=0;this.x1=0;this.y1=0;this.ready=!1;this.start=!1;e&&e.ondragstart&&(this.ondragstart=e.ondragstart);e&&e.ondrag&&(this.ondrag=e.ondrag);e&&e.ondragend&&(this.ondragend=e.ondragend)}function zr(e){var r=this;r.x0=0;r.y0=0;r.x1=0;r.y1=0;r.target=null;r.ready=!1;r.start=!1;if(e)for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);t.addEventListener("mousedown",r.mdown,!1)}function Jr(e){var t=this;t.x0=0;t.y0=0;t.x1=0;t.y1=0;t.ready=!1;t.start=!1;t.mouseIsDown=!1;t.mousedownTarget=fi;t.mousemoveTarget=fi;t.mouseupTarget=fi;if(e&&e instanceof Object)for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.e={};t.e.mdown=function(e){t.mdown.call(t,e)};t.e.mmove=function(e){t.mmove.call(t,e)};t.e.mup=function(e){t.mup.call(t,e)}}function Xr(){return Xn&&Xn.start||Kn&&Kn.start||Wn&&Wn.start}function Kr(){var e={rect:Fi,show:function(e,t,r,n){m(Fi,{display:"",width:r,height:n,x:e,y:t})},showD:function(e,t,r,n){m(Fi,{display:"",width:Math.abs(r),height:Math.abs(n),x:r>0?e:e+r,y:n>0?t:t+n})},hide:function(){m(Fi,{display:"none"})}};Xn=new Yr({ondragstart:function(e){Pi.tmpNode=this.target.cloneNode(!0)},ondrag:function(e){},ondragend:function(e){var t=this.target;"line"==m(t,"c_shapetype")&&it(t);pi.updateOne(t);Qi!=Dn.PCB||"TRACK"!=ai.getPCBCmdKey(t)&&"ARC"!=ai.getPCBCmdKey(t)&&"SOLIDREGION"!=ai.getPCBCmdKey(t)||Ei.buildOneNet(m(t,"net"),!0);Pi.save(["node",t.id,Pi.tmpNode,t.cloneNode(!0)]);Pi.tmpNode=null}});Kn=new zr({ondragstart:function(e){var t,r,n=this,i=n.target,a=n.selectedObjs,o=[];nt();if(n.atPartNoteText)n.hist=["node",i.id,i.cloneNode(!0),null];else{if(Qi==Dn.PCB){n._build_duration=void 0;n._padsCount=void 0;if(a.length<2){var s=nr(a);Ei.highlightNets(s);n._padsCount=h('g[c_partid="part_pad"]',Gi).length}var l,c,u=Xi.calFollowing(a),p=u.followingWireIds;n.tracks={};for(l in p)if(A(p,l)){c=d(l);if(c){o.push(["node",l,c.cloneNode(!0),null]);n.tracks[l]=function(e){function t(e,t,r){function n(n){n=n||0;var i=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),a=Math.sqrt(Math.pow(t.x-r.x,2)+Math.pow(t.y-r.y,2)),o=Math.sqrt(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2)),s=180*Math.acos((a*a+i*i-o*o)/(2*a*i))/Math.PI;return Math.abs(s-n)<=1}return n(90)||n(180)?e.x===t.x?"v-h":e.y===t.y?"h-v":void 0:Math.abs(e.x-t.x)<=1||Math.abs(e.y-t.y)<=1?"90-45":"45-90"}for(var r=e.points,n={points:[]},i=0;i<r.numberOfItems;i++){var a=r.getItem(i);n.points.push(a.x);n.points.push(a.y)}if(r.numberOfItems<3){n.start="h-v";n.end="h-v";return n}n.start=t(r.getItem(0),r.getItem(1),r.getItem(2));n.end=t(r.getItem(r.numberOfItems-3),r.getItem(r.numberOfItems-2),r.getItem(r.numberOfItems-1));return n}(c)}}n.followingInfo=u}o.wiresCount=o.length;for(t=0,r=a.length;t<r;t++)o.push(["node",a[t].id,a[t].cloneNode(!0),null]);n.hist=o}},ondrag:function(e){var t=this,r=(t.target,t.selectedObjs);if(t.atPartNoteText);else if(Qi==Dn.PCB){Xi.moveFollowing(t.followingInfo,t.movedX,t.movedY,t.tracks);var n,i=t.followingInfo.followingWireIds;for(n in i)A(i,n)&&pi.updateOne(d(n));pi.updateMore(r);if(r.length<2){var a=t._build_duration>50&&Date.now()-t._build_last<2*t._build_duration;if(a){t._timer_build&&clearTimeout(t._timer_build);t._timer_build=setTimeout(function(e){return function(){t._timer_build=0;var r=Date.now();Ei.buildRatLinesOfPCBLib(e);t._build_duration=Date.now()-r;t._build_last=Date.now()}}(r),100)}else{var o=Date.now();Ei.buildRatLinesOfPCBLib(r);t._build_duration=Date.now()-o;t._build_last=Date.now()}}}else pi.updateMore(r)},ondragend:function(e){var t=this,r=t.target,n=t.selectedObjs,i=!(!t.movedX&&!t.movedY);if(t.atPartNoteText){r.parentNode==Gi?pi.updateOne(r):pi.updateOne(r.parentNode);if(t.hist){if(!i&&ai.node.isSame(t.hist[2],r))return;t.hist[3]=r.cloneNode(!0);Pi.save(t.hist);t.hist=null}}else{Qi==Dn.PCB&&Ei.cancelHighlightNets();if(1==n.length&&"line"==m(n[0],"c_shapetype")){gi&&gi!=n[0]&&Ct();it(n[0]);gi=n[0];p(gi,"active",!0)}1==n.length&&tt("updateAttrPanel");var a,o,s,l,c,h,u=0,f=0,g=t.hist;g||(g=[]);g.wiresCount||(g.wiresCount=0);if(Qi==Dn.PCB&&g.wiresCount)for(l=0,c=g.wiresCount;l<c;l++){a=g[l][1];o=d(a);if(m(o,"points")!=m(g[l][2],"points")){u++;if(o.points.numberOfItems<2){s=ai.node.getRefId(o);pi.removeOne(o);m(o,"points",m(g[l][2],"points"));li.appendChild(o);g[l]=["del",a,s]}else{g[l][3]=o.cloneNode(!0);pi.updateOne(o)}}else g[l].length=0}pi.updateMore(n);if(Qi==Dn.PCB){var y="";for(l=0,c=n.length;l<c;l++){y=ai.getPCBCmdKey(n[l]);"SOLIDREGION"==y?Ei.buildOneNet(m(n[l],"net"),!0):"FOOTPRINT"==y&&Ei.buildRatLinesOfPCBLib(n[l])}}for(l=0,c=n.length;l<c;l++){h=g[l+g.wiresCount];if(h)if(!i&&ai.node.isSame(h[2],n[l]))h.length=0;else if("path"==n[l].tagName&&m(n[l],"attachedcopperid"))h.length=0;else{f++;h[3]=n[l].cloneNode(!0)}}g.length&&(u||f)&&Pi.save(g);t.hist=null}}});Wn=new Jr({strictMousedownTarget:fi,onmousedown:function(e,t){if(xi)return!1;if(Xn.start)return!1;if(Kn.start)return!1;if(Qi==Dn.PHOTOVIEW)return!1;if(!e.shiftKey){var r=Xt();if(r.length>0){Ct(r);tt("triggerEvent",["select_change"])}}},onready:function(e,t){Ct()},ondragstart:function(e,t){},ondrag:function(t,r){0!==r.dx&&0!==r.dy?e.showD(r.x0,r.y0,r.dx,r.dy):e.hide()},ondragend:function(t,r){e.hide();for(var n,i,o,s,l,c,d={x:r.dx>0?r.x0:r.x0+r.dx,y:r.dy>0?r.y0:r.y0+r.dy,width:r.dx>0?r.dx:-r.dx,height:r.dy>0?r.dy:-r.dy},h=Gi.children,u=h.length,g=u;--g>=0;){l=h[g];c=getComputedStyle(l);if((!c||"none"!=c.display)&&!(c&&"none"==c.pointerEvents||Mi.isLocked(l))){var y=m(l,"layerid");if((!y||zi.isVisible(y))&&0!==l.id.indexOf("layer_")&&!m(l,"attachedcopperid")){try{i=ue(l)}catch(e){continue}if(i.width||i.height){if(r.dx>0)o=ai.isRectInRect(i,d);else{o=ai.isRectTouchRect(i,d);o&&("polyline"==l.tagName?o=ai.isPolylineTouchRect(l,d):"polygon"==l.tagName&&(o=ai.isPolygonTouchRect(l,d)))}n=f(l,"selected");if(o!=n){p(l,"selected",o);s=!0}}}}}s&&tt("triggerEvent",["select_change"]);a("dragMoveCheck",[t])}})}function Wr(e){var r,n,i,a=si;if(a.on!==e){if(a.on&&a.waitingSave&&a.targets){if(a.pasting)return;if(a.offsetX||a.offsetY){pi.updateMore(a.targets);Qi==Dn.PCB&&Ei.buildRatLinesOfPCBLib(a.targets);if(a.crossProbePlaceMoves){r=a.crossProbePlaceMoves;n=[];for(i=0;i<r.length;i++)n.push(["move",r[i].id,r[i].offsetX+a.offsetX,r[i].offsetY+a.offsetY]);Pi.save(n);a.crossProbePlaceMoves=null}else Pi.save(["move",a.ids,a.offsetX,a.offsetY])}a.targets=null;a.ids="";a.waitingSave=0}xt();a.on=void 0!==e?e:!a.on;!a.on&&a.targets&&(a.targets=null);st(a.on?"grab":void 0);if(!1===e&&a.bind){a.bind=!1;t.removeEventListener("mousemove",en,!1);t.removeEventListener("mouseup",Qr,!1)}}}function qr(e,r){if(si.on){si.targets=r||Xt();if(!(si.targets.length<=0)){var n=si,a=Qe(e,!1);n.startX=a.x;n.startY=a.y;n.offsetX=0;n.offsetY=0;n.hasPin=!!u('g.selected[c_partid="part_pad"], g.selected g[c_partid="part_pad"]');r||(r=n.targets);p(Gi,"hidetext",!1);var o=r[0].id,s=r.length;for(i=1;i<s;i++)o+=","+r[i].id;n.ids=o;n.waitingSave=0;st("grabbing",n.startX,n.startY);if(!si.bind){si.bind=!0;t.addEventListener("mousemove",en,!1);setTimeout(function(){t.addEventListener("mouseup",Qr,!1)},1)}}}}function $r(e){var r=si;r.pasting=!0;r.targets=e.targets;r.startX=e.x;r.startY=e.y;r.offsetX=0;r.offsetY=0;r.hasPin=e.hasPin;p(Gi,"hidetext",!1);var n,i=r.targets[0].id,a=r.targets.length;for(n=1;n<a;n++)i+=","+r.targets[n].id;r.ids=i;r.waitingSave=1;if(!r.bind){r.bind=!0;t.addEventListener("mousemove",en,!1);setTimeout(function(){t.addEventListener("mouseup",Qr,!1)},1)}}function Qr(e){var t,r,n,i=si;if(i.on)if(i.pasting)Zr(e);else if(e.button===Vn){if(i.waitingSave&&i.targets){pi.updateMore(i.targets);Qi==Dn.PCB&&Ei.buildRatLinesOfPCBLib(i.targets);if(i.crossProbePlaceMoves){t=i.crossProbePlaceMoves;r=[];for(n=0;n<t.length;n++)r.push(["move",t[n].id,t[n].offsetX+i.offsetX,t[n].offsetY+i.offsetY]);Pi.save(r);i.waitingSave=0;i.crossProbePlaceMoves=null}else{Pi.save(["move",i.ids,i.offsetX,i.offsetY]);i.waitingSave=0}}a("dragMoveSwitch",[!1]);i.on=!0;st("grab")}else if(e.button===Gn){if(i.crossProbePlaceMoves){t=i.crossProbePlaceMoves;for(n=0;n<t.length;n++)Ee(d(t[n].id),-t[n].offsetX-i.offsetX,-t[n].offsetY-i.offsetY);i.crossProbePlaceMoves=null}else i.targets&&(i.offsetX||i.offsetY)&&Oe(i.targets,-i.offsetX,-i.offsetY);i.targets=null;i.ids="";i.waitingSave=0;a("dragMoveSwitch",[!1])}}function Zr(e){var t=si;if(t.on){if(e&&e.button!==Vn){if(e&&e.button===Gn)for(var r=t.targets,n=r.length-1;n>=0;n--)v(r[n])}else{pi.updateMore(t.targets);Qi==Dn.PCB&&Ei.buildRatLinesOfPCBLib(t.targets);Pi.save(["add",t.ids])}delete t.pasting;t.targets=null;t.ids="";t.waitingSave=0;a("dragMoveSwitch",[!1])}}function en(e){var t=si,r=Qe(e,!1),n=r.x-t.startX,i=r.y-t.startY;Bi.altKeyEnabled=e.altKey;if(t.hasPin||bi.adsorbGrid.enabled){var a=Bi.getSanpSize("X"),o=Bi.getSanpSize("Y");n=Math.round(n/a)*a;i=Math.round(i/o)*o}var s=n-t.offsetX,l=i-t.offsetY;if(s||l){Oe(t.targets,s,l);t.offsetX+=s;t.offsetY+=l;gi&&it(gi);t.waitingSave=1}}function tn(e){this.startX=0;this.startY=0;this.ready=0;this.start=0;this.target=null;this.oldPoints=[];this.pIndex=-1;if(e)for(var r in e)e.hasOwnProperty(r)&&(this[r]=e[r]);tn.instance=this;t.addEventListener("mousedown",this.mdown,!1)}function rn(e,t){var r=e.points.getItem(t>>1),n=e.points.getItem(t+1>>1),i=r.y-n.y,a=r.x-n.x,o=Math.PI;st((a?Math.abs(Math.atan(i/a)/o):.5)<.25?"row-resize":"col-resize")}function nn(){new tn({ondragstart:function(e){var t,r,n,i,a,o,s,l=e.target,c=e.dx,d=e.dy,h=l.points,u=h.numberOfItems,f=tn.instance;if(l!==gi)if(gi)Ct();else{gi=l;p(gi,"active",!0);it(l);tt("triggerEvent",["select_change"])}_e(l);if(u!=l.points.numberOfItems){h=l.points;u=h.numberOfItems;r=K({x:e.x0,y:e.y0},l)}else r=f.pIndex;r<=0?r=1:r%2==0&&r--;f.pIndex=r;n=Se(l);t=r>>1;i=n[t];a=n[t+1];i={x:i.x+c,y:i.y+d};a={x:a.x+c,y:a.y+d};if(u>2&&t===u-2){s=n[u-1];n.push({x:s.x,y:s.y});h.appendItem(be(s));u++;o=h.getItem(t+1);s=Y(i,a,o);n[t+1].P=s}if(u>2&&0===t){s=n[0];n.unshift({x:s.x,y:s.y});h.insertItemBefore(be(s),0);u++;r+=2;f.pIndex=r;t=1;o=h.getItem(t);s=Y(i,a,o);n[t].P=s}f.oldPoints=n},ondrag:function(e){var t,r,n,i,a,o,s,l,c,h,u,p,f,g,y=e.target,v=e.dx,m=e.dy,x=y.points,_=x.numberOfItems,P=tn.instance;r=P.pIndex;n=P.oldPoints;if(n&&d(y.id)){t=r>>1;i=n[t];a=n[t+1];o={x:i.x+v,y:i.y+m};s={x:a.x+v,y:a.y+m};var S,b;if(n.length>2){l=n[t-1];i=n[t];i.P&&(i=i.P);a=n[t+1];c=n[t+2];a.P&&(a=a.P);if(P.snap){h={x:e.x1,y:e.y1};u=Y(o,s,h);p=Ie(u);o.x+=p.x-u.x;o.y+=p.y-u.y;s.x+=p.x-u.x;s.y+=p.y-u.y}f=ee(l.x,l.y,i.x,i.y)<1?Y(o,s,i):X(o,s,l,i);g=ee(a.x,a.y,c.x,c.y)<1?Y(o,s,a):X(o,s,a,c)}else{f=o;g=s;if(P.snap){S=Ie(f);b=Ie(g);ee(S.x,S.y,f.x,f.y)<=ee(b.x,b.y,g.x,g.y)?b={x:g.x+S.x-f.x,y:g.y+S.y-f.y}:S={x:f.x+b.x-g.x,y:f.y+b.y-g.y}
;f=S;g=b}}if(t+1<_){i=x.getItem(t);a=x.getItem(t+1);i.x=f.x;i.y=f.y;a.x=g.x;a.y=g.y}if(Qi==Dn.PCB){var C=ai.getPCBCmdKey(y);if("TRACK"==C);else if("COPPERAREA"==C){pi.updateOne(y);Ai.rebuildCopperArea(y)}}"object"==typeof Ci&&Ci&&Ci.doRealtimeDRC&&gi&&Ci.doRealtimeDRC(gi,!0);y==gi&&it(y)}},ondragend:function(e){var t=tn.instance,r=e.target;if(t.polylinePoints&&t.polylinePoints!==m(r,"points")){_e(r);r==gi&&it(r);pi.updateOne(r);if(Qi==Dn.PCB){var n=ai.getPCBCmdKey(r);"TRACK"==n?Ei.buildOneNet(m(r,"net"),!0):"COPPERAREA"==n&&Ai.rebuildCopperArea(r)}var i=["attr",r.id,{points:t.polylinePoints},{points:m(r,"points")}];Pi.save(i)}}})}function S(e){var t,r=e.attributes,n=r.length,i={};for(t=n-1;t>=0;t--)if(r[t].nodeName.indexOf(":")>0){var a=r[t].namespaceURI;r[t].localName;if(a in Mn){if(!1===/^c:|^xlink:|^xml:|^xmlns:/.test(r[t].nodeName))try{if(a===NS_c){if(r[t].prefix!==Mn[NS_c]){i[Mn[NS_c]+":"+r[t].localName]=r[t].nodeValue;e.removeAttributeNode(r[t])}}else e.removeAttributeNode(r[t])}catch(e){}}else e.removeAttributeNode(r[t])}else if(0===r[t].nodeName.indexOf("on"))try{e.removeAttributeNode(r[t])}catch(e){}m(e,i)}function an(r,n){var i,a,o=null;if("string"==typeof r){var s=E(r);if(!s)return;o=t.importNode(s.documentElement,!0)}else o="[object Object]"==Object.prototype.toString.call(r)?makeSVG(r.tagName||r.tag,r.attr||r.attrs):t.importNode(r,!0);if(o){gn(m(o,"canvas")||"");var l=m(o.firstChild,"c_para")||"",c=m(o.firstChild,"c_transformList");x(o.firstChild,"c_transformList");P(o);var u=o.getElementsByTagName("title");u=u[0]&&u[0].firstChild&&3===u[0].firstChild.nodeType?u[0].firstChild.nodeValue:" ";var p=fi.getElementsByTagName("title")[0];if(p){for(;p.firstChild;)p.removeChild(p.firstChild);p.appendChild(b(u))}o=o.querySelector("g")||o;Ui.clear("NotSaveHistory");n&&A(n,"saved")?Pi.clear({saved:n.saved}):Pi.clear();ai.node.clearChildNodes(gNets);var f=cn(),g=e.frameElement,y=g&&g.parentNode,v=y&&"none"!=y.style.display;y&&!v&&(y.style.display="");if(o)for(;o.firstChild;){i=o.firstChild;if(1!=i.nodeType||"polyline"==i.tagName&&i.points.numberOfItems<2||"polygon"==i.tagName&&i.points.numberOfItems<3){pi.removeOne(i);o.removeChild(i)}else{zi.appendElement(i);ai.svg.fixOrigin(i)}}!function(){var e,t,r,n,i,a=h("#g1 > [c_origin]"),o=0,s=0;for(e=a.length-1;e>=0;e--){t=a[e];xy=m(t,"c_origin").split(",");xy[0]=+xy[0];xy[1]=+xy[1];(r===i||r>xy[0])&&(r=xy[0]);(n===i||n>xy[1])&&(n=xy[1])}(r>65536||r<-65536)&&(o=100-r|0);(n>65536||n<-65536)&&(s=100-n|0);if(o||s){Oe(Gi.children,o,s);pi.calAll()}}();!function(){var e,t,r,n,i,a,o,s,l,c=h('#g1 > g[c_partid] > g[c_partid="part_pcbtext"] > path[c_note="note_pre"]');for(e=c.length-1;e>=0;e--){t=c[e];n=t.parentNode;r=n.parentNode;i=ai.getPCBCmdKey(r);if("FOOTPRINT"==i){o=m(n,"c_origin");if(o){o=ai.numberlistToArray(o);s=ai.svg.getBBox(n.firstChild);l=[ai.toFixed(s.x,2),ai.toFixed(s.y+s.height/2,2)];if(l[0]>0&&l[1]>0&&(Math.abs(o[0]-l[0])>20||Math.abs(o[1]-l[1])>20)){o=l;m(n,"c_origin",l.join(","))}n.style.display="none";a=ai.svg.getBBox(r);if(a.width||a.height){var d=0,u=0,p=100,f=!1,g=!1;a.x-o[0]>p?f=!0:o[0]-a.x-a.width>p&&(f=!0);a.y-o[1]>p?g=!0:o[1]-a.y-a.height>p&&(g=!0);if(f||g){var y=m(n,"c_rotation");if("90"==y||"270"==y){f&&(d=a.x+a.width+5-o[0]|0);g&&(u=a.y+a.height/2-o[1]|0)}else{f&&(d=a.x+a.width/2-o[0]|0);g&&(u=a.y-5-o[1]|0)}wi.move(n,d,u);pi.updateOne(r)}}else{pi.removeOne(r);Gi.removeChild(r)}n.style.display=""}}}}();!function(){var e=ai.svg.getBBox(Gi);if(e.width>1e5||e.height>1e5){var t,r,n=Gi.children;for(t=n.length-1;t>=0;t--){r=n[t];e=ai.svg.getBBox(r);if(!e.width&&!e.height&&r.id.match(/^gge|^rep/)){pi.removeOne(r);Gi.removeChild(r)}}}}();hi=T()+1;var _,S=h("path[c_note=note_pre]",Gi);for(i=0,a=S.length;i<a;i++)(_=m(S[i],"c_text"))&&ui.ini(_);if(c){var C=c.split(" ");for(i=0;i<C.length;i+=2){var I=d(C[i]),L=C[i+1],O=0,w="M"==L.charAt(0);if(I){if(w){Sn(I,Fn.BOTTOMLAYER);O=+L.substr(1)}else{O=+L;O=360-O}var R=null,N=parseInt(m(I.firstChild,"c_rotation"),10)||0;N=180==N?0:N;Dt([I.firstChild],N,!1);R=I.firstChild.cloneNode(!0);O&&Dt([I],O,!0);if(R){m(R,"c_rotation",N);I.replaceChild(R,I.firstChild)}}}}f?pn():pi.calAll();dn();zi.initByCache();m(Gi,{c_para:l});pi.buildSignals();if(Qi==Dn.PCB)setTimeout(function(){Ei.buildAllNet();setTimeout(function(){Ai.rebuildCopperArea("all");zi.setActivePCBLayer(Fn.TOPLAYER)},100)},100);else if(Qi==Dn.PHOTOVIEW){Ii.init();Ii.reset("changeSide_topSide")}Re(Gi);Qi==Dn.PCB&&Oi.rebuild();tt("triggerEvent",["import_doc_done"]);tt("triggerEvent",["select_change"]);y&&!v&&(y.style.display="none");f&&jr()}else parent.$.messager.error("import node failure")}function on(e,r){var n,i,a,o,s,l=null;if("string"==typeof e){e.match(/^<\w/)&&!e.match(/^<svg/)&&(e='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+e+"</svg>");n=E(e);if(!n)return;l=t.importNode(n.documentElement,!0)}else 1===e.nodeType?l=t.importNode(e,!0):e.constructor==Object&&(l=makeSVG(e.tagName||e.tag,e.attr||e.attrs));if(l){P(l);x(l,"c_maxggei");if("svg"==l.tagName)for(i=0,a=l.childNodes.length;i<a;i++)if("g"===l.childNodes[i].tagName){l=l.childNodes[i];break}if("g"!=l.tagName){var c=Ue("g");if("svg"==l.tagName)for(;l.firstChild;)c.appendChild(l.firstChild);else c.appendChild(l);l=c}for(i=0,o=h("[id],[c_shapetype]",l),a=o.length;i<a;i++)m(o[i],{id:"",c_shapetype:""});m(l,"c_origin")||m(l,"c_origin","0,0");m(l,"display","");var p,f,g,y,_,S,b="",C=ai.c_paraToJson(m(l,"c_para")||"");l.id="g"+Date.now();f=u("#"+l.id+' > g[c_partid="part_annotation"] > path[c_note="note_name"]',l);f&&(f=f.parentNode);g=u("#"+l.id+' > g[c_partid="part_pcbtext"] > path[c_note="note_pre"]',l);if(g){m(g,"c_text").indexOf("?")<0&&m(g,"c_text",m(g,"c_text").replace(/\d+(\D*)$/,"?$1"));g=g.parentNode}l.id="";if(!g){S=!0;C.pre=C.pre?C.pre:" ";var I={text:C.pre,x:0,y:0,fontSize:4.5,fontFamily:""},L=tt("getFontPath",[I])||"M0,0";p='<g xmlns="http://www.w3.org/2000/svg" c_partid="part_pcbtext" c_origin="0,0" c_shapetype="group" layerid="3"><path c_note="note_pre" c_fontSize="4.5" c_text="'+D(C.pre)+'" d="'+L+'" fill="none" stroke-width="0.7"/></g>';n=E(p);if(n){g=t.importNode(n.documentElement,!0);l.insertBefore(g,l.firstChild)}}if(!f){C.package=C.package?C.package:" ";delete C.pre}b=ai.jsonToC_para(C);m(l,{c_para:b});var O;if(r){x(l,"c_partid");zi.appendElement(l)}else{var T="part_import",w=d(T);w&&v(w);O=function(){return"part_import_"+(1e6+(1e6*Math.random()|0)+"").substr(1)}();m(l,{id:T,c_partid:O});d("gCurParts").appendChild(l)}if(S&&g)try{var R=g.childNodes[0];m(R,"display","none");s=ai.svg.getBBox(l);var N=[s.x,s.y,s.width,s.height];y=+N[0]+N[2]/2|0;_=+N[1]-5|0;wi.path(R,y,_);m(g,"c_origin",y+","+_);m(R,{display:""})}catch(e){}ai.svg.fixOrigin(l);var k=u('g[c_partid="part_pad"][c_origin]',l);k||(k=u("g[c_origin]",l));if(k){var B,M,V,G,F,H,j=ai.numberlistToArray(m(l,"c_origin")),U=m(k,"c_origin");if(U){U=ai.numberlistToArray(U);B=+Bi.getSanpSize("X");V=(j[0]-U[0])%B;if(V){V<0&&(V+=B);F=V<B/2?-ai.toFixed(V,2):+ai.toFixed(B-V,2);j[0]+=F}M=+bi.adsorbGrid.distanceY;G=(j[1]-U[1])%M;if(G){G<0&&(G+=M);H=G<M/2?-ai.toFixed(G,2):+ai.toFixed(M-G,2);j[1]+=H}(V||G)&&m(l,{c_origin:j[0]+","+j[1]})}}if(r){A(r,"x")&&A(r,"y")&&dt(l,r.x,r.y);r.rotation&&Dt([l],r.rotation,!0);!function(){var e=+zi.getActiveLayer()||1,t=[Fn.BOTTOMLAYER,Fn.BOTTOMSILKLAYER,Fn.BOTTOMPASTERLAYER,Fn.BOTTOMSOLDERLAYER],r=l,n=+m(r,"layerid"),i=zi.getValidLayer("FOOTPRINT",e);n&&t.indexOf(n)<0!=t.indexOf(i)<0?Sn(r,i,!0):!n&&t.indexOf(i)>=0&&Sn(r,i,!0);m(l,{id:ai.newId(),c_shapetype:"group",c_etype:"pinpart"});x(l,"pointer-events");Fe(l);zi.appendElement(l);Qi==Dn.PCB&&Tr(l);pi.updateOne(l);Pi.save(["add",l.id])}()}else{!function(){if(Qi==Dn.PCB){var e=+zi.getActiveLayer()||1,t=[Fn.BOTTOMLAYER,Fn.BOTTOMSILKLAYER,Fn.BOTTOMPASTERLAYER,Fn.BOTTOMSOLDERLAYER],r=zi.getValidLayer("FOOTPRINT",e);t.indexOf(r)>=0&&Sn(l,r,!0);x(l,"pointer-events")}}();m(l,"display","none");yt("place."+T)}}else parent.$.messager.alert("import fail")}function sn(e,r){var n,i,a,o,s=null;if("string"==typeof e){e.match(/^<\w/)&&!e.match(/^<svg/)&&(e='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+e+"</svg>");n=E(e);if(!n)return;s=t.importNode(n.documentElement,!0)}else 1===e.nodeType?s=t.importNode(e,!0):e.constructor==Object&&(s=makeSVG(e.tagName||e.tag,e.attr||e.attrs));if(s){P(s);x(s,"c_maxggei");if("svg"==s.tagName)for(i=0,a=s.childNodes.length;i<a;i++)if("g"===s.childNodes[i].tagName){s=s.childNodes[i];break}if("g"!=s.tagName){var l=Ue("g");if("svg"==s.tagName)for(;s.firstChild;)l.appendChild(s.firstChild);else l.appendChild(s);s=l}for(i=0,o=h("[id]",s),a=o.length;i<a;i++)o[i].id="";m(s,"display","");var c;if(r){x(s,"c_partid");zi.appendElement(s)}else{var p="part_import",f=d(p);f&&v(f);c=function(){return"part_import_"+(1e6+(1e6*Math.random()|0)+"").substr(1)}();m(s,{id:p,c_partid:c});d("gCurParts").appendChild(s)}var g=ai.svg.getBBox(s),y=g.x+g.width/2|0,_=g.y+g.height/2|0;m(s,"c_origin",y+","+_);m(s,"c_module","1");var S=u('g[c_partid="part_pad"][c_origin]',s);S||(S=u("g[c_origin]",s));if(S){var b,C,I,L,O,T,w=ai.numberlistToArray(m(s,"c_origin")),R=m(S,"c_origin");if(R){R=ai.numberlistToArray(R);b=+Bi.getSanpSize("X");I=(w[0]-R[0])%b;if(I){I<0&&(I+=b);O=I<b/2?-ai.toFixed(I,2):+ai.toFixed(b-I,2);w[0]+=O}C=+bi.adsorbGrid.distanceY;L=(w[1]-R[1])%C;if(L){L<0&&(L+=C);T=L<C/2?-ai.toFixed(L,2):+ai.toFixed(C-L,2);w[1]+=T}(I||L)&&m(s,{c_origin:w[0]+","+w[1]})}}if(r){A(r,"x")&&A(r,"y")&&dt(s,r.x,r.y);r.rotation&&Dt([s],r.rotation,!0);!function(){Fe(s);for(var e=[].slice.call(s.children||s.childNodes,0).filter(function(e){return 1===e.nodeType}),t=e.map(function(e){return e.id}).join(","),r=0;r<e.length;r++){zi.appendElement(e[r]);if(Qi==Dn.PCB&&"g"==e[r].tagName){for(var n=h('g path[c_note="note_pre"]',e[r]),i=0;i<n.length;i++){var a=m(n[r],"c_text");a.indexOf("?")>0?m(n[r],"c_text",ui.getNewPre(a)):a.search(/\d+/)>=0&&m(n[r],"c_text",ui.getNewPre(a.replace(/\d+(\D*)$/,"?$1")))}Tr(e[r])}pi.updateOne(e[r])}v(s);if(t){Ei.buildAllNet();Pi.save(["add",t])}}()}else{m(s,"display","none");yt("place."+p);var N=h('g path[c_note="note_pre"]',s);for(i=0;i<N.length;i++){var k=m(N[i],"c_text");k&&k.indexOf("?")<0&&k.search(/\d+/)>=0&&m(N[i],"c_text",k.replace(/\d+(\D*)$/,"?$1"))}}}else parent.$.messager.alert("import fail")}function ln(e,r){var n,i,a,o;if(B(e)){Pi.startBatch();for(o=0;o<e.length;o++)ln(e[o],r);Pi.saveBatch()}else if(e){o=e.indexOf(" xmlns=");(o<0||o>e.indexOf(">"))&&(e=e.replace(/\/?>/,' xmlns="http://www.w3.org/2000/svg"$&'));o=e.indexOf(" xlink:href");if(o>0){o=e.indexOf(" xmlns:xlink=");o<0&&(e=e.replace(/\/?>/,' xmlns:xlink="http://www.w3.org/1999/xlink"$&'))}n=E(e);if(n&&n.documentElement.namespaceURI==Mn.svg){i=t.importNode(n.documentElement,!0);if(i){a=i.tagName;if(a&&!(a.indexOf(":")>0)&&"script"!==a&&"metadata"!==a){P(i);m(i,"c_shapetype")||m(i,"c_shapetype","line");Fe(i);zi.appendElement(i);var s=ai.getPCBCmdKey(i);Qi==Dn.PCB&&"FOOTPRINT"==s&&Tr(i);pi.updateOne(i);Qi==Dn.PCB&&m(i,"net")&&Ei.buildOneNet(m(i,"net"),!1);"part_pad"==s&&wr();Pi.save(["add",i.id])}}else parent.$.messager.warn("import fail")}}}function cn(){var e=!0,t=tt("getJsonCache");if(t){var r=I(JSON.stringify(t));r.head.editorVersion=Rn;pi.gJsonCache.layers;for(var n in Fn){var i=Fn[n];if(A(Fn,n)&&!r.layers[i]){r.layers[i]=pi.gJsonCache.layers[i];r.layers[i].config=!1;r.layers[i].visible=!1}}pi.gJsonCache=r;pi.gJsonCache.preference||(pi.gJsonCache.preference={hideNets:[],hideFootprints:[],unit:"mil"});pi.gJsonCache.head&&pi.gJsonCache.head.importedFrom&&(e=!1)}else{e=!1;Oi.init()}zi.updateFront();tt("triggerEvent",["layer_update"]);return e}function dn(){if(Qi==Dn.PCBLIB)return!1;var e,t,r,n,i=pi.gJsonCache.preference;if(i){e=i.hideFootprints||[];for(t=0,r=e.length;t<r;t++)e[t]&&(n=d(e[t]))&&"FOOTPRINT"==ai.getPCBCmdKey(n)&&m(n,"display","none");e=i.hideNets||[];for(t=0,r=e.length;t<r;t++)e[t]&&hn(e[t])}}function hn(e){if(e){var t,r=d("pcbNetStyle").sheet,n=r.cssRules;e=e.replace(/[\\\"]/g,"\\$&");for(var i=0,a=n.length;i<a;i++)if(0===n[i].selectorText.indexOf('line[net="'+e+'"]')){t=n[i];t.style.display="none";return}if(!t){var o='line[net="'+e+'"], polyline[net="'+e+'"]';r.insertRule(o+"{display:none;}",n.length)}}}function un(e,t){function r(){var e=Ui.getViewBox();return{x:e[0]+e[2]/2,y:e[1]+e[3]/2}}var n=Ue("g",{id:ai.newId(),layerid:zi.getActiveLayer(),c_partid:"part_svg",c_shapetype:"group"});M(e)||(e=[e]);e.forEach(function(e){var t=Ue("path",{d:e,id:ai.newId(),stroke:"none"});n.appendChild(t)});zi.appendElement(n);t&&"CanvasCenter"==t.position&&function(e){var t=r(),n=ai.svg.getBBox(e),i=t.x-(n.x+n.width/2),a=t.y-(n.y+n.height/2);wi.move(e,i,a)}(n);pi.updateOne(n);Pi.save(["add",n.id])}function pn(){function e(e){if("OVAL"==e.shape){var t=An(e.x,e.y,e.width,e.height,+e.rotation);e.pointArr=t[1]}}var t=pi.gJsonCache.FOOTPRINT;for(var r in t)if(t.hasOwnProperty(r))for(var n in t[r].PAD)t[r].PAD.hasOwnProperty(n)&&e(t[r].PAD[n]);var i=pi.gJsonCache.PAD;for(n in i)i.hasOwnProperty(n)&&e(i[n])}function fn(){Ui.getViewBox();return{viewWidth:1e3,viewHeight:1e3,backGround:m(d("gridBg"),"fill"),gridVisible:m(d("grid1"),"display")||"yes",gridColor:m(d("gridCell"),"fill"),gridSize:m(d("gridPattern"),"width"),canvasWidth:1e3,canvasHeight:1e3,gridStyle:"url(#gridPattern)"==m(d("grid1"),"fill")?"dot":"line",snapSize:bi.adsorbGrid.distanceX,unit:bi.canvas.unit,routingWidth:bi.canvas.routing,routingAngle:bi.canvas.angle,copperAreaDisplay:bi.canvas.copperZone,altSnapSize:bi.adsorbGrid.altSnapSize,originX:bi.canvas.originX,originY:bi.canvas.originY}}function gn(e){if(e.length>10){var t=e.split(jn);Ui.modify_canvas({"attr-pcbcanvas-width":t[7]||1e3,"attr-pcbcanvas-height":t[8]||1e3,"attr-pcbcanvas-bgcolor":t[3]||"#000000","attr-pcbcanvas-grid-visible":t[4],"attr-pcbcanvas-grid-color":t[5],"attr-pcbcanvas-grid-size":t[6]||10,"attr-pcbcanvas-grid-style":t[9],"attr-pcbcanvas-snap-size":t[10]||10,"attr-pcbcanvas-unit":t[11]||"mil","attr-pcbcanvas-routing-size":t[12]||"1","attr-pcbcanvas-angle":t[13]||"45","attr-pcbcanvas-copper-zone":t[14]||"visible","attr-pcbcanvas-alt-snap-size":t[15]||t[10]/2});if(e.length>17&&t[16]&&t[17]){var r=+t[16],n=+t[17];isFinite(r)&&isFinite(n)&&a("setOriginXY",[{x:r,y:n}])}}}function yn(e,t,r,n){var i,a,o,s,l,c,u,p,f,g,y,v,x,_={};M(e)&&e.length<=1&&(e=e[0]);if(M(e)&&e.length>1){Pi.startBatch();for(i=0;i<e.length;i++)yn(e[i],t,r,n,!0);Pi.saveBatch()}else if(e&&"object"==typeof t&&("object"!=typeof e||1==e.nodeType)){for(a in t)if(A(t,a)&&"string"==typeof t[a]&&!F(t[a]))return;t["attr-locked"]&&m(e,"locked","yes"===t["attr-locked"]?1:0);if("canvas"!=e){var P=m(e,"sourceId");if(P){e=d(P);if(!e)return}if("NotSaveHistory"==r&&"quickchange"==n)if(Pi.quickchangeNode!=e){y=e.cloneNode(!0);Pi.quickchangeNode=e;Pi.quickchangeNodeClone=y}else y=Pi.quickchangeNodeClone;else"NotSaveHistory"!=r&&(y=Pi.quickchangeNode!=e?e.cloneNode(!0):Pi.quickchangeNodeClone);var S=(m(e,"c_partid"),m(e,"c_shapetype"),m(e,"c_helper_type"),+m(e,"c_rotation")||0);s=m(e,"c_origin");s&&ai.numberlistToArray(s);u=ai.getPCBCmdKey(e);var b=we(e),C=!1,I="",L=m(e,"net");p={};if("object"==typeof t&&Object.keys(t)[0]&&Object.keys(t)[0].match(/-layerid/)&&!In(t[Object.keys(t)[0]]))tt("warnLayerInvisible");else{switch(u){case"ARC":for(a in t)if(t.hasOwnProperty(a)){o=t[a];C=!0;switch(a){case"attr-pcbarc-width":m(e,"stroke-width",o);break;case"attr-pcbarc-layerid":zi.moveElementToLayer(e,o);Ln(e);break;case"attr-pcbarc-net":I=(o||"").toUpperCase();m(e,"net",I);break;case"attr-pcbarc-rx-size":var E=e.pathSegList.getItem(0),O=e.pathSegList.getItem(1);if(o<=0||o*o*4<ee(E.x,E.y,O.x,O.y))return;O.r1=+o;O.r2=+o;e==gi&&it(e);C=!1;break;case"attr-pcbarc-center-x":f=ai.numberlistToArray(m(e,"c_helper_dots"));var T=f[0];Ee(e,o-T,0);e==gi&&it(e);break;case"attr-pcbarc-center-y":f=ai.numberlistToArray(m(e,"c_helper_dots"));var w=f[1];Ee(e,0,o-w);e==gi&&it(e);break;case"attr-pcbarc-start-x":l=e.pathSegList.getItem(0).x;ki.path_arc2.set(e,"",0,o-l,0,"");e==gi&&it(e);break;case"attr-pcbarc-start-y":l=e.pathSegList.getItem(0).y;ki.path_arc2.set(e,"",0,0,o-l,"");e==gi&&it(e);break;case"attr-pcbarc-end-x":l=e.pathSegList.getItem(1).x;ki.path_arc2.set(e,"",1,o-l,0,"");e==gi&&it(e);break;case"attr-pcbarc-end-y":l=e.pathSegList.getItem(1).y;ki.path_arc2.set(e,"",1,0,o-l,"");e==gi&&it(e)}}break;case"CIRCLE":for(a in t)if(t.hasOwnProperty(a)){o=t[a];switch(a){case"attr-pcbcircle-width":m(e,"stroke-width",o);break;case"attr-pcbcircle-layerid":zi.moveElementToLayer(e,o);break;case"attr-pcbcircle-center-x":m(e,"cx",o);e==gi&&it(e);break;case"attr-pcbcircle-center-y":m(e,"cy",o);e==gi&&it(e);break;case"attr-pcbcircle-r-size":m(e,"r",o);e==gi&&it(e)}}break;case"COPPERAREA":C=!0;for(a in t)if(t.hasOwnProperty(a)){o=t[a];switch(a){case"attr-copperArea-clearance-width":m(e,"clearanceWidth",o);break;case"attr-copperArea-thermal":m(e,"thermal",o);break;case"attr-copperArea-keep-island":m(e,"keepIsland",o);break;case"attr-copperArea-fill-style":"none"==o?m(e,"fillStyle","none"):m(e,"fillStyle","solid");break;case"attr-copperArea-layerid":zi.moveElementToLayer(e,o);break;case"attr-copperArea-net":m(e,"net",o?o.toUpperCase():"");I=o}}break;case"SOLIDREGION":C=!0;for(a in t)if(t.hasOwnProperty(a)){o=t[a];switch(a){case"attr-solidRegion-type":Cn(e,o,b.layerid);break;case"attr-solidRegion-layerid":if("npth"==b.type&&o!=Fn.ALL){parent.$.messager.warn("When the solid region is NPTH, please set the layer to Multi-Layer.");return}zi.moveElementToLayer(e,o);o==Fn.ALL&&Cn(e,"npth",b.layerid);break;case"attr-solidRegion-net":if("npth"==b.type){parent.$.messager.warn("You should not try to assign a net to a NPTH solid region.");return}m(e,"net",o?o.toUpperCase():"");I=o}}break;case"DIMENSION":for(a in t)if(t.hasOwnProperty(a)){o=t[a];var R="",k=[];switch(a){case"attr-dimension-layerid":zi.moveElementToLayer(e,o);break;case"attr-dimension-font-height":k=Vi.getStartAndEndPointByDimensionElement(e);R=Vi.getDimensionPath({x:k[0],y:k[1]},{x:k[2],y:k[3]},o);m(e,{d:R,c_fontSize:o});break;case"attr-dimension-start-x":case"attr-dimension-start-y":case"attr-dimension-end-x":case"attr-dimension-end-y":k=Vi.getStartAndEndPointByDimensionElement(e);R=Vi.getDimensionPath({x:k[0],y:k[1]},{x:k[2],y:k[3]});m(e,"d",R)}}break;case"PROTRACTOR":var V=null;for(a in t)if(t.hasOwnProperty(a)){o=t[a];switch(a){case"attr-protractor-layerid":zi.moveElementToLayer(e,o);break;case"attr-protractor-width":m(e,"stroke-width",o);break;case"attr-protractor-font-height":K=ki.get(e);var D=m(e,"c_precision");V=Vi.getProtractorPath(K.slice(0,2),K.slice(2,4),K.slice(4,6),{fontSize:o,precision:D,canAdjustLineLength:!0});m(e,{d:V,c_fontSize:o});e==gi&&it(e);break;case"attr-protractor-precision":K=ki.get(e);var H=m(e,"c_fontSize");V=Vi.getProtractorPath(K.slice(0,2),K.slice(2,4),K.slice(4,6),{fontSize:H,precision:o,canAdjustLineLength:!0});m(e,{d:V,c_precision:o});e==gi&&it(e)}}break;case"FOOTPRINT":"";"";_={};x=!1;for(a in t)if(A(t,a)){o=t[a];switch(a){case"attr-footprint-prefix":if(o.match(/\s|\n|\\n/))break;if(o){p.text=o;_n(ut("pre",e),p)}else m(ut("pre",e),{display:"none"});break;case"attr-footprint-layerid":Sn(e,o);zi.moveElementToLayer(e,o);break;case"attr-footprint-x":s=m(e,"c_origin")||"";p.x=+o;p.y=+s.split(",")[1];dt(e,p.x,p.y);C=!0;break;case"attr-footprint-y":s=m(e,"c_origin")||"";p.x=+s.split(",")[0];p.y=+o;dt(e,p.x,p.y);C=!0;break;case"attr-footprint-rotation":if(o!=S){c=oe(360-(parseInt(o,10)-parseInt(S,10)));m(e,"c_rotation","0");Ri.g(e,c);m(e,"c_rotation",oe(o));xr(e)}break;case"attr-footprint-prefix-display":m(ut("pre",e),{display:"none"==o?"none":"yes"});break;default:a&&!a.match(/^attr-/)&&(_[a]=o)}}for(a in _)if(A(_,a)&&a&&!a.match(/^attr-/)){o=_[a];x=!0;xn(e,a,o)}x&&tt("updateAttrPanel");break;case"IMAGE":var j=t["attr-pcbimage-href"];if(void 0!==j&&!ai.isValidImageURL(j))return;if(void 0!==j&&G(j)!=j)return;for(a in t)if(A(t,a)){o=t[a];switch(a){case"attr-pcbimage-layerid":zi.moveElementToLayer(e,o);break;case"attr-pcbimage-href":m(e,{"xlink:href":o});break;case"attr-pcbimage-x":m(e,{x:o});break;case"attr-pcbimage-y":m(e,{y:o});break;case"attr-pcbimage-width":m(e,{width:o});break;case"attr-pcbimage-height":m(e,{height:o});break;case"attr-pcbimage-rotation":m(e,{c_rotation:o})}}var U=A(t,"attr-pcbimage-rotation")?oe(360-t["attr-pcbimage-rotation"]):ie(e);U?m(e,"transform",pe(fe(e),U)):m(e,"transform","");tt("updateAttrPanel");it(e);break;case"SVGNODE":var Y,z=function(e){var t=getComputedStyle(e);if(t&&"none"!=t.display)Y=ai.svg.getBBox(e);else{e.style.display="inline";Y=ai.svg.getBBox(e);e.style.display=""}},J=function(e,t,r,n){if(r&&1!==r)if(B(e))for(var i=0;i<e.length;i++)J(e[i],t,r,n);else if("path"==e.tagName){var a,o,s,l,c,d,u=e.getPathData(),p={x:{M:[0],L:[0],H:[0],C:[0,2,4],S:[0,2],Q:[0,2],T:[0],A:[0,5]},y:{M:[1],L:[1],V:[0],C:[1,3,5],S:[1,3],Q:[1,3],T:[1],A:[1,6]}};for(a=0;a<u.length;a++){l=u[a].type;c=p[t]&&p[t][l];s=u[a].values;if(c&&s)for(o=0;o<c.length;o++){d=c[o];s[d]=ai.toFixed(n+(s[d]-n)*r,1)}}e.setPathData(u)}else{var f=h("path",e);J(f,t,r,n)}};for(a in t)if(A(t,a)){o=t[a];switch(a){case"attr-pcbsvgimage-layerid":zi.moveElementToLayer(e,o);break;case"attr-pcbsvgimage-x":z(e);wi.move(e,o-Y.x,0);break;case"attr-pcbsvgimage-y":z(e);wi.move(e,0,o-Y.y);break;case"attr-pcbsvgimage-width":z(e);Y.width&&J(e,"x",o/Y.width,Y.x);break;case"attr-pcbsvgimage-height":z(e);Y.height&&J(e,"y",o/Y.height,Y.y)}}break;case"PAD":var X=we(e);for(a in t)if(t.hasOwnProperty(a)){o=t[a];switch(a){case"attr-pad-number":p.number=o;break;case"attr-pad-shape":p.shape=o;break;case"attr-pad-points":p.points=o;break;case"attr-pad-layerid":p.layerid=o;C=!0;break;case"attr-pad-net":p.net=o?o.toUpperCase():"";I=p.net;C=!0;break;case"attr-pad-width":p.width=o;break;case"attr-pad-height":p.height=o;break;case"attr-pad-hole-size":p.holeR=o/2;break;case"attr-pad-x":p.x=o;A(t,"attr-pad-y")||(p.y=+X.c_origin.split(",")[1]);C=!0;break;case"attr-pad-y":p.y=o;A(t,"attr-pad-x")||(p.x=+X.c_origin.split(",")[0]);C=!0;break;case"attr-pad-hole-shape":p.holeType=o||"round";break;case"attr-pad-hole-y-size":p.holeLength=+o;break;case"attr-pad-plated":p.plated=o||"Y";break;case"attr-pad-rotation":if(o!=S){c=oe(360-(parseInt(o,10)-parseInt(S,10)));m(e,"c_rotation","0");Ri.g(e,c);m(e,"c_rotation",oe(o))}}}Pn(e,p);break;case"RECT":for(a in t)if(t.hasOwnProperty(a)){o=t[a];switch(a){case"attr-pcbrect-layerid":zi.moveElementToLayer(e,o);break;case"attr-pcbrect-start-x":m(e,"x",o);e==gi&&it(e);break;case"attr-pcbrect-start-y":m(e,"y",o);e==gi&&it(e);break;case"attr-pcbrect-width":m(e,"width",o);e==gi&&it(e);break;case"attr-pcbrect-height":m(e,"height",o);e==gi&&it(e)}}break;case"TEXT":for(a in t)if(t.hasOwnProperty(a)){o=t[a];switch(a){case"attr-pcbtext-text":o=o.replace(/\\n/g,"\n");if(o.match(/\s|\n/)&&e.childNodes[0]&&"note_pre"==m(e.childNodes[0],"c_note"))break;p.text=o;break;case"attr-pcbtext-font-family":p.fontFamily=o;break;case"attr-pcbtext-line-width":p.lineWidth=o;break;case"attr-pcbtext-height":p.height=o;break;case"attr-pcbtext-layerid":p.layerid=o;break;case"attr-pcbtext-rotation":p.rotation=o}}_n(e,p);"layerid"in p&&zi.moveElementToLayer(e,p.layerid);break;case"TRACK":var K=me(e.points),W=K.length;if(W<2)return;for(a in t)if(t.hasOwnProperty(a)){o=t[a];C=!0;switch(a){case"attr-track-width":m(e,"stroke-width",o);Ui.modify_canvas({"attr-pcbcanvas-routing-size":o||"1"});break;case"attr-track-layerid":zi.moveElementToLayer(e,o);Ln(e);break;case"attr-track-net":o&&(o=o.toUpperCase());m(e,"net",o);I=o;break;case"attr-track-start-x":K[0].x=o;m(e,"points",N(K));e==gi&&it(e);break;case"attr-track-start-y":K[0].y=o;m(e,"points",N(K));e==gi&&it(e);break;case"attr-track-end-x":K[W-1].x=o;m(e,"points",N(K));e==gi&&it(e);break;case"attr-track-end-y":K[W-1].y=o;m(e,"points",N(K));e==gi&&it(e)}}break;case"VIA":for(a in t)if(t.hasOwnProperty(a)){o=t[a];switch(a){case"attr-via-net":I=o?o.toUpperCase():"";C=!0;m(e,"net",I);m(d("part_via"),"net",I);break;case"attr-via-diameter-size":m(e.childNodes[0],"r",o/2);m(d("part_via").childNodes[0],"r",o/2);break;case"attr-via-hole-size":if(0!=+o){m(e.childNodes[1],"display",o/2==0?"none":"");m(e.childNodes[1],"r",o/2);m(d("part_via","net").childNodes[1],"r",o/2)}break;case"attr-via-x":m(e.childNodes[0],"cx",o);m(e.childNodes[1],"cx",o);C=!0;break;case"attr-via-y":m(e.childNodes[0],"cy",o);m(e.childNodes[1],"cy",o);C=!0}}break;case"HOLE":for(a in t)if(t.hasOwnProperty(a)){o=t[a];switch(a){case"attr-hole-hole-size":0!=+o&&vn("hole-size",+o,e);break;case"attr-hole-x":vn("x",+o,e);break;case"attr-hole-y":vn("y",+o,e)}}break;default:return}pi.updateOne(e);C&&(I&&L&&I!=L?Ei.buildGroupNets([I,L]):(I||L)&&Ei.buildOneNet(I||L,!0));"FOOTPRINT"==u&&Ei.buildRatLinesOfPCBLib(e);"PAD"!=u&&"VIA"!=u&&"HOLE"!=u||tt("updateAttrPanel");if("NotSaveHistory"!=r){v=e.cloneNode(!0);var q,$=0;for(a in t)if(t.hasOwnProperty(a)){if(++$>1){q="";break}q=a}Pi.quickchangeNode=null;Pi.quickchangeNodeClone=null;y&&Pi.save(["node",e.id,y,v],q)}}}else if("NotSaveHistory"!==r){g=Ui.getCanvasAttrs();Ui.modify_canvas(t);for(a in g)g.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&delete g.k;Pi.save(["attrpanel",Gi.id,g,t])}else Ui.modify_canvas(t)}}function vn(e,t,r){var n=pi.gJsonCache.HOLE[r.id||""];if(n){if("hole-size"==e){m(r.childNodes[1],"r",t/2);m(r.childNodes[2],"rx",t/2);m(r.childNodes[2],"ry",t/2);n.holeR=t/2}else if("x"==e){m(r.childNodes[1],"cx",t);m(r.childNodes[2],"cx",t);n.x=t}else if("y"==e){m(r.childNodes[1],"cy",t);m(r.childNodes[2],"cy",t);n.y=t}m(r.childNodes[0],"d",j(n.x,n.y,+n.holeR));m(r,"c_origin",n.x+","+n.y)}}function mn(e){var t,r,n={},i=e?M(e)?e:[e]:Xt(),a=i.length>1&&bn(i);n["attr-selected-count"]=i.length;if(a)return a;if(i.length<1||i.length>1&&!a){n=Ui.getCanvasAttrs();n["attr-selected-count"]=i.length;n.target="canvas";v(d("gPad"));v(d("gPre"));return n}t=i[0];n.target=ai.getPCBCmdKey(t);n["attr-locked"]=m(t,"locked")?"yes":"none";r=we(t);var o,s,l=ai.getPCBCmdKey(t);switch(l){case"ARC":var c=t.pathSegList,h=c.getItem(0),u=c.getItem(1),p=ai.arc.getCenterParam(h.x,h.y,u.x,u.y,u.largeArcFlag,u.sweepFlag,u.r1,u.r2,u.angle);if(p){n["attr-pcbarc-center-x"]=p.cx;n["attr-pcbarc-center-y"]=p.cy}n["attr-pcbarc-rx-size"]=u.r1;n["attr-pcbarc-start-x"]=h.x;n["attr-pcbarc-start-y"]=h.y;n["attr-pcbarc-end-x"]=u.x;n["attr-pcbarc-end-y"]=u.y;n["attr-pcbarc-width"]=r["stroke-width"];n["attr-pcbarc-layerid"]=r.layerid;n["attr-pcbarc-net"]=r.net;n["attr-pcbarc-length-size"]=Vi.getLengthOfTrackAndArc(pi.gJsonCache.ARC[t.id],!1);break;case"CIRCLE":n["attr-pcbcircle-width"]=parseFloat(r["stroke-width"]);n["attr-pcbcircle-layerid"]=r.layerid;n["attr-pcbcircle-center-x"]=r.cx;n["attr-pcbcircle-center-y"]=r.cy;n["attr-pcbcircle-r-size"]=r.r;break;case"COPPERAREA":n["attr-copperArea-layerid"]=r.layerid;n["attr-copperArea-net"]=r.net;n["attr-copperArea-thermal"]=r.thermal||"spoke";n["attr-copperArea-keep-island"]=r.keepIsland||"none";n["attr-copperArea-clearance-width"]=r.clearanceWidth||1;n["attr-copperArea-fill-style"]="none"==r.fillStyle?"none":"solid";break;case"SOLIDREGION":n["attr-solidRegion-layerid"]=r.layerid;n["attr-solidRegion-net"]=r.net;n["attr-solidRegion-type"]=r.type;break;case"DIMENSION":o=r.d||"";o.split("M");s=Vi.getStartAndEndPointByDimensionElement(t);n["attr-dimension-start-x"]=s[0];n["attr-dimension-start-y"]=s[1];n["attr-dimension-end-x"]=s[2];n["attr-dimension-end-y"]=s[3];n["attr-dimension-layerid"]=r.layerid;n["attr-dimension-font-height"]=r.c_fontSize||10;break;case"PROTRACTOR":var f=t.getAttribute("d"),g=/M.*\d*\s\d*\s/.exec(f);s=g?g[0].substring(1).trim().split(" "):[0,0];n["attr-protractor-start-x"]=s[0];n["attr-protractor-start-y"]=s[1];n["attr-protractor-layerid"]=r.layerid;n["attr-protractor-width"]=parseFloat(t.getAttribute("stroke-width"),10);n["attr-protractor-font-height"]=r.c_fontSize||4.5;n["attr-protractor-precision"]=r.c_precision||0;break;case"FOOTPRINT":var y=ut("pre",t);n["attr-footprint-prefix"]=m(y.firstChild,"c_text");n["attr-footprint-name-display"]="hidden";n["attr-footprint-prefix-display"]="none"==m(y,"display")?"none":"yes";n["attr-footprint-layerid"]=r.layerid;n["attr-footprint-x"]=r.c_origin.split(",")[0];n["attr-footprint-y"]=r.c_origin.split(",")[1];n["attr-footprint-rotation"]=r.c_rotation||0;n["attr-footprint-id"]=r.id;n.c_para=r.c_para;break;case"IMAGE":n["attr-pcbimage-layerid"]=r.layerid;n["attr-pcbimage-href"]=r["xlink:href"];n["attr-pcbimage-x"]=r.x;n["attr-pcbimage-y"]=r.y;n["attr-pcbimage-width"]=r.width;n["attr-pcbimage-height"]=r.height;var x=ie(t);x>0&&(x=360-x);n["attr-pcbimage-rotation"]=x;break;case"SVGNODE":n["attr-pcbsvgimage-layerid"]=r.layerid;var _,P=getComputedStyle(t),S=P&&"none"!=P.display;if(S)_=ai.svg.getBBox(t);else{t.style.display="inline";_=ai.svg.getBBox(t);t.style.display=""}n["attr-pcbsvgimage-x"]=ai.toFixed(_.x,1);n["attr-pcbsvgimage-y"]=ai.toFixed(_.y,1);n["attr-pcbsvgimage-width"]=ai.toFixed(_.width,1);n["attr-pcbsvgimage-height"]=ai.toFixed(_.height,1);break;case"PAD":n["attr-pad-number"]=r.number;n["attr-pad-shape"]=r.c_shape;n["attr-pad-layerid"]=r.layerid;n["attr-pad-net"]=r.net;n["attr-pad-width"]=r.c_width;n["attr-pad-height"]=r.c_height;n["attr-pad-id"]=r.id;var b=we(t);n["attr-pad-x"]=+b.c_origin.split(",")[0];n["attr-pad-y"]=+b.c_origin.split(",")[1];n["attr-pad-points"]="POLYGON"==r.c_shape?Cr(t):"";n["attr-pad-rotation"]=r.c_rotation||0;n["attr-pad-hole-shape"]=Gr(t);if("slot"==n["attr-pad-hole-shape"]){var C=+m(t.childNodes[1],"stroke-width"),A=R(m(t.childNodes[1],"points"));n["attr-pad-hole-y-size"]=+(Vi.distancePointToPoint(A[0],A[1])+C);n["attr-pad-hole-size"]=+C}else{n["attr-pad-hole-size"]=2*m(t.childNodes[1],"r");n["attr-pad-hole-size"]=n["attr-pad-hole-size"]>.002?n["attr-pad-hole-size"]:0;n["attr-pad-hole-y-size"]=0}n["attr-pad-plated"]=r.plated;break;case"RATLINE":n["attr-ratLine-net"]=r.net;n["attr-ratLine-start-x"]=r.x1;n["attr-ratLine-start-y"]=r.y1;n["attr-ratLine-end-x"]=r.x2;n["attr-ratLine-end-y"]=r.y2;n["attr-ratLine-id"]=r.id;break;case"RECT":n["attr-pcbrect-layerid"]=r.layerid;n["attr-pcbrect-start-x"]=r.x;n["attr-pcbrect-start-y"]=r.y;n["attr-pcbrect-width"]=r.width;n["attr-pcbrect-height"]=r.height;break;case"TEXT":var I=we(t.firstChild);n["attr-pcbtext-text"]=(I.c_text||"").replace(/\n/g,"\\n");n["attr-pcbtext-font-family"]=I.c_fontFamily||"";n["attr-pcbtext-line-width"]=I["stroke-width"];n["attr-pcbtext-height"]=I.c_fontSize;n["attr-pcbtext-layerid"]=r.layerid;n["attr-pcbtext-rotation"]=r.c_rotation;n["attr-pcbtext-mirror"]=r.c_mirror;break;case"TRACK":var L=me(t.points),E=L.length;n["attr-track-width"]=parseFloat(r["stroke-width"],10);n["attr-track-layerid"]=r.layerid;n["attr-track-net"]=r.net;n["attr-track-start-x"]=E>0?L[0].x:0;n["attr-track-start-y"]=E>0?L[0].y:0;n["attr-track-end-x"]=E>0?L[E-1].x:0;n["attr-track-end-y"]=E>0?L[E-1].y:0;n["attr-track-id"]=r.id;"path"!=t.tagName&&"polyline"!=t.tagName&&"line"!=t.tagName&&"polygon"!=t.tagName||(n["attr-arrow-marker"]=m(t,"marker-start")?"start":m(t,"marker-end")?"end":"");pi.gJsonCache.TRACK||(pi.gJsonCache.TRACK={});n["attr-track-length-size"]=Vi.getLengthOfTrackAndArc(pi.gJsonCache.TRACK[t.id],!1);break;case"VIA":n["attr-via-net"]=r.net;n["attr-via-diameter-size"]=2*m(t.childNodes[0],"r");n["attr-via-hole-size"]=2*m(t.childNodes[1],"r");n["attr-via-id"]=r.id;n["attr-via-x"]=m(t.childNodes[0],"cx");n["attr-via-y"]=m(t.childNodes[0],"cy");break;case"HOLE":n["attr-hole-hole-size"]=2*m(t.childNodes[1],"r");n["attr-hole-id"]=r.id;n["attr-hole-x"]=m(t.childNodes[1],"cx");n["attr-hole-y"]=m(t.childNodes[1],"cy")}return n}function xn(e,t,r){var n=m(e,"c_para")||"",i=n.split(Un),a=(i.length,ai.c_paraToJson(n));if(0!==Object.keys(a).length&&0!==t.indexOf("attr-")){a[t]=r;for(var o in a)A(a,o)&&(a[o]||"package"==o||delete a[o]);m(e,{c_para:ai.jsonToC_para(a)})}}function _n(e,t){function r(){if(o){var r=t.text||x.c_text,i=t.height||x.c_fontSize;r&&r.match(/\s|\n/)&&"note_pre"==x.c_note&&(r=r.replace(/\s|\n/g,""));var l=r.replace(/\n/g,"\\n"),c=r.replace(/\\n/g,"\n")
;if(P){t.fontFamily=_="";S=!0}var h={text:c,x:y,y:v,fontSize:i,fontFamily:_,degree:A(t,"rotation")?t.rotation:oe(360-d),mirror:f,rotateOriginX:y,rotateOriginY:v},u=tt("getFontPath",[h]);if(!u)return;m(a,{d:u,c_text:l,c_fontSize:i,c_fontFamily:_});m(a,{stroke:S?"":"none",fill:S?"none":""});m(e,"c_rotation",h.degree);m(e,"c_mirror",f?"1":"");Zt(e)}else if(s){if(A(t,"rotation")){n=oe(360-((t.rotation||0)-d));n&&Ri.rotate(e,n,y,v);m(e,"c_rotation",t.rotation)}if(p){var g=+m(e,"c_rotation")||0;if(g){Ri.rotate(e,g,y,v);Ni.flipH([e],y);Ri.rotate(e,-g,y,v)}else Ni.flipH([e],y);m(e,"c_mirror",f?"1":"");var b=y,C=v,I=re([b+100,C],90-g,b,C);I[0],I[1]}Zt(e)}A(t,"layerid")&&m(e,"layerid",t.layerid);t.lineWidth&&(S?m(a,{"stroke-width":t.lineWidth}):parent.$.messager.info("Changing line width won't work for silhouette fonts."))}var n,i=we(e),a=e.children[0],o=(e.children[1],Object.keys(t),A(t,"text")||A(t,"height")||A(t,"fontFamily")),s=A(t,"layerid")||A(t,"rotation"),l=[Fn.BOTTOMLAYER,Fn.BOTTOMSILKLAYER,Fn.BOTTOMPASTERLAYER,Fn.BOTTOMSOLDERLAYER],c=function(e){return l.indexOf(+e)>=0},d=+i.c_rotation||0,h=i.layerid,u=c(h),p=A(t,"layerid")&&u!=c(t.layerid),f=p?!u:u,g=i.c_origin.split(","),y=+g[0],v=+g[1],x=we(a),_=A(t,"fontFamily")?t.fontFamily:x.c_fontFamily||"",P=_&&tt("isFontMissing",[_]),S=!_;A(t,"text")&&P?parent.$.messager.confirm("Confirmation","Font is missing! You can confirm the dialog and use default font instead or cancel the dialog then upload your font and do it again.",function(e){e&&r()}):r()}function Pn(e,t){function r(){if(P!=i.c_shape){y="ELLIPSE"==P?Ue("ellipse",{cx:a,cy:o,rx:S,ry:S,stroke:"none","stroke-width":"0"}):"OVAL"==P?Ue("polyline",{points:C,"stroke-width":S}):Ue("polygon",{points:v,stroke:"none","stroke-width":"0"});e.replaceChild(y,e.childNodes[0])}else"ELLIPSE"==P?m(e.childNodes[0],{rx:S,ry:S}):"OVAL"==P?m(e.childNodes[0],{points:C,"stroke-width":S}):m(e.childNodes[0],"points",v);m(e,{c_width:x,c_height:_,c_rotation:s,c_shape:P})}function n(){var t=[],r=(B-2*u)/2||.01;t=[a-r,o,a+r,o];t=re(t,(360-(+m(e,"c_width")<+m(e,"c_height")?s+90:s))%360,a,o);return t.join(" ")}if(e&&e.childNodes&&e.childNodes[0]){A(t,"number")&&m(e,{number:t.number});A(t,"net")&&m(e,"net",t.net);A(t,"plated")&&m(e,"plated",t.plated||"Y");A(t,"x")&&A(t,"y")&&dt(e,t.x,t.y);var i=we(e),a=+i.c_origin.split(",")[0],o=+i.c_origin.split(",")[1],s=+i.c_rotation,l=e.childNodes[1],c=Gr(e),u=0,p=0,f=t.holeType||c;if(A(t,"layerid")&&t.layerid!=i.layerid){if(i.layerid==Fn.ALL&&t.layerid!=Fn.ALL){t.holeR=0;t.holeLength=0}else if(i.layerid!=Fn.ALL&&t.layerid==Fn.ALL&&!t.holeR){var g=pi.gJsonCache.DRCRULE?pi.gJsonCache.DRCRULE.holeSize:1.2;t.holeR=+(.3*Math.min(t.width||i.c_width||6,t.height||i.c_height||6)).toFixed(2);t.holeR=Math.max(t.holeR,g||1e-4,1e-4)}zi.moveElementToLayer(e,t.layerid)}if(A(t,"width")||A(t,"height")||A(t,"shape")){var y,v,x=+(t.width||i.c_width),_=+(t.height||i.c_height),P=t.shape||i.c_shape,S=0,b=0,C=[],I=0,L=0;switch(P){case"RECT":I=a-x/2;L=o-_/2;C=ai.convertRect2Polygon(I,L,x,_);v=re(C,360-s,a,o);r();break;case"ELLIPSE":b="width"in t?x:"height"in t?_:Math.min(x,_);S=b/2;x=_=b;r();break;case"OVAL":C=An(a,o,x,_,s);C=N(C[0]);S=Math.min(+x,+_);r();break;case"POLYGON":if("ELLIPSE"==i.c_shape){I=a-x/2;L=o-_/2;v=ai.convertRect2Polygon(I,L,x,_)}else if("OVAL"==i.c_shape)v=N(An(a,o,x,_,s)[1]);else{var E=e.childNodes[0],O=m(E,"points");v=(O||"").replace(/[ ,]{2,}| /g,",").split(",")}r();break;default:return}}if((A(t,"layerid")?t.layerid:i.layerid)!=Fn.ALL){t.holeR=0;t.holeLength=0}else{u="slot"==c?m(l,"stroke-width")/2:+m(l,"r");if("slot"==c){var T=+m(l,"stroke-width"),w=R(m(l,"points"));p=Vi.distancePointToPoint(w[0],w[1])+T}else p=2.1*m(l,"r");if("slot"==f){0==+t.holeR&&(t.holeR=u);0==+t.holeLength&&(t.holeLength=p)}else 0==+t.holeR&&(t.holeR=u);if("slot"==f){u=t.holeR||u;t.holeLength<=2*u&&(t.holeLength=2.1*u)}}if("round"==c)u="holeR"in t?+t.holeR||1e-4:+m(e.childNodes[1],"r");else{u="holeR"in t?+t.holeR||1e-4:+m(e.childNodes[1],"stroke-width")/2;var k=R(m(e.childNodes[1],"points")),B=t.holeLength||Vi.distancePointToPoint(k[0],k[1])+2*u;C=n()}if(c!=f)if("round"==f)u=+(t.holeR||m(e.childNodes[1],"stroke-width")/2);else{u=+(t.holeR||m(e.childNodes[1],"r"));B=2.1*u;C=n()}!function(){if(f!=c){y="round"==f?Ue("circle",{cx:a,cy:o,r:u,stroke:"none","stroke-width":"0"}):Ue("polyline",{points:C,"stroke-width":2*u});e.replaceChild(y,l);l=y}else"round"==f?m(l,{r:u}):m(l,{points:C,"stroke-width":2*u})}();var M=e.cloneNode(!0);m(M,"id","part_pad");m(M,"display","none");m(M,"class","");m(h("[id]",M),"id","");var V=d("gCurParts"),G=d("part_pad");G&&G.parentNode==V&&V.replaceChild(M,G)}}function Sn(e,t,r){if(!r){if(m(e,"layerid")==t)return}var n=ai.getPCBCmdKey(e);if("FOOTPRINT"==n||"TEXT"==n){m(e,"layerid",t);var i={};i[Fn.TOPLAYER]=Fn.BOTTOMLAYER;i[Fn.TOPSILKLAYER]=Fn.BOTTOMSILKLAYER;i[Fn.TOPPASTERLAYER]=Fn.BOTTOMPASTERLAYER;i[Fn.TOPSOLDERLAYER]=Fn.BOTTOMSOLDERLAYER;i[Fn.BOTTOMLAYER]=Fn.TOPLAYER;i[Fn.BOTTOMSILKLAYER]=Fn.TOPSILKLAYER;i[Fn.BOTTOMPASTERLAYER]=Fn.TOPPASTERLAYER;i[Fn.BOTTOMSOLDERLAYER]=Fn.TOPSOLDERLAYER;Ni.flipH([e]);var a=+m(e,"c_rotation");if(a){a=oe(360-a);m(e,"c_rotation",a)}if("FOOTPRINT"==n){var o=u('g[c_partid="part_pcbtext"] > [c_note="note_pre"]',e);if(o){o=o.parentNode;a=+m(o,"c_rotation");if(a){a=oe(360-a);m(o,"c_rotation",a)}}}for(var s,l=0,c=e.children,d=c.length;l<d;l++){s=m(c[l],"layerid");A(i,s)&&m(c[l],"layerid",i[s])}}}function bn(e){function t(e){var t,r=ai.getPCBCmdKey(e),n=mn(e);switch(r){case"FOOTPRINT":t=["attr-footprint-layerid","attr-footprint-prefix-display","attr-footprint-rotation"];break;case"TRACK":t=["attr-track-width","attr-track-layerid","attr-track-net"];break;case"PAD":t=["attr-pad-shape","attr-pad-layerid","attr-pad-net","attr-pad-width","attr-pad-height","attr-pad-hole-size"];break;case"VIA":t=["attr-via-diameter-size","attr-via-hole-size","attr-via-net"];break;case"TEXT":t=["attr-pcbtext-line-width","attr-pcbtext-height","attr-pcbtext-layerid","attr-pcbtext-font-family"];break;default:return null}for(var i in n)A(n,i)&&t.indexOf(i)<0&&delete n[i];n["attr-cmdkey"]=r;return n}if(!e||e.length<2)return!1;var r=["FOOTPRINT","TRACK","PAD","VIA","TEXT"],n=t(e[0]);if(!n)return!1;for(var i=e[0].tagName,a=1,o=e.length;a<o;a++){if(e[a].tagName!=i)return!1;var s=t(e[a]);if(!s||!function(e,t){return e["attr-cmdkey"]==t["attr-cmdkey"]&&r.indexOf(e["attr-cmdkey"])>=0}(n,s))return!1}n.target=ai.getPCBCmdKey(e[0]);n["attr-selected-count"]=e.length;return n}function Cn(e,t,r){switch(t){case"npth":m(e,{"stroke-width":"0.2",type:"npth",net:"",fill:""});r=Fn.ALL;break;case"solid":r=r==Fn.ALL?Fn.TOPLAYER:r;m(e,{"stroke-width":"0.2",type:"solid",fill:""});break;case"cutout":r=r==Fn.ALL?Fn.TOPLAYER:r;m(e,{"stroke-width":"1",type:"cutout",fill:"none"})}zi.moveElementToLayer(e,r)}function An(e,t,r,n,i){var a;r=+r;n=+n;var o=Math.min(r,n)/2;a=ai.createPolylineForOvalPad(e,t,r,n,i);var s=Ai.transformLineToOutlineBox(R(a.join(" ")),o);return[R(a.join(" ")),s]}function In(e){return pi.gJsonCache.layers[e]&&pi.gJsonCache.layers[e].visible}function Ln(e){function t(e,t,r){var n=pi.ifFind(e,t,r,Fn.ALL,"VIA");if(n&&n.type)return!0;n=pi.ifFind(e,t,r,Fn.ALL,"PAD");return!(!n||!n.type)}var r=ai.getPCBCmdKey(e),n=[],i=we(e);"TRACK"===r?n.push(e.points[0],e.points[e.points.length-1]):"ARC"===r&&n.push(e.pathSegList.getItem(0),e.pathSegList.getItem(1));if(!(n.length<2)&&Mr(i.layerid)){var a=pi.ifFind(n[0].x,n[0].y,i.net,Fn.ALL,"TRACK",i.id),o=pi.ifFind(n[1].x,n[1].y,i.net,Fn.ALL,"TRACK",i.id);if(a&&("TRACK"===a.type||"ARC"===a.type)&&a.gId!==i.id&&a.layerid!==i.layerid&&!t(n[0].x,n[0].y,i.net)){var s=Or(n[0].x,n[0].y,i.net);pi.updateOne(s);Pi.save(["add",s.id])}if(o&&("TRACK"===o.type||"ARC"===o.type)&&o.gId!==i.id&&o.layerid!==i.layerid&&!t(n[1].x,n[1].y,i.net)){var l=Or(n[1].x,n[1].y,i.net);pi.updateOne(l);Pi.save(["add",l.id])}}}function En(e){var t=e.shapeType;if(!(["TEXT","PAD","VIA","HOLE"].indexOf(t)<0)){var r,n,i={TEXT:{layerid:"attr-pcbtext-layerid",text:"attr-pcbtext-text","line-width":"attr-pcbtext-line-width",height:"attr-pcbtext-height"},PAD:{number:"attr-pad-number",shape:"attr-pad-shape",layerid:"attr-pad-layerid",net:"attr-pad-net",width:"attr-pad-width",height:"attr-pad-height","hole-size":"attr-pad-hole-size"},VIA:{"diameter-size":"attr-via-diameter-size","hole-size":"attr-via-hole-size",net:"attr-via-net"},HOLE:{"hole-size":"attr-hole-hole-size"},FOOTPRINT:{prefix:"attr-footprint-prefix",layerid:"attr-footprint-layerid","prefix-display":"attr-footprint-prefix-display",x:"attr-footprint-x",y:"attr-footprint-y",rotation:"attr-footprint-rotation"}},a={},o=i[t];n=d("TEXT"==t?"part_pcbtext":"part_"+t.toLowerCase());if(n){r=n.cloneNode(!0);m(r,{c_shapetype:"group",c_etype:"pinpart"});x(r,"pointer-events");A(e,"x")&&A(e,"y")&&dt(r,e.x,e.y);Fe(r);zi.appendElement(r);pi.updateOne(r);if(o){!function(e,t,r){if(r)for(var n in r)if(A(r,n))if(A(e,n))t[r[n]]=e[n];else{var i=ai.camelize(n);A(e,i)&&(t[r[n]]=e[i])}}(e,a,o);Object.keys(a).length>0&&yn(r,a,"NotSaveHistory")}"PAD"!=t&&"VIA"!=t||!m(r,"net")||Ei.buildOneNet(m(r,"net"),!1);"PAD"==t&&wr();Pi.save(["add",r.id]);return r}}}function On(e){function t(t){if(A(e,t))return e[t];if(t.indexOf("-")>-1){var r=ai.camelize(t);if(A(e,r))return e[r]}else{var n=ai.dasherize(t);if(A(e,n))return e[n]}}function r(e,t){var r=t.points||t.pointArr;Array.isArray(r)&&(r=r.reduce(function(e,t){return(e?e+" ":"")+t.x+" "+t.y},""));return Ue(e,{points:r,id:ai.newId()})}function n(e){return Ue("path",{d:e.d,id:ai.newId()})}var i,a,o=e.shapeType;if(!(["TRACK","DIMENSION","COPPERAREA","SOLIDREGION","RECT","CIRCLE","ARC"].indexOf(o)<0)){var s={TRACK:{width:"attr-track-width",net:"attr-track-net"},DIMENSION:{},COPPERAREA:{"clearance-width":"attr-copperArea-clearance-width",thermal:"attr-copperArea-thermal","keep-island":"attr-copperArea-keep-island","fill-style":"attr-copperArea-fill-style",net:"attr-copperArea-net"},SOLIDREGION:{type:"attr-solidRegion-type",layerid:"attr-solidRegion-layerid",net:"attr-solidRegion-net"},RECT:{},CIRCLE:{width:"attr-pcbcircle-width"},ARC:{width:"attr-pcbarc-width",net:"attr-pcbarc-net"}},l=e.layerid||zi.getActiveLayer();l=zi.getValidLayer(o,l);switch(o){case"TRACK":i=function(e){e.strokeWidth||(e.strokeWidth=bi.canvas.routing);var t=e.points||e.pointArr,n=e.layerid||zi.getActiveLayer(),i=e.net||"";n=zi.getValidLayer("TRACK",n);i||(i=ft());var a=r("polyline",t);m(a,{c_shapetype:"line",c_etype:"wire",layerid:n,net:i});return a}(e);break;case"DIMENSION":a=Vi.getDimensionPath({x:t("start-x"),y:t("start-y")},{x:t("end-x"),y:t("end-y")});i=n({d:a});m(i,{"stroke-width":"1",fill:"none",c_shapetype:"group"});break;case"COPPERAREA":i=r("polygon",e);m(i,{fill:"none","stroke-width":2,"stroke-dasharray":"3,3",clearanceWidth:"1",thermal:"spoke",keepIsland:"none",net:"GND"});break;case"SOLIDREGION":i=r("polygon",e);m(i,{"stroke-width":"0.2",type:"solid"});break;case"RECT":i=Ue("rect",{id:ai.newId(),x:e.x,y:e.y,width:e.width,height:e.height,rx:e["round-radius"]||"",ry:e["round-radius"]||""});break;case"CIRCLE":i=Ue("circle",{id:ai.newId(),cx:e.cx,cy:e.cy,r:e.r});break;case"ARC":a=function(e){function t(t){return A(e,t)}function r(t){return e[t]}A(e,"angle")||(e.angle=0);!A(e,"rx")&&A(e,"r1")&&(e.rx=e.r1);!A(e,"ry")&&A(e,"r2")&&(e.ry=e.r2);var n,i,a=["x1","y1","x2","y2","rx","ry","angle","largeArcFlag","sweepFlag"],o=["cx","cy","rx","ry","x1","y1","x2","y2"],s=["x1","y1","x2","y2","x3","y3"],l=["cx","cy","rx","ry","a1","a2","sweepFlag"],c=e.shapeType,d="pie"==c;if(a.every(t)){i="A"+e.rx+" "+e.ry+" "+(e.angle||0)+" "+(e.largeArcFlag?1:0)+" "+(e.sweepFlag?1:0)+" "+e.x2+" "+e.y2;if(d){var h=ai.arc.getCenterParam(e.x1,e.y1,e.x2,e.y2,e.largeArcFlag,e.sweepFlag,e.rx,e.ry,e.angle||0);h&&(i="M"+h.cx+" "+h.cy+"L"+e.x1+" "+e.y1+i+"Z")}else i="M"+e.x1+" "+e.y1+i}else if(o.every(t)){n=ai.arc.getArcParams.apply(null,o.map(r));i="A"+e.rx+" "+e.ry+" 0 "+n.fa+" "+n.fs+" "+n.x2+" "+n.y2;i=d?"M"+e.cx+" "+e.cy+"L"+n.x1+" "+n.y1+i+"Z":"M"+n.x1+" "+n.y1+i}else if(s.every(t)){n=ai.arc.getArcParamsBy3Points.apply(null,s.map(r));i="A"+n.r1+" "+n.r2+" "+n.angle+" "+n.largeArcFlag+" "+n.sweepFlag+" "+n.x+" "+n.y;i=d?"M"+n.cx+" "+n.cy+"L"+e.x1+" "+e.y1+i+"Z":"M"+e.x1+" "+e.y1+i}else if(l.every(t)){n=ai.arc.getArcParamsByCRA.apply(null,l.map(r));i="A"+e.rx+" "+e.ry+" 0 "+n.fa+" "+n.fs+" "+n.x2+" "+n.y2;i=d?"M"+e.cx+" "+e.cy+"L"+n.x1+" "+n.y1+i+"Z":"M"+n.x1+" "+n.y1+i}return i}(e);if(a){i=n({d:a});m(i,{"stroke-width":"1"})}}if(i){m(i,"layerid",l);zi.appendElement(i,o);pi.updateOne(i);var c=s[o];a={};if(c){!function(e,t,r){if(r)for(var n in r)if(A(r,n))if(A(e,n))t[r[n]]=e[n];else{var i=ai.camelize(n);A(e,i)&&(t[r[n]]=e[i])}}(e,a,c);Object.keys(a).length>0&&yn(i,a,"NotSaveHistory")}Pi.save(["add",i.id])}}}function Tn(e){var t=d(e.id);if(t&&e.svg&&t.parentNode==Gi){var r=e.id,n=t,i=Ye(e.svg);if(i){var a=ai.getPCBCmdKey(i);if(a==ai.getPCBCmdKey(n)){var o=h("*",n),s=h("*:not(.hitbox)",i);i.id=r;for(var l=0;l<s.length;l++)s[l].id=o[l]&&o[l].id||ai.newId();var c=function(e){for(var t=e;t&&t.parentNode!=Gi;)t=t.parentNode;return t!=e&&t}(n),u=(c||n).cloneNode(!0);n=n.parentNode.replaceChild(i,n);Qi==Dn.PCB&&"FOOTPRINT"==a&&Tr(i);if(Qi==Dn.PCB&&"TEXT"==a){var p=+m(i,"c_rotation");if(p){m(i,"c_rotation","0");Ri.rotate(i,360-p)}}var f=(c||i).cloneNode(!0);pi.updateOne(i);Qi==Dn.PCB&&m(i,"net")&&Ei.buildOneNet(m(i,"net"),!1);Pi.save(["node",f.id,f,u])}}}}function wn(){function e(e){var t=e.metaKey,r=e.ctrlKey,n=e.shiftKey,i=e.altKey,a=e.keyCode,o="",l=s[a];t&&(o+="Cmd+");r&&(o+="Ctrl+");n&&(o+="Shift+");i&&(o+="Alt+");a>=48&&a<=57||a>=65&&a<=90?o+=String.fromCharCode(a):"Cmd"!=l&&"Ctrl"!=l&&"Shift"!=l&&"Alt"!=l&&s.hasOwnProperty(a)&&(o+=s[a]);o&&/[^+]\+$/.test(o)&&(o=o.substring(0,o.length-1));return o}function r(t){Bi.altKeyEnabled=t.altKey;if(t.target.tagName){var r=t.target.tagName.toUpperCase();if("TEXTAREA"==r||"INPUT"==r&&"text"==t.target.type)return}if("keydown"===t.type){var n,s=e(t),l=Qi==Dn.PCB||Qi==Dn.PCBLIB||Qi==Dn.PCBMODULE?"PCB":"SCH",c=tt("getHotkeyConfig");if(c&&c[l]){c[l].hasOwnProperty(s)?n=c[l][s]:c.ALL.hasOwnProperty(s)&&(n=c.ALL[s]);n||"R"!=s||(n="rotate");if(n)if(o.hasOwnProperty(n)){var d=o[n](t);if(!1===d&&("Up"==s||"Down"==s||"Left"==s||"Right"==s)){var h={Up:[0,-1],Down:[0,1],Left:[-1,0],Right:[1,0]},u=Ui.getViewBox(),p=10/ci;u[0]+=p*h[s][0];u[1]+=p*h[s][1];Ui.setViewBox(u);t.preventDefault();t.stopPropagation();return}}else a(n);if(i.test(s)||qn&&"Delete"==s){t.preventDefault();t.stopPropagation()}}}}function n(t){if("keyup"===t.type){if(t.target.tagName){var r=t.target.tagName.toUpperCase();if("TEXTAREA"==r||"INPUT"==r&&"text"==t.target.type)return}var n=e(t);(i.test(n)||qn&&"Delete"==n)&&t.preventDefault();if("Esc"===n&&si.on){a("dragMoveSwitch",[!1]);a("undo")}}}var i=/^(Backspace|Space|Home|End|(?:Ctrl|Cmd|Shift)\+[\-+AOSFRDG])$/,o={left:function(){return Et(-1,0)},right:function(){return Et(1,0)},up:function(){return Et(0,-1)},down:function(){return Et(0,1)},zoom_in:function(){return tt("zoom_in",[gt.data])},zoom_out:function(){return tt("zoom_out",[gt.data])},draw_end:function(){if(0===xi.indexOf("place.part_")){Yi.end(s.ESC);return!0}if(xi){Yi.restart(!0);return!0}return!1},file_save:function(){return tt("file_save")},editSymbol:function(){return tt("symbolTool")},snap_grid:function(){return tt("snap_grid",[!bi.adsorbGrid.enabled])},change_route_angle:function(){var e=bi.canvas.angle+"",t=["45","90","0","ARC"];return tt("updateAttrByHotkey",[{cmd:"pcbcanvas-angle",value:t[(t.indexOf(e)+1)%t.length]}])},decrease_routing_width:function(){var e=+bi.canvas.routing;if(e>=.8){return tt("updateAttrByHotkey",[{cmd:"pcbcanvas-routing-size",value:ai.toFixed(ai.units.convert(e-.2,"pixel",bi.canvas.unit),ai.units.decimals[bi.canvas.unit])}])}},increase_routing_width:function(){var e=+bi.canvas.routing;return tt("updateAttrByHotkey",[{cmd:"pcbcanvas-routing-size",value:ai.toFixed(ai.units.convert(e+.2,"pixel",bi.canvas.unit),ai.units.decimals[bi.canvas.unit])}])},decrease_snap_size:function(){var e=+bi.adsorbGrid.distanceX;if(e>=.6){return tt("updateAttrByHotkey",[{cmd:"pcbcanvas-snap-size",value:ai.toFixed(ai.units.convert(e-.1,"pixel",bi.canvas.unit),ai.units.decimals[bi.canvas.unit])}])}},increase_snap_size:function(){var e=+bi.adsorbGrid.distanceX;return tt("updateAttrByHotkey",[{cmd:"pcbcanvas-snap-size",value:ai.toFixed(ai.units.convert(e+.1,"pixel",bi.canvas.unit),ai.units.decimals[bi.canvas.unit])}])},highlight_net:function(){var e;if(gi)e=m(gi,"net");else{var t=Xt();t&&t[0]&&(e=m(t[0],"net"))}e&&br(e,{scroll:!1})},remove_all_copper_area:function(){Ai.removeAllCopperPolygons()},rebuild_all_copper_area:function(){Ai.rebuildCopperArea("all")},findComponent:function(){return tt("findComponent")},findLibs:function(){tt("findLibs")},crossProbe:function(){return tt("crossProbe")},crossProbeAndPlace:function(){return tt("crossProbeAndPlace")},designManager:function(){return tt("designManager")},runDocSimulation:function(){return tt("runDocSimulation")},exploreFindComponents:function(){return tt("exploreFindComponents")}},s=function(){var e,t={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Esc:27,Space:32,PageUp:33,PageDn:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Delete:46,"`":192,"-":ri?173:189,"+":ri?61:187,"[":219,"]":221,"\\":220,";":ri?59:186,"'":222,",":188,".":190,"/":191};for(e=1;e<=12;e++)t["F"+e]=111+e;var r=Object.keys(t);for(e=0;e<r.length;e++){var n=t[r[e]];A(t,n)||(t[n]=r[e])}if(qn){if(ri)t[224]="Cmd";else{t[91]="Cmd";t[93]="Cmd"}delete t.Backspace;t[8]="Delete";t.Delete=8}return t}();a.registerHook({transferKeydown:r,transferKeypress:r});t.addEventListener("keydown",r,!1);t.addEventListener("keyup",n,!1);!function(){if(ti){var e=function(e){if((e.keyCode==s["+"]||e.keyCode==s["-"])&&(qn?e.metaKey:e.ctrlKey)){e.preventDefault();e.stopPropagation();return!1}};t.addEventListener("keydown",e,!1)}}()}!function(){"use strict";if(!("SVGPathSeg"in e)){e.SVGPathSeg=function(e,t,r){this.pathSegType=e;this.pathSegTypeAsLetter="z"==t?"Z":t;this._owningPathSegList=r};SVGPathSeg.prototype.classname="SVGPathSeg";SVGPathSeg.PATHSEG_UNKNOWN=0;SVGPathSeg.PATHSEG_CLOSEPATH=1;SVGPathSeg.PATHSEG_MOVETO_ABS=2;SVGPathSeg.PATHSEG_MOVETO_REL=3;SVGPathSeg.PATHSEG_LINETO_ABS=4;SVGPathSeg.PATHSEG_LINETO_REL=5;SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS=6;SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL=7;SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS=8;SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL=9;SVGPathSeg.PATHSEG_ARC_ABS=10;SVGPathSeg.PATHSEG_ARC_REL=11;SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS=12;SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL=13;SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS=14;SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL=15;SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS=16;SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL=17;SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS=18;SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL=19;SVGPathSeg.prototype._segmentChanged=function(){this._owningPathSegList&&this._owningPathSegList.segmentChanged(this)};e.SVGPathSegClosePath=function(e){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CLOSEPATH,"z",e)};SVGPathSegClosePath.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegClosePath.prototype.toString=function(){return"[object SVGPathSegClosePath]"};SVGPathSegClosePath.prototype._asPathString=function(){return this.pathSegTypeAsLetter};SVGPathSegClosePath.prototype.clone=function(){return new SVGPathSegClosePath(void 0)};e.SVGPathSegMovetoAbs=function(e,t,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_MOVETO_ABS,"M",e);this._x=t;this._y=r};SVGPathSegMovetoAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegMovetoAbs.prototype.toString=function(){return"[object SVGPathSegMovetoAbs]"};SVGPathSegMovetoAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegMovetoAbs.prototype.clone=function(){return new SVGPathSegMovetoAbs(void 0,this._x,this._y)};Object.defineProperty(SVGPathSegMovetoAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegMovetoAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegMovetoRel=function(e,t,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_MOVETO_REL,"m",e);this._x=t;this._y=r};SVGPathSegMovetoRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegMovetoRel.prototype.toString=function(){return"[object SVGPathSegMovetoRel]"};SVGPathSegMovetoRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegMovetoRel.prototype.clone=function(){return new SVGPathSegMovetoRel(void 0,this._x,this._y)};Object.defineProperty(SVGPathSegMovetoRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegMovetoRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegLinetoAbs=function(e,t,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_ABS,"L",e);this._x=t;this._y=r};SVGPathSegLinetoAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoAbs.prototype.toString=function(){return"[object SVGPathSegLinetoAbs]"};SVGPathSegLinetoAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegLinetoAbs.prototype.clone=function(){return new SVGPathSegLinetoAbs(void 0,this._x,this._y)};Object.defineProperty(SVGPathSegLinetoAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegLinetoAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegLinetoRel=function(e,t,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_REL,"l",e);this._x=t;this._y=r};SVGPathSegLinetoRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoRel.prototype.toString=function(){return"[object SVGPathSegLinetoRel]"};SVGPathSegLinetoRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegLinetoRel.prototype.clone=function(){return new SVGPathSegLinetoRel(void 0,this._x,this._y)};Object.defineProperty(SVGPathSegLinetoRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegLinetoRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoCubicAbs=function(e,t,r,n,i,a,o){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS,"C",e);this._x=t;this._y=r;this._x1=n;this._y1=i;this._x2=a;this._y2=o};SVGPathSegCurvetoCubicAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoCubicAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicAbs]"};SVGPathSegCurvetoCubicAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y};SVGPathSegCurvetoCubicAbs.prototype.clone=function(){return new SVGPathSegCurvetoCubicAbs(void 0,this._x,this._y,this._x1,this._y1,this._x2,this._y2)};Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"x1",{get:function(){return this._x1},set:function(e){this._x1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"y1",{get:function(){return this._y1},set:function(e){this._y1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"x2",{get:function(){return this._x2},set:function(e){this._x2=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"y2",{get:function(){return this._y2},set:function(e){this._y2=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoCubicRel=function(e,t,r,n,i,a,o){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL,"c",e);this._x=t;this._y=r;this._x1=n;this._y1=i;this._x2=a;this._y2=o};SVGPathSegCurvetoCubicRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoCubicRel.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicRel]"};SVGPathSegCurvetoCubicRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y};SVGPathSegCurvetoCubicRel.prototype.clone=function(){return new SVGPathSegCurvetoCubicRel(void 0,this._x,this._y,this._x1,this._y1,this._x2,this._y2)};Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"x1",{get:function(){return this._x1},set:function(e){this._x1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"y1",{get:function(){return this._y1},set:function(e){this._y1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"x2",{get:function(){return this._x2},set:function(e){this._x2=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"y2",{get:function(){return this._y2},set:function(e){this._y2=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoQuadraticAbs=function(e,t,r,n,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS,"Q",e);this._x=t;this._y=r;this._x1=n;this._y1=i};SVGPathSegCurvetoQuadraticAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoQuadraticAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticAbs]"};SVGPathSegCurvetoQuadraticAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y};SVGPathSegCurvetoQuadraticAbs.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticAbs(void 0,this._x,this._y,this._x1,this._y1)};Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"x1",{get:function(){return this._x1},set:function(e){this._x1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"y1",{get:function(){return this._y1},set:function(e){this._y1=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoQuadraticRel=function(e,t,r,n,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL,"q",e);this._x=t;this._y=r;this._x1=n;this._y1=i};SVGPathSegCurvetoQuadraticRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoQuadraticRel.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticRel]"};SVGPathSegCurvetoQuadraticRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y};SVGPathSegCurvetoQuadraticRel.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticRel(void 0,this._x,this._y,this._x1,this._y1)};Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"x1",{get:function(){return this._x1},set:function(e){this._x1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"y1",{get:function(){return this._y1},set:function(e){this._y1=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegArcAbs=function(e,t,r,n,i,a,o,s){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_ARC_ABS,"A",e);this._x=t;this._y=r;this._r1=n;this._r2=i;this._angle=a;this._largeArcFlag=o;this._sweepFlag=s};SVGPathSegArcAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegArcAbs.prototype.toString=function(){return"[object SVGPathSegArcAbs]"};SVGPathSegArcAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y};SVGPathSegArcAbs.prototype.clone=function(){return new SVGPathSegArcAbs(void 0,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)};Object.defineProperty(SVGPathSegArcAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcAbs.prototype,"r1",{get:function(){return this._r1},set:function(e){this._r1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcAbs.prototype,"r2",{get:function(){return this._r2},set:function(e){this._r2=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcAbs.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcAbs.prototype,"largeArcFlag",{get:function(){return this._largeArcFlag},set:function(e){this._largeArcFlag=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcAbs.prototype,"sweepFlag",{get:function(){return this._sweepFlag},set:function(e){this._sweepFlag=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegArcRel=function(e,t,r,n,i,a,o,s){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_ARC_REL,"a",e);this._x=t;this._y=r;this._r1=n;this._r2=i;this._angle=a;this._largeArcFlag=o;this._sweepFlag=s};SVGPathSegArcRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegArcRel.prototype.toString=function(){return"[object SVGPathSegArcRel]"};SVGPathSegArcRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y};SVGPathSegArcRel.prototype.clone=function(){return new SVGPathSegArcRel(void 0,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)};Object.defineProperty(SVGPathSegArcRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcRel.prototype,"r1",{get:function(){return this._r1},set:function(e){this._r1=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcRel.prototype,"r2",{get:function(){return this._r2},set:function(e){this._r2=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcRel.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegArcRel.prototype,"largeArcFlag",{get:function(){return this._largeArcFlag},set:function(e){this._largeArcFlag=e;this._segmentChanged()},enumerable:!0})
;Object.defineProperty(SVGPathSegArcRel.prototype,"sweepFlag",{get:function(){return this._sweepFlag},set:function(e){this._sweepFlag=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegLinetoHorizontalAbs=function(e,t){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS,"H",e);this._x=t};SVGPathSegLinetoHorizontalAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoHorizontalAbs.prototype.toString=function(){return"[object SVGPathSegLinetoHorizontalAbs]"};SVGPathSegLinetoHorizontalAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x};SVGPathSegLinetoHorizontalAbs.prototype.clone=function(){return new SVGPathSegLinetoHorizontalAbs(void 0,this._x)};Object.defineProperty(SVGPathSegLinetoHorizontalAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegLinetoHorizontalRel=function(e,t){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL,"h",e);this._x=t};SVGPathSegLinetoHorizontalRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoHorizontalRel.prototype.toString=function(){return"[object SVGPathSegLinetoHorizontalRel]"};SVGPathSegLinetoHorizontalRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x};SVGPathSegLinetoHorizontalRel.prototype.clone=function(){return new SVGPathSegLinetoHorizontalRel(void 0,this._x)};Object.defineProperty(SVGPathSegLinetoHorizontalRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegLinetoVerticalAbs=function(e,t){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS,"V",e);this._y=t};SVGPathSegLinetoVerticalAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoVerticalAbs.prototype.toString=function(){return"[object SVGPathSegLinetoVerticalAbs]"};SVGPathSegLinetoVerticalAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._y};SVGPathSegLinetoVerticalAbs.prototype.clone=function(){return new SVGPathSegLinetoVerticalAbs(void 0,this._y)};Object.defineProperty(SVGPathSegLinetoVerticalAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegLinetoVerticalRel=function(e,t){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL,"v",e);this._y=t};SVGPathSegLinetoVerticalRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoVerticalRel.prototype.toString=function(){return"[object SVGPathSegLinetoVerticalRel]"};SVGPathSegLinetoVerticalRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._y};SVGPathSegLinetoVerticalRel.prototype.clone=function(){return new SVGPathSegLinetoVerticalRel(void 0,this._y)};Object.defineProperty(SVGPathSegLinetoVerticalRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoCubicSmoothAbs=function(e,t,r,n,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS,"S",e);this._x=t;this._y=r;this._x2=n;this._y2=i};SVGPathSegCurvetoCubicSmoothAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoCubicSmoothAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicSmoothAbs]"};SVGPathSegCurvetoCubicSmoothAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y};SVGPathSegCurvetoCubicSmoothAbs.prototype.clone=function(){return new SVGPathSegCurvetoCubicSmoothAbs(void 0,this._x,this._y,this._x2,this._y2)};Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"x2",{get:function(){return this._x2},set:function(e){this._x2=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"y2",{get:function(){return this._y2},set:function(e){this._y2=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoCubicSmoothRel=function(e,t,r,n,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL,"s",e);this._x=t;this._y=r;this._x2=n;this._y2=i};SVGPathSegCurvetoCubicSmoothRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoCubicSmoothRel.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicSmoothRel]"};SVGPathSegCurvetoCubicSmoothRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y};SVGPathSegCurvetoCubicSmoothRel.prototype.clone=function(){return new SVGPathSegCurvetoCubicSmoothRel(void 0,this._x,this._y,this._x2,this._y2)};Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"x2",{get:function(){return this._x2},set:function(e){this._x2=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"y2",{get:function(){return this._y2},set:function(e){this._y2=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoQuadraticSmoothAbs=function(e,t,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS,"T",e);this._x=t;this._y=r};SVGPathSegCurvetoQuadraticSmoothAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoQuadraticSmoothAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticSmoothAbs]"};SVGPathSegCurvetoQuadraticSmoothAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegCurvetoQuadraticSmoothAbs.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticSmoothAbs(void 0,this._x,this._y)};Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});e.SVGPathSegCurvetoQuadraticSmoothRel=function(e,t,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL,"t",e);this._x=t;this._y=r};SVGPathSegCurvetoQuadraticSmoothRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoQuadraticSmoothRel.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticSmoothRel]"};SVGPathSegCurvetoQuadraticSmoothRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegCurvetoQuadraticSmoothRel.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticSmoothRel(void 0,this._x,this._y)};Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e;this._segmentChanged()},enumerable:!0});Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e;this._segmentChanged()},enumerable:!0});SVGPathElement.prototype.createSVGPathSegClosePath=function(){return new SVGPathSegClosePath(void 0)};SVGPathElement.prototype.createSVGPathSegMovetoAbs=function(e,t){return new SVGPathSegMovetoAbs(void 0,e,t)};SVGPathElement.prototype.createSVGPathSegMovetoRel=function(e,t){return new SVGPathSegMovetoRel(void 0,e,t)};SVGPathElement.prototype.createSVGPathSegLinetoAbs=function(e,t){return new SVGPathSegLinetoAbs(void 0,e,t)};SVGPathElement.prototype.createSVGPathSegLinetoRel=function(e,t){return new SVGPathSegLinetoRel(void 0,e,t)};SVGPathElement.prototype.createSVGPathSegCurvetoCubicAbs=function(e,t,r,n,i,a){return new SVGPathSegCurvetoCubicAbs(void 0,e,t,r,n,i,a)};SVGPathElement.prototype.createSVGPathSegCurvetoCubicRel=function(e,t,r,n,i,a){return new SVGPathSegCurvetoCubicRel(void 0,e,t,r,n,i,a)};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticAbs=function(e,t,r,n){return new SVGPathSegCurvetoQuadraticAbs(void 0,e,t,r,n)};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticRel=function(e,t,r,n){return new SVGPathSegCurvetoQuadraticRel(void 0,e,t,r,n)};SVGPathElement.prototype.createSVGPathSegArcAbs=function(e,t,r,n,i,a,o){return new SVGPathSegArcAbs(void 0,e,t,r,n,i,a,o)};SVGPathElement.prototype.createSVGPathSegArcRel=function(e,t,r,n,i,a,o){return new SVGPathSegArcRel(void 0,e,t,r,n,i,a,o)};SVGPathElement.prototype.createSVGPathSegLinetoHorizontalAbs=function(e){return new SVGPathSegLinetoHorizontalAbs(void 0,e)};SVGPathElement.prototype.createSVGPathSegLinetoHorizontalRel=function(e){return new SVGPathSegLinetoHorizontalRel(void 0,e)};SVGPathElement.prototype.createSVGPathSegLinetoVerticalAbs=function(e){return new SVGPathSegLinetoVerticalAbs(void 0,e)};SVGPathElement.prototype.createSVGPathSegLinetoVerticalRel=function(e){return new SVGPathSegLinetoVerticalRel(void 0,e)};SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothAbs=function(e,t,r,n){return new SVGPathSegCurvetoCubicSmoothAbs(void 0,e,t,r,n)};SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothRel=function(e,t,r,n){return new SVGPathSegCurvetoCubicSmoothRel(void 0,e,t,r,n)};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothAbs=function(e,t){return new SVGPathSegCurvetoQuadraticSmoothAbs(void 0,e,t)};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothRel=function(e,t){return new SVGPathSegCurvetoQuadraticSmoothRel(void 0,e,t)};"getPathSegAtLength"in SVGPathElement.prototype||(SVGPathElement.prototype.getPathSegAtLength=function(e){if(void 0===e||!isFinite(e))throw"Invalid arguments.";var r=t.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d",this.getAttribute("d"));var n=r.pathSegList.numberOfItems-1;if(n<=0)return 0;do{r.pathSegList.removeItem(n);if(e>r.getTotalLength())break;n--}while(n>0);return n})}if(!("SVGPathSegList"in e&&"appendItem"in e.SVGPathSegList.prototype)){e.SVGPathSegList=function(e){this._pathElement=e;this._list=this._parsePath(this._pathElement.getAttribute("d"));this._mutationObserverConfig={attributes:!0,attributeFilter:["d"]};this._pathElementMutationObserver=new MutationObserver(this._updateListFromPathMutations.bind(this));this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)};SVGPathSegList.prototype.classname="SVGPathSegList";Object.defineProperty(SVGPathSegList.prototype,"numberOfItems",{get:function(){this._checkPathSynchronizedToList();return this._list.length},enumerable:!0});Object.defineProperty(SVGPathElement.prototype,"pathSegList",{get:function(){this._pathSegList||(this._pathSegList=new SVGPathSegList(this));return this._pathSegList},enumerable:!0});Object.defineProperty(SVGPathElement.prototype,"normalizedPathSegList",{get:function(){return this.pathSegList},enumerable:!0});Object.defineProperty(SVGPathElement.prototype,"animatedPathSegList",{get:function(){return this.pathSegList},enumerable:!0});Object.defineProperty(SVGPathElement.prototype,"animatedNormalizedPathSegList",{get:function(){return this.pathSegList},enumerable:!0});SVGPathSegList.prototype._checkPathSynchronizedToList=function(){this._updateListFromPathMutations(this._pathElementMutationObserver.takeRecords())};SVGPathSegList.prototype._updateListFromPathMutations=function(e){if(this._pathElement){var t=!1;e.forEach(function(e){"d"==e.attributeName&&(t=!0)});t&&(this._list=this._parsePath(this._pathElement.getAttribute("d")))}};SVGPathSegList.prototype._writeListToPath=function(){this._pathElementMutationObserver.disconnect();this._pathElement.setAttribute("d",SVGPathSegList._pathSegArrayAsString(this._list));this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)};SVGPathSegList.prototype.segmentChanged=function(e){this._writeListToPath()};SVGPathSegList.prototype.clear=function(){this._checkPathSynchronizedToList();this._list.forEach(function(e){e._owningPathSegList=null});this._list=[];this._writeListToPath()};SVGPathSegList.prototype.initialize=function(e){this._checkPathSynchronizedToList();this._list=[e];e._owningPathSegList=this;this._writeListToPath();return e};SVGPathSegList.prototype._checkValidIndex=function(e){if(isNaN(e)||e<0||e>=this.numberOfItems)throw"INDEX_SIZE_ERR"};SVGPathSegList.prototype.getItem=function(e){this._checkPathSynchronizedToList();this._checkValidIndex(e);return this._list[e]};SVGPathSegList.prototype.insertItemBefore=function(e,t){this._checkPathSynchronizedToList();t>this.numberOfItems&&(t=this.numberOfItems);e._owningPathSegList&&(e=e.clone());this._list.splice(t,0,e);e._owningPathSegList=this;this._writeListToPath();return e};SVGPathSegList.prototype.replaceItem=function(e,t){this._checkPathSynchronizedToList();e._owningPathSegList&&(e=e.clone());this._checkValidIndex(t);this._list[t]=e;e._owningPathSegList=this;this._writeListToPath();return e};SVGPathSegList.prototype.removeItem=function(e){this._checkPathSynchronizedToList();this._checkValidIndex(e);var t=this._list[e];this._list.splice(e,1);this._writeListToPath();return t};SVGPathSegList.prototype.appendItem=function(e){this._checkPathSynchronizedToList();e._owningPathSegList&&(e=e.clone());this._list.push(e);e._owningPathSegList=this;this._writeListToPath();return e};SVGPathSegList._pathSegArrayAsString=function(e){var t="",r=!0;e.forEach(function(e){if(r){r=!1;t+=e._asPathString()}else t+=" "+e._asPathString()});return t};SVGPathSegList.prototype._parsePath=function(e){if(!e||0==e.length)return[];var t=this,r=function(){this.pathSegList=[]};r.prototype.appendSegment=function(e){this.pathSegList.push(e)};var n=function(e){this._string=e;this._currentIndex=0;this._endIndex=this._string.length;this._previousCommand=SVGPathSeg.PATHSEG_UNKNOWN;this._skipOptionalSpaces()};n.prototype._isCurrentSpace=function(){var e=this._string[this._currentIndex];return e<=" "&&(" "==e||"\n"==e||"\t"==e||"\r"==e||"\f"==e)};n.prototype._skipOptionalSpaces=function(){for(;this._currentIndex<this._endIndex&&this._isCurrentSpace();)this._currentIndex++;return this._currentIndex<this._endIndex};n.prototype._skipOptionalSpacesOrDelimiter=function(){if(this._currentIndex<this._endIndex&&!this._isCurrentSpace()&&","!=this._string.charAt(this._currentIndex))return!1;if(this._skipOptionalSpaces()&&this._currentIndex<this._endIndex&&","==this._string.charAt(this._currentIndex)){this._currentIndex++;this._skipOptionalSpaces()}return this._currentIndex<this._endIndex};n.prototype.hasMoreData=function(){return this._currentIndex<this._endIndex};n.prototype.peekSegmentType=function(){var e=this._string[this._currentIndex];return this._pathSegTypeFromChar(e)};n.prototype._pathSegTypeFromChar=function(e){switch(e){case"Z":case"z":return SVGPathSeg.PATHSEG_CLOSEPATH;case"M":return SVGPathSeg.PATHSEG_MOVETO_ABS;case"m":return SVGPathSeg.PATHSEG_MOVETO_REL;case"L":return SVGPathSeg.PATHSEG_LINETO_ABS;case"l":return SVGPathSeg.PATHSEG_LINETO_REL;case"C":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS;case"c":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL;case"Q":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS;case"q":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL;case"A":return SVGPathSeg.PATHSEG_ARC_ABS;case"a":return SVGPathSeg.PATHSEG_ARC_REL;case"H":return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS;case"h":return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL;case"V":return SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS;case"v":return SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL;case"S":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS;case"s":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL;case"T":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS;case"t":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL;default:return SVGPathSeg.PATHSEG_UNKNOWN}};n.prototype._nextCommandHelper=function(e,t){return("+"==e||"-"==e||"."==e||e>="0"&&e<="9")&&t!=SVGPathSeg.PATHSEG_CLOSEPATH?t==SVGPathSeg.PATHSEG_MOVETO_ABS?SVGPathSeg.PATHSEG_LINETO_ABS:t==SVGPathSeg.PATHSEG_MOVETO_REL?SVGPathSeg.PATHSEG_LINETO_REL:t:SVGPathSeg.PATHSEG_UNKNOWN};n.prototype.initialCommandIsMoveTo=function(){if(!this.hasMoreData())return!0;var e=this.peekSegmentType();return e==SVGPathSeg.PATHSEG_MOVETO_ABS||e==SVGPathSeg.PATHSEG_MOVETO_REL};n.prototype._parseNumber=function(){var e=0,t=0,r=1,n=0,i=1,a=1,o=this._currentIndex;this._skipOptionalSpaces();if(this._currentIndex<this._endIndex&&"+"==this._string.charAt(this._currentIndex))this._currentIndex++;else if(this._currentIndex<this._endIndex&&"-"==this._string.charAt(this._currentIndex)){this._currentIndex++;i=-1}if(!(this._currentIndex==this._endIndex||(this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")&&"."!=this._string.charAt(this._currentIndex))){for(var s=this._currentIndex;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";)this._currentIndex++;if(this._currentIndex!=s)for(var l=this._currentIndex-1,c=1;l>=s;){t+=c*(this._string.charAt(l--)-"0");c*=10}if(this._currentIndex<this._endIndex&&"."==this._string.charAt(this._currentIndex)){this._currentIndex++;if(this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")return;for(;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";){r*=10;n+=(this._string.charAt(this._currentIndex)-"0")/r;this._currentIndex+=1}}if(this._currentIndex!=o&&this._currentIndex+1<this._endIndex&&("e"==this._string.charAt(this._currentIndex)||"E"==this._string.charAt(this._currentIndex))&&"x"!=this._string.charAt(this._currentIndex+1)&&"m"!=this._string.charAt(this._currentIndex+1)){this._currentIndex++;if("+"==this._string.charAt(this._currentIndex))this._currentIndex++;else if("-"==this._string.charAt(this._currentIndex)){this._currentIndex++;a=-1}if(this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")return;for(;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";){e*=10;e+=this._string.charAt(this._currentIndex)-"0";this._currentIndex++}}var d=t+n;d*=i;e&&(d*=Math.pow(10,a*e));if(o!=this._currentIndex){this._skipOptionalSpacesOrDelimiter();return d}}};n.prototype._parseArcFlag=function(){if(!(this._currentIndex>=this._endIndex)){var e=!1,t=this._string.charAt(this._currentIndex++);if("0"==t)e=!1;else{if("1"!=t)return;e=!0}this._skipOptionalSpacesOrDelimiter();return e}};n.prototype.parseSegment=function(){var e=this._string[this._currentIndex],r=this._pathSegTypeFromChar(e);if(r==SVGPathSeg.PATHSEG_UNKNOWN){if(this._previousCommand==SVGPathSeg.PATHSEG_UNKNOWN)return null;r=this._nextCommandHelper(e,this._previousCommand);if(r==SVGPathSeg.PATHSEG_UNKNOWN)return null}else this._currentIndex++;this._previousCommand=r;switch(r){case SVGPathSeg.PATHSEG_MOVETO_REL:return new SVGPathSegMovetoRel(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_MOVETO_ABS:return new SVGPathSegMovetoAbs(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_REL:return new SVGPathSegLinetoRel(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_ABS:return new SVGPathSegLinetoAbs(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:return new SVGPathSegLinetoHorizontalRel(t,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:return new SVGPathSegLinetoHorizontalAbs(t,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:return new SVGPathSegLinetoVerticalRel(t,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:return new SVGPathSegLinetoVerticalAbs(t,this._parseNumber());case SVGPathSeg.PATHSEG_CLOSEPATH:this._skipOptionalSpaces();return new SVGPathSegClosePath(t);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL:var n={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicRel(t,n.x,n.y,n.x1,n.y1,n.x2,n.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:var n={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicAbs(t,n.x,n.y,n.x1,n.y1,n.x2,n.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL:var n={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicSmoothRel(t,n.x,n.y,n.x2,n.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:var n={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicSmoothAbs(t,n.x,n.y,n.x2,n.y2);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL:var n={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoQuadraticRel(t,n.x,n.y,n.x1,n.y1);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:var n={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoQuadraticAbs(t,n.x,n.y,n.x1,n.y1);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:return new SVGPathSegCurvetoQuadraticSmoothRel(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:return new SVGPathSegCurvetoQuadraticSmoothAbs(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_ARC_REL:var n={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegArcRel(t,n.x,n.y,n.x1,n.y1,n.arcAngle,n.arcLarge,n.arcSweep);case SVGPathSeg.PATHSEG_ARC_ABS:var n={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegArcAbs(t,n.x,n.y,n.x1,n.y1,n.arcAngle,n.arcLarge,n.arcSweep);default:throw"Unknown path seg type."}};var i=new r,a=new n(e);if(!a.initialCommandIsMoveTo())return[];for(;a.hasMoreData();){var o=a.parseSegment();if(!o)return[];i.appendSegment(o)}return i.pathSegList}}}();SVGPathElement.prototype.getPathData&&SVGPathElement.prototype.setPathData||function(){var t={Z:"Z",M:"M",L:"L",C:"C",Q:"Q",A:"A",H:"H",V:"V",S:"S",T:"T",z:"Z",m:"m",l:"l",c:"c",q:"q",a:"a",h:"h",v:"v",s:"s",t:"t"},r=function(e){this._string=e;this._currentIndex=0;this._endIndex=this._string.length;this._prevCommand=null;this._skipOptionalSpaces()},n=-1!==e.navigator.userAgent.indexOf("MSIE ");r.prototype={parseSegment:function(){var e=this._string[this._currentIndex],r=t[e]?t[e]:null;if(null===r){if(null===this._prevCommand)return null;r=("+"===e||"-"===e||"."===e||e>="0"&&e<="9")&&"Z"!==this._prevCommand?"M"===this._prevCommand?"L":"m"===this._prevCommand?"l":this._prevCommand:null;if(null===r)return null}else this._currentIndex+=1;this._prevCommand=r;var n=null,i=r.toUpperCase();if("H"===i||"V"===i)n=[this._parseNumber()];else if("M"===i||"L"===i||"T"===i)n=[this._parseNumber(),this._parseNumber()];else if("S"===i||"Q"===i)n=[this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber()];else if("C"===i)n=[this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber()];else if("A"===i)n=[this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseArcFlag(),this._parseArcFlag(),this._parseNumber(),this._parseNumber()];else if("Z"===i){this._skipOptionalSpaces();n=[]}return null===n||n.indexOf(null)>=0?null:{type:r,values:n}},hasMoreData:function(){return this._currentIndex<this._endIndex},peekSegmentType:function(){var e=this._string[this._currentIndex];return t[e]?t[e]:null},initialCommandIsMoveTo:function(){if(!this.hasMoreData())return!0;var e=this.peekSegmentType();return"M"===e||"m"===e},_isCurrentSpace:function(){var e=this._string[this._currentIndex];return e<=" "&&(" "===e||"\n"===e||"\t"===e||"\r"===e||"\f"===e)},_skipOptionalSpaces:function(){for(;this._currentIndex<this._endIndex&&this._isCurrentSpace();)this._currentIndex+=1;return this._currentIndex<this._endIndex},_skipOptionalSpacesOrDelimiter:function(){if(this._currentIndex<this._endIndex&&!this._isCurrentSpace()&&","!==this._string[this._currentIndex])return!1;if(this._skipOptionalSpaces()&&this._currentIndex<this._endIndex&&","===this._string[this._currentIndex]){this._currentIndex+=1;this._skipOptionalSpaces()}return this._currentIndex<this._endIndex},_parseNumber:function(){var e=0,t=0,r=1,n=0,i=1,a=1,o=this._currentIndex;this._skipOptionalSpaces();if(this._currentIndex<this._endIndex&&"+"===this._string[this._currentIndex])this._currentIndex+=1;else if(this._currentIndex<this._endIndex&&"-"===this._string[this._currentIndex]){this._currentIndex+=1;i=-1}if(this._currentIndex===this._endIndex||(this._string[this._currentIndex]<"0"||this._string[this._currentIndex]>"9")&&"."!==this._string[this._currentIndex])return null;for(var s=this._currentIndex;this._currentIndex<this._endIndex&&this._string[this._currentIndex]>="0"&&this._string[this._currentIndex]<="9";)this._currentIndex+=1;if(this._currentIndex!==s)for(var l=this._currentIndex-1,c=1;l>=s;){t+=c*(this._string[l]-"0");l-=1;c*=10}if(this._currentIndex<this._endIndex&&"."===this._string[this._currentIndex]){this._currentIndex+=1;if(this._currentIndex>=this._endIndex||this._string[this._currentIndex]<"0"||this._string[this._currentIndex]>"9")return null;for(;this._currentIndex<this._endIndex&&this._string[this._currentIndex]>="0"&&this._string[this._currentIndex]<="9";){n+=(this._string[this._currentIndex]-"0")*(r*=.1);this._currentIndex+=1}}if(this._currentIndex!==o&&this._currentIndex+1<this._endIndex&&("e"===this._string[this._currentIndex]||"E"===this._string[this._currentIndex])&&"x"!==this._string[this._currentIndex+1]&&"m"!==this._string[this._currentIndex+1]){this._currentIndex+=1;if("+"===this._string[this._currentIndex])this._currentIndex+=1;else if("-"===this._string[this._currentIndex]){this._currentIndex+=1;a=-1}if(this._currentIndex>=this._endIndex||this._string[this._currentIndex]<"0"||this._string[this._currentIndex]>"9")return null;for(;this._currentIndex<this._endIndex&&this._string[this._currentIndex]>="0"&&this._string[this._currentIndex]<="9";){e*=10;e+=this._string[this._currentIndex]-"0";this._currentIndex+=1}}var d=t+n;d*=i;e&&(d*=Math.pow(10,a*e));if(o===this._currentIndex)return null;this._skipOptionalSpacesOrDelimiter();return d},_parseArcFlag:function(){if(this._currentIndex>=this._endIndex)return null;var e=0,t=this._string[this._currentIndex];this._currentIndex+=1;if("0"===t)e=0;else{if("1"!==t)return null;e=1}this._skipOptionalSpacesOrDelimiter();return e}};var i=function(e){if(!e||0===e.length)return[];var t=new r(e),n=[];if(t.initialCommandIsMoveTo())for(;t.hasMoreData();){var i=t.parseSegment();if(null===i)break;n.push(i)}return n},a=function(e,t,r,n,i,o,s,l,c,d){var h,u,p,f,g=function(e,t,r){return{x:e*Math.cos(r)-t*Math.sin(r),y:e*Math.sin(r)+t*Math.cos(r)}},y=function(e){return Math.PI*e/180}(s),v=[];if(d){h=d[0];u=d[1];p=d[2];f=d[3]}else{var m=g(e,t,-y);e=m.x;t=m.y;var x=g(r,n,-y);r=x.x;n=x.y;var _=(e-r)/2,P=(t-n)/2,S=_*_/(i*i)+P*P/(o*o);if(S>1){S=Math.sqrt(S);i*=S;o*=S}var b;b=l===c?-1:1;var C=i*i,A=o*o,I=C*A-C*P*P-A*_*_,L=C*P*P+A*_*_,E=b*Math.sqrt(Math.abs(I/L));p=E*i*P/o+(e+r)/2;f=E*-o*_/i+(t+n)/2;h=Math.asin(((t-f)/o).toFixed(9));u=Math.asin(((n-f)/o).toFixed(9));e<p&&(h=Math.PI-h);r<p&&(u=Math.PI-u);h<0&&(h=2*Math.PI+h);u<0&&(u=2*Math.PI+u);c&&h>u&&(h-=2*Math.PI);!c&&u>h&&(u-=2*Math.PI)}var O=u-h;if(Math.abs(O)>120*Math.PI/180){var T=u,w=r,R=n;u=c&&u>h?h+120*Math.PI/180*1:h+120*Math.PI/180*-1;r=p+i*Math.cos(u);n=f+o*Math.sin(u);v=a(r,n,w,R,i,o,s,0,c,[u,T,p,f])}O=u-h;var N=Math.cos(h),k=Math.sin(h),B=Math.cos(u),M=Math.sin(u),V=Math.tan(O/4),G=4/3*i*V,F=4/3*o*V,D=[e,t],H=[e+G*k,t-F*N],j=[r+G*M,n-F*B],U=[r,n];H[0]=2*D[0]-H[0];H[1]=2*D[1]-H[1];if(d)return[H,j,U].concat(v);v=[H,j,U].concat(v).join().split(",");var Y=[],z=[];v.forEach(function(e,t){t%2?z.push(g(v[t-1],v[t],y).y):z.push(g(v[t],v[t+1],y).x);if(6===z.length){Y.push(z);z=[]}});return Y},o=function(e){var t=[],r=null,n=null,i=null,a=null;e.forEach(function(e){var o=e.type;if("M"===o){var s=e.values[0],l=e.values[1];t.push({type:"M",values:[s,l]});i=s;a=l;r=s;n=l}else if("m"===o){var s=r+e.values[0],l=n+e.values[1];t.push({type:"M",values:[s,l]});i=s;a=l;r=s;n=l}else if("L"===o){var s=e.values[0],l=e.values[1];t.push({type:"L",values:[s,l]});r=s;n=l}else if("l"===o){var s=r+e.values[0],l=n+e.values[1];t.push({type:"L",values:[s,l]});r=s;n=l}else if("C"===o){var c=e.values[0],d=e.values[1],h=e.values[2],u=e.values[3],s=e.values[4],l=e.values[5];t.push({type:"C",values:[c,d,h,u,s,l]});r=s;n=l}else if("c"===o){var c=r+e.values[0],d=n+e.values[1],h=r+e.values[2],u=n+e.values[3],s=r+e.values[4],l=n+e.values[5];t.push({type:"C",values:[c,d,h,u,s,l]});r=s;n=l}else if("Q"===o){var c=e.values[0],d=e.values[1],s=e.values[2],l=e.values[3];t.push({type:"Q",values:[c,d,s,l]});r=s;n=l}else if("q"===o){var c=r+e.values[0],d=n+e.values[1],s=r+e.values[2],l=n+e.values[3];t.push({type:"Q",values:[c,d,s,l]});r=s;n=l}else if("A"===o){var s=e.values[5],l=e.values[6];t.push({type:"A",values:[e.values[0],e.values[1],e.values[2],e.values[3],e.values[4],s,l]});r=s;n=l}else if("a"===o){var s=r+e.values[5],l=n+e.values[6];t.push({type:"A",values:[e.values[0],e.values[1],e.values[2],e.values[3],e.values[4],s,l]});r=s;n=l}else if("H"===o){var s=e.values[0];t.push({type:"H",values:[s]});r=s}else if("h"===o){var s=r+e.values[0];t.push({type:"H",values:[s]});r=s}else if("V"===o){var l=e.values[0];t.push({type:"V",values:[l]});n=l}else if("v"===o){var l=n+e.values[0];t.push({type:"V",values:[l]});n=l}else if("S"===o){var h=e.values[0],u=e.values[1],s=e.values[2],l=e.values[3];t.push({type:"S",values:[h,u,s,l]});r=s;n=l}else if("s"===o){var h=r+e.values[0],u=n+e.values[1],s=r+e.values[2],l=n+e.values[3];t.push({type:"S",values:[h,u,s,l]});r=s;n=l}else if("T"===o){var s=e.values[0],l=e.values[1];t.push({type:"T",values:[s,l]});r=s;n=l}else if("t"===o){var s=r+e.values[0],l=n+e.values[1];t.push({type:"T",values:[s,l]});r=s;n=l}else if("Z"===o||"z"===o){t.push({type:"Z",values:[]});r=i;n=a}});return t},s=function(e){var t=[],r=null,n=null,i=null,o=null,s=null,l=null,c=null;e.forEach(function(e){if("M"===e.type){var d=e.values[0],h=e.values[1];t.push({type:"M",values:[d,h]});l=d;c=h;o=d;s=h}else if("C"===e.type){var u=e.values[0],p=e.values[1],f=e.values[2],g=e.values[3],d=e.values[4],h=e.values[5];t.push({type:"C",values:[u,p,f,g,d,h]});n=f;i=g;o=d;s=h}else if("L"===e.type){var d=e.values[0],h=e.values[1];t.push({type:"L",values:[d,h]});o=d;s=h}else if("H"===e.type){var d=e.values[0];t.push({type:"L",values:[d,s]});o=d}else if("V"===e.type){var h=e.values[0];t.push({type:"L",values:[o,h]});s=h}else if("S"===e.type){var y,v,f=e.values[0],g=e.values[1],d=e.values[2],h=e.values[3];if("C"===r||"S"===r){y=o+(o-n);v=s+(s-i)}else{y=o;v=s}t.push({type:"C",values:[y,v,f,g,d,h]});n=f;i=g;o=d;s=h}else if("T"===e.type){var u,p,d=e.values[0],h=e.values[1];if("Q"===r||"T"===r){u=o+(o-n);p=s+(s-i)}else{u=o;p=s}var y=o+2*(u-o)/3,v=s+2*(p-s)/3,m=d+2*(u-d)/3,x=h+2*(p-h)/3;t.push({type:"C",values:[y,v,m,x,d,h]});n=u;i=p;o=d;s=h}else if("Q"===e.type){
var u=e.values[0],p=e.values[1],d=e.values[2],h=e.values[3],y=o+2*(u-o)/3,v=s+2*(p-s)/3,m=d+2*(u-d)/3,x=h+2*(p-h)/3;t.push({type:"C",values:[y,v,m,x,d,h]});n=u;i=p;o=d;s=h}else if("A"===e.type){var _=e.values[0],P=e.values[1],S=e.values[2],b=e.values[3],C=e.values[4],d=e.values[5],h=e.values[6];if(0===_||0===P){t.push({type:"C",values:[o,s,d,h,d,h]});o=d;s=h}else if(o!==d||s!==h){var A=a(o,s,d,h,_,P,S,b,C);A.forEach(function(e){t.push({type:"C",values:e});o=d;s=h})}}else if("Z"===e.type){t.push(e);o=l;s=c}r=e.type});return t};SVGPathElement.prototype.getPathData=function(e){if(e&&e.normalize){var t;t=i(this.getAttribute("d")||"");return s(o(t))}var t=i(this.getAttribute("d")||"");return t};SVGPathElement.prototype.setPathData=function(e){if(0===e.length)n?this.setAttribute("d",""):this.removeAttribute("d");else{for(var t="",r=0,i=e.length;r<i;r+=1){var a=e[r];r>0&&(t+=" ");t+=a.type;a.values&&(t+=" "+a.values.join(" "))}this.setAttribute("d",t)}}}();!function(){function e(e){this.message=e}var t="undefined"!=typeof exports?exports:this,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.prototype=new Error;e.prototype.name="InvalidCharacterError";t.btoa||(t.btoa=function(t){for(var n,i,a=String(t),o=0,s=r,l="";a.charAt(0|o)||(s="=",o%1);l+=s.charAt(63&n>>8-o%1*8)){i=a.charCodeAt(o+=.75);if(i>255)throw new e("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");n=n<<8|i}return l});t.atob||(t.atob=function(t){var n=String(t).replace(/=+$/,"");if(n.length%4==1)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var i,a,o=0,s=0,l="";a=n.charAt(s++);~a&&(i=o%4?64*i+a:a,o++%4)?l+=String.fromCharCode(255&i>>(-2*o&6)):0)a=r.indexOf(a);return l})}();!function(e){var t=["concat","every","filter","forEach","includes","indexOf","lastIndexOf","map","pop","push","reduce","reduceRight","reverse","shift","slice","some","sort","splice","unshift"],r={};Array.prototype.toArray||(Array.prototype.toArray=function(){return this.slice()});for(var n=0;n<e.length;n++){e[n].toArray||(e[n].toArray=function(){return Array.prototype.slice.call(this)});for(var i=0;i<t.length;i++){var a=t[i];e[n][a]||(e[n][a]=function(e){return r[e]||(r[e]=function(){var t=this.toArray();return t[e].apply(t,arguments)})}(a))}}}([HTMLCollection.prototype,NodeList.prototype]);e.SVGElement&&!SVGElement.prototype.getTransformToElement&&(SVGElement.prototype.getTransformToElement=function(e){return e.getScreenCTM().inverse().multiply(this.getScreenCTM())});e.SVGElement&&!SVGElement.prototype.contains&&(SVGElement.prototype.contains=function(e){return(20&this.compareDocumentPosition(e))>0});!e.SVGElement||"children"in SVGElement.prototype||Object.defineProperty(SVGElement.prototype,"children",{get:function(){for(var e=this.childNodes,t=e.length,r=[],n=0;n<t;n++)1===e[n].nodeType&&r.push(e[n]);return r}});!e.SVGElement||"outerHTML"in SVGElement.prototype||Object.defineProperty(SVGElement.prototype,"outerHTML",{get:function(){var e=this,t=(new XMLSerializer).serializeToString(e);"svg"!=e.tagName&&(t=t.replace(/ xmlns="http:\/\/www\.w3\.org\/2000\/svg"/g,""));return t}});!e.SVGSVGElement||"checkEnclosure"in SVGSVGElement.prototype||Object.defineProperties(SVGSVGElement.prototype,{getIntersectionList:{get:function(e,t){return[]}},getEnclosureList:{get:function(e,t){return[]}},checkIntersection:{get:function(e,t){return!1}},checkEnclosure:{get:function(e,t){return!1}}});!function(){function t(e,t){return e.hasOwnProperty(t)}var r="object"==typeof localStorage;if(r)try{var n="_"+Math.random();localStorage.setItem(n,"_");localStorage.removeItem(n)}catch(e){r=!1}if(!r){var i={},a={getItem:function(e){return t(i,e)?i[e]:null},setItem:function(e,t){i[e]=String(t)},removeItem:function(e){t(i,e)&&delete i[e]},clear:function(){for(var e in i)t(i,e)&&delete i[e]}};if("object"!=typeof localStorage)e.localStorage=a;else for(var o in a)t(a,o)&&(localStorage[o]=a[o])}}();String.prototype.codePointAt||function(){"use strict";var e=function(e){if(null===this)throw TypeError();var t=String(this),r=t.length,n=e?Number(e):0;n!=n&&(n=0);if(!(n<0||n>=r)){var i,a=t.charCodeAt(n);if(a>=55296&&a<=56319&&r>n+1){i=t.charCodeAt(n+1);if(i>=56320&&i<=57343)return 1024*(a-55296)+i-56320+65536}return a}};Object.defineProperty?Object.defineProperty(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();String.fromCodePoint||function(){var e=function(){try{var e={},t=Object.defineProperty,r=t(e,e,e)&&t}catch(e){}return r}(),t=String.fromCharCode,r=Math.floor,n=function(){var e,n,i=[],a=-1,o=arguments.length;if(!o)return"";for(var s="";++a<o;){var l=Number(arguments[a]);if(!isFinite(l)||l<0||l>1114111||r(l)!=l)throw RangeError("Invalid code point: "+l);if(l<=65535)i.push(l);else{l-=65536;e=55296+(l>>10);n=l%1024+56320;i.push(e,n)}if(a+1==o||i.length>16384){s+=t.apply(null,i);i.length=0}}return s};e?e(String,"fromCodePoint",{value:n,configurable:!0,writable:!0}):String.fromCodePoint=n}();n.prototype={constructor:n,Point:function(e,t){this.x=e;this.y=t},_findPolarAngle:function(e,t){var r,n;if(!e||!t)return 0;r=t.x-e.x;n=t.y-e.y;if(0==r&&0==n)return 0;var i=57.295779513082*Math.atan2(n,r);this.reverse?i<=0&&(i+=360):i>=0&&(i+=360);return i},addPoint:function(e,t){if(void 0===this.anchorPoint||this.anchorPoint.y>t||this.anchorPoint.y===t&&this.anchorPoint.x>e){void 0!==this.anchorPoint&&this.points.push(new this.Point(this.anchorPoint.x,this.anchorPoint.y));this.anchorPoint=new this.Point(e,t)}else this.points.push(new this.Point(e,t))},_sortPoints:function(){var e=this;return this.points.sort(function(t,r){var n=e._findPolarAngle(e.anchorPoint,t),i=e._findPolarAngle(e.anchorPoint,r);return n<i?-1:n>i?1:0})},_checkPoints:function(e,t,r){var n,i=this._findPolarAngle(e,t),a=this._findPolarAngle(e,r);if(i>a){n=i-a;return!(n>180)}if(i<a){n=a-i;return n>180}return!0},getHull:function(){var e,t,r=[];this.reverse=this.points.every(function(e){return e.x<0&&e.y<0});e=this._sortPoints();t=e.length;if(t<3){e.unshift(this.anchorPoint);return e}r.push(e.shift(),e.shift());for(;;){var n,i,a;r.push(e.shift());n=r[r.length-3];i=r[r.length-2];a=r[r.length-1];this._checkPoints(n,i,a)&&r.splice(r.length-2,1);if(0==e.length){if(t==r.length){var o=this.anchorPoint;r=r.filter(function(e){return!!e});r.some(function(e){return e.x==o.x&&e.y==o.y})||r.unshift(this.anchorPoint);return r}e=r;t=e.length;r=[];r.push(e.shift(),e.shift())}}}};"function"==typeof define&&define.amd&&define(function(){return n});"undefined"!=typeof module&&(module.exports=n);!function(){"use strict";function t(e,r){if(!(this instanceof t))return new t(e,r);this._maxEntries=Math.max(4,e||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));r&&this._initFormat(r);this.clear()}function r(e,t){e.bbox=n(e,0,e.children.length,t)}function n(e,t,r,n){for(var o,s=i(),l=t;l<r;l++){o=e.children[l];a(s,e.leaf?n(o):o.bbox)}return s}function i(){return[1/0,1/0,-1/0,-1/0]}function a(e,t){e[0]=Math.min(e[0],t[0]);e[1]=Math.min(e[1],t[1]);e[2]=Math.max(e[2],t[2]);e[3]=Math.max(e[3],t[3]);return e}function o(e,t){return e.bbox[0]-t.bbox[0]}function s(e,t){return e.bbox[1]-t.bbox[1]}function l(e){return(e[2]-e[0])*(e[3]-e[1])}function c(e){return e[2]-e[0]+(e[3]-e[1])}function d(e,t){return(Math.max(t[2],e[2])-Math.min(t[0],e[0]))*(Math.max(t[3],e[3])-Math.min(t[1],e[1]))}function h(e,t){var r=Math.max(e[0],t[0]),n=Math.max(e[1],t[1]),i=Math.min(e[2],t[2]),a=Math.min(e[3],t[3]);return Math.max(0,i-r)*Math.max(0,a-n)}function u(e,t){return e[0]<=t[0]&&e[1]<=t[1]&&t[2]<=e[2]&&t[3]<=e[3]}function p(e,t){return t[0]<=e[2]&&t[1]<=e[3]&&t[2]>=e[0]&&t[3]>=e[1]}function f(e,t,r,n,i){for(var a,o=[t,r];o.length;){r=o.pop();t=o.pop();if(!(r-t<=n)){a=t+Math.ceil((r-t)/n/2)*n;g(e,t,r,a,i);o.push(t,a,a,r)}}}function g(e,t,r,n,i){for(var a,o,s,l,c,d,h,u,p;r>t;){if(r-t>600){a=r-t+1;o=n-t+1;s=Math.log(a);l=.5*Math.exp(2*s/3);c=.5*Math.sqrt(s*l*(a-l)/a)*(o-a/2<0?-1:1);d=Math.max(t,Math.floor(n-o*l/a+c));h=Math.min(r,Math.floor(n+(a-o)*l/a+c));g(e,d,h,n,i)}u=e[n];o=t;p=r;y(e,t,n);i(e[r],u)>0&&y(e,t,r);for(;o<p;){y(e,o,p);o++;p--;for(;i(e[o],u)<0;)o++;for(;i(e[p],u)>0;)p--}if(0===i(e[t],u))y(e,t,p);else{p++;y(e,p,r)}p<=n&&(t=p+1);n<=p&&(r=p-1)}}function y(e,t,r){var n=e[t];e[t]=e[r];e[r]=n}t.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,r=[],n=this.toBBox;if(!p(e,t.bbox))return r;for(var i,a,o,s,l=[];t;){for(i=0,a=t.children.length;i<a;i++){o=t.children[i];s=t.leaf?n(o):o.bbox;p(e,s)&&(t.leaf?r.push(o):u(e,s)?this._all(o,r):l.push(o))}t=l.pop()}return r},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n;n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(e){e&&this._insert(e,this.data.height-1);return this},clear:function(){this.data={children:[],height:1,bbox:i(),leaf:!0};return this},remove:function(e){if(!e)return this;for(var t,r,n,i,a=this.data,o=this.toBBox(e),s=[],l=[];a||s.length;){if(!a){a=s.pop();r=s[s.length-1];t=l.pop();i=!0}if(a&&a.leaf){n=a.children.indexOf(e);if(-1!==n){a.children.splice(n,1);s.push(a);this._condense(s);return this}}if(!i&&a&&!a.leaf&&u(a.bbox,o)){s.push(a);l.push(t);t=0;r=a;a=a.children[0]}else if(r){t++;a=r.children[t];i=!1}else a=null}return this},toBBox:function(e){return e},compareMinX:function(e,t){return e[0]-t[0]},compareMinY:function(e,t){return e[1]-t[1]},toJSON:function(){return this.data},fromJSON:function(e){this.data=e;return this},_all:function(e,t){for(var r=[];e;){e.leaf?t.push.apply(t,e.children):r.push.apply(r,e.children);e=r.pop()}return t},_build:function(e,t,n,i){var a,o=n-t+1,s=this._maxEntries;if(o<=s){a={children:e.slice(t,n+1),height:1,bbox:null,leaf:!0};r(a,this.toBBox);return a}if(!i){i=Math.ceil(Math.log(o)/Math.log(s));s=Math.ceil(o/Math.pow(s,i-1))}a={children:[],height:i,bbox:null};var l,c,d,h,u=Math.ceil(o/s),p=u*Math.ceil(Math.sqrt(s));f(e,t,n,p,this.compareMinX);for(l=t;l<=n;l+=p){d=Math.min(l+p-1,n);f(e,l,d,u,this.compareMinY);for(c=l;c<=d;c+=u){h=Math.min(c+u-1,d);a.children.push(this._build(e,c,h,i-1))}}r(a,this.toBBox);return a},_chooseSubtree:function(e,t,r,n){for(var i,a,o,s,c,h,u,p;;){if(!t)break;n.push(t);if(t.leaf||n.length-1===r)break;u=p=1/0;for(i=t.children.length-1;i>=0;i--){o=t.children[i];o&&o.bbox&&"number"==typeof o.bbox[3]&&!isNaN(o.bbox[3])||t.children.splice(i,1)}for(i=0,a=t.children.length;i<a;i++){o=t.children[i];c=l(o.bbox);h=d(e,o.bbox)-c;if(h<p){p=h;u=c<u?c:u;s=o}else if(h===p&&c<u){u=c;s=o}}t=s}return t},_insert:function(e,t,r){var n=this.toBBox,i=r?e.bbox:n(e),o=[];if(i&&"number"==typeof i[3]&&isFinite(i[3])){var s=this._chooseSubtree(i,this.data,t,o);if(s){s.children.push(e);a(s.bbox,i);for(;t>=0&&o[t].children.length>this._maxEntries;){this._split(o,t);t--}this._adjustParentBBoxes(i,o,t)}}},_split:function(e,t){var n=e[t],i=n.children.length,a=this._minEntries;this._chooseSplitAxis(n,a,i);var o={children:n.children.splice(this._chooseSplitIndex(n,a,i)),height:n.height};n.leaf&&(o.leaf=!0);r(n,this.toBBox);r(o,this.toBBox);t?e[t-1].children.push(o):this._splitRoot(n,o)},_splitRoot:function(e,t){this.data={children:[e,t],height:e.height+1};r(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,r){var i,a,o,s,c,d,u,p;d=u=1/0;for(i=t;i<=r-t;i++){a=n(e,0,i,this.toBBox);o=n(e,i,r,this.toBBox);s=h(a,o);c=l(a)+l(o);if(s<d){d=s;p=i;u=c<u?c:u}else if(s===d&&c<u){u=c;p=i}}return p},_chooseSplitAxis:function(e,t,r){if(e){var n=e.leaf?this.compareMinX:o,i=e.leaf?this.compareMinY:s;this._allDistMargin(e,t,r,n)<this._allDistMargin(e,t,r,i)&&e.children.sort(n)}},_allDistMargin:function(e,t,r,i){e.children.sort(i);var o,s,l=this.toBBox,d=n(e,0,t,l),h=n(e,r-t,r,l),u=c(d)+c(h);for(o=t;o<r-t;o++){s=e.children[o];a(d,e.leaf?l(s):s.bbox);u+=c(d)}for(o=r-t-1;o>=t;o--){s=e.children[o];a(h,e.leaf?l(s):s.bbox);u+=c(h)}return u},_adjustParentBBoxes:function(e,t,r){for(var n=r;n>=0;n--)a(t[n].bbox,e)},_condense:function(e){for(var t,n=e.length-1;n>=0;n--)if(0===e[n].children.length)if(n>0){t=e[n-1].children;t.splice(t.indexOf(e[n]),1)}else this.clear();else r(e[n],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0]));this.compareMinY=new Function("a","b",t.join(e[1]));this.toBBox=new Function("a","return [a"+e.join(", a")+"];")}};"function"==typeof define&&define.amd?define(function(){return t}):"undefined"!=typeof module?module.exports=t:"undefined"!=typeof self?self.rbush=t:e.rbush=t}();!function(){function r(e,t,r){et.biginteger_used=1;if(null!=e)if("number"==typeof e)this.fromString(Math.floor(e).toString(),10);else if(null==t&&"string"!=typeof e)this.fromString(e,256);else{-1!=e.indexOf(".")&&(e=e.substring(0,e.indexOf(".")));this.fromString(e,t)}}function n(){return new r(null)}function i(e,t,r,n,i,a){for(;--a>=0;){var o=t*this[e++]+r[n]+i;i=Math.floor(o/67108864);r[n++]=67108863&o}return i}function a(e,t,r,n,i,a){for(var o=32767&t,s=t>>15;--a>=0;){var l=32767&this[e],c=this[e++]>>15,d=s*l+c*o;l=o*l+((32767&d)<<15)+r[n]+(1073741823&i);i=(l>>>30)+(d>>>15)+s*c+(i>>>30);r[n++]=1073741823&l}return i}function o(e,t,r,n,i,a){for(var o=16383&t,s=t>>14;--a>=0;){var l=16383&this[e],c=this[e++]>>14,d=s*l+c*o;l=o*l+((16383&d)<<14)+r[n]+i;i=(l>>28)+(d>>14)+s*c;r[n++]=268435455&l}return i}function s(e){return lt.charAt(e)}function l(e,t){var r=ct[e.charCodeAt(t)];return null==r?-1:r}function c(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t;e.s=this.s}function d(e){this.t=1;this.s=e<0?-1:0;e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0}function h(e){var t=n();t.fromInt(e);return t}function u(e,t){var n;if(16==t)n=4;else if(8==t)n=3;else if(256==t)n=8;else if(2==t)n=1;else if(32==t)n=5;else{if(4!=t){this.fromRadix(e,t);return}n=2}this.t=0;this.s=0;for(var i=e.length,a=!1,o=0;--i>=0;){var s=8==n?255&e[i]:l(e,i);if(s<0)"-"==e.charAt(i)&&(a=!0);else{a=!1;if(0==o)this[this.t++]=s;else if(o+n>this.DB){this[this.t-1]|=(s&(1<<this.DB-o)-1)<<o;this[this.t++]=s>>this.DB-o}else this[this.t-1]|=s<<o;o+=n;o>=this.DB&&(o-=this.DB)}}if(8==n&&0!=(128&e[0])){this.s=-1;o>0&&(this[this.t-1]|=(1<<this.DB-o)-1<<o)}this.clamp();a&&r.ZERO.subTo(this,this)}function p(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t}function f(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var r,n=(1<<t)-1,i=!1,a="",o=this.t,l=this.DB-o*this.DB%t;if(o-- >0){if(l<this.DB&&(r=this[o]>>l)>0){i=!0;a=s(r)}for(;o>=0;){if(l<t){r=(this[o]&(1<<l)-1)<<t-l;r|=this[--o]>>(l+=this.DB-t)}else{r=this[o]>>(l-=t)&n;if(l<=0){l+=this.DB;--o}}r>0&&(i=!0);i&&(a+=s(r))}}return i?a:"0"}function g(){var e=n();r.ZERO.subTo(this,e);return e}function y(){return this.s<0?this.negate():this}function v(e){var t=this.s-e.s;if(0!=t)return t;var r=this.t;t=r-e.t;if(0!=t)return this.s<0?-t:t;for(;--r>=0;)if(0!=(t=this[r]-e[r]))return t;return 0}function m(e){var t,r=1;if(0!=(t=e>>>16)){e=t;r+=16}if(0!=(t=e>>8)){e=t;r+=8}if(0!=(t=e>>4)){e=t;r+=4}if(0!=(t=e>>2)){e=t;r+=2}if(0!=(t=e>>1)){e=t;r+=1}return r}function x(){return this.t<=0?0:this.DB*(this.t-1)+m(this[this.t-1]^this.s&this.DM)}function _(e,t){var r;for(r=this.t-1;r>=0;--r)t[r+e]=this[r];for(r=e-1;r>=0;--r)t[r]=0;t.t=this.t+e;t.s=this.s}function P(e,t){for(var r=e;r<this.t;++r)t[r-e]=this[r];t.t=Math.max(this.t-e,0);t.s=this.s}function S(e,t){var r,n=e%this.DB,i=this.DB-n,a=(1<<i)-1,o=Math.floor(e/this.DB),s=this.s<<n&this.DM;for(r=this.t-1;r>=0;--r){t[r+o+1]=this[r]>>i|s;s=(this[r]&a)<<n}for(r=o-1;r>=0;--r)t[r]=0;t[o]=s;t.t=this.t+o+1;t.s=this.s;t.clamp()}function b(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t)t.t=0;else{var n=e%this.DB,i=this.DB-n,a=(1<<n)-1;t[0]=this[r]>>n;for(var o=r+1;o<this.t;++o){t[o-r-1]|=(this[o]&a)<<i;t[o-r]=this[o]>>n}n>0&&(t[this.t-r-1]|=(this.s&a)<<i);t.t=this.t-r;t.clamp()}}function C(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;){n+=this[r]-e[r];t[r++]=n&this.DM;n>>=this.DB}if(e.t<this.t){n-=e.s;for(;r<this.t;){n+=this[r];t[r++]=n&this.DM;n>>=this.DB}n+=this.s}else{n+=this.s;for(;r<e.t;){n-=e[r];t[r++]=n&this.DM;n>>=this.DB}n-=e.s}t.s=n<0?-1:0;n<-1?t[r++]=this.DV+n:n>0&&(t[r++]=n);t.t=r;t.clamp()}function A(e,t){var n=this.abs(),i=e.abs(),a=n.t;t.t=a+i.t;for(;--a>=0;)t[a]=0;for(a=0;a<i.t;++a)t[a+n.t]=n.am(0,i[a],t,a,0,n.t);t.s=0;t.clamp();this.s!=e.s&&r.ZERO.subTo(t,t)}function I(e){for(var t=this.abs(),r=e.t=2*t.t;--r>=0;)e[r]=0;for(r=0;r<t.t-1;++r){var n=t.am(r,t[r],e,2*r,0,1);if((e[r+t.t]+=t.am(r+1,2*t[r],e,2*r+1,n,t.t-r-1))>=t.DV){e[r+t.t]-=t.DV;e[r+t.t+1]=1}}e.t>0&&(e[e.t-1]+=t.am(r,t[r],e,2*r,0,1));e.s=0;e.clamp()}function L(e,t,i){var a=e.abs();if(!(a.t<=0)){var o=this.abs();if(o.t<a.t){null!=t&&t.fromInt(0);null!=i&&this.copyTo(i)}else{null==i&&(i=n());var s=n(),l=this.s,c=e.s,d=this.DB-m(a[a.t-1]);if(d>0){a.lShiftTo(d,s);o.lShiftTo(d,i)}else{a.copyTo(s);o.copyTo(i)}var h=s.t,u=s[h-1];if(0!=u){var p=u*(1<<this.F1)+(h>1?s[h-2]>>this.F2:0),f=this.FV/p,g=(1<<this.F1)/p,y=1<<this.F2,v=i.t,x=v-h,_=null==t?n():t;s.dlShiftTo(x,_);if(i.compareTo(_)>=0){i[i.t++]=1;i.subTo(_,i)}r.ONE.dlShiftTo(h,_);_.subTo(s,s);for(;s.t<h;)s[s.t++]=0;for(;--x>=0;){var P=i[--v]==u?this.DM:Math.floor(i[v]*f+(i[v-1]+y)*g);if((i[v]+=s.am(0,P,i,x,0,h))<P){s.dlShiftTo(x,_);i.subTo(_,i);for(;i[v]<--P;)i.subTo(_,i)}}if(null!=t){i.drShiftTo(h,t);l!=c&&r.ZERO.subTo(t,t)}i.t=h;i.clamp();d>0&&i.rShiftTo(d,i);l<0&&r.ZERO.subTo(i,i)}}}}function E(e){var t=n();this.abs().divRemTo(e,null,t);this.s<0&&t.compareTo(r.ZERO)>0&&e.subTo(t,t);return t}function O(e){this.m=e}function T(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e}function w(e){return e}function R(e){e.divRemTo(this.m,null,e)}function N(e,t,r){e.multiplyTo(t,r);this.reduce(r)}function k(e,t){e.squareTo(t);this.reduce(t)}function B(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;t=t*(2-(15&e)*t)&15;t=t*(2-(255&e)*t)&255;t=t*(2-((65535&e)*t&65535))&65535;t=t*(2-e*t%this.DV)%this.DV;return t>0?this.DV-t:-t}function M(e){this.m=e;this.mp=e.invDigit();this.mpl=32767&this.mp;this.mph=this.mp>>15;this.um=(1<<e.DB-15)-1;this.mt2=2*e.t}function V(e){var t=n();e.abs().dlShiftTo(this.m.t,t);t.divRemTo(this.m,null,t);e.s<0&&t.compareTo(r.ZERO)>0&&this.m.subTo(t,t);return t}function G(e){var t=n();e.copyTo(t);this.reduce(t);return t}function F(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=32767&e[t],n=r*this.mpl+((r*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;r=t+this.m.t;e[r]+=this.m.am(0,n,e,t,0,this.m.t);for(;e[r]>=e.DV;){e[r]-=e.DV;e[++r]++}}e.clamp();e.drShiftTo(this.m.t,e);e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function D(e,t){e.squareTo(t);this.reduce(t)}function H(e,t,r){e.multiplyTo(t,r);this.reduce(r)}function j(){return 0==(this.t>0?1&this[0]:this.s)}function U(e,t){if(e>4294967295||e<1)return r.ONE;var i=n(),a=n(),o=t.convert(this),s=m(e)-1;o.copyTo(i);for(;--s>=0;){t.sqrTo(i,a);if((e&1<<s)>0)t.mulTo(a,o,i);else{var l=i;i=a;a=l}}return t.revert(i)}function Y(e,t){var r;r=e<256||t.isEven()?new O(t):new M(t);return this.exp(e,r)}function z(){var e=n();this.copyTo(e);return e}function J(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function X(){return 0==this.t?this.s:this[0]<<24>>24}function K(){return 0==this.t?this.s:this[0]<<16>>16}function W(e){return Math.floor(Math.LN2*this.DB/Math.log(e))}function q(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function $(e){null==e&&(e=10);if(0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),r=Math.pow(e,t),i=h(r),a=n(),o=n(),s="";this.divRemTo(i,a,o);for(;a.signum()>0;){s=(r+o.intValue()).toString(e).substr(1)+s;a.divRemTo(i,a,o)}return o.intValue().toString(e)+s}function Q(e,t){this.fromInt(0);null==t&&(t=10);for(var n=this.chunkSize(t),i=Math.pow(t,n),a=!1,o=0,s=0,c=0;c<e.length;++c){var d=l(e,c);if(d<0)"-"==e.charAt(c)&&0==this.signum()&&(a=!0);else{s=t*s+d;if(++o>=n){this.dMultiply(i);this.dAddOffset(s,0);o=0;s=0}}}if(o>0){this.dMultiply(Math.pow(t,o));this.dAddOffset(s,0)}a&&r.ZERO.subTo(this,this)}function Z(e,t,n){if("number"==typeof t)if(e<2)this.fromInt(1);else{this.fromNumber(e,n);this.testBit(e-1)||this.bitwiseTo(r.ONE.shiftLeft(e-1),se,this);this.isEven()&&this.dAddOffset(1,0);for(;!this.isProbablePrime(t);){this.dAddOffset(2,0);this.bitLength()>e&&this.subTo(r.ONE.shiftLeft(e-1),this)}}else{var i=[],a=7&e;i.length=1+(e>>3);t.nextBytes(i);a>0?i[0]&=(1<<a)-1:i[0]=0;this.fromString(i,256)}}function ee(){var e=this.t,t=[];t[0]=this.s;var r,n=this.DB-e*this.DB%8,i=0;if(e-- >0){n<this.DB&&(r=this[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);for(;e>=0;){if(n<8){r=(this[e]&(1<<n)-1)<<8-n;r|=this[--e]>>(n+=this.DB-8)}else{r=this[e]>>(n-=8)&255;if(n<=0){n+=this.DB;--e}}0!=(128&r)&&(r|=-256);0==i&&(128&this.s)!=(128&r)&&++i;(i>0||r!=this.s)&&(t[i++]=r)}}return t}function te(e){return 0==this.compareTo(e)}function re(e){return this.compareTo(e)<0?this:e}function ne(e){return this.compareTo(e)>0?this:e}function ie(e,t,r){var n,i,a=Math.min(e.t,this.t);for(n=0;n<a;++n)r[n]=t(this[n],e[n]);if(e.t<this.t){i=e.s&this.DM;for(n=a;n<this.t;++n)r[n]=t(this[n],i);r.t=this.t}else{i=this.s&this.DM;for(n=a;n<e.t;++n)r[n]=t(i,e[n]);r.t=e.t}r.s=t(this.s,e.s);r.clamp()}function ae(e,t){return e&t}function oe(e){var t=n();this.bitwiseTo(e,ae,t);return t}function se(e,t){return e|t}function le(e){var t=n();this.bitwiseTo(e,se,t);return t}function ce(e,t){return e^t}function de(e){var t=n();this.bitwiseTo(e,ce,t);return t}function he(e,t){return e&~t}function ue(e){var t=n();this.bitwiseTo(e,he,t);return t}function pe(){for(var e=n(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];e.t=this.t;e.s=~this.s;return e}function fe(e){var t=n();e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t);return t}function ge(e){var t=n();e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t);return t}function ye(e){if(0==e)return-1;var t=0;if(0==(65535&e)){e>>=16;t+=16}if(0==(255&e)){e>>=8;t+=8}if(0==(15&e)){e>>=4;t+=4}if(0==(3&e)){e>>=2;t+=2}0==(1&e)&&++t;return t}function ve(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+ye(this[e]);return this.s<0?this.t*this.DB:-1}function me(e){for(var t=0;0!=e;){e&=e-1;++t}return t}function xe(){for(var e=0,t=this.s&this.DM,r=0;r<this.t;++r)e+=me(this[r]^t);return e}function _e(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)}function Pe(e,t){var n=r.ONE.shiftLeft(e);this.bitwiseTo(n,t,n);return n}function Se(e){return this.changeBit(e,se)}function be(e){return this.changeBit(e,he)}function Ce(e){return this.changeBit(e,ce)}function Ae(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;){n+=this[r]+e[r];t[r++]=n&this.DM;n>>=this.DB}if(e.t<this.t){n+=e.s;for(;r<this.t;){n+=this[r];t[r++]=n&this.DM;n>>=this.DB}n+=this.s}else{n+=this.s;for(;r<e.t;){n+=e[r];t[r++]=n&this.DM;n>>=this.DB}n+=e.s}t.s=n<0?-1:0;n>0?t[r++]=n:n<-1&&(t[r++]=this.DV+n);t.t=r;t.clamp()}function Ie(e){var t=n();this.addTo(e,t);return t}function Le(e){var t=n();this.subTo(e,t);return t}function Ee(e){var t=n();this.multiplyTo(e,t);return t}function Oe(){var e=n();this.squareTo(e);return e}function Te(e){var t=n();this.divRemTo(e,t,null);return t}function we(e){var t=n();this.divRemTo(e,null,t);return t}function Re(e){var t=n(),r=n();this.divRemTo(e,t,r);return new Array(t,r)}function Ne(e){this[this.t]=this.am(0,e-1,this,0,0,this.t);++this.t;this.clamp()}function ke(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;this[t]+=e;for(;this[t]>=this.DV;){this[t]-=this.DV;++t>=this.t&&(this[this.t++]=0);++this[t]}}}function Be(){}function Me(e){return e}function Ve(e,t,r){e.multiplyTo(t,r)}function Ge(e,t){e.squareTo(t)}function Fe(e){return this.exp(e,new Be)}function De(e,t,r){var n=Math.min(this.t+e.t,t);r.s=0;r.t=n;for(;n>0;)r[--n]=0;var i;for(i=r.t-this.t;n<i;++n)r[n+this.t]=this.am(0,e[n],r,n,0,this.t);for(i=Math.min(e.t,t);n<i;++n)this.am(0,e[n],r,n,0,t-n);r.clamp()}function He(e,t,r){--t;var n=r.t=this.t+e.t-t;r.s=0;for(;--n>=0;)r[n]=0;for(n=Math.max(t-this.t,0);n<e.t;++n)r[this.t+n-t]=this.am(t-n,e[n],r,0,0,this.t+n-t);r.clamp();r.drShiftTo(1,r)}function je(e){this.r2=n();this.q3=n();r.ONE.dlShiftTo(2*e.t,this.r2);this.mu=this.r2.divide(e);this.m=e}function Ue(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=n();e.copyTo(t);this.reduce(t);return t}function Ye(e){return e}function ze(e){e.drShiftTo(this.m.t-1,this.r2);if(e.t>this.m.t+1){e.t=this.m.t+1;e.clamp()}this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);for(;e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);e.subTo(this.r2,e);for(;e.compareTo(this.m)>=0;)e.subTo(this.m,e)}function Je(e,t){e.squareTo(t);this.reduce(t)}function Xe(e,t,r){e.multiplyTo(t,r);this.reduce(r)}function Ke(e,t){var r,i,a=e.bitLength(),o=h(1);if(a<=0)return o;r=a<18?1:a<48?3:a<144?4:a<768?5:6;i=a<8?new O(t):t.isEven()?new je(t):new M(t);var s=[],l=3,c=r-1,d=(1<<r)-1;s[1]=i.convert(this);if(r>1){var u=n();i.sqrTo(s[1],u);for(;l<=d;){s[l]=n();i.mulTo(u,s[l-2],s[l]);l+=2}}var p,f,g=e.t-1,y=!0,v=n();a=m(e[g])-1;for(;g>=0;){if(a>=c)p=e[g]>>a-c&d;else{p=(e[g]&(1<<a+1)-1)<<c-a;g>0&&(p|=e[g-1]>>this.DB+a-c)}l=r;for(;0==(1&p);){p>>=1;--l}if((a-=l)<0){a+=this.DB;--g}if(y){s[p].copyTo(o);y=!1}else{for(;l>1;){i.sqrTo(o,v);i.sqrTo(v,o);l-=2}if(l>0)i.sqrTo(o,v);else{f=o;o=v;v=f}i.mulTo(v,s[p],o)}for(;g>=0&&0==(e[g]&1<<a);){i.sqrTo(o,v);f=o;o=v;v=f;if(--a<0){a=this.DB-1;--g}}}return i.revert(o)}function We(e){var t=this.s<0?this.negate():this.clone(),r=e.s<0?e.negate():e.clone();if(t.compareTo(r)<0){var n=t;t=r;r=n}var i=t.getLowestSetBit(),a=r.getLowestSetBit();if(a<0)return t;i<a&&(a=i);if(a>0){t.rShiftTo(a,t);r.rShiftTo(a,r)}for(;t.signum()>0;){(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t);(i=r.getLowestSetBit())>0&&r.rShiftTo(i,r);if(t.compareTo(r)>=0){t.subTo(r,t);t.rShiftTo(1,t)}else{r.subTo(t,r);r.rShiftTo(1,r)}}a>0&&r.lShiftTo(a,r);return r}function qe(e){if(e<=0)return 0;var t=this.DV%e,r=this.s<0?e-1:0;if(this.t>0)if(0==t)r=this[0]%e;else for(var n=this.t-1;n>=0;--n)r=(t*r+this[n])%e;return r}function $e(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return r.ZERO;for(var n=e.clone(),i=this.clone(),a=h(1),o=h(0),s=h(0),l=h(1);0!=n.signum();){for(;n.isEven();){n.rShiftTo(1,n);if(t){if(!a.isEven()||!o.isEven()){a.addTo(this,a);o.subTo(e,o)}a.rShiftTo(1,a)}else o.isEven()||o.subTo(e,o);o.rShiftTo(1,o)}for(;i.isEven();){i.rShiftTo(1,i);if(t){if(!s.isEven()||!l.isEven()){s.addTo(this,s);l.subTo(e,l)}s.rShiftTo(1,s)}else l.isEven()||l.subTo(e,l);l.rShiftTo(1,l)}if(n.compareTo(i)>=0){n.subTo(i,n);t&&a.subTo(s,a);o.subTo(l,o)}else{i.subTo(n,i);t&&s.subTo(a,s);l.subTo(o,l)}}if(0!=i.compareTo(r.ONE))return r.ZERO;if(l.compareTo(e)>=0)return l.subtract(e);if(!(l.signum()<0))return l;l.addTo(e,l);return l.signum()<0?l.add(e):l}function Qe(e){var t,r=this.abs();if(1==r.t&&r[0]<=dt[dt.length-1]){for(t=0;t<dt.length;++t)if(r[0]==dt[t])return!0;return!1}if(r.isEven())return!1;t=1;for(;t<dt.length;){for(var n=dt[t],i=t+1;i<dt.length&&n<ht;)n*=dt[i++];n=r.modInt(n);for(;t<i;)if(n%dt[t++]==0)return!1}return r.millerRabin(e)}function Ze(e){var t=this.subtract(r.ONE),i=t.getLowestSetBit();if(i<=0)return!1;var a=t.shiftRight(i);e=e+1>>1;e>dt.length&&(e=dt.length);for(var o=n(),s=0;s<e;++s){o.fromInt(dt[Math.floor(Math.random()*dt.length)]);var l=o.modPow(a,this);if(0!=l.compareTo(r.ONE)&&0!=l.compareTo(t)){for(var c=1;c++<i&&0!=l.compareTo(t);){l=l.modPowInt(2,this);if(0==l.compareTo(r.ONE))return!1}if(0!=l.compareTo(t))return!1}}return!0}var et={},tt=!1;if("undefined"!=typeof module&&module.exports){module.exports=et;tt=!0}else void 0!==t?e.ClipperLib=et:self.ClipperLib=et;var rt;if(tt){var nt="chrome";rt="Netscape"}else{var nt=navigator.userAgent.toString().toLowerCase();rt=navigator.appName}var it={};-1!=nt.indexOf("chrome")&&-1==nt.indexOf("chromium")?it.chrome=1:it.chrome=0;-1!=nt.indexOf("chromium")?it.chromium=1:it.chromium=0;-1!=nt.indexOf("safari")&&-1==nt.indexOf("chrome")&&-1==nt.indexOf("chromium")?it.safari=1:it.safari=0;-1!=nt.indexOf("firefox")?it.firefox=1:it.firefox=0;-1!=nt.indexOf("firefox/17")?it.firefox17=1:it.firefox17=0;-1!=nt.indexOf("firefox/15")?it.firefox15=1:it.firefox15=0;-1!=nt.indexOf("firefox/3")?it.firefox3=1:it.firefox3=0;-1!=nt.indexOf("opera")?it.opera=1:it.opera=0;-1!=nt.indexOf("msie 10")?it.msie10=1:it.msie10=0;-1!=nt.indexOf("msie 9")?it.msie9=1:it.msie9=0;-1!=nt.indexOf("msie 8")?it.msie8=1:it.msie8=0;-1!=nt.indexOf("msie 7")?it.msie7=1:it.msie7=0;-1!=nt.indexOf("msie ")?it.msie=1:it.msie=0;et.biginteger_used=null;var at;if("Microsoft Internet Explorer"==rt){r.prototype.am=a;at=30}else if("Netscape"!=rt){r.prototype.am=i;at=26}else{r.prototype.am=o;at=28}r.prototype.DB=at;r.prototype.DM=(1<<at)-1;r.prototype.DV=1<<at;r.prototype.FV=Math.pow(2,52);r.prototype.F1=52-at;r.prototype.F2=2*at-52;var ot,st,lt="0123456789abcdefghijklmnopqrstuvwxyz",ct=[];ot="0".charCodeAt(0);for(st=0;st<=9;++st)ct[ot++]=st;ot="a".charCodeAt(0);for(st=10;st<36;++st)ct[ot++]=st;ot="A".charCodeAt(0);for(st=10;st<36;++st)ct[ot++]=st;O.prototype.convert=T;O.prototype.revert=w;O.prototype.reduce=R;O.prototype.mulTo=N;O.prototype.sqrTo=k;M.prototype.convert=V;M.prototype.revert=G;M.prototype.reduce=F;M.prototype.mulTo=H;M.prototype.sqrTo=D;r.prototype.copyTo=c;r.prototype.fromInt=d;r.prototype.fromString=u;r.prototype.clamp=p;r.prototype.dlShiftTo=_;r.prototype.drShiftTo=P;r.prototype.lShiftTo=S;r.prototype.rShiftTo=b;r.prototype.subTo=C;r.prototype.multiplyTo=A;r.prototype.squareTo=I;r.prototype.divRemTo=L;r.prototype.invDigit=B;r.prototype.isEven=j;r.prototype.exp=U;r.prototype.toString=f;r.prototype.negate=g;r.prototype.abs=y;r.prototype.compareTo=v;r.prototype.bitLength=x;r.prototype.mod=E;r.prototype.modPowInt=Y;r.ZERO=h(0);r.ONE=h(1);Be.prototype.convert=Me;Be.prototype.revert=Me;Be.prototype.mulTo=Ve;Be.prototype.sqrTo=Ge;je.prototype.convert=Ue;je.prototype.revert=Ye;je.prototype.reduce=ze;je.prototype.mulTo=Xe;je.prototype.sqrTo=Je;var dt=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],ht=(1<<26)/dt[dt.length-1];r.prototype.chunkSize=W;r.prototype.toRadix=$;r.prototype.fromRadix=Q;r.prototype.fromNumber=Z;r.prototype.bitwiseTo=ie;r.prototype.changeBit=Pe;r.prototype.addTo=Ae;r.prototype.dMultiply=Ne;r.prototype.dAddOffset=ke;r.prototype.multiplyLowerTo=De;r.prototype.multiplyUpperTo=He;r.prototype.modInt=qe;r.prototype.millerRabin=Ze;r.prototype.clone=z;r.prototype.intValue=J;r.prototype.byteValue=X;r.prototype.shortValue=K;r.prototype.signum=q;r.prototype.toByteArray=ee;r.prototype.equals=te;r.prototype.min=re;r.prototype.max=ne;r.prototype.and=oe;r.prototype.or=le;r.prototype.xor=de;r.prototype.andNot=ue;r.prototype.not=pe;r.prototype.shiftLeft=fe;r.prototype.shiftRight=ge;r.prototype.getLowestSetBit=ve;r.prototype.bitCount=xe;r.prototype.testBit=_e;r.prototype.setBit=Se;r.prototype.clearBit=be;r.prototype.flipBit=Ce;r.prototype.add=Ie;r.prototype.subtract=Le
;r.prototype.multiply=Ee;r.prototype.divide=Te;r.prototype.remainder=we;r.prototype.divideAndRemainder=Re;r.prototype.modPow=Ke;r.prototype.modInverse=$e;r.prototype.pow=Fe;r.prototype.gcd=We;r.prototype.isProbablePrime=Qe;r.prototype.square=Oe;et.Math_Abs_Int64=et.Math_Abs_Int32=et.Math_Abs_Double=function(e){return Math.abs(e)};et.Math_Max_Int32_Int32=function(e,t){return Math.max(e,t)};it.msie||it.opera||it.safari?et.Cast_Int32=function(e){return 0|e}:et.Cast_Int32=function(e){return~~e};it.chrome?et.Cast_Int64=function(e){return e<-2147483648||e>2147483647?e<0?Math.ceil(e):Math.floor(e):~~e}:it.firefox&&"function"==typeof Number.toInteger?et.Cast_Int64=function(e){return Number.toInteger(e)}:it.msie7||it.msie8?et.Cast_Int64=function(e){return parseInt(e,10)}:it.msie?et.Cast_Int64=function(e){return e<-2147483648||e>2147483647?e<0?Math.ceil(e):Math.floor(e):0|e}:et.Cast_Int64=function(e){return e<0?Math.ceil(e):Math.floor(e)};et.Clear=function(e){e.length=0};et.MaxSteps=64;et.PI=3.141592653589793;et.PI2=6.283185307179586;et.IntPoint=function(){var e=arguments;if(1==e.length){this.x=e[0].x;this.y=e[0].y}if(2==e.length){this.x=e[0];this.y=e[1]}};et.IntRect=function(){var e=arguments;if(4==e.length){var t=e[0],r=e[1],n=e[2],i=e[3];this.left=t;this.top=r;this.right=n;this.bottom=i}else{this.left=0;this.top=0;this.right=0;this.bottom=0}};et.Polygon=function(){return[]};et.Polygons=function(){return[]};et.ExPolygons=function(){var e=[];e.exPolygons=!0;return e};et.ExPolygon=function(){this.outer=null;this.holes=null};et.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3};et.PolyType={ptSubject:0,ptClip:1};et.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3};et.JoinType={jtSquare:0,jtRound:1,jtMiter:2};et.EdgeSide={esLeft:1,esRight:2};et.Protects={ipNone:0,ipLeft:1,ipRight:2,ipBoth:3};et.Direction={dRightToLeft:0,dLeftToRight:1};et.TEdge=function(){this.xbot=0;this.ybot=0;this.xcurr=0;this.ycurr=0;this.xtop=0;this.ytop=0;this.dx=0;this.deltaX=0;this.deltaY=0;this.tmpX=0;this.polyType=et.PolyType.ptSubject;this.side=null;this.windDelta=0;this.windCnt=0;this.windCnt2=0;this.outIdx=0;this.next=null;this.prev=null;this.nextInLML=null;this.nextInAEL=null;this.prevInAEL=null;this.nextInSEL=null;this.prevInSEL=null};et.IntersectNode=function(){this.edge1=null;this.edge2=null;this.pt=null;this.next=null};et.LocalMinima=function(){this.y=0;this.leftBound=null;this.rightBound=null;this.next=null};et.Scanbeam=function(){this.y=0;this.next=null};et.OutRec=function(){this.idx=0;this.isHole=!1;this.FirstLeft=null;this.AppendLink=null;this.pts=null;this.bottomPt=null};et.OutPt=function(){this.idx=0;this.pt=null;this.next=null;this.prev=null};et.JoinRec=function(){this.pt1a=null;this.pt1b=null;this.poly1Idx=0;this.pt2a=null;this.pt2b=null;this.poly2Idx=0};et.HorzJoinRec=function(){this.edge=null;this.savedIdx=0};et.ClipperBase=function(){this.m_MinimaList=null;this.m_CurrentLM=null;this.m_edges=[[]];this.m_UseFullRange=!1};et.ClipperBase.horizontal=-9007199254740992;et.ClipperBase.loRange=47453132;et.ClipperBase.hiRange=0xfffffffffffff;et.ClipperBase.PointsEqual=function(e,t){return e.x==t.x&&e.y==t.y};et.ClipperBase.prototype.PointIsVertex=function(e,t){var r=t;do{if(et.ClipperBase.PointsEqual(r.pt,e))return!0;r=r.next}while(r!=t);return!1};et.ClipperBase.prototype.PointInPolygon=function(e,t,n){var i=t,a=!1;if(n)do{(i.pt.y<=e.y&&e.y<i.prev.pt.y||i.prev.pt.y<=e.y&&e.y<i.pt.y)&&new r(e.x-i.pt.x).compareTo(new r(i.prev.pt.x-i.pt.x).multiply(new r(e.y-i.pt.y)).divide(new r(i.prev.pt.y-i.pt.y)))<0&&(a=!a);i=i.next}while(i!=t);else do{(i.pt.y<=e.y&&e.y<i.prev.pt.y||i.prev.pt.y<=e.y&&e.y<i.pt.y)&&e.x-i.pt.x<(i.prev.pt.x-i.pt.x)*(e.y-i.pt.y)/(i.prev.pt.y-i.pt.y)&&(a=!a);i=i.next}while(i!=t);return a};et.ClipperBase.prototype.SlopesEqual=et.ClipperBase.SlopesEqual=function(){var e,t,n,i,a,o,s,l=arguments;if(3==l.length){e=l[0],t=l[1],s=l[2];return s?new r(e.deltaY).multiply(new r(t.deltaX)).toString()==new r(e.deltaX).multiply(new r(t.deltaY)).toString():e.deltaY*t.deltaX==e.deltaX*t.deltaY}if(4==l.length){n=l[0],i=l[1],a=l[2],s=l[3];return s?new r(n.y-i.y).multiply(new r(i.x-a.x)).toString()==new r(n.x-i.x).multiply(new r(i.y-a.y)).toString():(n.y-i.y)*(i.x-a.x)-(n.x-i.x)*(i.y-a.y)==0}if(5==l.length){n=l[0],i=l[1],a=l[2],o=l[3],s=l[4];return s?new r(n.y-i.y).multiply(new r(a.x-o.x)).toString()==new r(n.x-i.x).multiply(new r(a.y-o.y)).toString():(n.y-i.y)*(a.x-o.x)-(n.x-i.x)*(a.y-o.y)==0}};et.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var e=0;e<this.m_edges.length;++e){for(var t=0;t<this.m_edges[e].length;++t)this.m_edges[e][t]=null;et.Clear(this.m_edges[e])}et.Clear(this.m_edges);this.m_UseFullRange=!1};et.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!=this.m_MinimaList;){var e=this.m_MinimaList.next;this.m_MinimaList=null;this.m_MinimaList=e}this.m_CurrentLM=null};et.ClipperBase.prototype.AddPolygons=function(e,t){var r=!1,n=!1;if(!(e instanceof Array))return r;for(var i=0;i<e.length;++i){n=this.AddPolygon(e[i],t,!0);if(n&&"exceed"!=n)r=!0;else if("exceed"==n)break}"exceed"==n&&et.Error("Coordinate exceeds range bounds in AddPolygons().");return r};et.ClipperBase.prototype.AddPolygon=function(e,t,r){if(!(e instanceof Array))return!1;var n=e.length;if(n<3)return!1;var i=new et.Polygon;i.push(new et.IntPoint(e[0].x,e[0].y));var a,o=0,s=!1;for(a=1;a<n;++a){var l;l=this.m_UseFullRange?et.ClipperBase.hiRange:et.ClipperBase.loRange;if(et.Math_Abs_Int64(e[a].x)>l||et.Math_Abs_Int64(e[a].y)>l){if(et.Math_Abs_Int64(e[a].x)>et.ClipperBase.hiRange||et.Math_Abs_Int64(e[a].y)>et.ClipperBase.hiRange){if(void 0!==r)return"exceed";s=!0;break}l=et.ClipperBase.hiRange;this.m_UseFullRange=!0}if(!et.ClipperBase.PointsEqual(i[o],e[a])){o>0&&this.SlopesEqual(i[o-1],i[o],e[a],this.m_UseFullRange)?et.ClipperBase.PointsEqual(i[o-1],e[a])&&o--:o++;o<i.length?i[o]=e[a]:i.push(new et.IntPoint(e[a].x,e[a].y))}}s&&void 0===r&&et.Error("Coordinate exceeds range bounds in AddPolygon()");if(o<2)return!1;n=o+1;for(;n>2;){if(et.ClipperBase.PointsEqual(i[o],i[0]))o--;else if(et.ClipperBase.PointsEqual(i[0],i[1])||this.SlopesEqual(i[o],i[0],i[1],this.m_UseFullRange))i[0]=i[o--];else if(this.SlopesEqual(i[o-1],i[o],i[0],this.m_UseFullRange))o--;else{if(!this.SlopesEqual(i[0],i[1],i[2],this.m_UseFullRange))break;for(a=2;a<=o;++a)i[a-1]=i[a];o--}n--}if(n<3)return!1;var c=[];for(a=0;a<n;a++)c.push(new et.TEdge);this.m_edges.push(c);c[0].xcurr=i[0].x;c[0].ycurr=i[0].y;this.InitEdge(c[n-1],c[0],c[n-2],i[n-1],t);for(a=n-2;a>0;--a)this.InitEdge(c[a],c[a+1],c[a-1],i[a],t);this.InitEdge(c[0],c[1],c[n-1],i[0],t);var d=c[0],h=d;do{d.xcurr=d.xbot;d.ycurr=d.ybot;d.ytop<h.ytop&&(h=d);d=d.next}while(d!=c[0]);h.windDelta>0&&(h=h.next);h.dx==et.ClipperBase.horizontal&&(h=h.next);d=h;do{d=this.AddBoundsToLML(d)}while(d!=h);return!0};et.ClipperBase.prototype.InitEdge=function(e,t,r,n,i){e.next=t;e.prev=r;e.xcurr=n.x;e.ycurr=n.y;if(e.ycurr>=e.next.ycurr){e.xbot=e.xcurr;e.ybot=e.ycurr;e.xtop=e.next.xcurr;e.ytop=e.next.ycurr;e.windDelta=1}else{e.xtop=e.xcurr;e.ytop=e.ycurr;e.xbot=e.next.xcurr;e.ybot=e.next.ycurr;e.windDelta=-1}this.SetDx(e);e.polyType=i;e.outIdx=-1};et.ClipperBase.prototype.SetDx=function(e){e.deltaX=e.xtop-e.xbot;e.deltaY=e.ytop-e.ybot;0==e.deltaY?e.dx=et.ClipperBase.horizontal:e.dx=e.deltaX/e.deltaY};et.ClipperBase.prototype.AddBoundsToLML=function(e){e.nextInLML=null;e=e.next;for(;;){if(e.dx==et.ClipperBase.horizontal){if(e.next.ytop<e.ytop&&e.next.xbot>e.prev.xbot)break;e.xtop!=e.prev.xbot&&this.SwapX(e);e.nextInLML=e.prev}else{if(e.ycurr==e.prev.ycurr)break;e.nextInLML=e.prev}e=e.next}var t=new et.LocalMinima;t.next=null;t.y=e.prev.ybot;if(e.dx==et.ClipperBase.horizontal){e.xbot!=e.prev.xbot&&this.SwapX(e);t.leftBound=e.prev;t.rightBound=e}else if(e.dx<e.prev.dx){t.leftBound=e.prev;t.rightBound=e}else{t.leftBound=e;t.rightBound=e.prev}t.leftBound.side=et.EdgeSide.esLeft;t.rightBound.side=et.EdgeSide.esRight;this.InsertLocalMinima(t);for(;e.next.ytop!=e.ytop||e.next.dx==et.ClipperBase.horizontal;){e.nextInLML=e.next;e=e.next;e.dx==et.ClipperBase.horizontal&&e.xbot!=e.prev.xtop&&this.SwapX(e)}return e.next};et.ClipperBase.prototype.InsertLocalMinima=function(e){if(null==this.m_MinimaList)this.m_MinimaList=e;else if(e.y>=this.m_MinimaList.y){e.next=this.m_MinimaList;this.m_MinimaList=e}else{for(var t=this.m_MinimaList;null!=t.next&&e.y<t.next.y;)t=t.next;e.next=t.next;t.next=e}};et.ClipperBase.prototype.PopLocalMinima=function(){null!=this.m_CurrentLM&&(this.m_CurrentLM=this.m_CurrentLM.next)};et.ClipperBase.prototype.SwapX=function(e){e.xcurr=e.xtop;e.xtop=e.xbot;e.xbot=e.xcurr};et.ClipperBase.prototype.Reset=function(){this.m_CurrentLM=this.m_MinimaList;for(var e=this.m_MinimaList;null!=e;){for(var t=e.leftBound;null!=t;){t.xcurr=t.xbot;t.ycurr=t.ybot;t.side=et.EdgeSide.esLeft;t.outIdx=-1;t=t.nextInLML}t=e.rightBound;for(;null!=t;){t.xcurr=t.xbot;t.ycurr=t.ybot;t.side=et.EdgeSide.esRight;t.outIdx=-1;t=t.nextInLML}e=e.next}};et.ClipperBase.prototype.GetBounds=function(){var e=new et.IntRect,t=this.m_MinimaList;if(null==t)return e;e.left=t.leftBound.xbot;e.top=t.leftBound.ybot;e.right=t.leftBound.xbot;e.bottom=t.leftBound.ybot;for(;null!=t;){t.leftBound.ybot>e.bottom&&(e.bottom=t.leftBound.ybot);for(var r=t.leftBound;;){for(var n=r;null!=r.nextInLML;){r.xbot<e.left&&(e.left=r.xbot);r.xbot>e.right&&(e.right=r.xbot);r=r.nextInLML}r.xbot<e.left&&(e.left=r.xbot);r.xbot>e.right&&(e.right=r.xbot);r.xtop<e.left&&(e.left=r.xtop);r.xtop>e.right&&(e.right=r.xtop);r.ytop<e.top&&(e.top=r.ytop);if(n!=t.leftBound)break;r=t.rightBound}t=t.next}return e};et.Clipper=function(){this.m_PolyOuts=null;this.m_ClipType=et.ClipType.ctIntersection;this.m_Scanbeam=null;this.m_ActiveEdges=null;this.m_SortedEdges=null;this.m_IntersectNodes=null;this.m_ExecuteLocked=!1;this.m_ClipFillType=et.PolyFillType.pftEvenOdd;this.m_SubjFillType=et.PolyFillType.pftEvenOdd;this.m_Joins=null;this.m_HorizJoins=null;this.m_ReverseOutput=!1;this.m_UsingExPolygons=!1;et.ClipperBase.call(this);this.m_Scanbeam=null;this.m_ActiveEdges=null;this.m_SortedEdges=null;this.m_IntersectNodes=null;this.m_ExecuteLocked=!1;this.m_PolyOuts=[];this.m_Joins=[];this.m_HorizJoins=[];this.m_ReverseOutput=!1;this.m_UsingExPolygons=!1};et.Clipper.prototype.Clear=function(){if(0!=this.m_edges.length){this.DisposeAllPolyPts();et.ClipperBase.prototype.Clear.call(this)}};et.Clipper.prototype.DisposeScanbeamList=function(){for(;null!=this.m_Scanbeam;){var e=this.m_Scanbeam.next;this.m_Scanbeam=null;this.m_Scanbeam=e}};et.Clipper.prototype.Reset=function(){et.ClipperBase.prototype.Reset.call(this);this.m_Scanbeam=null;this.m_ActiveEdges=null;this.m_SortedEdges=null;this.DisposeAllPolyPts();for(var e=this.m_MinimaList;null!=e;){this.InsertScanbeam(e.y);this.InsertScanbeam(e.leftBound.ytop);e=e.next}};et.Clipper.prototype.get_ReverseSolution=function(){return this.m_ReverseOutput};et.Clipper.prototype.set_ReverseSolution=function(e){this.m_ReverseOutput=e};et.Clipper.prototype.InsertScanbeam=function(e){var t;if(null==this.m_Scanbeam){this.m_Scanbeam=new et.Scanbeam;this.m_Scanbeam.next=null;this.m_Scanbeam.y=e}else if(e>this.m_Scanbeam.y){t=new et.Scanbeam;t.y=e;t.next=this.m_Scanbeam;this.m_Scanbeam=t}else{for(var r=this.m_Scanbeam;null!=r.next&&e<=r.next.y;)r=r.next;if(e==r.y)return;t=new et.Scanbeam;t.y=e;t.next=r.next;r.next=t}};et.Clipper.prototype.Execute=function(e,t,r,n){var i;if(2==arguments.length){r=et.PolyFillType.pftEvenOdd;n=et.PolyFillType.pftEvenOdd}if(void 0===t.exPolygons){if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0;et.Clear(t);this.m_SubjFillType=r;this.m_ClipFillType=n;this.m_ClipType=e;this.m_UsingExPolygons=!1;i=this.ExecuteInternal();i&&this.BuildResult(t);this.m_ExecuteLocked=!1;return i}if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0;et.Clear(t);this.m_SubjFillType=r;this.m_ClipFillType=n;this.m_ClipType=e;this.m_UsingExPolygons=!0;i=this.ExecuteInternal();i&&this.BuildResultEx(t);this.m_ExecuteLocked=!1;return i};et.Clipper.prototype.PolySort=function(e,t){if(e==t)return 0;if(null==e.pts||null==t.pts)return null==e.pts!=(null==t.pts)?null==e.pts?1:-1:0;var r,n;r=e.isHole?e.FirstLeft.idx:e.idx;n=t.isHole?t.FirstLeft.idx:t.idx;var i=r-n;return 0==i&&e.isHole!=t.isHole?e.isHole?1:-1:i};et.Clipper.prototype.FindAppendLinkEnd=function(e){for(;null!=e.AppendLink;)e=e.AppendLink;return e};et.Clipper.prototype.FixHoleLinkage=function(e){var t;t=null!=e.bottomPt?this.m_PolyOuts[e.bottomPt.idx].FirstLeft:e.FirstLeft;e==t&&et.Error("HoleLinkage error");if(null!=t){null!=t.AppendLink&&(t=this.FindAppendLinkEnd(t));if(t==e)t=null;else if(t.isHole){this.FixHoleLinkage(t);t=t.FirstLeft}}e.FirstLeft=t;null==t&&(e.isHole=!1);e.AppendLink=null};et.Clipper.prototype.ExecuteInternal=function(){var e;try{this.Reset();if(null==this.m_CurrentLM)return!0;var t=this.PopScanbeam();do{this.InsertLocalMinimaIntoAEL(t);et.Clear(this.m_HorizJoins);this.ProcessHorizontals();var r=this.PopScanbeam();e=this.ProcessIntersections(t,r);if(!e)break;this.ProcessEdgesAtTopOfScanbeam(r);t=r}while(null!=this.m_Scanbeam)}catch(t){e=!1}if(e){for(var n,i=0;i<this.m_PolyOuts.length;i++){n=this.m_PolyOuts[i];if(null!=n.pts){this.FixupOutPolygon(n);if(null!=n.pts){n.isHole&&this.m_UsingExPolygons&&this.FixHoleLinkage(n);(n.isHole^this.m_ReverseOutput)==this.Area(n,this.m_UseFullRange)>0&&this.ReversePolyPtLinks(n.pts)}}}this.JoinCommonEdges();this.m_UsingExPolygons&&this.m_PolyOuts.sort(this.PolySort)}et.Clear(this.m_Joins);et.Clear(this.m_HorizJoins);return e};et.Clipper.prototype.PopScanbeam=function(){var e=this.m_Scanbeam.y;this.m_Scanbeam;this.m_Scanbeam=this.m_Scanbeam.next;null;return e};et.Clipper.prototype.DisposeAllPolyPts=function(){for(var e=0;e<this.m_PolyOuts.length;++e)this.DisposeOutRec(e);et.Clear(this.m_PolyOuts)};et.Clipper.prototype.DisposeOutRec=function(e){var t=this.m_PolyOuts[e];null!=t.pts&&this.DisposeOutPts(t.pts);t=null;this.m_PolyOuts[e]=null};et.Clipper.prototype.DisposeOutPts=function(e){if(null!=e){e.prev.next=null;for(;null!=e;){e;e=e.next;null}}};et.Clipper.prototype.AddJoin=function(e,t,r,n){var i=new et.JoinRec;i.poly1Idx=r>=0?r:e.outIdx;i.pt1a=new et.IntPoint(e.xcurr,e.ycurr);i.pt1b=new et.IntPoint(e.xtop,e.ytop);i.poly2Idx=n>=0?n:t.outIdx;i.pt2a=new et.IntPoint(t.xcurr,t.ycurr);i.pt2b=new et.IntPoint(t.xtop,t.ytop);this.m_Joins.push(i)};et.Clipper.prototype.AddHorzJoin=function(e,t){var r=new et.HorzJoinRec;r.edge=e;r.savedIdx=t;this.m_HorizJoins.push(r)};et.Clipper.prototype.InsertLocalMinimaIntoAEL=function(e){for(var t,r;null!=this.m_CurrentLM&&this.m_CurrentLM.y==e;){var n=this.m_CurrentLM.leftBound,i=this.m_CurrentLM.rightBound;this.InsertEdgeIntoAEL(n);this.InsertScanbeam(n.ytop);this.InsertEdgeIntoAEL(i);if(this.IsEvenOddFillType(n)){n.windDelta=1;i.windDelta=1}else i.windDelta=-n.windDelta;this.SetWindingCount(n);i.windCnt=n.windCnt;i.windCnt2=n.windCnt2;if(i.dx==et.ClipperBase.horizontal){this.AddEdgeToSEL(i);this.InsertScanbeam(i.nextInLML.ytop)}else this.InsertScanbeam(i.ytop);this.IsContributing(n)&&this.AddLocalMinPoly(n,i,new et.IntPoint(n.xcurr,this.m_CurrentLM.y));if(i.outIdx>=0&&i.dx==et.ClipperBase.horizontal)for(var a=0;a<this.m_HorizJoins.length;a++){t=new et.IntPoint,r=new et.IntPoint;var o=this.m_HorizJoins[a];(function(){t={Value:t};r={Value:r};var e=this.GetOverlapSegment(new et.IntPoint(o.edge.xbot,o.edge.ybot),new et.IntPoint(o.edge.xtop,o.edge.ytop),new et.IntPoint(i.xbot,i.ybot),new et.IntPoint(i.xtop,i.ytop),t,r);t=t.Value;r=r.Value;return e}).call(this)&&this.AddJoin(o.edge,i,o.savedIdx,-1)}if(n.nextInAEL!=i){i.outIdx>=0&&i.prevInAEL.outIdx>=0&&this.SlopesEqual(i.prevInAEL,i,this.m_UseFullRange)&&this.AddJoin(i,i.prevInAEL,-1,-1);var s=n.nextInAEL;t=new et.IntPoint(n.xcurr,n.ycurr);for(;s!=i;){null==s&&et.Error("InsertLocalMinimaIntoAEL: missing rightbound!");this.IntersectEdges(i,s,t,et.Protects.ipNone);s=s.nextInAEL}}this.PopLocalMinima()}};et.Clipper.prototype.InsertEdgeIntoAEL=function(e){e.prevInAEL=null;e.nextInAEL=null;if(null==this.m_ActiveEdges)this.m_ActiveEdges=e;else if(this.E2InsertsBeforeE1(this.m_ActiveEdges,e)){e.nextInAEL=this.m_ActiveEdges;this.m_ActiveEdges.prevInAEL=e;this.m_ActiveEdges=e}else{for(var t=this.m_ActiveEdges;null!=t.nextInAEL&&!this.E2InsertsBeforeE1(t.nextInAEL,e);)t=t.nextInAEL;e.nextInAEL=t.nextInAEL;null!=t.nextInAEL&&(t.nextInAEL.prevInAEL=e);e.prevInAEL=t;t.nextInAEL=e}};et.Clipper.prototype.E2InsertsBeforeE1=function(e,t){return t.xcurr==e.xcurr?t.dx>e.dx:t.xcurr<e.xcurr};et.Clipper.prototype.IsEvenOddFillType=function(e){return e.polyType==et.PolyType.ptSubject?this.m_SubjFillType==et.PolyFillType.pftEvenOdd:this.m_ClipFillType==et.PolyFillType.pftEvenOdd};et.Clipper.prototype.IsEvenOddAltFillType=function(e){return e.polyType==et.PolyType.ptSubject?this.m_ClipFillType==et.PolyFillType.pftEvenOdd:this.m_SubjFillType==et.PolyFillType.pftEvenOdd};et.Clipper.prototype.IsContributing=function(e){var t,r;if(e.polyType==et.PolyType.ptSubject){t=this.m_SubjFillType;r=this.m_ClipFillType}else{t=this.m_ClipFillType;r=this.m_SubjFillType}switch(t){case et.PolyFillType.pftEvenOdd:case et.PolyFillType.pftNonZero:if(1!=et.Math_Abs_Int32(e.windCnt))return!1;break;case et.PolyFillType.pftPositive:if(1!=e.windCnt)return!1;break;default:if(-1!=e.windCnt)return!1}switch(this.m_ClipType){case et.ClipType.ctIntersection:switch(r){case et.PolyFillType.pftEvenOdd:case et.PolyFillType.pftNonZero:return 0!=e.windCnt2;case et.PolyFillType.pftPositive:return e.windCnt2>0;default:return e.windCnt2<0}break;case et.ClipType.ctUnion:switch(r){case et.PolyFillType.pftEvenOdd:case et.PolyFillType.pftNonZero:return 0==e.windCnt2;case et.PolyFillType.pftPositive:return e.windCnt2<=0;default:return e.windCnt2>=0}break;case et.ClipType.ctDifference:if(e.polyType==et.PolyType.ptSubject)switch(r){case et.PolyFillType.pftEvenOdd:case et.PolyFillType.pftNonZero:return 0==e.windCnt2;case et.PolyFillType.pftPositive:return e.windCnt2<=0;default:return e.windCnt2>=0}else switch(r){case et.PolyFillType.pftEvenOdd:case et.PolyFillType.pftNonZero:return 0!=e.windCnt2;case et.PolyFillType.pftPositive:return e.windCnt2>0;default:return e.windCnt2<0}}return!0};et.Clipper.prototype.SetWindingCount=function(e){for(var t=e.prevInAEL;null!=t&&t.polyType!=e.polyType;)t=t.prevInAEL;if(null==t){e.windCnt=e.windDelta;e.windCnt2=0;t=this.m_ActiveEdges}else if(this.IsEvenOddFillType(e)){e.windCnt=1;e.windCnt2=t.windCnt2;t=t.nextInAEL}else{t.windCnt*t.windDelta<0?et.Math_Abs_Int32(t.windCnt)>1?t.windDelta*e.windDelta<0?e.windCnt=t.windCnt:e.windCnt=t.windCnt+e.windDelta:e.windCnt=t.windCnt+t.windDelta+e.windDelta:et.Math_Abs_Int32(t.windCnt)>1&&t.windDelta*e.windDelta<0?e.windCnt=t.windCnt:t.windCnt+e.windDelta==0?e.windCnt=t.windCnt:e.windCnt=t.windCnt+e.windDelta;e.windCnt2=t.windCnt2;t=t.nextInAEL}if(this.IsEvenOddAltFillType(e))for(;t!=e;){e.windCnt2=0==e.windCnt2?1:0;t=t.nextInAEL}else for(;t!=e;){e.windCnt2+=t.windDelta;t=t.nextInAEL}};et.Clipper.prototype.AddEdgeToSEL=function(e){if(null==this.m_SortedEdges){this.m_SortedEdges=e;e.prevInSEL=null;e.nextInSEL=null}else{e.nextInSEL=this.m_SortedEdges;e.prevInSEL=null;this.m_SortedEdges.prevInSEL=e;this.m_SortedEdges=e}};et.Clipper.prototype.CopyAELToSEL=function(){var e=this.m_ActiveEdges;this.m_SortedEdges=e;if(null!=this.m_ActiveEdges){this.m_SortedEdges.prevInSEL=null;e=e.nextInAEL;for(;null!=e;){e.prevInSEL=e.prevInAEL;e.prevInSEL.nextInSEL=e;e.nextInSEL=null;e=e.nextInAEL}}};et.Clipper.prototype.SwapPositionsInAEL=function(e,t){var r,n;if(!(null==e.nextInAEL&&null==e.prevInAEL||null==t.nextInAEL&&null==t.prevInAEL)){if(e.nextInAEL==t){r=t.nextInAEL;null!=r&&(r.prevInAEL=e);n=e.prevInAEL;null!=n&&(n.nextInAEL=t);t.prevInAEL=n;t.nextInAEL=e;e.prevInAEL=t;e.nextInAEL=r}else if(t.nextInAEL==e){r=e.nextInAEL;null!=r&&(r.prevInAEL=t);n=t.prevInAEL;null!=n&&(n.nextInAEL=e);e.prevInAEL=n;e.nextInAEL=t;t.prevInAEL=e;t.nextInAEL=r}else{r=e.nextInAEL;n=e.prevInAEL;e.nextInAEL=t.nextInAEL;null!=e.nextInAEL&&(e.nextInAEL.prevInAEL=e);e.prevInAEL=t.prevInAEL;null!=e.prevInAEL&&(e.prevInAEL.nextInAEL=e);t.nextInAEL=r;null!=t.nextInAEL&&(t.nextInAEL.prevInAEL=t);t.prevInAEL=n;null!=t.prevInAEL&&(t.prevInAEL.nextInAEL=t)}null==e.prevInAEL?this.m_ActiveEdges=e:null==t.prevInAEL&&(this.m_ActiveEdges=t)}};et.Clipper.prototype.SwapPositionsInSEL=function(e,t){var r,n;if(!(null==e.nextInSEL&&null==e.prevInSEL||null==t.nextInSEL&&null==t.prevInSEL)){if(e.nextInSEL==t){r=t.nextInSEL;null!=r&&(r.prevInSEL=e);n=e.prevInSEL;null!=n&&(n.nextInSEL=t);t.prevInSEL=n;t.nextInSEL=e;e.prevInSEL=t;e.nextInSEL=r}else if(t.nextInSEL==e){r=e.nextInSEL;null!=r&&(r.prevInSEL=t);n=t.prevInSEL;null!=n&&(n.nextInSEL=e);e.prevInSEL=n;e.nextInSEL=t;t.prevInSEL=e;t.nextInSEL=r}else{r=e.nextInSEL;n=e.prevInSEL;e.nextInSEL=t.nextInSEL;null!=e.nextInSEL&&(e.nextInSEL.prevInSEL=e);e.prevInSEL=t.prevInSEL;null!=e.prevInSEL&&(e.prevInSEL.nextInSEL=e);t.nextInSEL=r;null!=t.nextInSEL&&(t.nextInSEL.prevInSEL=t);t.prevInSEL=n;null!=t.prevInSEL&&(t.prevInSEL.nextInSEL=t)}null==e.prevInSEL?this.m_SortedEdges=e:null==t.prevInSEL&&(this.m_SortedEdges=t)}};et.Clipper.prototype.AddLocalMaxPoly=function(e,t,r){this.AddOutPt(e,r);if(e.outIdx==t.outIdx){e.outIdx=-1;t.outIdx=-1}else e.outIdx<t.outIdx?this.AppendPolygon(e,t):this.AppendPolygon(t,e)};et.Clipper.prototype.AddLocalMinPoly=function(e,t,r){var n,i;if(t.dx==et.ClipperBase.horizontal||e.dx>t.dx){this.AddOutPt(e,r);t.outIdx=e.outIdx;e.side=et.EdgeSide.esLeft;t.side=et.EdgeSide.esRight;n=e;i=n.prevInAEL==t?t.prevInAEL:n.prevInAEL}else{this.AddOutPt(t,r);e.outIdx=t.outIdx;e.side=et.EdgeSide.esRight;t.side=et.EdgeSide.esLeft;n=t;i=n.prevInAEL==e?e.prevInAEL:n.prevInAEL}null!=i&&i.outIdx>=0&&et.Clipper.TopX(i,r.y)==et.Clipper.TopX(n,r.y)&&this.SlopesEqual(n,i,this.m_UseFullRange)&&this.AddJoin(n,i,-1,-1)};et.Clipper.prototype.CreateOutRec=function(){var e=new et.OutRec;e.idx=-1;e.isHole=!1;e.FirstLeft=null;e.AppendLink=null;e.pts=null;e.bottomPt=null;return e};et.Clipper.prototype.AddOutPt=function(e,t){var r,n,i=e.side==et.EdgeSide.esLeft;if(e.outIdx<0){r=this.CreateOutRec();this.m_PolyOuts.push(r);r.idx=this.m_PolyOuts.length-1;e.outIdx=r.idx;n=new et.OutPt;r.pts=n;r.bottomPt=n;n.pt=t;n.idx=r.idx;n.next=n;n.prev=n;this.SetHoleState(e,r)}else{r=this.m_PolyOuts[e.outIdx];n=r.pts;var a;if(i&&et.ClipperBase.PointsEqual(t,n.pt)||!i&&et.ClipperBase.PointsEqual(t,n.prev.pt))return;a=new et.OutPt;a.pt=t;a.idx=r.idx;a.pt.y==r.bottomPt.pt.y&&a.pt.x<r.bottomPt.pt.x&&(r.bottomPt=a);a.next=n;a.prev=n.prev;a.prev.next=a;n.prev=a;i&&(r.pts=a)}};et.Clipper.prototype.SwapPoints=function(e,t){var r=e.Value;e.Value=t.Value;t.Value=r};et.Clipper.prototype.GetOverlapSegment=function(e,t,r,n,i,a){if(et.Math_Abs_Int64(e.x-t.x)>et.Math_Abs_Int64(e.y-t.y)){e.x>t.x&&function(){e={Value:e};t={Value:t};var r=this.SwapPoints(e,t);e=e.Value;t=t.Value;return r}.call(this);r.x>n.x&&function(){r={Value:r};n={Value:n};var e=this.SwapPoints(r,n);r=r.Value;n=n.Value;return e}.call(this);e.x>r.x?i.Value=e:i.Value=r;t.x<n.x?a.Value=t:a.Value=n;return i.Value.x<a.Value.x}e.y<t.y&&function(){e={Value:e};t={Value:t};var r=this.SwapPoints(e,t);e=e.Value;t=t.Value;return r}.call(this);r.y<n.y&&function(){r={Value:r};n={Value:n};var e=this.SwapPoints(r,n);r=r.Value;n=n.Value;return e}.call(this);e.y<r.y?i.Value=e:i.Value=r;t.y>n.y?a.Value=t:a.Value=n;return i.Value.y>a.Value.y};et.Clipper.prototype.FindSegment=function(e,t,r,n){if(null==e.Value)return!1;var i=e.Value,a=new et.IntPoint(r.Value),o=new et.IntPoint(n.Value);do{if(this.SlopesEqual(a,o,e.Value.pt,e.Value.prev.pt,t)&&this.SlopesEqual(a,o,e.Value.pt,t)&&this.GetOverlapSegment(a,o,e.Value.pt,e.Value.prev.pt,r,n))return!0;e.Value=e.Value.next}while(e.Value!=i);return!1};et.Clipper.prototype.Pt3IsBetweenPt1AndPt2=function(e,t,r){return!(!et.ClipperBase.PointsEqual(e,r)&&!et.ClipperBase.PointsEqual(t,r))||(e.x!=t.x?e.x<r.x==r.x<t.x:e.y<r.y==r.y<t.y)};et.Clipper.prototype.InsertPolyPtBetween=function(e,t,r){var n=new et.OutPt;n.pt=r;if(t==e.next){e.next=n;t.prev=n;n.next=t;n.prev=e}else{t.next=n;e.prev=n;n.next=e;n.prev=t}return n};et.Clipper.prototype.SetHoleState=function(e,t){for(var r=!1,n=e.prevInAEL;null!=n;){if(n.outIdx>=0){r=!r;null==t.FirstLeft&&(t.FirstLeft=this.m_PolyOuts[n.outIdx])}n=n.prevInAEL}r&&(t.isHole=!0)};et.Clipper.prototype.GetDx=function(e,t){return e.y==t.y?et.ClipperBase.horizontal:(t.x-e.x)/(t.y-e.y)};et.Clipper.prototype.FirstIsBottomPt=function(e,t){for(var r=e.prev;et.ClipperBase.PointsEqual(r.pt,e.pt)&&r!=e;)r=r.prev;var n=et.Math_Abs_Double(this.GetDx(e.pt,r.pt));r=e.next;for(;et.ClipperBase.PointsEqual(r.pt,e.pt)&&r!=e;)r=r.next;var i=et.Math_Abs_Double(this.GetDx(e.pt,r.pt));r=t.prev;for(;et.ClipperBase.PointsEqual(r.pt,t.pt)&&r!=t;)r=r.prev;var a=et.Math_Abs_Double(this.GetDx(t.pt,r.pt));r=t.next;for(;et.ClipperBase.PointsEqual(r.pt,t.pt)&&r!=t;)r=r.next;var o=et.Math_Abs_Double(this.GetDx(t.pt,r.pt));return n>=a&&n>=o||i>=a&&i>=o};et.Clipper.prototype.GetBottomPt=function(e){for(var t=null,r=e.next;r!=e;){if(r.pt.y>e.pt.y){e=r;t=null}else if(r.pt.y==e.pt.y&&r.pt.x<=e.pt.x)if(r.pt.x<e.pt.x){t=null;e=r}else r.next!=e&&r.prev!=e&&(t=r);r=r.next}if(null!=t)for(;t!=r;){this.FirstIsBottomPt(r,t)||(e=t);t=t.next;for(;!et.ClipperBase.PointsEqual(t.pt,e.pt);)t=t.next}return e};et.Clipper.prototype.GetLowermostRec=function(e,t){var r=e.bottomPt,n=t.bottomPt;return r.pt.y>n.pt.y?e:r.pt.y<n.pt.y?t:r.pt.x<n.pt.x?e:r.pt.x>n.pt.x?t:r.next==r?t:n.next==n?e:this.FirstIsBottomPt(r,n)?e:t};et.Clipper.prototype.Param1RightOfParam2=function(e,t){do{e=e.FirstLeft;if(e==t)return!0}while(null!=e);return!1};et.Clipper.prototype.AppendPolygon=function(e,t){var r,n=this.m_PolyOuts[e.outIdx],i=this.m_PolyOuts[t.outIdx];r=this.Param1RightOfParam2(n,i)?i:this.Param1RightOfParam2(i,n)?n:this.GetLowermostRec(n,i);var a,o,s=n.pts,l=s.prev,c=i.pts,d=c.prev;if(e.side==et.EdgeSide.esLeft){if(t.side==et.EdgeSide.esLeft){this.ReversePolyPtLinks(c);c.next=s;s.prev=c;l.next=d;d.prev=l;n.pts=d}else{d.next=s;s.prev=d;c.prev=l;l.next=c;n.pts=c}a=et.EdgeSide.esLeft}else{if(t.side==et.EdgeSide.esRight){this.ReversePolyPtLinks(c);l.next=d;d.prev=l;c.next=s;s.prev=c}else{l.next=c;c.prev=l;s.prev=d;d.next=s}a=et.EdgeSide.esRight}if(r==i){n.bottomPt=i.bottomPt;n.bottomPt.idx=n.idx;i.FirstLeft!=n&&(n.FirstLeft=i.FirstLeft);n.isHole=i.isHole}i.pts=null;i.bottomPt=null;i.AppendLink=n;var h=e.outIdx,u=t.outIdx;e.outIdx=-1;t.outIdx=-1;for(var p=this.m_ActiveEdges;null!=p;){if(p.outIdx==u){p.outIdx=h;p.side=a;break}p=p.nextInAEL}for(o=0;o<this.m_Joins.length;++o){this.m_Joins[o].poly1Idx==u&&(this.m_Joins[o].poly1Idx=h);this.m_Joins[o].poly2Idx==u&&(this.m_Joins[o].poly2Idx=h)}for(o=0;o<this.m_HorizJoins.length;++o)this.m_HorizJoins[o].savedIdx==u&&(this.m_HorizJoins[o].savedIdx=h)};et.Clipper.prototype.ReversePolyPtLinks=function(e){if(null!=e){var t,r;t=e;do{r=t.next;t.next=t.prev;t.prev=r;t=r}while(t!=e)}};et.Clipper.SwapSides=function(e,t){var r=e.side;e.side=t.side;t.side=r};et.Clipper.SwapPolyIndexes=function(e,t){var r=e.outIdx;e.outIdx=t.outIdx;t.outIdx=r};et.Clipper.prototype.DoEdge1=function(e,t,r){this.AddOutPt(e,r);et.Clipper.SwapSides(e,t);et.Clipper.SwapPolyIndexes(e,t)};et.Clipper.prototype.DoEdge2=function(e,t,r){this.AddOutPt(t,r);et.Clipper.SwapSides(e,t);et.Clipper.SwapPolyIndexes(e,t)};et.Clipper.prototype.DoBothEdges=function(e,t,r){this.AddOutPt(e,r);this.AddOutPt(t,r);et.Clipper.SwapSides(e,t);et.Clipper.SwapPolyIndexes(e,t)};et.Clipper.prototype.IntersectEdges=function(e,t,r,n){var i=0==(et.Protects.ipLeft&n)&&null==e.nextInLML&&e.xtop==r.x&&e.ytop==r.y,a=0==(et.Protects.ipRight&n)&&null==t.nextInLML&&t.xtop==r.x&&t.ytop==r.y,o=e.outIdx>=0,s=t.outIdx>=0;if(e.polyType==t.polyType)if(this.IsEvenOddFillType(e)){var l=e.windCnt;e.windCnt=t.windCnt;t.windCnt=l}else{e.windCnt+t.windDelta==0?e.windCnt=-e.windCnt:e.windCnt+=t.windDelta;t.windCnt-e.windDelta==0?t.windCnt=-t.windCnt:t.windCnt-=e.windDelta}else{this.IsEvenOddFillType(t)?e.windCnt2=0==e.windCnt2?1:0:e.windCnt2+=t.windDelta;this.IsEvenOddFillType(e)?t.windCnt2=0==t.windCnt2?1:0:t.windCnt2-=e.windDelta}var c,d,h,u;if(e.polyType==et.PolyType.ptSubject){c=this.m_SubjFillType;h=this.m_ClipFillType}else{c=this.m_ClipFillType;h=this.m_SubjFillType}if(t.polyType==et.PolyType.ptSubject){d=this.m_SubjFillType;u=this.m_ClipFillType}else{d=this.m_ClipFillType;u=this.m_SubjFillType}var p,f;switch(c){case et.PolyFillType.pftPositive:p=e.windCnt;break;case et.PolyFillType.pftNegative:p=-e.windCnt;break;default:p=et.Math_Abs_Int32(e.windCnt)}switch(d){case et.PolyFillType.pftPositive:f=t.windCnt;break;case et.PolyFillType.pftNegative:f=-t.windCnt;break;default:f=et.Math_Abs_Int32(t.windCnt)}if(o&&s)i||a||0!=p&&1!=p||0!=f&&1!=f||e.polyType!=t.polyType&&this.m_ClipType!=et.ClipType.ctXor?this.AddLocalMaxPoly(e,t,r):this.DoBothEdges(e,t,r);else if(o)0!=f&&1!=f||this.m_ClipType==et.ClipType.ctIntersection&&t.polyType!=et.PolyType.ptSubject&&0==t.windCnt2||this.DoEdge1(e,t,r);else if(s)0!=p&&1!=p||this.m_ClipType==et.ClipType.ctIntersection&&e.polyType!=et.PolyType.ptSubject&&0==e.windCnt2||this.DoEdge2(e,t,r);else if(!(0!=p&&1!=p||0!=f&&1!=f||i||a)){var g,y;switch(h){case et.PolyFillType.pftPositive:g=e.windCnt2;break;case et.PolyFillType.pftNegative:g=-e.windCnt2;break;default:g=et.Math_Abs_Int32(e.windCnt2)}switch(u){case et.PolyFillType.pftPositive:y=t.windCnt2;break;case et.PolyFillType.pftNegative:y=-t.windCnt2;break;default:y=et.Math_Abs_Int32(t.windCnt2)}if(e.polyType!=t.polyType)this.AddLocalMinPoly(e,t,r);else if(1==p&&1==f)switch(this.m_ClipType){case et.ClipType.ctIntersection:g>0&&y>0&&this.AddLocalMinPoly(e,t,r);break;case et.ClipType.ctUnion:g<=0&&y<=0&&this.AddLocalMinPoly(e,t,r);break;case et.ClipType.ctDifference:(e.polyType==et.PolyType.ptClip&&g>0&&y>0||e.polyType==et.PolyType.ptSubject&&g<=0&&y<=0)&&this.AddLocalMinPoly(e,t,r);break;case et.ClipType.ctXor:this.AddLocalMinPoly(e,t,r)}else et.Clipper.SwapSides(e,t)}if(i!=a&&(i&&e.outIdx>=0||a&&t.outIdx>=0)){et.Clipper.SwapSides(e,t);et.Clipper.SwapPolyIndexes(e,t)}i&&this.DeleteFromAEL(e);a&&this.DeleteFromAEL(t)};et.Clipper.prototype.DeleteFromAEL=function(e){var t=e.prevInAEL,r=e.nextInAEL;if(null!=t||null!=r||e==this.m_ActiveEdges){null!=t?t.nextInAEL=r:this.m_ActiveEdges=r;null!=r&&(r.prevInAEL=t);e.nextInAEL=null;e.prevInAEL=null}};et.Clipper.prototype.DeleteFromSEL=function(e){var t=e.prevInSEL,r=e.nextInSEL;if(null!=t||null!=r||e==this.m_SortedEdges){null!=t?t.nextInSEL=r:this.m_SortedEdges=r;null!=r&&(r.prevInSEL=t);e.nextInSEL=null;e.prevInSEL=null}};et.Clipper.prototype.UpdateEdgeIntoAEL=function(e){null==e.Value.nextInLML&&et.Error("UpdateEdgeIntoAEL: invalid call");var t=e.Value.prevInAEL,r=e.Value.nextInAEL;e.Value.nextInLML.outIdx=e.Value.outIdx;null!=t?t.nextInAEL=e.Value.nextInLML:this.m_ActiveEdges=e.Value.nextInLML;null!=r&&(r.prevInAEL=e.Value.nextInLML);e.Value.nextInLML.side=e.Value.side;e.Value.nextInLML.windDelta=e.Value.windDelta;e.Value.nextInLML.windCnt=e.Value.windCnt;e.Value.nextInLML.windCnt2=e.Value.windCnt2;e.Value=e.Value.nextInLML;e.Value.prevInAEL=t;e.Value.nextInAEL=r;e.Value.dx!=et.ClipperBase.horizontal&&this.InsertScanbeam(e.Value.ytop)};et.Clipper.prototype.ProcessHorizontals=function(){for(var e=this.m_SortedEdges;null!=e;){this.DeleteFromSEL(e);this.ProcessHorizontal(e);e=this.m_SortedEdges}};et.Clipper.prototype.ProcessHorizontal=function(e){var t,r,n;if(e.xcurr<e.xtop){r=e.xcurr;n=e.xtop;t=et.Direction.dLeftToRight}else{r=e.xtop;n=e.xcurr;t=et.Direction.dRightToLeft}var i;i=null!=e.nextInLML?null:this.GetMaximaPair(e);for(var a=this.GetNextInAEL(e,t);null!=a;){var o=this.GetNextInAEL(a,t);if(null!=i||t==et.Direction.dLeftToRight&&a.xcurr<=n||t==et.Direction.dRightToLeft&&a.xcurr>=r){if(a.xcurr==e.xtop&&null==i){if(this.SlopesEqual(a,e.nextInLML,this.m_UseFullRange)){e.outIdx>=0&&a.outIdx>=0&&this.AddJoin(e.nextInLML,a,e.outIdx,-1);break}if(a.dx<e.nextInLML.dx)break}if(a==i){
t==et.Direction.dLeftToRight?this.IntersectEdges(e,a,new et.IntPoint(a.xcurr,e.ycurr),0):this.IntersectEdges(a,e,new et.IntPoint(a.xcurr,e.ycurr),0);i.outIdx>=0&&et.Error("ProcessHorizontal error");return}a.dx!=et.ClipperBase.horizontal||this.IsMinima(a)||(a.xcurr,a.xtop),t==et.Direction.dLeftToRight?this.IntersectEdges(e,a,new et.IntPoint(a.xcurr,e.ycurr),this.IsTopHorz(e,a.xcurr)?et.Protects.ipLeft:et.Protects.ipBoth):this.IntersectEdges(a,e,new et.IntPoint(a.xcurr,e.ycurr),this.IsTopHorz(e,a.xcurr)?et.Protects.ipRight:et.Protects.ipBoth);this.SwapPositionsInAEL(e,a)}else if(t==et.Direction.dLeftToRight&&a.xcurr>n&&null==e.nextInSEL||t==et.Direction.dRightToLeft&&a.xcurr<r&&null==e.nextInSEL)break;a=o}if(null!=e.nextInLML){e.outIdx>=0&&this.AddOutPt(e,new et.IntPoint(e.xtop,e.ytop));(function(){e={Value:e};var t=this.UpdateEdgeIntoAEL(e);e=e.Value;return t}).call(this)}else{e.outIdx>=0&&this.IntersectEdges(e,i,new et.IntPoint(e.xtop,e.ycurr),et.Protects.ipBoth);this.DeleteFromAEL(i);this.DeleteFromAEL(e)}};et.Clipper.prototype.IsTopHorz=function(e,t){for(var r=this.m_SortedEdges;null!=r;){if(t>=Math.min(r.xcurr,r.xtop)&&t<=Math.max(r.xcurr,r.xtop))return!1;r=r.nextInSEL}return!0};et.Clipper.prototype.GetNextInAEL=function(e,t){return t==et.Direction.dLeftToRight?e.nextInAEL:e.prevInAEL};et.Clipper.prototype.IsMinima=function(e){return null!=e&&e.prev.nextInLML!=e&&e.next.nextInLML!=e};et.Clipper.prototype.IsMaxima=function(e,t){return null!=e&&e.ytop==t&&null==e.nextInLML};et.Clipper.prototype.IsIntermediate=function(e,t){return e.ytop==t&&null!=e.nextInLML};et.Clipper.prototype.GetMaximaPair=function(e){return this.IsMaxima(e.next,e.ytop)&&e.next.xtop==e.xtop?e.next:e.prev};et.Clipper.prototype.ProcessIntersections=function(e,t){if(null==this.m_ActiveEdges)return!0;try{this.BuildIntersectList(e,t);if(null==this.m_IntersectNodes)return!0;if(!this.FixupIntersections())return!1;this.ProcessIntersectList()}catch(e){this.m_SortedEdges=null;this.DisposeIntersectNodes();et.Error("ProcessIntersections error")}return!0};et.Clipper.prototype.BuildIntersectList=function(e,t){if(null!=this.m_ActiveEdges){var r=this.m_ActiveEdges;r.tmpX=et.Clipper.TopX(r,t);this.m_SortedEdges=r;this.m_SortedEdges.prevInSEL=null;r=r.nextInAEL;for(;null!=r;){r.prevInSEL=r.prevInAEL;r.prevInSEL.nextInSEL=r;r.nextInSEL=null;r.tmpX=et.Clipper.TopX(r,t);r=r.nextInAEL}for(var n=!0;n&&null!=this.m_SortedEdges;){n=!1;r=this.m_SortedEdges;for(;null!=r.nextInSEL;){var i=r.nextInSEL,a=new et.IntPoint;if(r.tmpX>i.tmpX&&function(){a={Value:a};var e=this.IntersectPoint(r,i,a);a=a.Value;return e}.call(this)){if(a.y>e){a.y=e;a.x=et.Clipper.TopX(r,a.y)}this.AddIntersectNode(r,i,a);this.SwapPositionsInSEL(r,i);n=!0}else r=i}if(null==r.prevInSEL)break;r.prevInSEL.nextInSEL=null}this.m_SortedEdges=null}};et.Clipper.prototype.FixupIntersections=function(){if(null==this.m_IntersectNodes.next)return!0;this.CopyAELToSEL();for(var e=this.m_IntersectNodes,t=this.m_IntersectNodes.next;null!=t;){var r,n=e.edge1;if(n.prevInSEL==e.edge2)r=n.prevInSEL;else if(n.nextInSEL==e.edge2)r=n.nextInSEL;else{for(;null!=t&&t.edge1.nextInSEL!=t.edge2&&t.edge1.prevInSEL!=t.edge2;)t=t.next;if(null==t)return!1;this.SwapIntersectNodes(e,t);n=e.edge1;r=e.edge2}this.SwapPositionsInSEL(n,r);e=e.next;t=e.next}this.m_SortedEdges=null;return e.edge1.prevInSEL==e.edge2||e.edge1.nextInSEL==e.edge2};et.Clipper.prototype.ProcessIntersectList=function(){for(;null!=this.m_IntersectNodes;){var e=this.m_IntersectNodes.next;this.IntersectEdges(this.m_IntersectNodes.edge1,this.m_IntersectNodes.edge2,this.m_IntersectNodes.pt,et.Protects.ipBoth);this.SwapPositionsInAEL(this.m_IntersectNodes.edge1,this.m_IntersectNodes.edge2);this.m_IntersectNodes=null;this.m_IntersectNodes=e}};var ut=function(e){return e<0?Math.ceil(e-.5):Math.round(e)},pt=function(e){return e<0?Math.ceil(e-.5):Math.floor(e+.5)},ft=function(e){return e<0?-Math.round(Math.abs(e)):Math.round(e)},gt=function(e){if(e<0){e-=.5;return e<-2147483648?Math.ceil(e):0|e}e+=.5;return e>2147483647?Math.floor(e):0|e};it.msie?et.Clipper.Round=ut:it.chromium?et.Clipper.Round=ft:it.safari?et.Clipper.Round=gt:et.Clipper.Round=pt;et.Clipper.TopX=function(e,t){return t==e.ytop?e.xtop:e.xbot+et.Clipper.Round(e.dx*(t-e.ybot))};et.Clipper.prototype.AddIntersectNode=function(e,t,r){var n=new et.IntersectNode;n.edge1=e;n.edge2=t;n.pt=r;n.next=null;if(null==this.m_IntersectNodes)this.m_IntersectNodes=n;else if(this.ProcessParam1BeforeParam2(n,this.m_IntersectNodes)){n.next=this.m_IntersectNodes;this.m_IntersectNodes=n}else{for(var i=this.m_IntersectNodes;null!=i.next&&this.ProcessParam1BeforeParam2(i.next,n);)i=i.next;n.next=i.next;i.next=n}};et.Clipper.prototype.ProcessParam1BeforeParam2=function(e,t){var r;if(e.pt.y==t.pt.y){if(e.edge1==t.edge1||e.edge2==t.edge1){r=t.pt.x>e.pt.x;return t.edge1.dx>0?!r:r}if(e.edge1==t.edge2||e.edge2==t.edge2){r=t.pt.x>e.pt.x;return t.edge2.dx>0?!r:r}return t.pt.x>e.pt.x}return e.pt.y>t.pt.y};et.Clipper.prototype.SwapIntersectNodes=function(e,t){var r=e.edge1,n=e.edge2,i=e.pt;e.edge1=t.edge1;e.edge2=t.edge2;e.pt=t.pt;t.edge1=r;t.edge2=n;t.pt=i};et.Clipper.prototype.IntersectPoint=function(e,t,r){var n,i;if(this.SlopesEqual(e,t,this.m_UseFullRange))return!1;if(0==e.dx){r.Value.x=e.xbot;if(t.dx==et.ClipperBase.horizontal)r.Value.y=t.ybot;else{i=t.ybot-t.xbot/t.dx;r.Value.y=et.Clipper.Round(r.Value.x/t.dx+i)}}else if(0==t.dx){r.Value.x=t.xbot;if(e.dx==et.ClipperBase.horizontal)r.Value.y=e.ybot;else{n=e.ybot-e.xbot/e.dx;r.Value.y=et.Clipper.Round(r.Value.x/e.dx+n)}}else{n=e.xbot-e.ybot*e.dx;i=t.xbot-t.ybot*t.dx;var a=(i-n)/(e.dx-t.dx);r.Value.y=et.Clipper.Round(a);et.Math_Abs_Double(e.dx)<et.Math_Abs_Double(t.dx)?r.Value.x=et.Clipper.Round(e.dx*a+n):r.Value.x=et.Clipper.Round(t.dx*a+i)}if(r.Value.y<e.ytop||r.Value.y<t.ytop){if(e.ytop>t.ytop){r.Value.x=e.xtop;r.Value.y=e.ytop;return et.Clipper.TopX(t,e.ytop)<e.xtop}r.Value.x=t.xtop;r.Value.y=t.ytop;return et.Clipper.TopX(e,t.ytop)>t.xtop}return!0};et.Clipper.prototype.DisposeIntersectNodes=function(){for(;null!=this.m_IntersectNodes;){var e=this.m_IntersectNodes.next;this.m_IntersectNodes=null;this.m_IntersectNodes=e}};et.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(e){for(var t,r=this.m_ActiveEdges;null!=r;)if(this.IsMaxima(r,e)&&this.GetMaximaPair(r).dx!=et.ClipperBase.horizontal){t=r.prevInAEL;this.DoMaxima(r,e);r=null==t?this.m_ActiveEdges:t.nextInAEL}else{if(this.IsIntermediate(r,e)&&r.nextInLML.dx==et.ClipperBase.horizontal){if(r.outIdx>=0){this.AddOutPt(r,new et.IntPoint(r.xtop,r.ytop));for(var n=0;n<this.m_HorizJoins.length;++n){var i=new et.IntPoint,a=new et.IntPoint,o=this.m_HorizJoins[n];(function(){i={Value:i};a={Value:a};var e=this.GetOverlapSegment(new et.IntPoint(o.edge.xbot,o.edge.ybot),new et.IntPoint(o.edge.xtop,o.edge.ytop),new et.IntPoint(r.nextInLML.xbot,r.nextInLML.ybot),new et.IntPoint(r.nextInLML.xtop,r.nextInLML.ytop),i,a);i=i.Value;a=a.Value;return e}).call(this)&&this.AddJoin(o.edge,r.nextInLML,o.savedIdx,r.outIdx)}this.AddHorzJoin(r.nextInLML,r.outIdx)}(function(){r={Value:r};var e=this.UpdateEdgeIntoAEL(r);r=r.Value;return e}).call(this);this.AddEdgeToSEL(r)}else{r.xcurr=et.Clipper.TopX(r,e);r.ycurr=e}r=r.nextInAEL}this.ProcessHorizontals();r=this.m_ActiveEdges;for(;null!=r;){if(this.IsIntermediate(r,e)){r.outIdx>=0&&this.AddOutPt(r,new et.IntPoint(r.xtop,r.ytop));(function(){r={Value:r};var e=this.UpdateEdgeIntoAEL(r);r=r.Value;return e}).call(this);t=r.prevInAEL;var s=r.nextInAEL;if(null!=t&&t.xcurr==r.xbot&&t.ycurr==r.ybot&&r.outIdx>=0&&t.outIdx>=0&&t.ycurr>t.ytop&&this.SlopesEqual(r,t,this.m_UseFullRange)){this.AddOutPt(t,new et.IntPoint(r.xbot,r.ybot));this.AddJoin(r,t,-1,-1)}else if(null!=s&&s.xcurr==r.xbot&&s.ycurr==r.ybot&&r.outIdx>=0&&s.outIdx>=0&&s.ycurr>s.ytop&&this.SlopesEqual(r,s,this.m_UseFullRange)){this.AddOutPt(s,new et.IntPoint(r.xbot,r.ybot));this.AddJoin(r,s,-1,-1)}}r=r.nextInAEL}};et.Clipper.prototype.DoMaxima=function(e,t){for(var r=this.GetMaximaPair(e),n=e.xtop,i=e.nextInAEL;i!=r;){null==i&&et.Error("DoMaxima error");this.IntersectEdges(e,i,new et.IntPoint(n,t),et.Protects.ipBoth);i=i.nextInAEL}if(e.outIdx<0&&r.outIdx<0){this.DeleteFromAEL(e);this.DeleteFromAEL(r)}else e.outIdx>=0&&r.outIdx>=0?this.IntersectEdges(e,r,new et.IntPoint(n,t),et.Protects.ipNone):et.Error("DoMaxima error")};et.Clipper.ReversePolygons=function(e){for(var t=e.length,r=0;r<t;r++)e[r]instanceof Array&&e[r].reverse()};et.Clipper.Orientation=function(e){return this.Area(e)>=0};et.Clipper.prototype.PointCount=function(e){if(null==e)return 0;var t=0,r=e;do{t++;r=r.next}while(r!=e);return t};et.Clipper.prototype.BuildResult=function(e){et.Clear(e);for(var t,r=this.m_PolyOuts.length,n=0;n<r;n++){t=this.m_PolyOuts[n];if(null!=t.pts){var i=t.pts,a=this.PointCount(i);if(!(a<3)){for(var o=new et.Polygon(a),s=0;s<a;s++){o.push(new et.IntPoint(i.pt.x,i.pt.y));i=i.prev}e.push(o)}}}};et.Clipper.prototype.BuildResultEx=function(e){et.Clear(e);for(var t=0;t<this.m_PolyOuts.length;){var r=this.m_PolyOuts[t++];if(null==r.pts)break;var n=r.pts,i=this.PointCount(n);if(!(i<3)){var a=new et.ExPolygon;a.outer=new et.Polygon;a.holes=new et.Polygons;for(var o=0;o<i;o++){a.outer.push(new et.IntPoint(n.pt.x,n.pt.y));n=n.prev}for(;t<this.m_PolyOuts.length;){r=this.m_PolyOuts[t];if(null==r.pts||!r.isHole)break;var s=new et.Polygon;n=r.pts;do{s.push(new et.IntPoint(n.pt.x,n.pt.y));n=n.prev}while(n!=r.pts);a.holes.push(s);t++}e.push(a)}}};et.Clipper.prototype.FixupOutPolygon=function(e){var t=null;e.pts=e.bottomPt;for(var r=e.bottomPt;;){if(r.prev==r||r.prev==r.next){this.DisposeOutPts(r);e.pts=null;e.bottomPt=null;return}if(et.ClipperBase.PointsEqual(r.pt,r.next.pt)||this.SlopesEqual(r.prev.pt,r.pt,r.next.pt,this.m_UseFullRange)){t=null;r==e.bottomPt&&(e.bottomPt=null);r.prev.next=r.next;r.next.prev=r.prev;r=r.prev;null}else{if(r==t)break;null==t&&(t=r);r=r.next}}if(null==e.bottomPt){e.bottomPt=this.GetBottomPt(r);e.bottomPt.idx=e.idx;e.pts=e.bottomPt}};et.Clipper.prototype.JoinPoints=function(e,t,r){t.Value=null;r.Value=null;var n=this.m_PolyOuts[e.poly1Idx],i=this.m_PolyOuts[e.poly2Idx];if(null==n||null==i)return!1;var a=n.pts,o=i.pts,s=e.pt2a,l=e.pt2b,c=e.pt1a,d=e.pt1b;if(!function(){a={Value:a};s={Value:s};l={Value:l};var e=this.FindSegment(a,this.m_UseFullRange,s,l);a=a.Value;s=s.Value;l=l.Value;return e}.call(this))return!1;if(n==i){o=a.next;if(!function(){o={Value:o};c={Value:c};d={Value:d};var e=this.FindSegment(o,this.m_UseFullRange,c,d);o=o.Value;c=c.Value;d=d.Value;return e}.call(this)||o==a)return!1}else if(!function(){o={Value:o};c={Value:c};d={Value:d};var e=this.FindSegment(o,this.m_UseFullRange,c,d);o=o.Value;c=c.Value;d=d.Value;return e}.call(this))return!1;if(!function(){s={Value:s};l={Value:l};var e=this.GetOverlapSegment(s.Value,l.Value,c,d,s,l);s=s.Value;l=l.Value;return e}.call(this))return!1;var h,u,p=a.prev;et.ClipperBase.PointsEqual(a.pt,s)?t.Value=a:et.ClipperBase.PointsEqual(p.pt,s)?t.Value=p:t.Value=this.InsertPolyPtBetween(a,p,s);et.ClipperBase.PointsEqual(a.pt,l)?r.Value=a:et.ClipperBase.PointsEqual(p.pt,l)?r.Value=p:t.Value==a||t.Value==p?r.Value=this.InsertPolyPtBetween(a,p,l):this.Pt3IsBetweenPt1AndPt2(a.pt,t.Value.pt,l)?r.Value=this.InsertPolyPtBetween(a,t.Value,l):r.Value=this.InsertPolyPtBetween(t.Value,p,l);p=o.prev;h=et.ClipperBase.PointsEqual(o.pt,s)?o:et.ClipperBase.PointsEqual(p.pt,s)?p:this.InsertPolyPtBetween(o,p,s);u=et.ClipperBase.PointsEqual(o.pt,l)?o:et.ClipperBase.PointsEqual(p.pt,l)?p:h==o||h==p?this.InsertPolyPtBetween(o,p,l):this.Pt3IsBetweenPt1AndPt2(o.pt,h.pt,l)?this.InsertPolyPtBetween(o,h,l):this.InsertPolyPtBetween(h,p,l);if(t.Value.next==r.Value&&h.prev==u){t.Value.next=h;h.prev=t.Value;r.Value.prev=u;u.next=r.Value;return!0}if(t.Value.prev==r.Value&&h.next==u){t.Value.prev=h;h.next=t.Value;r.Value.next=u;u.prev=r.Value;return!0}return!1};et.Clipper.prototype.FixupJoinRecs=function(e,t,r){for(var n=r;n<this.m_Joins.length;n++){var i=this.m_Joins[n];i.poly1Idx==e.poly1Idx&&this.PointIsVertex(i.pt1a,t)&&(i.poly1Idx=e.poly2Idx);i.poly2Idx==e.poly1Idx&&this.PointIsVertex(i.pt2a,t)&&(i.poly2Idx=e.poly2Idx)}};et.Clipper.prototype.JoinCommonEdges=function(){for(var e,t,r=0;r<this.m_Joins.length;r++){var n,i,a=this.m_Joins[r];if(function(){n={Value:n};i={Value:i};var e=this.JoinPoints(a,n,i);n=n.Value;i=i.Value;return e}.call(this)){var o=this.m_PolyOuts[a.poly1Idx],s=this.m_PolyOuts[a.poly2Idx];if(o==s){o.pts=this.GetBottomPt(n);o.bottomPt=o.pts;o.bottomPt.idx=o.idx;s=this.CreateOutRec();this.m_PolyOuts.push(s);s.idx=this.m_PolyOuts.length-1;a.poly2Idx=s.idx;s.pts=this.GetBottomPt(i);s.bottomPt=s.pts;s.bottomPt.idx=s.idx;if(this.PointInPolygon(s.pts.pt,o.pts,this.m_UseFullRange)){s.isHole=!o.isHole;s.FirstLeft=o;this.FixupJoinRecs(a,i,r+1);this.FixupOutPolygon(o);this.FixupOutPolygon(s);(s.isHole^this.m_ReverseOutput)==this.Area(s,this.m_UseFullRange)>0&&this.ReversePolyPtLinks(s.pts)}else if(this.PointInPolygon(o.pts.pt,s.pts,this.m_UseFullRange)){s.isHole=o.isHole;o.isHole=!s.isHole;s.FirstLeft=o.FirstLeft;o.FirstLeft=s;this.FixupJoinRecs(a,i,r+1);this.FixupOutPolygon(o);this.FixupOutPolygon(s);(o.isHole^this.m_ReverseOutput)==this.Area(o,this.m_UseFullRange)>0&&this.ReversePolyPtLinks(o.pts);if(this.m_UsingExPolygons&&o.isHole)for(e=0;e<this.m_PolyOuts.length;++e){t=this.m_PolyOuts[e];t.isHole&&null!=t.bottomPt&&t.FirstLeft==o&&(t.FirstLeft=s)}}else{s.isHole=o.isHole;s.FirstLeft=o.FirstLeft;this.FixupJoinRecs(a,i,r+1);this.FixupOutPolygon(o);this.FixupOutPolygon(s);if(this.m_UsingExPolygons&&null!=s.pts)for(e=0;e<this.m_PolyOuts.length;++e){t=this.m_PolyOuts[e];t.isHole&&null!=t.bottomPt&&t.FirstLeft==o&&this.PointInPolygon(t.bottomPt.pt,s.pts,this.m_UseFullRange)&&(t.FirstLeft=s)}}}else{if(this.m_UsingExPolygons)for(e=0;e<this.m_PolyOuts.length;++e)this.m_PolyOuts[e].isHole&&null!=this.m_PolyOuts[e].bottomPt&&this.m_PolyOuts[e].FirstLeft==s&&(this.m_PolyOuts[e].FirstLeft=o);this.FixupOutPolygon(o);if(null!=o.pts){o.isHole=this.Area(o,this.m_UseFullRange)<0;o.isHole&&null==o.FirstLeft&&(o.FirstLeft=s.FirstLeft)}var l=o.idx,c=s.idx;s.pts=null;s.bottomPt=null;s.AppendLink=o;for(e=r+1;e<this.m_Joins.length;e++){var d=this.m_Joins[e];d.poly1Idx==c&&(d.poly1Idx=l);d.poly2Idx==c&&(d.poly2Idx=l)}}}}};et.Clipper.FullRangeNeeded=function(e){for(var t=!1,r=0;r<e.length;r++)et.Math_Abs_Int64(e[r].x)>et.ClipperBase.hiRange||et.Math_Abs_Int64(e[r].y)>et.ClipperBase.hiRange?et.Error("Coordinate exceeds range bounds in FullRangeNeeded()."):(et.Math_Abs_Int64(e[r].x)>et.ClipperBase.loRange||et.Math_Abs_Int64(e[r].y)>et.ClipperBase.loRange)&&(t=!0);return t};et.Clipper.prototype.Area=et.Clipper.Area=function(){var e,t,n=arguments;if(1==n.length){var i=n[0],a=i.length-1;if(a<2)return 0;if(et.Clipper.FullRangeNeeded(i)){t=new r(i[a].x+i[0].x).multiply(new r(i[0].y-i[a].y));for(e=1;e<=a;++e)t=t.add(new r(i[e-1].x+i[e].x).multiply(new r(i[e].y-i[e-1].y)));return parseFloat(t.toString())/2}var o=(i[a].x+i[0].x)*(i[0].y-i[a].y);for(e=1;e<=a;++e)o+=(i[e-1].x+i[e].x)*(i[e].y-i[e-1].y);return o/2}if(2==n.length){var s=n[0],l=n[1],c=s.pts;if(null==c)return 0;if(l){t=new r(r.ZERO);do{t=t.add(new r(c.pt.x+c.prev.pt.x).multiply(new r(c.prev.pt.y-c.pt.y)));c=c.next}while(c!=s.pts);return parseFloat(t.toString())/2}t=0;do{t+=(c.pt.x+c.prev.pt.x)*(c.prev.pt.y-c.pt.y);c=c.next}while(c!=s.pts);return t/2}};et.Clipper.BuildArc=function(e,t,r,n){var i=Math.sqrt(et.Math_Abs_Double(n))*et.Math_Abs_Double(r-t);i/=4;i<6&&(i=6);i>64&&(i=et.MaxSteps);for(var a=et.Cast_Int32(i),o=new et.Polygon,s=(r-t)/(a-1),l=t,c=0;c<a;++c){o.push(new et.IntPoint(e.x+et.Clipper.Round(Math.cos(l)*n),e.y+et.Clipper.Round(Math.sin(l)*n)));l+=s}return o};et.Clipper.GetUnitNormal=function(e,t){var r=t.x-e.x,n=t.y-e.y;if(0==r&&0==n)return new et.Clipper.DoublePoint(0,0);var i=1/Math.sqrt(r*r+n*n);r*=i;n*=i;return new et.Clipper.DoublePoint(n,-r)};et.Clipper.prototype.OffsetPolygons=function(e,t,r,n,i){var a=arguments;if(4==a.length)i=!0;else if(3==a.length){n=2;i=!0}else if(2==a.length){r=et.JoinType.jtSquare;n=2;i=!0}isNaN(t)?et.Error("Delta is not a number"):isNaN(n)&&et.Error("MiterLimit is not a number");var o={};new et.Clipper.PolyOffsetBuilder(e,o,t,r,n,i);o=o.Value?o.Value:[[]];return o};et.Clipper.prototype.SimplifyPolygon=function(e,t){var r=new et.Polygons,n=new et.Clipper;n.AddPolygon(e,et.PolyType.ptSubject)&&n.Execute(et.ClipType.ctUnion,r,t,t);return r};et.Clipper.prototype.SimplifyPolygons=function(e,t){var r=new et.Polygons,n=new et.Clipper;n.AddPolygons(e,et.PolyType.ptSubject)&&n.Execute(et.ClipType.ctUnion,r,t,t);return r};var yt,vt=et.Clipper,mt=et.ClipperBase;if(void 0===Object.getOwnPropertyNames){for(yt in mt.prototype)void 0!==vt.prototype[yt]&&vt.prototype[yt]!=Object.prototype[yt]||(vt.prototype[yt]=mt.prototype[yt]);for(yt in mt)void 0===vt[yt]&&(vt[yt]=mt[yt]);vt.$baseCtor=mt}else{for(var xt=Object.getOwnPropertyNames(mt.prototype),_t=0;_t<xt.length;_t++)void 0===Object.getOwnPropertyDescriptor(vt.prototype,xt[_t])&&Object.defineProperty(vt.prototype,xt[_t],Object.getOwnPropertyDescriptor(mt.prototype,xt[_t]));for(yt in mt)void 0===vt[yt]&&(vt[yt]=mt[yt]);vt.$baseCtor=mt}et.Clipper.DoublePoint=function(e,t){this.x=e;this.y=t};et.Clipper.PolyOffsetBuilder=function(e,t,r,n,i,a){this.pts=null;this.currentPoly=null;this.normals=null;this.delta=0;this.m_R=0;this.m_i=0;this.m_j=0;this.m_k=0;this.botPt=null;if(0!=r){this.pts=e;this.delta=r;var o,s;if(a){for(var l=this.pts.length,c=0;c<l&&0==this.pts[c].length;)c++;if(c==l)return;this.botPt=this.pts[c][0];for(o=c;o<l;++o){this.UpdateBotPt(this.pts[o][0])&&(c=o);for(s=this.pts[o].length-1;s>0;s--)et.ClipperBase.PointsEqual(this.pts[o][s],this.pts[o][s-1])?this.pts[o].splice(s,1):this.UpdateBotPt(this.pts[o][s])&&(c=o)}et.Clipper.Orientation(this.pts[c])||et.Clipper.ReversePolygons(this.pts)}i<=1&&(i=1);var d=2/(i*i);this.normals=[];t.Value=new et.Polygons;var h;for(this.m_i=0;this.m_i<this.pts.length;this.m_i++){h=this.pts[this.m_i].length;h>1&&this.pts[this.m_i][0].x==this.pts[this.m_i][h-1].x&&this.pts[this.m_i][0].y==this.pts[this.m_i][h-1].y&&h--;if(!(0==h||h<3&&r<=0))if(1!=h){et.Clear(this.normals);for(s=0;s<h-1;++s)this.normals.push(et.Clipper.GetUnitNormal(this.pts[this.m_i][s],this.pts[this.m_i][s+1]));this.normals.push(et.Clipper.GetUnitNormal(this.pts[this.m_i][h-1],this.pts[this.m_i][0]));this.currentPoly=new et.Polygon;this.m_k=h-1;for(this.m_j=0;this.m_j<h;++this.m_j){switch(n){case et.JoinType.jtMiter:this.m_R=this.normals[this.m_j].x*this.normals[this.m_k].x+this.normals[this.m_j].y*this.normals[this.m_k].y+1;this.m_R>=d?this.DoMiter():this.DoSquare(i);break;case et.JoinType.jtRound:this.DoRound();break;case et.JoinType.jtSquare:this.DoSquare(1)}this.m_k=this.m_j}t.Value.push(this.currentPoly)}else{var u;u=et.Clipper.BuildArc(this.pts[this.m_i][h-1],0,et.PI2,r);t.Value.push(u)}}var p=new et.Clipper;p.AddPolygons(t.Value,et.PolyType.ptSubject);if(r>0)p.Execute(et.ClipType.ctUnion,t.Value,et.PolyFillType.pftPositive,et.PolyFillType.pftPositive);else{var f=p.GetBounds(),g=new et.Polygon;g.push(new et.IntPoint(f.left-10,f.bottom+10));g.push(new et.IntPoint(f.right+10,f.bottom+10));g.push(new et.IntPoint(f.right+10,f.top-10));g.push(new et.IntPoint(f.left-10,f.top-10));p.AddPolygon(g,et.PolyType.ptSubject);p.Execute(et.ClipType.ctUnion,t.Value,et.PolyFillType.pftNegative,et.PolyFillType.pftNegative);if(t.Value.length>0){t.Value.splice(0,1);for(o=0;o<t.Value.length;o++)t.Value[o].reverse()}}}else t.Value=e};et.Clipper.PolyOffsetBuilder.prototype.UpdateBotPt=function(e){if(e.y>this.botPt.y||e.y==this.botPt.y&&e.x<this.botPt.x){this.botPt=e;return!0}return!1};et.Clipper.PolyOffsetBuilder.prototype.AddPoint=function(e){this.currentPoly.push(e)};et.Clipper.PolyOffsetBuilder.prototype.DoSquare=function(e){var t=new et.IntPoint(et.Cast_Int64(et.Clipper.Round(this.pts[this.m_i][this.m_j].x+this.normals[this.m_k].x*this.delta)),et.Cast_Int64(et.Clipper.Round(this.pts[this.m_i][this.m_j].y+this.normals[this.m_k].y*this.delta))),r=new et.IntPoint(et.Cast_Int64(et.Clipper.Round(this.pts[this.m_i][this.m_j].x+this.normals[this.m_j].x*this.delta)),et.Cast_Int64(et.Clipper.Round(this.pts[this.m_i][this.m_j].y+this.normals[this.m_j].y*this.delta)));if((this.normals[this.m_k].x*this.normals[this.m_j].y-this.normals[this.m_j].x*this.normals[this.m_k].y)*this.delta>=0){var n=Math.atan2(this.normals[this.m_k].y,this.normals[this.m_k].x),i=Math.atan2(-this.normals[this.m_j].y,-this.normals[this.m_j].x);n=Math.abs(i-n);n>et.PI&&(n=et.PI2-n);var a=Math.tan((et.PI-n)/4)*Math.abs(this.delta*e);t=new et.IntPoint(et.Cast_Int64(t.x-this.normals[this.m_k].y*a),et.Cast_Int64(t.y+this.normals[this.m_k].x*a));this.AddPoint(t);r=new et.IntPoint(et.Cast_Int64(r.x+this.normals[this.m_j].y*a),et.Cast_Int64(r.y-this.normals[this.m_j].x*a));this.AddPoint(r)}else{this.AddPoint(t);this.AddPoint(this.pts[this.m_i][this.m_j]);this.AddPoint(r)}};et.Clipper.PolyOffsetBuilder.prototype.DoMiter=function(){if((this.normals[this.m_k].x*this.normals[this.m_j].y-this.normals[this.m_j].x*this.normals[this.m_k].y)*this.delta>=0){var e=this.delta/this.m_R;this.AddPoint(new et.IntPoint(et.Cast_Int64(et.Clipper.Round(this.pts[this.m_i][this.m_j].x+(this.normals[this.m_k].x+this.normals[this.m_j].x)*e)),et.Cast_Int64(et.Clipper.Round(this.pts[this.m_i][this.m_j].y+(this.normals[this.m_k].y+this.normals[this.m_j].y)*e))))}else{var t=new et.IntPoint(et.Cast_Int64(et.Clipper.Round(this.pts[this.m_i][this.m_j].x+this.normals[this.m_k].x*this.delta)),et.Cast_Int64(et.Clipper.Round(this.pts[this.m_i][this.m_j].y+this.normals[this.m_k].y*this.delta))),r=new et.IntPoint(et.Cast_Int64(et.Clipper.Round(this.pts[this.m_i][this.m_j].x+this.normals[this.m_j].x*this.delta)),et.Cast_Int64(et.Clipper.Round(this.pts[this.m_i][this.m_j].y+this.normals[this.m_j].y*this.delta)));this.AddPoint(t);this.AddPoint(this.pts[this.m_i][this.m_j]);this.AddPoint(r)}};et.Clipper.PolyOffsetBuilder.prototype.DoRound=function(){var e=new et.IntPoint(et.Clipper.Round(this.pts[this.m_i][this.m_j].x+this.normals[this.m_k].x*this.delta),et.Clipper.Round(this.pts[this.m_i][this.m_j].y+this.normals[this.m_k].y*this.delta)),t=new et.IntPoint(et.Clipper.Round(this.pts[this.m_i][this.m_j].x+this.normals[this.m_j].x*this.delta),et.Clipper.Round(this.pts[this.m_i][this.m_j].y+this.normals[this.m_j].y*this.delta));this.AddPoint(e);if((this.normals[this.m_k].x*this.normals[this.m_j].y-this.normals[this.m_j].x*this.normals[this.m_k].y)*this.delta>=0){if(this.normals[this.m_j].x*this.normals[this.m_k].x+this.normals[this.m_j].y*this.normals[this.m_k].y<.985){var r=Math.atan2(this.normals[this.m_k].y,this.normals[this.m_k].x),n=Math.atan2(this.normals[this.m_j].y,this.normals[this.m_j].x);this.delta>0&&n<r?n+=et.PI2:this.delta<0&&n>r&&(n-=et.PI2);for(var i=et.Clipper.BuildArc(this.pts[this.m_i][this.m_j],r,n,this.delta),a=0;a<i.length;a++)this.AddPoint(i[a])}}else this.AddPoint(this.pts[this.m_i][this.m_j]);this.AddPoint(t)};et.Error=function(e){try{throw new Error(e)}catch(e){alert(e.message)}};et.Clone=function(e){if(!(e instanceof Array))return[];if(0==e.length)return[];if(1==e.length&&0==e[0].length)return[[]];var t=e[0]instanceof Array;t||(e=[e]);var r,n,i,a,o=e.length,s=[];for(n=0;n<o;n++){r=e[n].length;a=[];for(i=0;i<r;i++)a.push({x:e[n][i].x,y:e[n][i].y});s.push(a)}t||(s=s[0]);return s};et.Clean=function(e,t){if(!(e instanceof Array))return[];var r=e[0]instanceof Array,e=et.Clone(e);if("number"!=typeof t||null===t){et.Error("Delta is not a number in Clean().");return e}if(0==e.length||1==e.length&&0==e[0].length||t<0)return e;r||(e=[e]);for(var n,i,a,o,s,l,c,d=e.length,h=[],u=0;u<d;u++){i=e[u];n=i.length;if(0!=n)if(n<3){a=i;h.push(a)}else{a=i;o=t*t;s=i[0];l=1;for(c=1;c<n;c++)if(!((i[c].x-s.x)*(i[c].x-s.x)+(i[c].y-s.y)*(i[c].y-s.y)<=o)){a[l]=i[c];s=i[c];l++}s=i[l-1];(i[0].x-s.x)*(i[0].x-s.x)+(i[0].y-s.y)*(i[0].y-s.y)<=o&&l--;l<n&&a.splice(l,n-l);a.length&&h.push(a)}}!r&&h.length?h=h[0]:r||0!=h.length?r&&0==h.length&&(h=[[]]):h=[];return h};et.Lighten=function(e,t){if(!(e instanceof Array))return[];if("number"!=typeof t||null===t){et.Error("Tolerance is not a number in Lighten().");return et.Clone(e)}if(0===e.length||1==e.length&&0===e[0].length||t<0)return et.Clone(e);e[0]instanceof Array||(e=[e]);var r,n,i,a,o,s,l,c,d,h,u,p,f,g,y,v=e.length,m=[];for(r=0;r<v;r++){i=e[r];for(a=0;a<1e6;a++){o=[];s=i.length;if(i[s-1].x!=i[0].x||i[s-1].y!=i[0].y){p=1;i.push({x:i[0].x,y:i[0].y});s=i.length}else p=0;u=[];for(n=0;n<s-2;n++){l=i[n];d=i[n+1];c=i[n+2];f=c.x-l.x;g=c.y-l.y;h=0;if(0!==f||0!==g){y=Math.sqrt(f*f+g*g);h=Math.abs((d.x-l.x)*g-(d.y-l.y)*f)/y}if(h<=t){u[n+1]=1;n++}}o.push({x:i[0].x,y:i[0].y});for(n=1;n<s-1;n++)u[n]||o.push({x:i[n].x,y:i[n].y});o.push({x:i[s-1].x,y:i[s-1].y});p&&i.pop();if(!u.length)break;i=o}s=o.length;o[s-1].x==o[0].x&&o[s-1].y==o[0].y&&o.pop();o.length>2&&m.push(o)}!e[0]instanceof Array&&(m=m[0]);void 0===m&&(m=[[]]);return m};et.OffsetPoint=function(e,t){return et.OffsetPolyline([e],t)};et.OffsetPolyline=function(e,t){var r=new et.Polygon;e.forEach(function(e){r.push(e)});if(e.length>2)for(var n=e.length-2;n>0;n--)r.push(e[n]);return et.OffsetPolygon(r,t)};et.OffsetPolygon=function(e,t){var r=new et.Polygons;r.push(e);return(new et.Clipper).OffsetPolygons(r,t,et.JoinType.jtRound,100,!0)};et.BuildArc=et.Clipper.BuildArc}();GrowingPacker=function(){};GrowingPacker.prototype={fit:function(e){var t,r,n,i=e.length,a=i>0?e[0].w:0,o=i>0?e[0].h:0;this.root={x:0,y:0,w:a,h:o};for(t=0;t<i;t++){n=e[t];(r=this.findNode(this.root,n.w,n.h))?n.fit=this.splitNode(r,n.w,n.h):n.fit=this.growNode(n.w,n.h)}},findNode:function(e,t,r){return e.used?this.findNode(e.right,t,r)||this.findNode(e.down,t,r):t<=e.w&&r<=e.h?e:null},splitNode:function(e,t,r){e.used=!0;e.down={x:e.x,y:e.y+r,w:e.w,h:e.h-r};e.right={x:e.x+t,y:e.y,w:e.w-t,h:r};return e},growNode:function(e,t){var r=e<=this.root.w,n=t<=this.root.h,i=n&&this.root.h>=this.root.w+e,a=r&&this.root.w>=this.root.h+t;return i?this.growRight(e,t):a?this.growDown(e,t):n?this.growRight(e,t):r?this.growDown(e,t):null},growRight:function(e,t){this.root={used:!0,x:0,y:0,w:this.root.w+e,h:this.root.h,down:this.root,right:{x:this.root.w,y:0,w:e,h:this.root.h}};return(node=this.findNode(this.root,e,t))?this.splitNode(node,e,t):null},growDown:function(e,t){this.root={used:!0,x:0,y:0,w:this.root.w,h:this.root.h+t,down:{x:0,y:this.root.h,w:this.root.w,h:t},right:this.root};return(node=this.findNode(this.root,e,t))?this.splitNode(node,e,t):null}};var Rn="5.3.14",Nn={0:0,90:1,180:0,270:-1},kn={0:1,90:0,180:-1,270:0},Bn=[1,10,100,1e3],Mn=function(){var e="http://www.w3.org/2000/svg",t="http://www.w3.org/1999/xlink",r="http://www.w3.org/XML/1998/namespace",n="https://easyeda.com/",i={svg:e,xlink:t,xml:r,c:n};i[e]="svg";i[t]="xlink";i[r]="xml";i[n]="c";return i}(),Vn=0,Gn=2,Fn={TOPLAYER:1,BOTTOMLAYER:2,TOPSILKLAYER:3,BOTTOMSILKLAYER:4,TOPPASTERLAYER:5,BOTTOMPASTERLAYER:6,TOPSOLDERLAYER:7,BOTTOMSOLDERLAYER:8,RATLINES:9,BOARDOUTLINE:10,ALL:11,DOCUMENT:12,TOPASSEMBLY:13,BOTTOMASSEMBLY:14,MECHANICAL:15,INNER1:21,INNER2:22,INNER3:23,INNER4:24},Dn={SCH:"1",SCHLIB:"2",PCB:"3",PCBLIB:"4",PRJ:"5",SUBPART:"6",SPICESYMBOL:"7",SUBCKT:"8",NETLIST:"9",WAVEFORM:"10",SCHLIB3D:"11",PHOTOVIEW:"12",SCHMODULE:"13",PCBMODULE:"14"},Hn=function(){var e,t={};for(e in Dn)t[Dn[e]]=e;return t}(),jn="~",Un="`",Yn={tabCounter:2,checkNotificationInterval:12e4,checkUpdateInterval:36e5,cooperationSites:["elektroda","amobbs","allaboutcircuits","diyaudio","hifidiy","edaboard"],cushionShape:null,cushionShapeFor:null,fileOperationAPI:"/EditorBridge/fileOperation",svgFileAPI:"/EditorBridge/svgFile",treeDataAPI:"/EditorBridge/treeData",anonymousPid:"441bd07389f646ac82c8d1dbc45a6021",version:"V"+Rn,buildDate:"03/21/2018",lcscUUID:"0819f05c4eef4c71ace90d822a990e87",easyedaUUID:"4251c6ae97414f38bb1d929da02c4173",winWidth:e.innerWidth||t.documentElement.clientWidth,winHeight:e.innerHeight||t.documentElement.clientHeight,ignoreConfirmClose:!1,teams:[],apis:{projects:{create:"/api/projects/add",my_projects:"/api/projects",common:"/api/users/0819f05c4eef4c71ace90d822a990e87/public_project",update:"/api/projects/{uuid}/update",share:"/api/projects/{uuid}/share",stick:"/api/projects/{uuid}/stick",cancelStick:"/api/projects/{uuid}/unstick"},document:{create:"/api/documents/create",ajaxDetail:"/api/documents/{uuid}",schematics:"/api/projects/schematic",updateCanvas:"/api/documents/{uuid}/update_canvas",modify:"/api/documents/{uuid}/update",tag:"/api/histories/{uuid}",share:"/api/documents/{uuid}/share",duplicate:"/api/documents/{uuid}/copy",delete:"/api/documents/{uuid}/delete",simulation:"/api/documents/{uuid}/simulate",spiceNetlist:"/api/documents/{uuid}/spiceNetlist",simulatedSpice:"/api/documents/{uuid}/simulatedSpice",importThirdDocOrLibs:"https://analyze.easyeda.com/api/convert/from/{from}/to/{to}",histories:"/api/documents/{uuid}/histories"},components:{myComponents:"/api/user/component_tags",myModules:"/api/user/model_tags",ajaxLists:"/api/components",create:"/api/components/add",ajaxDetail:"/api/components/{uuid}",updateCanvas:"/api/components/{uuid}/update_canvas",modify:"/api/components/{uuid}/update",delete:"/api/components/{uuid}/delete",duplicate:"/api/components/{uuid}/copy",subpart:"/api/components/{uuid}/add_subpart",contribute:"/api/components/contribute",getSubckt:"/api/components/getSubckt",updateSubckt:"/api/components/updateSubckt",search:"/api/components/search",searchPCBAndModules:"/api/components/search/PCBAndModules",packageDetail:"/api/components/packages",tags:"/api/components/tags",uuid:"/api/packages/uuid",reportError:"/api/components/{uuid}/report"},others:{bugReport:"/api/client/bugs",userInfo:"/api/user",getLcscPrice:"/api/getPrices",buyComponentFromLcsc:"/api/v1/buy",addFavorite:"/api/components/{uuid}/star",checkPackagesAvaliable:"/api/packagesExists",pcbOperate:"/api/PCB/operate",teams:"/api/teams",startPage:"/api/page/editor-start-page",versionPage:"/api/page/editor-v",notification:"/api/notifications/unread-count",getVersion:"/version",getPackageNewestTitle:"/api/components/check-different",preference:"/api/user/preference",getPcbFabricationPrice:"/api/pcb_order/{uuid}/get_price",orderAtJLCPCB:"api/pcb_order/{uuid}/save",gerberView:"api/pcb_order/{uuid}/gerber_view",gerberDownloadStatistic:"api/documents/{uuid}/download_gerber"}}};(function(){var e=location.hostname;e.indexOf("lceda")>-1||e.indexOf("easyeda")})(),t.querySelector('head meta[name="STATIC"]').getAttribute("content");a.hooks={};a.wildcardHooks={};a.registerHook=function(e,t){if("string"==typeof e)if(e.indexOf("*")>=0){var r="^"+e.replace(/\*/g,".*")+"$";a.wildcardHooks[r]=t}else a.hooks[e]=t;else if(e instanceof RegExp)a.wildcardHooks[e]=t;else for(var n in e)e.hasOwnProperty(n)&&a.registerHook(n,e[n])};var zn,Jn,Xn,Kn,Wn,qn=o("Mac OS")>0,$n=o("chromeframe")>0||o("x-clock")>0,Qn=(o("MSIE")>0||o("Trident")>=0)&&!$n,Zn=Qn&&o("MSIE 9.0")>0,ei=o("Edge/")>0,ti=0===o("Opera/"),ri=o("Firefox/")>0,ni=(o("AppleWebKit"),o("Chrome/")>0&&!Qn&&!ei&&!ti&&!ri),ii=(o("Safari/"),o("Electron/"),{}),ai={},oi=null,si={on:!1,targets:null,bind:!1},li=t.createDocumentFragment(),ci=1,di=100,hi=4;e.gClipboard=t.createDocumentFragment();e.easyeda={};e.callCommand=a;var ui={data:{}},pi={gJsonCache:{TRACK:{},PAD:{},VIA:{},TEXT:{},DIMENSION:{},FOOTPRINT:{},ARC:{},RECT:{},CIRCLE:{},IMAGE:{},COPPERAREA:{},SOLIDREGION:{},SVGNODE:{},DRCRULE:{trackWidth:.6,track2Track:.6,pad2Pad:.6,track2Pad:.6,hole2Hole:1,holeSize:1.2,isRealtime:!0},FABRICATION:{},SIGNALS:{},head:{},systemColor:{background:"#000000",grid:"#FFFFFF",highLight:"#FFFFFF",hole:"#222222",DRCError:"#FFFFFF"},preference:{hideNets:[],hideFootprints:[],unit:"mil"},layers:{1:{name:"TopLayer",color:"#FF0000",darkColor:"#CC0000",visible:!0,active:!0,config:!0},2:{name:"BottomLayer",color:"#0000FF",darkColor:"#000080",visible:!0,active:!1,config:!0},3:{name:"TopSilkLayer",color:"#FFFF00",darkColor:"#B9B900",visible:!0,active:!1,config:!0},4:{name:"BottomSilkLayer",
color:"#808000",darkColor:"#535300",visible:!0,active:!1,config:!0},5:{name:"TopPasterLayer",color:"#808080",darkColor:"#666666",visible:!1,active:!1,config:!1},6:{name:"BottomPasterLayer",color:"#800000",darkColor:"#660000",visible:!1,active:!1,config:!1},7:{name:"TopSolderLayer",color:"#800080",darkColor:"#660066",visible:!1,active:!1,config:!1},8:{name:"BottomSolderLayer",color:"#AA00FF",darkColor:"#8800CC",visible:!1,active:!1,config:!1},9:{name:"Ratlines",color:"#6464FF",darkColor:"#5050CC",visible:!1,active:!1,config:!0},10:{name:"BoardOutline",color:"#FF00FF",darkColor:"#CC00CC",visible:!0,active:!1,config:!0},11:{name:"Multi-Layer",color:"#C0C0C0",darkColor:"#999999",visible:!0,active:!1,config:!0},12:{name:"Document",color:"#FFFFFF",darkColor:"#CCCCCC",visible:!0,active:!1,config:!0},13:{name:"TopAssembly",color:"#33CC99",darkColor:"#33AA99",visible:!1,active:!1,config:!1},14:{name:"BottomAssembly",color:"#5555FF",darkColor:"#8888FF",visible:!1,active:!1,config:!1},15:{name:"Mechanical",color:"#F022F0",darkColor:"#F088F0",visible:!1,active:!1,config:!1},21:{name:"Inner1",color:"#800000",darkColor:"#660000",visible:!1,active:!1,config:!1},22:{name:"Inner2",color:"#008000",darkColor:"#006600",visible:!1,active:!1,config:!1},23:{name:"Inner3",color:"#00FF00",darkColor:"#00CC00",visible:!1,active:!1,config:!1},24:{name:"Inner4",color:"#000080",darkColor:"#000066",visible:!1,active:!1,config:!1}}}},ii={signals:pi.gJsonCache.SIGNALS,currentNet:1,nodes:{},routedGroup:{},nets:{}},fi=t.getElementById("root"),gi=null,yi=[],vi=[],mi=[],xi="",_i="",Pi={},Si={},bi={adsorbGrid:{visible:!0,gridSize:10,enabled:!0,distanceX:1,distanceY:1,altSnapSize:.5},canvas:{originX:4e3,originY:3e3,unit:"mil",routing:1,angle:45,copperZone:"visible"}},Ci={_errorA:[],_padA:[],_trackA:[],_rules:{},_holeA:[],maxClearance:.4,checkedKeys:["PAD","VIA","TRACK","ARC","SOLIDREGION","FOOTPRINT"]},Ai={_clearanceWidth:1,_scaleFactor:50,_copperNet:"GND",_copperLayerId:Fn.TOPLAYER,_copperThermal:"spoke",_copperKeepIsland:"none",_copperOutline:null,copperPolygons:{},_padOrViaHasSameNetNameWithCopperArr:[],_attachedCopperId:null,_boardOutlines:[]},Ii={},Li={COPPERAREA:[1,2,21,22,23,24],RECT:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24],TRACK:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24],PAD:[11,1,2],VIA:[11],HOLE:[11],TEXT:[3,4,1,2,7,8,12,13,14,15,21,22,23,24],ARC:[3,4,1,2,7,8,10,12,13,14,15,21,22,23,24],ELLIPSE:[3,4,12,13,14,15],CIRCLE:[3,4,12,13,14,15],DIMENSION:[3,4,12,13,14,15],IMAGE:[3,4,1,2,7,8,12,13,14,15],FOOTPRINT:[1,2],SOLIDREGION:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,11],SVGNODE:[1,2,3,4,7,8,12,13,14,15],PROTRACTOR:[3,4,12,13,14,15]},Ei={graph:[],nodeCount:0,ratLineArr:{},PADMap:[],realRatLineArr:{}},Oi={nodeIndex:{},trees:{},signalLayers:[],_bulkPatch:{},_isBulkMode:!1},Ti='<?xml version="1.0" encoding="utf-8" standalone="no"?><svg width="800" height="600" viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>entry port pcb</title><g c_partid="part_annotation" c_layer="" c_origin="0,0"><text x="0" y="0" font-family="simplex" font-size="12mm" fill="#FFFFFF" text-anchor="start" type="comment">Text</text></g><g c_partid="part_pad" c_type="pinpart" number="0" layerid="11" net="" c_origin="400,300" c_rotation="0" c_width="6" c_height="6" c_shape="ELLIPSE"><ellipse cx="400" cy="300" rx="3" ry="3" stroke="none" /><circle cx="400" cy="300" r="1.8" stroke="none" /></g><g c_partid="part_via" c_type="pinpart" layerid="11" net="" c_origin="400,300"><circle cx="400" cy="300" r="1.22" stroke="none" /><circle cx="400" cy="300" r="0.6" stroke="none" /></g><g c_partid="part_hole" c_type="pinpart" layerid="11" c_origin="0,0"><path d="M-5,-5 L5,5 M-5,5 L5,-5" fill="none" stroke-width="0.8"/><circle cx="0" cy="0" r="4" stroke="none" /><ellipse cx="0" cy="0" rx="4" ry="4" stroke-width="0.5" fill="none" /></g><g c_partid="part_pcbtext" c_origin="10,10" c_rotation="0" c_mirror="none"><path c_text="TEXT" c_fontSize="8" d="M12.55,5.64L12.55,13.27M10,5.64L15.09,5.64M17.49,5.64L17.49,13.27M17.49,5.64L22.22,5.64M17.49,9.27L20.4,9.27M17.49,13.27L22.22,13.27M24.62,5.64L29.71,13.27M29.71,5.64L24.62,13.27M34.65,5.64L34.65,13.27M32.11,5.64L37.2,5.64" fill="none" stroke-width="0.8"/></g><g c_origin="160,410" c_para="" c_partid="part_import_tmpl" c_shapetype="group" c_etype="pinpart" layerid="1"><g c_partid="part_pcbtext" c_origin="428.6,142.23046875" layerid="3"><path c_note="note_pre" c_fontSize="4.5" c_text="U2" d="M 217 133.55L217 136.61 L217.2 137.23 L217.61 137.64 L218.23 137.84 L218.64 137.84 L219.25 137.64 L219.66 137.23 L219.86 136.61 L219.86 133.55 M 221.62 133.55L223.87 133.55 L222.65 135.18 L223.26 135.18 L223.67 135.39 L223.87 135.59 L224.08 136.2 L224.08 136.61 L223.87 137.23 L223.46 137.64 L222.85 137.84 L222.24 137.84 L221.62 137.64 L221.42 137.43 L221.21 137.02" fill="none" stroke-width="0.7"/></g></g><g c_origin="160,410" c_para="" c_partid="part_board_frame" c_shapetype="group" c_etype="pinpart"></g></svg>';!function(){if(!e.console){var t=function(){};return{log:t,info:t,warn:t,error:t}}var r={};["log","info","warn","error"].forEach(function(t){r[t]=e.console[t].bind(e.console)})}();ai.camelize=function(e){return e.replace(/\-[a-z]/g,function(e){return e.charAt(1).toUpperCase()})};ai.dasherize=function(e){return e.replace(/[a-z][A-Z]/g,function(e){return e.charAt(0)+"-"+e.charAt(1).toLowerCase()})};ai.extractDocType=function(e){return"string"==typeof e?e.split(jn)[0]:e.docType};ai.json2EntitiedStr=function(e){return(JSON.stringify(e)||"").replace(/"/g,"&quot;")};ai.newId=function(){return"gge"+ ++hi};ai.toHexColor=function(e){if(/^#.{6}$/.text(e))return e.toUpperCase();if(/^#...$/.text(e))return e.replace(/[^#]/g,"$&$&").toUpperCase();if(/^rgb\((\d+).+(\d+).+(\d+)\)$/.text(e)){e="#"+(+RegExp.$1+256).toString(16)+(+RegExp.$2+256).toString(16)+(+RegExp.$3+256).toString(16);return e.replace(/1(..)/g,"$1").toUpperCase()}return e};ai.isValidImageURL=function(e){return e&&(/^(https?:)?\/\/[\w\.-]+\/[^\s#?"]+\.(jpg|jpeg|png|gif|svg)$/i.test(e)||/^data:image\/(jpeg|png|gif|svg\+xml);base64,/.test(e)||/^\/assets\/static\/images\//.test(e))};ai.numberlistToArray=function(e,t){var r,n=(e||"").split(t||/[\s,]+/g);for(r=0;r<n.length;r++)n[r]=+n[r];return n};ai.extend=function(){var e,t=0,r=arguments,n=r.length,i=!1;if(n<1)return{};if("boolean"==typeof r[0]){i=r[0];e=r[1];t=1}else if("boolean"==typeof r[n-1]){i=r[n-1];e=r[0];n--}else e=r[0];(!e||"object"!=typeof e&&"function"!=typeof e)&&(e={});for(;t<n;t++){var a=r[t];if(a&&"object"==typeof a){if(a==e)continue;for(var o in a)A(a,o)&&(i&&a[o]&&"object"==typeof a[o]?e[o]=ai.extend({},a[o]):e[o]=a[o])}}return e};ai.cloneJSON=function(e){return e&&"object"==typeof e?I(JSON.stringify(e)):e};ai.getVendorProperty=function(e,t){if(A(e,t))return e[t];var r=t.charAt(0).toUpperCase()+t.substr(1);return e["webkit"+r]||e["moz"+r]||e["o"+r]||e["ms"+r]};ai.getErrorInfo=function(t){var r="",n=navigator,i="",a="",o="",s=t.stack||t.error&&t.error.stack;"object"==typeof Yn&&(r+="#build: "+Yn.version+", "+Yn.buildDate+";\n");var l=H(n.userAgent);l&&(r+="#browser: "+l+";\n");r+="#userAgent: "+n.userAgent+";\n";n.platform&&(r+="#platform: "+n.platform+";\n");n.language&&(r+="#language: "+n.language+";");n.languages&&(r+=" langs:"+n.languages+";");n.systemLanguage&&(r+=" sysLang:"+n.systemLanguage+";");n.userLanguage&&(r+=" userLang:"+n.userLanguage+";");n.browserLanguage&&(r+=" browserLang:"+n.browserLanguage+";");r+="\n";"object"==typeof Locale&&Locale&&Locale._curr&&(r+="#Locale._curr: "+Locale._curr+";\n");var c=location.protocol+"//"+location.host;r+="#location: "+location.href.replace(c,"")+";\n";try{if(e!=top)r+="#top.location: "+top.location.href.replace(c,"")+";\n";else{var d=$("#tabbar_bodies .editframe").toArray();d.length&&(r+="#iframes: "+d.map(function(e){return e.getAttribute("src")}).join("  ")+"\n")}}catch(e){}r+="#tostring: "+t.toString()+";\n";t.toString()!=Object.prototype.toString.call(t)&&(r+="#tostring2: "+Object.prototype.toString.call(t)+";\n");t.type&&(r+="#type: "+t.type+";\n");i=t.filename||t.fileName||t.error&&t.error.filename||t.error&&t.error.fileName||"";i=i.replace(/[^#\?]+\//,"");a=t.lineno||t.lineNumber||t.error&&t.error.lineno||t.error&&t.error.lineNumber||"";o=t.colno||t.columnNumber||t.error&&t.error.colno||t.error&&t.error.columnNumber||"";if(!i&&s)if(s.match(/\/([^\/]+):(\d+):(\d+)\)/)){i=RegExp.$1;a=RegExp.$2;o=RegExp.$3}else if(s.match(/\/([^\/]+):(\d+)\)/)){i=RegExp.$1;a=RegExp.$2}r+="#file: "+i+"; #line:"+a+"; #col:"+o+";\n";t.message?r+="#message: "+t.message+";\n":t.description?r+="#message: "+t.description+";\n":t.error&&t.error.message?r+="#message: "+t.error.message+";\n":t.error&&t.error.description&&(r+="#message: "+t.error.description+";\n");if(s){c=c.replace(/[\/:]/g,"\\$&");s=s.replace(new RegExp(c,"g"),"");s=s.replace(/\n(\S)/g,"\n  $1");r+="#stack: "+s+";\n";if(s.indexOf("this.get(...).querySelectorAll")>0){if(!top._querySelectorAll_err&&top.$&&top.$.messager&&top.$.messager.error){top._querySelectorAll_err=1;setTimeout(function(){"function"==typeof notifyReportBug?notifyReportBug():tt("notifyReportBug")},500)}for(var h=[[Element,"Element","innerHTML","__INNERHTML_DESCRIPTOR"],[Node,"Node","textContent","__TEXTCONTENT_DESCRIPTOR"]],u=0;u<h.length;u++){var p=h[u],f=p[1],g=p[2],y=e[p[3]];if(y)try{var v,m;v=Object.getOwnPropertyDescriptor(p.prototype,g);if(!v||v.set!=y.set){m={}.toString.call(v.set);r+="-----------------------\n"+f+" "+g+" set was overide:\n"+m+"\n";m.indexOf("[native code]")<0&&Object.defineProperty(p.prototype,g,y)}}catch(e){}}}}return{detail:r,file:i,lineno:a,colno:o}};ai.submitJsError=function(e){try{if(!(e&&e.file&&e.lineno&&e.colno))return;if(e.detail.indexOf("https://embed.tawk.to/")>0)return;var t=e.detail.match(/#file:.+\n#message:.+\n#stack:.*\n.*(?:\n.*)?/);t||(t=e.detail.match(/#file:.+\n#message:.+/));if(!t||!t[0])return;e.key=MD5(t[0]);errKeys||(errKeys={});if(A(errKeys,e.key))return;var r={};$.extend(r,{keyId:e.key,file:e.file,detail:e.detail});$.extend(r,{locale:Locale._curr,build:Yn.version+","+Yn.buildDate,login:0|isLogined()});$.extend(r,ai.getEnvInfo());$.postJSON({url:Yn.apis.others.bugReport,data:{bugInfo:JSON.stringify(r)},timeout:6e4}).then(function(e){e&&e.success})}catch(e){}};ai.reportError=function(e){if(e&&"object"==typeof e)try{var t=ai.getErrorInfo(e);t.file&&t.lineno&&t.colno&&(void 0!==tt?tt("triggerEvent",["error",t]):ai.submitJsError(t))}catch(e){}};ai.getEnvInfo=function(){var r=navigator,n=r.userAgent.replace(/Mozilla\/\S*|AppleWebKit\/\S*|KHTML, like Gecko|/,""),i=t.body,a={os:[["Windows 10",/Windows NT (?:10\.|6\.4)/],["Windows 8.1",/Windows (?:8\.1|NT 6\.3)/],["Windows 8",/Windows (?:8|NT 6\.2)/],["Windows 7",/Windows (?:7|NT 6\.1)/],["Windows Phone",/Windows Phone/],["$1",/((?:Windows (?:NT )?|WinNT) \d+\.?\d*)/],["Mac OS",/Mac OS X|MacPPC|MacIntel|Mac_PowerPC|Macintosh/],["$&",/iPhone|iPad|iPod|OpenBSD|FreeBSD|Ubuntu|Linux|Unix|BlackBerry|OS\/2|Android/]],browser:[["IEMobile $1",/ IEMobile\/(\d+)/],["IE 11",/Edge\/12|Trident\/7.* rv:11/],["IE 10",/MSIE 10|Trident\/6/],["IE 9",/MSIE 9|Trident\/5/],["IE $1",/MSIE (\d+)/],["Firefox $1",/Firefox\/(\d+)/],["Opera $1",/Opera\/.*Version\/(\d+)/],["Chrome $1",/Chrome\/(\d+)/],["Safari $1",/Version\/(\d+).* Safari/,/Android/]]},o={platform:r.platform||"",language:r.language||r.userLanguage||"",os:"other",browser:"other",screen:{width:screen.width,height:screen.height,devicePixelRatio:e.devicePixelRatio||1,touch:0|("ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch)},features:{applicationCache:0|!!e.applicationCache,IndexedDB:0|!!ai.getVendorProperty(e,"indexedDB"),FileSystem:0|!!ai.getVendorProperty(e,"requestFileSystem"),WebWorker:0|!!e.Worker,history:"pushState"in e.history|0,hashchange:"onhashchange"in e|0,draganddrop:0|("draggable"in i||"ondragstart"in i&&"ondrop"in i)}};a.os.some(function(e){var t,r=e[0],i=e[1],a=e[2];if(t=n.match(i)){r=r.indexOf("$")<0?r:"$&"==r?t[0]:r.replace("$1",t[1]);if(!a||!a.test(n)){o.os=r;return!0}}});a.browser.some(function(e){var t,r=e[0],i=e[1],a=e[2];if(t=n.match(i)){r=r.indexOf("$")<0?r:"$&"==r?t[0]:r.replace("$1",t[1]);if(!a||!a.test(n)){o.browser=r;return!0}}});return o};ai.c_paraToJson=function(e){if(!e)return{};if("string"!=typeof e)return e;for(var t=e.split(Un),r={},n=0,i=t.length-1;n<i;n+=2)t[n]&&(r[t[n]]=V(t[n+1]||""));return r};ai.jsonToC_para=function(e){var t="";if("string"==typeof e)return e;for(var r in e)if(r&&A(e,r)&&0!==r.indexOf("attr-")){for(;r.indexOf(Un)>=0;)r=r.replace(Un,"");for(var n=""+e[r];n.indexOf(Un)>=0;)n=n.replace(Un,"");t+=r+Un+n+Un}return t};ai.getSCHCmdKey=function(e){if(!e||!e.tagName||e==Gi||e.contains(Gi))return"";var t=we(e);if("object"!=typeof t)return"";var r=t.c_partid,n=function(e){return e?0===e.indexOf("part_annotation")?"annotation":0===e.indexOf("part_pin")?"pin":0===e.indexOf("part_junction")?"junction":0===e.indexOf("part_busentry")?"busentry":0===e.indexOf("part_netLabel_text")?"netlabel":0===e.indexOf("part_netLabel_")?"netflag":0===e.indexOf("part_import_")?"schlib":0===e.indexOf("part_arrowhead")?"arrowhead":0===e.indexOf("part_no_connect_flag")?"noconnectflag":0===e.indexOf("part_svg")?"svgnode":"":""}(r);if(n)return n;var i=e.tagName;if("polyline"==i&&"wire"==t.c_etype)n="wire";else if("polyline"==i&&"bus"==t.c_etype)n="bus";else{n=i||"";"path"==n&&(n="arc1"==t.c_helper_type||"pie1"==t.c_helper_type?"arc":"path")}return n.toLowerCase()};ai.getPCBCmdKey=function(e){if(!e||!e.tagName||e==Gi||e.contains(Gi))return"";var t=e.tagName,r=m(e,"c_partid")||"",n="";switch(t){case"g":if(!e.childNodes.length)return"";switch(r){case"part_pad":n="PAD";break;case"part_via":n="VIA";break;case"part_hole":n="HOLE";break;case"part_pcbtext":n="TEXT";break;case"part_svg":n="SVGNODE";break;case"":e.id&&e.id.match(/^layer_/)||(n="SVGNODE");break;default:n=0===r.indexOf("part_import_")?"FOOTPRINT":""}break;case"polyline":n="TRACK";break;case"polygon":n=m(e,"stroke-dasharray")?"COPPERAREA":"SOLIDREGION";break;case"path":m(e,"attachedcopperid")?n="":"group"==m(e,"c_shapetype")?n="DIMENSION":"protractor"==m(e,"c_shapetype")?n="PROTRACTOR":"none"!=m(e,"stroke")||m(e,"fill")?(m(e,"d")||"").indexOf("A")>0&&(n="ARC"):n="SVGNODE";break;case"line":n="RATLINE";break;case"rect":n="RECT";break;case"circle":n="CIRCLE";break;case"text":n="SVGNODE";break;default:n=(t||"").toUpperCase();A(Ji,n)||(n=t.match(/^(ellipse|image|a)$/)?"SVGNODE":"")}return n};ai.createPolylineForOvalPad=function(e,t,r,n,i){e=+e;t=+t;r=+r;n=+n;i=i||0;i=+i;var a=new c(0,0),o=new c(0,0),s=0,l=(r>n?n:r)/2;if(r<n){a.x=o.x=e;s=n/2-l;a.y=t-s;o.y=t+s}else{a.y=o.y=t;s=r/2-l;a.x=e-s;o.x=e+s}var d=[a.x,a.y,o.x,o.y];d=re(d,(360-i)%360,e,t);return d};ai.convertRect2Polygon=function(e,t,r,n){return[+e,+t,+e+r,+t,+e+r,+t+n,+e,+t+n]};ai.Dots={eachAdd:function(e,t,r){var n;for(n=0;n<e.length-1;n+=2){e[n]+=t;e[n+1]+=r}return e}};ai.units={decimals:{pixel:2,mil:1,mm:3,inch:3},isUnit:function(e){return/^(pixel|mil|mm|inch)$/i.test(e)},changeElementsUnit:function(e,t,r){if(t!=r&&ai.units.isUnit(t)&&ai.units.isUnit(r))for(var n=ai.units.decimals[r],i=0;i<e.length;i++){var a=e[i].value.toLowerCase(),o=a.replace(/\D+$/,"");if(o&&isFinite(o)){e[i].value=ai.toFixed(ai.units.convert(+o,t,r),n)+r;e[i].setAttribute("oldval",e[i].value)}}},convert:function(e,t,r){if(t==r)return e;t=t.toLowerCase();r=r.toLowerCase();if("cm"==t){t="mm";e*=10}if("cm"==r){r="mm";e*=.1}"px"==t&&(t="pixel");"px"==r&&(r="pixel");switch(t+"2"+r){case"mil2pixel":return.1*e;case"mil2mm":return.0254*e;case"mil2inch":return.001*e;case"mm2pixel":return 3.937*e;case"mm2mil":return 39.37*e;case"mm2inch":return.03937*e;case"pixel2mil":return 10*e;case"pixel2mm":return.254*e;case"pixel2inch":return.01*e;case"inch2pixel":return 100*e;case"inch2mil":return 1e3*e;case"inch2mm":return 25.4*e}throw Error("Not supported unit convert "+t+" to "+r)}};ai.formatDate=function(e,t){if(e){var r={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in r)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?r[n]:("00"+r[n]).substr((""+r[n]).length)));return t}};c.prototype={toString:function(){return ai.toFixed(this.x,1)+"_"+ai.toFixed(this.y,1)}};ai.arc={c_helper_lines:[{type:"path_arc"},{from:0,to:1},{type:"rect_center_corner",center:0,corner:1},{from:0,to:2,ray:1},{from:0,to:3,ray:1}],c_helper_lines_pie1:[{type:"path_arc"},{from:0,to:1},{type:"rect_center_corner",center:0,corner:1},{from:2,to:0,ray:-1},{from:3,to:0,ray:-1}],getDotByAngle:function(e,t,r){var n=Math.PI,i=.5*n,a=n+n;r%=a;r<0&&(r+=a);if(0===r)return{x:e,y:0};if(r==i)return{x:0,y:t};if(r==n)return{x:-e,y:0};if(r==1.5*n)return{x:0,y:-t};var o=Math.tan(r),s=Math.sqrt(1/(1/(e*e)+o*o/(t*t)));r>i&&r<1.5*n&&(s=-s);var l=s?s*o:r<n?t:-t;r>n!=l<0&&(l=-l);return{x:s,y:l}},getAngle:function(e,t){if(0===e&&0===t)return null;var r=Math.atan2(t,e);return r<0?r+Math.PI+Math.PI:r},getArcParams:function(e,t,r,n,i,a,o,s){var l={fa:1,fs:0,angle:0},c=ai.arc.getAngle(i-e,a-t),d=ai.arc.getAngle(o-e,s-t);if(null===c||null===d)return null;var h=ai.arc.getDotByAngle(r,n,c),u=ai.arc.getDotByAngle(r,n,d);l.x1=e+h.x;l.y1=t+h.y;l.x2=e+u.x;l.y2=t+u.y;l.a1=c;l.a2=d;var p=Math.PI,f=p+p,g=(d<c?f:0)+d-c;l.fa=g>=p?1:0;l.fs=1;return l},getArcParamsByCRA:function(e,t,r,n,i,a,o){var s={angle:0,fa:1,fs:0},l=ai.arc.getDotByAngle(r,n,i),c=ai.arc.getDotByAngle(r,n,a);s.x1=e+l.x;s.y1=t+l.y;s.x2=e+c.x;s.y2=t+c.y;s.rx=r;s.ry=n;var d=Math.PI,h=d+d,u=(a-i)%h;u<0&&(u+=h);s.fs=o?1:0;s.fa=o?u>=d?1:0:u>=d?0:1;return s},convertSvgParam2CanvasParam:function(e){e=V(e.replace(/[^0-9\., \-]/gi," "));var t=e.split(/[ ,]+/g);return 9!==t.length?null:ai.arc.getCenterParam(+t[0],+t[1],+t[7],+t[8],+t[5],+t[6],+t[2],+t[3],+t[4])||null},getCenterParam:function(e,t,r,n,i,a,o,s,l){function c(e,t,r,n){var i=e*r+t*n,a=Math.sqrt((e*e+t*t)*(r*r+n*n)),o=Math.acos(i/a);e*n-t*r<0&&(o=-o);return o}function d(e){for(var t=2*Math.PI;e>=t;)e-=t;for(;e<0;)e+=t;return e}function h(e){e.rx=o;e.ry=s;e.startAngle=e.theta1;e.endAngle=d(e.theta1+e.delta_theta);return e}var u,p,f,g;o<0&&(o=-o);s<0&&(s=-s);var y=Math.sin(l),v=Math.cos(l),m=(e-r)/2,x=(t-n)/2,_=(e+r)/2,P=(t+n)/2;if(o<1e-5||s<1e-5){f=c(1,0,r-e,n-t);return h({cx:_,cy:P,theta1:f,delta_theta:Math.PI})}var S=v*m+y*x,b=v*x-y*m,C=S*S/(o*o)+b*b/(s*s);if(C>1){o*=Math.sqrt(C);s*=Math.sqrt(C)}var A=o*s,I=o*b,L=s*S,E=I*I+L*L;if(!E)return h({cx:_,cy:P,theta1:0,delta_theta:0});var O=(A*A-E)/E;O=Math.sqrt(Math.abs(O));i==a&&(O=-O);var T=O*I/s,w=-O*L/o;u=v*T-y*w+_;p=y*T+v*w+P;var R=(S-T)/o,N=(S+T)/o,k=(b-w)/s,B=(b+w)/s;f=c(1,0,R,k);g=c(R,k,-N,-B);for(var M=2*Math.PI;g>M;)g-=M;for(;g<0;)g+=M;!1!==a&&0!==a||(g-=M);return h({cx:u,cy:p,theta1:f,delta_theta:g})},calculateArcHelperDots:function(e){var t,r,n,i,a,o,s,l,c,d,h,u=e.pathSegList,p=u.numberOfItems,f=p>0&&u.getItem(0),g=p>1&&u.getItem(1),y=p>2&&u.getItem(2);if(p<2)return[];if(2==p&&"A"==g.pathSegTypeAsLetter){h=g;t=f.x;r=f.y}else{if(!(p>=3&&"L"==g.pathSegTypeAsLetter&&"A"==y.pathSegTypeAsLetter))return[];h=y;t=g.x;r=g.y}n=h.x,i=h.y,a=h.largeArcFlag,o=h.sweepFlag,s=h.r1,l=h.r2,c=h.angle,d=c*Math.PI/180;var v=ai.arc.getCenterParam(t,r,n,i,a,o,s,l,d),m=ai.toFixed(v.cx,2),x=ai.toFixed(v.cy,2),_=c%180==90||c%180==-90,P=m+(_?l:s),S=x+(_?s:l),b=[m,x,P,S,t,r,n,i];b.path_arc=["M"+t,r+"A"+s,l,c,1-a,1-o,n,i].join(" ");return b},getArcParamsBy3Points:function(e,t,r,n,i,a){function o(e,t,r){var n=Math.acos(e/r);return t>=0?n:2*Math.PI-n}var s=r-e,l=i-e,c=n-t,d=a-t,h=e*e,u=r*r,p=i*i,f=t*t,g=n*n,y=a*a,v=(c*(y-f+p-h)-d*(g-f+u-h))/(2*l*c-2*s*d),m=(s*(p-h+y-f)-l*(u-h+g-f))/(2*d*s-2*c*l);if(isFinite(v)&&isFinite(m)){var x=Math.sqrt((e-v)*(e-v)+(t-m)*(t-m)),_=[e-i,t-a],P=[r-i,n-a],S=_[0]*P[0]+_[1]*P[1],b=S<0?0:1,C=o(e-v,t-m,x),A=o(r-v,n-m,x),I=o(i-v,a-m,x),L=0;I>C?(A>I||A<C)&&(L=1):A>I&&A<C&&(L=1);return{r1:x,r2:x,angle:0,largeArcFlag:b,sweepFlag:L,x:r,y:n,cx:v,cy:m}}},getCenterPoint:function(e,t,r,n,i,a,o,s,l){var c=ai.arc.getCenterParam(e,t,r,n,i,a,o,s,l);return{x:c.cx,y:c.cy}}};ai.fileType={getIcon:function(e){var t="";switch(e+""){case Dn.SCH:case Dn.SCHMODULE:t="icon-eda-sch";break;case Dn.SCHLIB:case Dn.SUBPART:t="icon-eda-eelib";break;case Dn.PCB:case Dn.PCBMODULE:t="icon-eda-pcb";break;case Dn.PCBLIB:t="icon-pcblib";break;case Dn.SPICESYMBOL:t="icon-spicesymbol";break;case Dn.SUBCKT:t="icon-subckt";break;case Dn.WAVEFORM:t="icon-waveform";break;case Dn.PHOTOVIEW:t="icon-eda-pcb";break;case Dn.PRJ:t="icon-prj"}return t},getNewTitle:function(e){var t="New";switch(e+""){case Dn.PRJ:t="New Project";break;case Dn.SCH:case Dn.SUBCKT:t="Sheet";break;case Dn.SCHMODULE:t="New Schematic Module";break;case Dn.SUBCKT:t="Sheet";break;case Dn.SCHLIB:t="New Schematic Lib";break;case Dn.SPICESYMBOL:t="New_Spice_Symbol";break;case Dn.PCB:t="NEW_PCB";break;case Dn.PCBMODULE:t="New PCB Module";break;case Dn.PCBLIB:t="NEWPCBLIB";break;case Dn.WAVEFORM:t="WaveForm";break;case Dn.PHOTOVIEW:t="Photo View"}return t},getSaveAsDlgTitle:function(e){var t="Save as";switch(e+""){case Dn.PRJ:t="Save as a new project";break;case Dn.SCH:t="Save as a schematic";break;case Dn.SCHLIB:t="Save as a schematic Lib";break;case Dn.SPICESYMBOL:t="Save as a spice Symbol";break;case Dn.SUBCKT:t="Save as a spice subckt";break;case Dn.PCB:t="Save as a PCB file";break;case Dn.PCBLIB:t="Save as a PCB Lib";break;case Dn.PHOTOVIEW:t="Save as a Photo View";break;case Dn.WAVEFORM:t="Save as a WaveForm";break;case Dn.SCHMODULE:t="Save as a Schematic Module";break;case Dn.PCBMODULE:t="Save as a PCB Module"}return t},getAbstractFileType:function(e){switch(e+""){case Dn.SCH:case Dn.SUBCKT:case Dn.SCHMODULE:return"sch";case Dn.SCHLIB:case Dn.SUBPART:case Dn.SPICESYMBOL:return"schlib";case Dn.PCB:case Dn.PCBMODULE:return"pcb";case Dn.PCBLIB:return"pcblib";case Dn.WAVEFORM:return"waveform";case Dn.PHOTOVIEW:return"photoview"}},mergeFileType:function(e){return e==Dn.PCB||e==Dn.PCBLIB||e==Dn.PHOTOVIEW?"pcb_pcblib":"sch_schlib_waveform"},isLib:function(e){var t=ai.fileType.getAbstractFileType(e);return"schlib"==t||"pcblib"==t},isModule:function(e){return e==Dn.SCHMODULE||e==Dn.PCBMODULE},isComponent:function(e){return ai.fileType.isLib(e)||ai.fileType.isModule(e)},isDocument:function(e){return e==Dn.SCH||e==Dn.SUBCKT||e==Dn.PCB||e==Dn.WAVEFORM},getApi:function(e,t){var r;switch(e+""){case Dn.PRJ:r=Yn.apis.projects;break;case Dn.SCH:case Dn.SUBCKT:case Dn.PCB:case Dn.WAVEFORM:r=Yn.apis.document;break;case Dn.SCHLIB:case Dn.SUBPART:case Dn.SPICESYMBOL:case Dn.SCHMODULE:case Dn.PCBMODULE:case Dn.PCBLIB:r=Yn.apis.components;break;case Dn.PHOTOVIEW:}if(r&&!t)return r;if(!r||!t||!r[t])throw Error("No such api");return r[t]},needProject:function(e){return e==Dn.SCH||e==Dn.SUBCKT||e==Dn.PCB||e==Dn.WAVEFORM}};ai.toFixed=function(e,t){"number"!=typeof e&&(e=+e);if(isNaN(e))return NaN;t|=0;if(t<=0||!e)return Math.round(e);var r=Bn[t]||Math.pow(10,t)||10;return Math.round(e*r)/r};ai.toFixedString=function(e,t){if(!e||"string"!=typeof e)return"";var r=/\d+\.\d{12,}/g,n=Bn[t]||Math.pow(10,t)||10;return e.replace(r,function(e){return Math.round(e*n)/n})};ai.isDotInRect=function(e,t,r){return 3==arguments.length?e>=r.x&&e<=r.x+r.width&&t>=r.y&&t<=r.y+r.height:ai.isDotInRect(e.x,e.y,t)};ai.isDotInArea=function(e,t,r,n,i,a){if(r>i){var o=r;r=i;i=o}if(n>a){var s=n;n=a;a=s}return e>=r&&e<=i&&t>=n&&t<=a};ai.bbox2Polygon=function(e){e.x,e.y,e.x,e.width,e.y,e.x,e.y,e.x,e.y};ai.isRectInRect=function(e,t){return ai.isDotInRect(e.x,e.y,t)&&ai.isDotInRect(e.x+e.width,e.y,t)&&ai.isDotInRect(e.x,e.y+e.height,t)&&ai.isDotInRect(e.x+e.width,e.y+e.height,t)};ai.combineBox=function(e,t){var r=Math.max(e.x+e.width,t.x+t.width),n=Math.max(e.y+e.height,t.y+t.height),i=Math.min(e.x,t.x),a=Math.min(e.y,t.y);return{x:i,y:a,width:r-i,height:n-a}};ai.combineMultiBox=function(e){if(M(e)){for(var t=[],r=[],n=[],i=[],a=0;a<e.length;a++){t.push(e[a].x+e[a].width);r.push(e[a].y+e[a].height);n.push(e[a].x);i.push(e[a].y)}var o=Math.max.apply(null,t),s=Math.max.apply(null,r),l=Math.min.apply(null,n),c=Math.min.apply(null,i);return{x:l,y:c,width:o-l,height:s-c}}};ai.isRectTouchRect=function(e,t){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y};ai.isPolylineTouchRect=function(e,t){for(var r=e.points,n=r.length||r.numberOfItems,i=0;i<n;i++)if(ai.isDotInRect(r.getItem(i).x,r.getItem(i).y,t))return!0;var a,o,s,l,c,d,h,u,p={x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height};for(i=1;i<n;i++){a={x1:r.getItem(i-1).x,y1:r.getItem(i-1).y,x2:r.getItem(i).x,y2:r.getItem(i).y};o=a.x2-a.x1;s=a.y2-a.y1;l={};if(o>0){l.x1=a.x1;l.x2=a.x2}else{l.x1=a.x2;l.x2=a.x1}if(s>0){l.y1=a.y1;l.y2=a.y2}else{l.y1=a.y2;l.y2=a.y1}if(!(l.x1>p.x2||l.x2<p.x1||l.y1>p.y2||l.y2<p.y1)){c=s*(p.x1-a.x1)-o*(p.y1-a.y1);d=s*(p.x1-a.x1)-o*(p.y2-a.y1);h=s*(p.x2-a.x1)-o*(p.y1-a.y1);u=s*(p.x2-a.x1)-o*(p.y2-a.y1);if(!(c>0&&d>0&&h>0&&u>0||c<0&&d<0&&h<0&&u<0))return!0}}return!1};ai.isPolygonTouchRect=function(e,t){for(var r=e.points,n=r.length||r.numberOfItems,i=0;i<n;i++)if(ai.isDotInRect(r.getItem(i).x,r.getItem(i).y,t))return!0;var a,o,s,l,c,d,h,u,p={x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height};for(i=0;i<n;i++){a=0===i?{x1:r.getItem(n-1).x,y1:r.getItem(n-1).y,x2:r.getItem(i).x,y2:r.getItem(i).y}:{x1:r.getItem(i-1).x,y1:r.getItem(i-1).y,x2:r.getItem(i).x,y2:r.getItem(i).y};o=a.x2-a.x1;s=a.y2-a.y1;l={};if(o>0){l.x1=a.x1;l.x2=a.x2}else{l.x1=a.x2;l.x2=a.x1}if(s>0){l.y1=a.y1;l.y2=a.y2}else{l.y1=a.y2;l.y2=a.y1}if(!(l.x1>p.x2||l.x2<p.x1||l.y1>p.y2||l.y2<p.y1)){c=s*(p.x1-a.x1)-o*(p.y1-a.y1);d=s*(p.x1-a.x1)-o*(p.y2-a.y1);h=s*(p.x2-a.x1)-o*(p.y1-a.y1);u=s*(p.x2-a.x1)-o*(p.y2-a.y1);if(!(c>0&&d>0&&h>0&&u>0||c<0&&d<0&&h<0&&u<0))return!0}}return!1};ai.svg={getRefPoint:function(e){var t;switch(e&&e.tagName){case"path":var r=e.pathSegList.getItem(0);r&&"M"==r.pathSegTypeAsLetter&&(t=[r.x,r.y]);break;case"svg":case"text":case"rect":case"image":t=[+m(e,"x"),+m(e,"y")];break;case"circle":case"ellipse":t=[+m(e,"cx"),+m(e,"cy")];break;case"line":t=[+m(e,"x1"),+m(e,"y1")];break;case"polygon":case"polyline":var n=e.points.getItem(0);n&&(t=[n.x,n.y]);break;case"g":var i=m(e,"c_origin");if(i){i=i.replace(/\s+/g,"").split(/,/);i[0]-=0;i[1]-=0;t=i}else{var a=u("g[c_origin], svg, path, text, rect, image, circle, ellipse, line, polygon, polyline",e);a&&(t=ai.svg.getRefPoint(a))}}if(t)return{x:t[0],y:t[1]}},transformPoint:function(e,t){return{x:e.x*t.a+e.y*t.c+t.e,y:e.x*t.b+e.y*t.d+t.f}},transformBox:function(e,t){for(var r,n=[e.x,e.x+e.width,e.x,e.x+e.width],i=[e.y,e.y,e.y+e.height,e.y+e.height],a=0;a<4;a++){r=ai.svg.transformPoint({x:n[a],y:i[a]},t);n[a]=r.x;i[a]=r.y}var o=Math.min.apply(0,n),s=Math.min.apply(0,i);return{x:o,y:s,width:Math.max.apply(0,n)-o,height:Math.max.apply(0,i)-s}},isZeroBox:function(e){return!(e.x||e.y||e.width||e.height)},getBBox:function(e){try{var t=e.getBBox();return{x:t.x,y:t.y,width:t.width,height:t.height}}catch(e){return{x:0,y:0,width:0,height:0}}},getBBoxMerged:function(e,t){if(!e||!e.length)return{x:0,y:0,width:0,height:0};for(var r,n=0;n<e.length;n++)if(e[n]){var i=ai.svg.getViewBBox(e[n],t);if(i.x||i.y||i.width||i.height)if(r){r.width=Math.max(i.x+i.width,r.x+r.width)-Math.min(i.x,r.x);r.height=Math.max(i.y+i.height,r.y+r.height)-Math.min(i.y,r.y);r.x=Math.min(i.x,r.x);r.y=Math.min(i.y,r.y)}else r=i}return r||{x:0,y:0,width:0,height:0}},getElementsCenter:function(e,t){if(!e||!e[0])return{x:0,y:0};var r=ai.svg.getBBoxMerged(e,t);return{x:ai.toFixed(r.x+r.width/2,3),y:ai.toFixed(r.y+r.height/2,3)}},getBBoxFixed:function(t,r){function n(t){var r=e.getComputedStyle&&getComputedStyle(t);return!r||"none"==r.display}function i(e){for(var t,r,a,l=e.children||[].filter.call(e.childNodes,function(e){return 1===e.nodeType}),c=0,d=l.length;c<d;c++){a=l[c];if(o){if("text"==a.tagName)continue;if("g"==a.tagName){var h=m(a,"c_partid");if("part_annotation"==h||"part_pcbtext"==h)continue}}if((!s||!f(a,"pindot"))&&("none"!=m(a,"display")&&"none"!=a.style.display&&!n(a))){try{r=a.getBBox();if(!(r.width||r.height||r.x||r.y))continue}catch(e){continue}"g"==a.tagName?r=i(a):"path"==a.tagName&&(r=ai.svg.getBBoxForPath(a));if(r&&(r.width||r.height)){if(m(a,"transform"))try{var u=a.getTransformToElement(e);r=ai.svg.transformBox(r,u)}catch(e){}t=t?ai.combineBox(t,r):r}}}return t||{x:0,y:0,width:0,height:0}}var a,o=r&&r.excludeText,s=r&&r.excludePindot;if("g"!=t.tagName){var l=m(t,"display")||"",c=t.style.display;m(t,"display","");t.style.display="inline !important";a="path"==t.tagName?ai.svg.getBBoxForPath(t):ai.svg.getBBox(t);m(t,"display",l);t.style.display=c;return a}a=ai.svg.getBBox(t);if(!a.width&&!a.height)return a;if((a.x||a.y)&&!o)return a;a=i(t);a.width||a.height||(a=ai.svg.getBBox(t));return a},getBBoxExcludeText:function(e){return ai.svg.getBBoxFixed(e,{excludeText:!0})},hasBBoxBugForPath:function(){var e=t.createElement("div");e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg"><path d="M 0 0 C 0 100 100 0 10 10"/></svg>';t.body.appendChild(e);var r=!1;try{var n=e.querySelector("path").getBBox();r=47!=(0|n.width)||44!=(0|n.height)}catch(e){}t.body.removeChild(e);return r}(),getBBoxForPath:function(e,t){var r,n,i=ai.svg.getBBox(e);if(!(i.width||i.height||i.x||i.y)){r=e.getPointAtLength(0);return{x:r.x,y:r.y,width:0,height:0}}if(!ai.svg.hasBBoxBugForPath)return i;if(!/[cqst]/i.test(m(e,"d")))return i;if(navigator.userAgent.indexOf("AppleWebKit")<0)return i;n=e.getTotalLength();if(n<=0){r=e.getPointAtLength(0);return{x:r.x,y:r.y,width:0,height:0}}("number"!=typeof t||t<=0)&&(t=5);t=Math.min(.1*n,Math.max(t,.01*n));for(var a=0,o=[],s=[];a<n;){r=e.getPointAtLength(a);o.push(r.x);s.push(r.y);a+=t}r=e.getPointAtLength(n);o.push(r.x);s.push(r.y);i.x=Math.min.apply(0,o);i.y=Math.min.apply(0,s);i.width=Math.max.apply(0,o)-i.x;i.height=Math.max.apply(0,s)-i.y;return i},getViewBBox:function(e,t){var r=ai.svg.getBBoxFixed(e,{excludeText:t});if(m(e,"transform")){var n=fi.contains(e)?fi:e.parentNode;if(n)try{var i=e.getTransformToElement(n);r=ai.svg.transformBox(r,i)}catch(e){}}r.x=ai.toFixed(r.x,3);r.y=ai.toFixed(r.y,3);r.width=ai.toFixed(r.width,3);r.height=ai.toFixed(r.height,3);return r},setTooltip:function(e,t){if(e&&e.tagName&&e.children){var r,n;for(r=0;r<e.children.length;r++)if("title"==e.children[r].tagName){n=e.children[r];break}if(t){n||(n=e.appendChild(Ue("title")));ai.node.setTextContent(n,t)}else n&&e.removeChild(n)}},getPathHelperType:function(e){if(e&&"path"==e.tagName){for(var t=e.pathSegList,r=t.numberOfItems,n="",i=0;i<r&&i<5;i++)n+=t.getItem(i).pathSegTypeAsLetter;return"MA"==n?t.getItem(1).r1!=t.getItem(1).r2||Qi!=Dn.PCBLIB&&Qi!=Dn.PCB?"arc1":"arc2":/^(?:MALZ|MLAZ|MLLAZ?)$/.test(n)?"pie1":void 0}},deletePathPointAtCdot:function(e,t){function r(e){return e.pathSegTypeAsLetter}function n(e){return{M:1,L:1,H:1,V:1,A:1,T:1,S:2,Q:2,C:3,Z:0}[e.toUpperCase()]||0}if(!(!e||"path"!=e.tagName||isNaN(t)||t<0)){if(!ai.svg.getPathHelperType(e))for(var i=ki.get(e),a=e.pathSegList,o=a.numberOfItems,s=[],l=-1,c=0;c<o;c++){var d,h,u,p,f,g=a.getItem(c),y=r(g),v=(c&&r(a.getItem(c-1)),c+1<o?r(a.getItem(c+1)):"");u=void 0===s[c]?s[c]=n(y):s[c];v&&(p=void 0===s[c+1]?s[c+1]=n(v):s[c+1]);if("M"!=y.toUpperCase()||v&&"M"!=v.toUpperCase()&&"Z"!=v){l+=u;if(!(l<t)){if(l>t)return;switch(y.toUpperCase()){case"M":f=l+p;if("M"==y){g.x=i[2*f];g.y=i[2*f+1]}else{g.x+=i[2*f]-i[2*l];g.y+=i[2*f+1]-i[2*l+1]}var m=function(e,t,n){for(var i=e.numberOfItems,a=n||0;a<i;a++){var o=r(e.getItem(a));if("M"==o||"m"==o)return a>n?-1:a;if(o==t)return a}return-1}(a,"Z",c+1);if(m>=0){h=e.createSVGPathSegLinetoAbs(i[2*l],i[2*l+1]);a.replaceItem(h,m)}a.removeItem(c+1);return;case"L":case"H":case"V":case"T":case"A":a.removeItem(c);return;case"S":case"Q":a.removeItem(c);return;case"C":switch(y+v){case"CC":d=a.getItem(c+1);d.x1=i[2*(l-2)];d.y1=i[2*(l-2)+1];a.removeItem(c);return;case"CS":g.x2=i[2*(l+1)];g.y2=i[2*(l+1)+1];a.removeItem(c+1);return
;case"Cc":d=a.getItem(c+1);d.x1=i[2*(l-2)]-i[2*(l-3)];d.y1=i[2*(l-2)+1]-i[2*(l-3)+1];d.x2=i[2*(l+2)]-i[2*(l-3)];d.y2=i[2*(l+2)+1]-i[2*(l-3)+1];d.x=i[2*(l+3)]-i[2*(l-3)];d.y=i[2*(l+3)+1]-i[2*(l-3)+1];a.removeItem(c);return;case"Cs":h=e.createSVGPathSegCurvetoCubicRel(i[2*f-2],i[2*f-1]);h.x1=i[2*(l-2)]-i[2*(l-3)];h.y1=i[2*(l-2)+1]-i[2*(l-3)+1];h.x2=i[2*(l+2)]-i[2*(l-3)];h.y2=i[2*(l+2)+1]-i[2*(l-3)+1];h.x=i[2*(l+3)]-i[2*(l-3)];h.y=i[2*(l+3)+1]-i[2*(l-3)+1];a.replaceItem(h,c);a.removeItem(c+1);return;case"cC":case"cS":case"cc":case"cs":default:a.removeItem(c)}return;default:return}}}}}},fixOperaPathDAttribute:function(e){var t,r,n,i=e.pathSegList,a=i.numberOfItems,o="";for(r=0;r<a;r++){t=i.getItem(r);n=t.pathSegTypeAsLetter;switch(n.toUpperCase()){case"M":case"L":case"T":o+=n+t.x+" "+t.y;break;case"H":o+=n+t.x;break;case"V":o+=n+t.y;break;case"C":o+=n+t.x1+" "+t.y1+" "+t.x2+" "+t.y2+" "+t.x+" "+t.y;break;case"S":o+=n+t.x2+" "+t.y2+" "+t.x+" "+t.y;break;case"Q":o+=n+t.x1+" "+t.y1+" "+t.x+" "+t.y;break;case"A":o+=n+t.r1+" "+t.r2+" "+t.angle+" "+ +t.largeArcFlag+" "+ +t.sweepFlag+" "+t.x+" "+t.y;break;case"Z":o+=n}}e.setAttribute("d",o)},fixOrigin:function(e){var t=m(e,"c_origin");if(t){var r=ai.svg.getBBox(e);if(r.x||r.y||r.width||r.height){var n=t.split(","),i=+n[0],a=+n[1],o=bi.adsorbGrid.gridSize,s=r.x+r.width/2,l=r.y+r.height/2,c=0,d=0;(i<r.x-10||i>r.x+r.width+10)&&(c=Math.round((s-i)/o));(a<r.y-10||a>r.y+r.height+10)&&(d=Math.round((l-a)/o));(c||d)&&m(e,"c_origin",i+c*o+","+(a+d*o))}}}};ai.node={clearChildNodes:function(e){for(;e&&e.lastChild;)e.removeChild(e.lastChild)},getRefId:function(e){return e.nextElementSibling?e.nextElementSibling.id:e.parentNode?"<"+e.parentNode.id:""},isSame:function(e,t){if(!e||!t)return!1;var r=new XMLSerializer;return r.serializeToString(e)==r.serializeToString(t)},contains:function(e,t){return e.contains?e!=t&&e.contains(t):20==e.compareDocumentPosition(t)},children:function(e){return e.children||[].filter.call(e.childNodes,function(e){return 1===e.nodeType})},setTextContent:function(t,r){if(t)try{t.textContent=r}catch(t){try{var n=e.__TEXTCONTENT_DESCRIPTOR;if(n){var i={}.toString.call(n.set);i.indexOf("[native code]")<0&&Object.defineProperty(Node.prototype,"textContent",n)}}catch(e){}}}};var wi={move:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);!e||0===t&&0===r||wi[e.tagName](e,t,r)},g:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);if(e&&(0!==t||0!==r)){for(var n=e.children,i=n.length,a=0;a<i;a++)wi.hasOwnProperty(n[a].tagName)&&wi[n[a].tagName](n[a],t,r);if(m(e,"c_origin")){var o=m(e,"c_origin");o=ai.numberlistToArray(o);o[0]=ai.toFixed(o[0]+t,4);o[1]=ai.toFixed(o[1]+r,4);m(e,"c_origin",o.join(","))}}},svg:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);if(e&&(0!==t||0!==r)){0!==t&&m(e,{x:+(m(e,"x")||0)+t});0!==r&&m(e,{y:+(m(e,"y")||0)+r})}},rect:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);!e||0===t&&0===r||wi.svg(e,t,r)},text:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);if(e&&(0!==t||0!==r)){var n,i=+(m(e,"x")||0),a=+(m(e,"y")||0),o=m(e,"transform")||"";o&&(n=o.match(/rotate\((-?[\d.]+)[,\s].+\)/))?m(e,{x:i+t,y:a+r,transform:"rotate("+n[1]+","+(i+t)+","+(a+r)+")"}):m(e,{x:i+t,y:a+r});for(var s=h("tspan",e),l=s.length,c=0;c<l;c++)m(s[c],{x:i+t})}},image:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);if(e&&(0!==t||0!==r)){var n=+(m(e,"x")||0),i=+(m(e,"y")||0),a=+m(e,"width"),o=+m(e,"height"),s=ie(e);m(e,{x:n+t,y:i+r});if(s){m(e,"transform",pe({x:n+t,y:i+r,width:a,height:o},s))}}},circle:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);!e||0===t&&0===r||m(e,{cx:+m(e,"cx")+t,cy:+m(e,"cy")+r})},ellipse:function(e,t,r){wi.circle(e,t,r)},line:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);!e||0===t&&0===r||m(e,{x1:+m(e,"x1")+t,x2:+m(e,"x2")+t,y1:+m(e,"y1")+r,y2:+m(e,"y2")+r})},polyline:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);if(e&&(0!==t||0!==r)){for(var n=V(m(e,"points")).split(/[\s\,]+/g),i=0;i<n.length-1;i+=2){n[i]=ai.toFixed(+n[i]+t,4);n[i+1]=ai.toFixed(+n[i+1]+r,4)}m(e,{points:n.join(" ")})}},polygon:function(e,t,r){wi.polyline(e,t,r)},path:function(e,t,r){isFinite(t)||(t=0);isFinite(r)||(r=0);if(e&&(0!==t||0!==r)){if(ti);!function(t,r){function n(e,t,r){e[t]=ai.toFixed(e[t]+r,4)}for(var i=e.getPathData(),a=i.length,o=0;o<a;o++){var s=i[o],l=s.type,c=s.values;switch(l){case"M":case"L":case"T":n(c,0,t);n(c,1,r);break;case"H":n(c,0,t);break;case"V":n(c,0,r);break;case"C":n(c,0,t);n(c,1,r);n(c,2,t);n(c,3,r);n(c,4,t);n(c,5,r);break;case"S":case"Q":n(c,0,t);n(c,1,r);n(c,2,t);n(c,3,r);break;case"A":n(c,5,t);n(c,6,r)}}e.setPathData(i)}(t,r)}}},Ri={rotate:function(e,t,r,n){var i,a;if(void 0===r||void 0===n)if("g"!==e.tagName||"part_annotation"==m(e,"c_partid")){i=ai.svg.getViewBBox(e);r=ai.toFixed(i.x+i.width/2,3);n=ai.toFixed(i.y+i.height/2,3)}else{var o=m(e,"c_origin");if(o){a=o.split(",");r=+a[0];n=+a[1]}else{i=ai.svg.getViewBBox(e);r=ai.toFixed(i.x+i.width/2,3);n=ai.toFixed(i.y+i.height/2,3)}}"g"!=e.tagName||"part_annotation"!=m(e,"c_partid")?Ri[e.tagName]&&Ri[e.tagName](e,t,r,n):Ri.annotation(e,t,r,n)},groupRotate:function(e,t,r,n){var i,a,o,s,l=e.length;if(l)if(l<2)Ri.rotate(e[0],t,r,n);else if(void 0===r||void 0===n){for(i=0;i<l;i++)if("text"!=e[i].tagName&&!m(e[i],"c_origin")){a=!0;break}if(a)for(i=0;i<l;i++){s=function(e){try{return e.getBBox()}catch(e){}}(e[i]);if(s)if(o){o.x=Math.min(o.x,s.x);o.y=Math.min(o.y,s.y);o.x2=Math.max(o.x2,s.x+s.width);o.y2=Math.max(o.y2,s.y+s.height)}else o={x:s.x,y:s.y,x2:s.x+s.width,y2:s.y+s.height}}else for(i=0;i<l;i++){s=function(e){if(e){var t=e.split(",");return{x:+t[0],y:+t[1]}}}(m(e[i],"c_origin"));s||"text"!=e[i].tagName||(s={x:+m(e[i],"x"),y:+m(e[i],"y")});if(s)if(o){o.x=Math.min(o.x,s.x);o.y=Math.min(o.y,s.y);o.x2=Math.max(o.x2,s.x);o.y2=Math.max(o.y2,s.y)}else o={x:s.x,y:s.y,x2:s.x,y2:s.y}}if(o){r=ai.toFixed((o.x+o.x2)/2,3);n=ai.toFixed((o.y+o.y2)/2,3);for(i=0;i<l;i++)Ri.rotate(e[i],t,r,n)}}else for(i=0;i<l;i++)Ri.rotate(e[i],t,r,n)},g:function(e,t,r,n){void 0===t&&(t=270);if(t%360!=0){var i,a,o,s,l=m(e,"c_origin");if(void 0===r||void 0===n)if(l){i=l.split(",");r=+i[0];n=+i[1]}else{a=e.getBBox();r=a.x+a.width/2|0;n=a.y+a.height/2|0}else if(l){i=l.split(",");o=[+i[0],+i[1]];o=re(o,t,r,n);m(e,"c_origin",o.join(","))}if(l){s=+(m(e,"c_rotation")||0);s=oe(s-t);m(e,"c_rotation",s)}if("part_pin"!=m(e,"c_partid")){for(var c,d,h,u=e.children||e.childNodes,p=u.length,f=0;f<p;f++){if(Qi==Dn.SCH&&"g"==u[f].tagName&&"text"==u[f].firstChild.tagName){c=m(u[f].firstChild,"c_note");if("note_pre"==c){d=u[f].firstChild;continue}if("note_name"==c){h=u[f].firstChild;continue}}Ri.rotate(u[f],t,r,n)}(d||h)&&resetPositionOfPreAndName(d,h)}else Ri.pin(e,t,r,n)}},svg:function(e,t,r,n){var i=m(e,"x"),a=m(e,"y");if(void 0===r||void 0===n)Ri.rotate(e,t,i,a);else if(null===i||null===a)for(var o=e.children||e.childNodes,s=o.length,l=0;l<s;l++)Ri.hasOwnProperty(o[l].tagName)&&Ri.rotate(o[l],t,r,n);else null!==i&&null!==a&&Ri.image(e,t,r,n)},rect:function(e,t,r,n){m(e,ne({x:+m(e,"x"),y:+m(e,"y"),width:+m(e,"width"),height:+m(e,"height")},t,r,n))},text:function(e,t,r,n){void 0===t&&(t=270);var i,a,o=m(e,"text-anchor")||"start",s=m(e,"transform");i="end"==o?s?270:180:s?90:0;var l=s;l&&l.match(/[\d\.\-]+/)[0];a=oe(i-t);var c,d,u,p;try{c=e.getBBox()}catch(e){c={width:0}}if(0===c.width||0===c.height){var f={},g=+m(e,"x"),y=+m(e,"y"),v=[g,y];void 0!==r&&void 0!==n&&(v=re(v,t,r,n));f.x=v[0];f.y=v[1];o=0===a||90==a?"start":"end";s=0===a||180==a?"":"rotate(270,"+f.x+","+f.y+")";f["text-anchor"]=o;f.transform=s;m(e,f);d=h("tspan",e);for(u=0,p=d.length;u<p;u++)m(d[u],{x:f.x})}else{var x=ue(e),_=ne(x,t,r,n),P=0===a||90==a?"start":"end",S=0===a||180==a?"":"rotate(270,"+_.x+","+_.y+")";m(e,{x:_.x,y:_.y,"text-anchor":P,transform:S});var b=ue(e),C=_.x-b.x,A=_.y-b.y,I=S?"rotate(270,"+(_.x+C)+","+(_.y+A)+")":"";m(e,{x:_.x+C,y:_.y+A,"text-anchor":P,transform:I});d=h("tspan",e);for(u=0,p=d.length;u<p;u++)m(d[u],{x:_.x+C})}},pin:function(e,t,r,n){for(var i=h("text",e),a=i[0],o=i[1],s=u("circle",e),l=m(a,"x")-m(s,"cx"),c=m(a,"y")-m(s,"cy"),d=m(o,"x")-m(s,"cx"),p=m(o,"y")-m(s,"cy"),f=e.children||e.childNodes,g=f.length,y=0;y<g;y++){var v=f[y],x=v.tagName;x&&v!=a&&v!=o&&Ri[x]&&Ri[x](f[y],t,r,n)}var _,P,S=+m(s,"cx"),b=+m(s,"cy"),C={},A=m(a,"text-anchor")||"start",I=m(a,"transform");_="end"==A?I?90:0:I?270:180;P=oe(_-t);y=_/90|0;var L=[l,-c,-l,c][y],E=[c,l,c,l][y];y=P/90|0;var O=[L,E,-L,E][y],T=[E,-L,E,L][y],w=S+O,R=b+T;C.x=w;C.y=R;C["text-anchor"]=0===P||90==P?"end":"start";C.transform=90==P||270==P?"rotate(270,"+w+","+R+")":"";m(a,C);y=_/90|0;var N=[d,-p,-d,p][y],k=[p,d,p,d][y];y=P/90|0;var B=[N,k,-N,k][y],M=[k,-N,k,N][y],V=S+B,G=b+M;C.x=V;C.y=G;C["text-anchor"]=0===P||90==P?"start":"end";C.transform=90==P||270==P?"rotate(270,"+V+","+G+")":"";m(o,C)},image:function(e,t,r,n){if(0!==t){var i=ai.svg.getViewBBox(e);if(void 0===r||void 0===n){r=ai.toFixed(i.x+i.width/2,3);n=ai.toFixed(i.y+i.height/2,3)}var a=(m(e,"x"),m(e,"y"),+m(e,"width")||0),o=+m(e,"height")||0,s=oe(ie(e)+t),l=ne(i,t,r,n),c={x:l.x,y:l.y,c_rotation:oe(360-s)};i={x:c.x,y:c.y,width:a,height:o};c.transform=pe(i,s);m(e,c)}},circle:function(e,t,r,n){var i=[m(e,"cx"),m(e,"cy")];i=re(i,t,r,n);m(e,{cx:i[0],cy:i[1]})},ellipse:function(e,t,r,n){var i=[m(e,"cx"),m(e,"cy")];i=re(i,t,r,n);m(e,{cx:i[0],cy:i[1]});if(t%180!=0){var a=m(e,"rx");m(e,{rx:m(e,"ry"),ry:a})}},line:function(e,t,r,n){var i=[m(e,"x1"),m(e,"y1"),m(e,"x2"),m(e,"y2")];i=re(i,t,r,n);m(e,{x1:i[0],y1:i[1],x2:i[2],y2:i[3]})},polyline:function(e,t,r,n){void 0===t&&(t=270);var i=V(m(e,"points")).split(/[\s\,]+/);i=re(i,t,r,n);m(e,{points:i.join(" ")})},polygon:function(e,t,r,n){Ri.polyline(e,t,r,n)},path:function(e,t,r,n){if(t%360!=0){t=oe(t);for(var i,a,o,s,l,c,d,h,u,p=ti,f=e.pathSegList,g=f.numberOfItems,y=0;y<g;y++){i=null;a=f.getItem(y);o=a.pathSegType;u=o%2==0;if(0!=o&&1!=o){if(u){s=o;l=r;c=n}else{s=o-1;l=0;c=0}switch(s){case 2:case 4:i=re([a.x,a.y],t,l,c);a.x=i[0];a.y=i[1];break;case 6:i=re([a.x,a.y,a.x1,a.y1,a.x2,a.y2],t,l,c);a.x=i[0];a.y=i[1];a.x1=i[2];a.y1=i[3];a.x2=i[4];a.y2=i[5];break;case 8:i=re([a.x,a.y,a.x1,a.y1],t,l,c);a.x=i[0];a.y=i[1];a.x1=i[2];a.y1=i[3];break;case 10:i=re([a.x,a.y],t,l,c);a.x=i[0];a.y=i[1];a.angle=(a.angle-t)%180;if(90==a.angle||-90==a.angle){a.angle=0;var v=a.r1,x=a.r2;a.r1=x;a.r2=v}break;case 12:if(180==t)a.x=u?r+r-a.x:-a.x;else{d=Nn[t];h=u?e.createSVGPathSegLinetoVerticalAbs((a.x-r)*d+n):e.createSVGPathSegLinetoVerticalRel(a.x*d);f.replaceItem(h,y)}break;case 14:if(180==t)a.y=u?n+n-a.y:-a.y;else{d=Nn[t];h=u?e.createSVGPathSegLinetoHorizontalAbs(r-(a.y-n)*d):e.createSVGPathSegLinetoHorizontalRel(-a.y*d);f.replaceItem(h,y)}break;case 16:i=re([a.x,a.y,a.x2,a.y2],t,l,c);a.x=i[0];a.y=i[1];a.x2=i[2];a.y2=i[3];break;case 18:i=re([a.x,a.y],t,l,c);a.x=i[0];a.y=i[1]}}}p&&ai.svg.fixOperaPathDAttribute(e);Zn&&m(e,"d",m(e,"d"))}},annotation:function(e,t,r,n){void 0===t&&(t=270);if(t%360!=0){var i,a,o,s,l,c,d,p,f,g,y,v,x,_,P=u("text",e);a=e.getBBox();o=a.x+a.width/2;s=a.y+a.height/2;i=re([o,s],t,r,n);r=i[0];n=i[1];y=+(m(e,"c_rotation")||0);y=oe(y-t);m(e,"c_rotation",y);m(e,"c_origin",ai.toFixed(r,2)+","+ai.toFixed(n,2));switch(y){case 0:case 180:v="";break;case 90:v="270";break;case 270:v="90";break;default:return}m(P,"text-anchor","");m(P,"transform",v?"rotate("+v+","+m(P,"x")+","+m(P,"y")+")":"");l=e.getBBox();c=l.x+l.width/2;d=l.y+l.height/2;p=ai.toFixed(+m(P,"x")+r-c,2);f=ai.toFixed(+m(P,"y")+n-d,2);v=v?"rotate("+v+","+p+","+f+")":"";m(P,{x:p,y:f,transform:v});g=h("tspan",P);for(x=0,_=g.length;x<_;x++)m(g[x],"x",p)}}},Ni={point:function(e,t,r){null!==t&&(e.x=2*t-e.x);null!==r&&(e.y=2*r-e.y)},element:function(e,t,r){e.tagName&&Ni[e.tagName](e,t,r)},elementsFlipH:function(e,t){if(0!==e.length){var r,n;if(void 0===t||null===t){var i,a,o,s,l=m(e[0],"c_origin");if(l)i=a=+l.split(",")[0];else try{s=e[0].getBBox();i=s.x;a=s.x+s.width}catch(e){i=Number.MAX_VALUE;a=-Number.MAX_VALUE}for(r=0,n=e.length;r<n;r++){l=m(e[r],"c_origin");if(l){o=+l.split(",")[0];o<i?i=o:o>a&&(a=o)}else{if("none"==e[r].style.display)continue;try{s=e[r].getBBox();s.x<i?i=s.x:s.x+s.width>a&&(a=s.x+s.width)}catch(e){}}}t=(i+a)/2}for(r=0,n=e.length;r<n;r++)Ni[e[r].tagName](e[r],t,null)}},elementsFlipV:function(e,t){if(e.length){var r,n;if(void 0===t||null===t){var i,a,o,s,l=m(e[0],"c_origin");if(l)i=a=+l.split(",")[1];else try{s=e[0].getBBox();i=s.y;a=s.y+s.height}catch(e){Number.MAX_VALUE;-Number.MAX_VALUE}for(r=1,n=e.length;r<n;r++){l=m(e[r],"c_origin");if(l){o=+l.split(",")[1];o<i?i=o:o>a&&(a=o)}else{if("none"==e[r].style.display)continue;try{s=e[r].getBBox();s.y<i?i=s.y:s.y+s.height>a&&(a=s.y+s.height)}catch(e){}}}t=(i+a)/2}for(r=0,n=e.length;r<n;r++)Ni[e[r].tagName](e[r],null,t)}},flipH:function(e,t){if(e instanceof NodeList||Array.isArray(e))return Ni.elementsFlipH(e,t);if(void 0===t||null===t)try{var r=e.getBBox();t=r.x+r.width/2}catch(r){var n=e.tagName;if("rect"!=n&&"image"!=n)return;t=+m(e,"x")+m(e,"width")/2}Ni[e.tagName](e,t,null)},flipV:function(e,t){if(e instanceof NodeList||Array.isArray(e))return Ni.elementsFlipV(e,t);if(void 0===t||null===t)try{var r=e.getBBox();t=r.y+r.height/2}catch(r){var n=e.tagName;if("rect"!=n&&"image"!=n)return;t=+m(e,"y")+m(e,"height")/2}Ni[e.tagName](e,null,t)},g:function(e,t,r){var n,i,a,o,s=m(e,"c_origin");if(s){n=s.split(",");o={x:+n[0],y:+n[1]};Ni.point(o,t,r);m(e,"c_origin",o.x+","+o.y)}if("part_pin"!=m(e,"c_partid")){var l=e.children||e.childNodes;a=l.length;for(i=0;i<a;i++){var c=l[i].tagName;c&&Ri.hasOwnProperty(c)&&Ni[c](l[i],t,r)}m(e,"c_partid")}else Ni.pin(e,t,r)},svg:{},rect:function(e,t,r){null!==t&&m(e,"x",2*t-m(e,"x")-m(e,"width"));null!==r&&m(e,"y",2*r-m(e,"y")-m(e,"height"))},text:function(e,t,r){var n=void 0!==t&&null!==t,i=void 0!==r&&null!==r;if(n||i){var a,o=ie(e),s="text-anchor";if(n){m(e,"x",2*t-m(e,"x"));if(0===o||180==o){a=m(e,s);m(e,s,"start"!=a&&a?"start":"end")}}if(i){m(e,"y",2*r-m(e,"y"));if(270==o||90==o){a=m(e,s);m(e,s,"start"!=a&&a?"start":"end")}}m(e,"transform")&&m(e,"transform","rotate("+o+","+m(e,"x")+","+m(e,"y")+")")}},pin:function(e,t,r){var n,i=h("text",e),a=i[0],o=i[1],s=u("circle",e),l=!!m(a,"transform"),c=null!==r,d={};if(l!==c)var p=m(a,"x")-m(s,"cx"),f=m(a,"y")-m(s,"cy"),g=m(o,"x")-m(s,"cx"),y=m(o,"y")-m(s,"cy");for(var v=e.children||e.childNodes,x=v.length,_=0;_<x;_++){var P=v[_],S=P.tagName;S&&P!=a&&P!=o&&Ni[S](v[_],t,r)}if(l==c){m(e,"c_rotation",oe((m(e,"c_rotation")||0)-180));d["text-anchor"]="end"==m(a,"text-anchor")?"start":"end";n={x:+m(a,"x"),y:+m(a,"y")};Ni.point(n,t,r);d.x=n.x;d.y=n.y;l&&(d.transform=m(a,"transform").replace(/([\-.\d]+[\s,]+)[\-]?[.\d]+/,"$1"+d.x).replace(/(([\-.\d]+[\s,]+){2})[\-]?[.\d]+/,"$1"+d.y));m(a,d);d["text-anchor"]="end"==m(o,"text-anchor")?"start":"end";n={x:+m(o,"x"),y:+m(o,"y")};Ni.point(n,t,r);d.x=n.x;d.y=n.y;l&&(d.transform=m(o,"transform").replace(/([\-.\d]+[\s,]+)[\-]?[.\d]+/,"$1"+d.x).replace(/(([\-.\d]+[\s,]+){2})[\-]?[.\d]+/,"$1"+d.y));m(o,d)}else{var b=+m(s,"cx"),C=+m(s,"cy");d.x=b+p;d.y=C+f;l&&(d.transform=m(a,"transform").replace(/([\-.\d]+[\s,]+)[\-]?[.\d]+/,"$1"+d.x).replace(/(([\-.\d]+[\s,]+){2})[\-]?[.\d]+/,"$1"+d.y));m(a,d);d.x=b+g;d.y=C+y;l&&(d.transform=m(o,"transform").replace(/([\-.\d]+[\s,]+)[\-]?[.\d]+/,"$1"+d.x).replace(/(([\-.\d]+[\s,]+){2})[\-]?[.\d]+/,"$1"+d.y));m(o,d)}},image:function(e,t,r){},circle:function(e,t,r){null!==t&&m(e,"cx",2*t-m(e,"cx"));null!==r&&m(e,"cy",2*r-m(e,"cy"))},ellipse:function(e,t,r){Ni.circle(e,t,r)},line:function(e,t,r){if(null!==t){m(e,"x1",2*t-m(e,"x1"));m(e,"x2",2*t-m(e,"x2"))}if(null!==r){m(e,"y1",2*r-m(e,"y1"));m(e,"y2",2*r-m(e,"y2"))}},polyline:function(e,t,r){var n,i,a=V(m(e,"points")).split(/[\s\,]+/);if(null!==t){var o=2*t;for(n=0,i=a.length-1;n<i;n+=2)a[n]=o-a[n]}if(null!==r){var s=2*r;for(n=0,i=a.length-1;n<i;n+=2)a[n+1]=s-a[n+1]}m(e,{points:a.join(" ")})},polygon:function(e,t,r){Ni.polyline(e,t,r)},path:function(e,t,r){if(ti)var n=!0;var i,a,o,s,l,c=e.pathSegList,d=c.numberOfItems,h=2*t,u=2*r;if(null!==t){for(l=0;l<d;l++){i=c.getItem(l);switch(i.pathSegType){case SVGPathSeg.PATHSEG_MOVETO_ABS:case SVGPathSeg.PATHSEG_LINETO_ABS:case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:i.x=h-i.x;break;case SVGPathSeg.PATHSEG_MOVETO_REL:case SVGPathSeg.PATHSEG_LINETO_REL:case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:i.x=-i.x;break;case SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:case SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:i.x=h-i.x;i.x1=h-i.x1;i.x2=h-i.x2;break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL:i.x=-i.x;i.x1=-i.x1;i.x2=-i.x2;break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:i.x=h-i.x;i.x2=h-i.x2;break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL:i.x=-i.x;i.x2=-i.x2;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:i.x=h-i.x;i.x1=h-i.x1;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL:i.x=-i.x;i.x1=-i.x1;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:i.x=h-i.x;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:i.x=-i.x;break;case SVGPathSeg.PATHSEG_ARC_ABS:i.x=h-i.x;i.sweepFlag=1-i.sweepFlag;break;case SVGPathSeg.PATHSEG_ARC_REL:i.x=-i.x;i.sweepFlag=1-i.sweepFlag}}a=m(e,"c_helper_dots");if(a){o=a.split(/[\s\,]+/);for(l=0,d=o.length-1;l<d;l+=2)o[l]=h-o[l];s=o.splice(4,2);o.push(s[0],s[1]);m(e,"c_helper_dots",o.join(","))}}if(null!==r){for(l=0;l<d;l++){i=c.getItem(l);switch(i.pathSegType){case SVGPathSeg.PATHSEG_MOVETO_ABS:case SVGPathSeg.PATHSEG_LINETO_ABS:case SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:i.y=u-i.y;break;case SVGPathSeg.PATHSEG_MOVETO_REL:case SVGPathSeg.PATHSEG_LINETO_REL:case SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:i.y=-i.y;break;case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:i.y=u-i.y;i.y1=u-i.y1;i.y2=u-i.y2;break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL:i.y=-i.y;i.y1=-i.y1;i.y2=-i.y2;break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:i.y=u-i.y;i.y2=u-i.y2;break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL:i.y=-i.y;i.y2=-i.y2;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:i.y=u-i.y;i.y1=u-i.y1;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL:i.y=-i.y;i.y1=-i.y1;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:i.y=u-i.y;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:i.y=-i.y;break;case SVGPathSeg.PATHSEG_ARC_ABS:i.y=u-i.y;i.sweepFlag=1-i.sweepFlag;break;case SVGPathSeg.PATHSEG_ARC_REL:i.y=-i.y;i.sweepFlag=1-i.sweepFlag}}a=m(e,"c_helper_dots");if(a){o=a.split(/[\s\,]+/);for(l=0,d=o.length-1;l<d;l+=2)o[l+1]=u-o[l+1];s=o.splice(4,2);o.push(s[0],s[1]);m(e,"c_helper_dots",o.join(","))}}n&&ai.svg.fixOperaPathDAttribute(e);Zn&&m(e,"d",m(e,"d"))}},ki={get:function(e){return ki[e.tagName].get.apply(e,arguments)},set:function(e){ki[e.tagName].set.apply(e,arguments)},text:{get:function(e){var t=e.getBBox(),r=t.x,n=t.y,i=t.width,a=t.height,o=[r,n,r+i,n,r+i,n+a,r,n+a];o.onlyLines=1;o.c_helper_lines=[{type:"rect",data:t}];return o},set:function(e,t,r,n,i){wi.text(e,n,i)}},g:{get:function(e){if("part_annotation"===m(e,"c_partid"))return[];var t=e.getBBox(),r=t.x,n=t.y,i=t.width,a=t.height;return[r,n,r+i,n,r,n+a,r+i,n+a]},set:function(e,t,r,n,i){wi.g(e,n,i)}},svg:{get:function(e){return ki.rect.get(e)},set:function(e,t,r,n,i){return ki.rect.set(e,t,r,n,i)}},image:{get:function(e){var t=ai.svg.getViewBBox(e),r=[t.x,t.y,t.x+t.width,t.y,t.x+t.width,t.y+t.height,t.x,t.y+t.height];r.c_helper_lines=[{from:0,to:1},{from:1,to:2},{from:2,to:3},{from:3,to:0}];return r},set:function(e,t,r,n,i){var a={x:t[0],y:t[1],width:t[2]-t[0],height:t[5]-t[1]};if(0===r||3==r){a.x+=n;a.width-=n}if(0===r||1==r){a.y+=i;a.height-=i}1!=r&&2!=r||(a.width+=n);2!=r&&3!=r||(a.height+=i);if(0!==a.width&&0!==a.height){if(a.width<0){a.width=-a.width;a.x-=a.width}if(a.height<0){a.height=-a.height;a.y-=a.height}var o=ie(e);90!=o&&270!=o||(a.width=[a.height,a.height=a.width][0]);a.transform=o?pe(a,o):"";m(e,a)}}},rect:{get:function(e){var t=+m(e,"x"),r=+m(e,"y"),n=+m(e,"width"),i=+m(e,"height");return[t,r,t+n,r,t+n,r+i,t,r+i]},set:function(e,t,r,n,i){t||(t=ki.rect.get(e));var a={x:t[0],y:t[1],width:t[2]-t[0],height:t[5]-t[1]};if(0===r||3==r){a.x+=n;a.width-=n}if(0===r||1==r){a.y+=i;a.height-=i}1!=r&&2!=r||(a.width+=n);2!=r&&3!=r||(a.height+=i);if(0!==a.width&&0!==a.height){if(a.width<0){a.width=-a.width;a.x-=a.width}if(a.height<0){a.height=-a.height;a.y-=a.height}m(e,a)}}},circle:{get:function(e){var t=+m(e,"cx"),r=+m(e,"cy"),n=+m(e,"r");return[t,r,t,r-n,t,r+n,t-n,r,t+n,r]},set:function(e,t,r,n,i){t||(t=ki.circle.get(e));var a={cx:t[0],cy:t[1],r:t[1]-t[3]};if(0===r){a.cx+=n;a.cy+=i}1==r&&(a.r-=i);2==r&&(a.r+=i);3==r&&(a.r-=n);4==r&&(a.r+=n);if(0!==a.r){a.r<0&&(a.r=-a.r);m(e,a)}}},ellipse_0:{get:function(e){var t=+m(e,"cx"),r=+m(e,"cy"),n=+m(e,"rx"),i=+m(e,"ry");return[t,r,t,r-i,t,r+i,t-n,r,t+n,r]},set:function(e,t,r,n,i){t||(t=ki.ellipse_0.get(e));var a={cx:t[0],cy:t[1],rx:t[0]-t[6],ry:t[1]-t[3]};if(0===r){a.cx+=n;a.cy+=i}1==r&&(a.ry-=i);2==r&&(a.ry+=i);3==r&&(a.rx-=n);4==r&&(a.rx+=n);if(0!==a.rx&&0!==a.ry){a.rx<0&&(a.rx=-a.rx);a.ry<0&&(a.ry=-a.ry);m(e,a)}}},ellipse:{get:function(e){var t=+m(e,"cx"),r=+m(e,"cy"),n=+m(e,"rx"),i=+m(e,"ry");return[t-n,r-i,t+n,r-i,t-n,r+i,t+n,r+i]},set:function(e,t,r,n,i){t||(t=ki.ellipse.get(e));var a={cx:(t[0]+t[2])/2,cy:(t[1]+t[5])/2,rx:(t[2]-t[0])/2,ry:(t[5]-t[1])/2};a.cx+=n/2;a.cy+=i/2;0===r||2==r?a.rx-=n/2:a.rx+=n/2;0===r||1==r?a.ry-=i/2:a.ry+=i/2;if(0!==a.rx&&0!==a.ry){a.rx<0&&(a.rx=-a.rx);a.ry<0&&(a.ry=-a.ry);m(e,a)}}},line:{get:function(e){return[+m(e,"x1"),+m(e,"y1"),+m(e,"x2"),+m(e,"y2")]},set:function(e,t,r,n,i){t||(t=ki.line.get(e));var a={x1:t[0],y1:t[1],x2:t[2],y2:t[3]};if(0===r){a.x1+=n;a.y1+=i}if(1==r){a.x2+=n;a.y2+=i}m(e,a)}},polyline:{get:function(e){for(var t=V(m(e,"points")).split(/[\s\,]+/g),r=0;r<t.length;r++)t[r]=+t[r];for(r=t.length-2;r>=2;r-=2)t.splice(r,0,(t[r-2]+t[r])/2,(t[r-1]+t[r+1])/2);t.lightDots="odd";return t},set:function(e,t,r,n,i){var a=t.slice(0);a[2*r]+=n;a[2*r+1]+=i;if(r%2&&(!se(2*a[2*r],a[2*r-2]+a[2*r+2])||!se(2*a[2*r+1],a[2*r-1]+a[2*r+3]))){a.splice(2*r+2,0,0,0);a.splice(2*r,0,0,0)}for(var o=4,s=a.slice(0,2);o<a.length-1;o+=4)s.push(a[o],a[o+1]);m(e,{points:ai.toFixedString(s.join(" "))})}},polygon:{get:function(e){for(var t=V(m(e,"points")).split(/[\s\,]+/g),r=0;r<t.length;r++)t[r]=+t[r];for(r=t.length-2;r>=2;r-=2)t.splice(r,0,(t[r-2]+t[r])/2,(t[r-1]+t[r+1])/2);r=t.length-2;t.push((t[0]+t[r])/2,(t[1]+t[r+1])/2);t.lightDots="odd";return t},set:function(e,t,r,n,i){var a,o=t.slice(0),s=2*r;o[s]+=n;o[s+1]+=i;if(r==o.length/2-1)se(2*o[s],o[0]+o[s-2])&&se(2*o[s+1],o[1]+o[s-1])||o.splice(s,0,0,0);else if(r%2&&(!se(2*o[s],o[s-2]+o[s+2])||!se(2*o[s+1],o[s-1]+o[s+3]))){o.splice(s+2,0,0,0);o.splice(s,0,0,0)}for(s=4,a=o.slice(0,2);s<o.length-1;s+=4)a.push(o[s],o[s+1]);m(e,{points:ai.toFixedString(a.join(" "))})}},path:{get:function(e){if(pi.gJsonCache.DIMENSION&&A(pi.gJsonCache.DIMENSION,m(e,"id")))return Vi.getStartAndEndPointByDimensionElement(e);if(pi.gJsonCache.PROTRACTOR&&A(pi.gJsonCache.PROTRACTOR,m(e,"id"))){var t=e.getPathData();return t.length<4?[]:[].concat(t[0].values,t[1].values,t[3].values,t[6].values)}var r=ai.svg.getPathHelperType(e);if(r){var n=e.tagName+"_"+r;if(ki[n]&&ki[n].get)return ki[n].get.apply(e,arguments)}for(var i,a,o,s=e.pathSegList,l=s.numberOfItems,c=0,d=0,h=[],u=0,p=0,f=[],g=0;g<l;g++){i=s.getItem(g);a=i.pathSegType;0===g&&2!=a&&3!=a&&1!=a&&h.push(c,d);var y=h.length/2-1;switch(a){case 1:c=u;d=p;break;case 2:c=i.x;d=i.y;u=c;p=d;if(g+1==l)break;o=s.getItem(g+1).pathSegType;if(2==o||3==o||1==o)break;h.push(c,d);break;case 4:h.push(c=i.x,d=i.y);break;case 12:h.push(c=i.x,d);break;case 14:h.push(c,d=i.y);break;case 6:f.push({from:y,to:y+1},{from:y+2,to:y+3});h.push(i.x1,i.y1,c=i.x2,d=i.y2,i.x,i.y);break;case 16:f.push({from:y+1,to:y+2});h.push(i.x2,i.y2,c=i.x,d=i.y);break;case 8:f.push({from:y,to:y+1},{from:y+1,to:y+2});h.push(i.x1,i.y1,c=i.x,d=i.y);break;case 18:case 10:h.push(c=i.x,d=i.y);break;case 3:c+=i.x;d+=i.y;u=c;p=d;if(g+1==l)break;o=s.getItem(g+1).pathSegType;if(2==o||3==o||1==o)break;h.push(c,d);break;case 5:h.push(c+=i.x,d+=i.y);break;case 13:h.push(c+=i.x,d);break;case 15:h.push(c,d+=i.y);break;case 7:f.push({from:y,to:y+1},{from:y+2,to:y+3});h.push(c+i.x1,d+i.y1,c+i.x2,d+i.y2,c+=i.x,d+=i.y);break;case 17:f.push({from:y+1,to:y+2});h.push(c+i.x2,d+i.y2,c+=i.x,d+=i.y);break;case 9:f.push({from:y+1,to:y+2});h.push(c+i.x1,d+i.y1,c+=i.x,d+=i.y);break;case 19:case 11:h.push(c+=i.x,d+=i.y)}i.pathSegType}f.length&&(h.c_helper_lines=f);return h},set:function(e,t,r,n,i,a){if(pi.gJsonCache.DIMENSION&&A(pi.gJsonCache.DIMENSION,m(e,"id"))){if(t.length<4)return;var o=t.slice(2*r,2*r+1+1),s=r>0?[t[0],t[1]]:[t[2],t[3]],l=m(e,"c_fontSize");m(e,"d",Vi.getDimensionPath({x:s[0],y:s[1]},{x:o[0]+n,y:o[1]+i},l));tt("updateAttrPanel")}else if(pi.gJsonCache.PROTRACTOR&&A(pi.gJsonCache.PROTRACTOR,m(e,"id"))){var c="";if(t.length<6)return;var d=[t[0],t[1]],h=[t[2],t[3]],u=[t[4],t[5]],p=[],f=m(e,"c_fontSize"),g=m(e,"c_precision");if(0===r){d[0]+=n;d[1]+=i}else if(1===r){h[0]+=n;h[1]+=i}else if(2===r){u[0]+=n;u[1]+=i}else{if(3!==r)return;p[0]=t[6]+n;p[1]=t[7]+i}c=Vi.getProtractorPath(d,h,u,{fontPoint:p,fontSize:f,canAdjustLineLength:!0,precision:g});if(c){m(e,"d",c);tt("updateAttrPanel")}}else if(0!==n||0!==i){var y=ai.svg.getPathHelperType(e);if(y){var v=e.tagName+"_"+y;if(ki[v]&&ki[v].set){ki[v].set.apply(e,arguments);return}}a&&m(e,{d:a});var x=e.pathSegList,_=x.numberOfItems,P=-1;e:for(var S=0;S<_;S++){var b=x.getItem(S);switch(b.pathSegType){case 1:break;case 2:case 3:if(S+1==_)break;var C=x.getItem(S+1).pathSegType;if(2==C||3==C||1==C)break;P++;if(P==r){b.x=ai.toFixed(b.x+n,3);b.y=ai.toFixed(b.y+i,3);break e}break;case 4:case 5:P++;if(P==r){b.x=ai.toFixed(b.x+n,3);b.y=ai.toFixed(b.y+i,3);break e}break;case 12:case 13:P++;if(P==r){b.x+=n;break e}break;case 14:case 15:P++;if(P==r){b.y+=i;break e}break;case 6:case 7:P++;if(P==r){b.x1+=n;b.y1+=i;break e}P++;if(P==r){b.x2+=n;b.y2+=i;break e}P++;if(P==r){b.x+=n;b.y+=i;break e}break;case 16:case 17:P++;if(P==r){b.x2+=n;b.y2+=i;break e}P++;if(P==r){b.x+=n;b.y+=i;break e}break;case 8:case 9:P++;if(P==r){b.x1+=n;b.y1+=i;break e}P++;if(P==r){b.x+=n;b.y+=i;break e}break;case 18:case 19:case 10:case 11:P++;if(P==r){b.x+=n;b.y+=i;break e}}}}else a&&m(e,{d:a})}},path_arc1:{get:function(e){var t=ai.arc.calculateArcHelperDots(e);t.c_helper_lines=ai.arc.c_helper_lines;return t},set:function(e,t,r,n,i,a){var o,s,l,c,d=t?t.slice(0):ki.path_arc1.get(e),h=!(Qi==Dn.PCBLIB||Qi==Dn.PCB);if(0===r){a&&m(e,{d:a});ai.Dots.eachAdd(d,n,i);wi.path(e,n,i)}else{d[2*r]+=n;d[2*r+1]+=i;o=Math.abs(d[0]-d[2]);s=Math.abs(d[1]-d[3]);if(0===o||0===s)return;if(h){o=Math.abs(d[0]-d[2]);s=Math.abs(d[1]-d[3])}else o=s=te(d[0],d[1],d[2],d[3]);l=ai.arc.getArcParams(d[0],d[1],o,s,d[4],d[5],d[6],d[7]);if(null===l)return;c="M"+l.x1+","+l.y1+" A"+o+","+s+" 0 "+l.fa+" "+l.fs+" "+l.x2+","+l.y2;m(e,{d:c})}m(e,{c_helper_dots:d.join(",")})}},path_arc2:{get:function(e){for(var t,r,n,i=[],a=1,o=e.pathSegList.numberOfItems;a<o;a++){t=e.pathSegList.getItem(a);if("A"==t.pathSegTypeAsLetter){r=t;n=e.pathSegList.getItem(a-1);break}}if(r){i.push(n.x,n.y,r.x,r.y);var s=ai.arc.getCenterParam(n.x,n.y,r.x,r.y,r.largeArcFlag,r.sweepFlag,r.r1,r.r2,r.angle),l=s.cx,c=s.cy,d=ae([n.x,n.y],[l,c],s.delta_theta/2);i.push(d[0],d[1])}return i},set:function(e,t,r,n,i,a){if(0!==n||0!==i){var o,s,l,c=t?t.slice(0):ki.path_arc2.get(e);if(!(0===r&&se(c[0]+n,c[2])&&se(c[1]+i,c[3])||1===r&&se(c[2]+n,c[0])&&se(c[3]+i,c[1])||2===r&&se((c[2]-c[0])*(c[5]+i-c[1]),(c[3]-c[1])*(c[4]+n-c[0])))){if(2===r){o=J({x:c[0],y:c[1]},{x:c[2],y:c[3]},{x:c[4]+n,y:c[5]+i});if(o<4)return;o=Math.sqrt(o)}a&&m(e,"d",a);var d=e.pathSegList.getItem(1),h=d.r1,u=+d.largeArcFlag,p=+d.sweepFlag,f=ee(c[0],c[1],c[2],c[3]),g=h*h-f/4;if(2==r){s=(c[2]-c[0])*(c[5]-c[1])-(c[4]-c[0])*(c[3]-c[1]);c[2*r]+=n;c[2*r+1]+=i;l=(c[2]-c[0])*(c[5]-c[1])-(c[4]-c[0])*(c[3]-c[1]);s*l<0&&(p^=1)}else{o=h+(u?1:-1)*(g>0?Math.sqrt(g):0);c[2*r]+=n;c[2*r+1]+=i;f=ee(c[0],c[1],c[2],c[3])}h=f/(8*o)+o/2;u=h>o?0:1;m(e,"d","M"+c[0]+","+c[1]+" A"+h+","+h+" 0 "+u+" "+p+" "+c[2]+","+c[3])}}else a&&m(e,{d:a})}},path_pie1:{get:function(e){var t=ai.arc.calculateArcHelperDots(e);t.c_helper_lines=ai.arc.c_helper_lines_pie1;return t},set:function(e,t,r,n,i,a){var o=t?t.slice(0):ki.path_pie1.get(e);if(0===r){a&&m(e,{d:a});ai.Dots.eachAdd(o,n,i);wi.path(e,n,i)}else{o[2*r]+=n;o[2*r+1]+=i;var s=Math.abs(o[0]-o[2]),l=Math.abs(o[1]-o[3]);if(0===s||0===l)return;var c=ai.arc.getArcParams(o[0],o[1],s,l,o[4],o[5],o[6],o[7]);if(!c)return;m(e,{d:"M"+o[0]+","+o[1]+" L"+c.x1+","+c.y1+" A"+s+","+l+" 0 "+c.fa+" "+c.fs+" "+c.x2+","+c.y2+"Z"})}}},alwaysNotSnap:function(e,t){var r=ki.getHelperType(e);return r&&(("arc1"==r||"pie1"==r)&&(2==t||3==t)||"arc2"==r&&2==t)},getHelperType:function(e){var t=m(e,"c_helper_type");if(t)return t;if("path"==e.tagName){var r=e.pathSegList,n=r.numberOfItems;if(2==n&&"A"==r.getItem(1).pathSegTypeAsLetter)return Qi==Dn.PCB||Qi==Dn.PCBLIB?"arc2":"arc1";if(4==n&&"L"==r.getItem(1).pathSegTypeAsLetter&&"A"==r.getItem(2).pathSegTypeAsLetter)return"pie1"}return""}},Bi={_PCBSnapStack:[.2,.25,.5,1,1.25,2.5,5,10],altKeyEnabled:!1,getSanpSize:function(e){return Bi.altKeyEnabled?+bi.adsorbGrid.altSnapSize||1:+bi.adsorbGrid["distance"+e]||1},getPCBSnapSizeList:function(){var e=bi.canvas.unit,t="";Bi._PCBSnapStack.forEach(function(r){t+='<option value="'+ai.toFixed(ai.units.convert(r,"pixel",e),ai.units.decimals[e])+'">'});return t}},Mi=function(){function e(){if(!n){n=!0;t=d("gControlLocks");r=t&&u("g",t);var e=function(){};for(var s in a)A(a,s)&&(o[s]=r||"function"!=typeof a[s]?a[s]:e);r&&t.addEventListener("click",function(e){var t=m(e.target.parentNode,"target-id"),r=t&&d(t);if(r){m(r,i,"");Pi.save(["attr",t,{locked:"1"},{locked:""}])}},!1)}}var t,r,n,i="locked",a={attName:i,init:e,isLocked:function(e){return"1"==m(e,i)},updateOne:function(e){e&&Gi.contains(e)&&a.isLocked(e)?a.lockOne(e,!1):a.unlockOne(e,!1)},updateMore:function(e){for(var t=0;t<e.length;t++)e[t]&&a.updateOne(e[t])},lockOne:function(e,n){if(e&&e.id){!1!==n&&m(e,i,"1");var a=u('g[target-id="'+e.id+'"]',t),o=ai.svg.getViewBBox(e);if(o.width||o.height){if(!a){a=u('g[display="none"]',t)||t.appendChild(r.cloneNode(!0));m(a,"target-id",e.id)}m(a,"display","");var s=20/ci;m(u("use",a),{x:o.width>s?o.x:o.x+(o.width-s)/2,y:o.y-s,width:s,height:s});m(u("rect",a),{x:o.x,y:o.y,width:o.width,height:o.height})}else a&&m(a,"display","none")}},lockMore:function(e,n){if(e&&e.length){e=[].filter.call(e,function(e){return e&&e.id});!1!==n&&m(e,i,"1");var a,o,s,l,c=20/ci;for(s=0;s<e.length;s++){o=u('g[target-id="'+e[s].id+'"]',t);o&&m(o,"display","none")}a=h('g[display="none"]',t);m(a,"target-id","");for(s=0,l=0;s<e.length;s++){var d=e[s],p=ai.svg.getViewBBox(d);if(p.width||p.height){o=a[l]?a[l++]:t.appendChild(r.cloneNode(!0));m(o,"display","");m(o,"target-id",d.id);m(u("use",o),{x:p.width>c?p.x:p.x+(p.width-c)/2,y:p.y-c,width:c,height:c});m(u("rect",o),{x:p.x,y:p.y,width:p.width,height:p.height})}}}},unlockOne:function(e,r){if(e&&e.id){!1!==r&&m(e,i,"");var n=u('g[target-id="'+e.id+'"]',t);if(n){m(n,"display","none");m(n,"target-id","")}}},unlockMore:function(e,r){if(e&&e.length){e=[].filter.call(e,function(e){return e&&e.id});!1!==r&&m(e,i,"");for(var n=0;n<e.length;n++){var a=u('g[target-id="'+e[n].id+'"]',t);if(a){m(a,"display","none");m(a,"target-id","")}}}},unlockAll:function(){for(var e=h("[locked]",Gi),r=0;r<e.length;r++)x(e[r],"locked");var n=h("g",t);m(n,"display","none");m(n,"target-id","")},lockSelectedObjs:function(e){e=e?e.ids?e.ids:e:Xt();if(e&&e.length){"string"==typeof e[0]?e=e.map(function(e){return d(e)}):e[0].gId&&(e=e.map(function(e){return d(e.gId)}));e=[].filter.call(e,function(e){return Gi.contains(e)&&!a.isLocked(e)});if(e.length){var t=[].map.call(e,function(e){return e.id}).join(",");m(e,i,"1");Pi.save(["attr",t,{locked:""},{locked:"1"}])}}},resize:function(){
for(var e=h('g:not([display="none"])',t),r=20/ci,n=0;n<e.length;n++){var i=u("rect",e[n]),a={x:+m(i,"x"),y:+m(i,"y"),width:+m(i,"width"),height:+m(i,"height")};m(u("use",e[n]),{x:a.width>r?a.x:a.x+(a.width-r)/2,y:a.y-r,width:r,height:r})}},switchLockUI:function(e){m(t,!0===e?"":!1===e?"none":"none"==m(t,"display")?"":"none")}},o={};for(var s in a)A(a,s)&&("function"==typeof a[s]?o[s]=function(t,i){return function(){n||e();return r?i.apply(a,arguments):void 0}}(0,a[s]):o[s]=a[s]);return o}();!function(){function e(r){this.ready=0;this.start=0;if(r)for(var n in r)r.hasOwnProperty(n)&&(this[n]=r[n]);e.instance=this;t.addEventListener("mousedown",this.mdown,!1)}e.prototype={mdown:function(r){var n=e.instance;1==r.button&&r.preventDefault();if((r.button===Gn||1===r.button)&&!(r.ctrlKey||r.metaKey||r.shiftKey||r.altKey||r.target==t.documentElement||n.ready)){var i=r.clientX,a=r.clientY;n.lastX=i;n.lastY=a;n.ready=1;n.start=0;n.helperCursorBefore=_i;st("grabbing");t.addEventListener("mousemove",n.mmove,!1);t.addEventListener("mouseup",n.mup,!1)}},mmove:function(t){var r=e.instance;if(r.ready&&(!t.buttons||6&t.buttons)){var n=t.clientX,i=t.clientY,a=n-r.lastX,o=i-r.lastY;if(!r.start){if(a*a+o*o<=36)return}r.lastX=n;r.lastY=i;if(!r.start){Yn.dragpanning=!0;r.start=1;r.rootcursor=f(fi,"cursor-none");r.ondragstart&&r.ondragstart({dx:a,dy:o,originalEvent:t})}r.ondrag&&r.ondrag({dx:a,dy:o,originalEvent:t})}},mup:function(t){var r=e.instance;t.button!==Gn&&1!==t.button||r.mupRight(t)},mupRight:function(r){var n=e.instance;if(n.ready){t.removeEventListener("mousemove",n.mmove,!1);t.removeEventListener("mouseup",n.mup,!1);var i=n.start;n.ready=0;n.start=0;if("grabbing"==_i){var a=n.helperCursorBefore;a?n.rootcursor?st(a,!0):st(a):st()}i&&n.ondragend&&n.ondragend({originalEvent:r})}}};Jn=function(){zn=new e({ondrag:function(e){var t=e.dx,r=e.dy,n=Ui.getViewBox();n[0]-=t/ci;n[1]-=r/ci;Ui.setViewBox(n)},ondragend:function(e){Yn.dragpanning=!0;setTimeout(function(){Yn.dragpanning=!1},5)}})}}();Pi.records=[];Pi.timestamps=[];Pi._queueBatchRecords=[];Pi.maxLength=120;Pi.index=-1;Pi.savedIndex=-1;Pi.logs=[];Pi.log=function(e){Pi.logs.push(e);Pi.logs.length>Pi.maxLength&&Pi.logs.shift()};Pi.getLogs=function(){return{index:Pi.index,records:JSON.parse(JSON.stringify(Pi.records,function(e,t){return t instanceof Element?serializeNode(t):t}))}};Pi.log("begin");Pi.XMLSerializer=e.XMLSerializer?new XMLSerializer:{serializeToString:function(){}};Pi.DOMParser=e.DOMParser?new DOMParser:{parseFromString:function(){}};Pi.save=function(e,t){if(Array.isArray(e))if(Pi.batchState)Array.isArray(e)&&Array.isArray(e[0])?[].push.apply(Pi._queueBatchRecords,e):Pi._queueBatchRecords.push(e);else{Pi.log(e.concat(t?"mergeSource:"+t:[]));if(t&&t===Pi.lastMergeSource){var r=Pi.records[Pi.index],n=r[0],i=r[1];if(n===e[0]&&i===e[1]){Pi.records.pop();Pi.index--}}else Pi.lastMergeSource=t||"";Pi.index>=Pi.maxLength-1?Pi.records.shift():Pi.index++;Pi.timestamps[Pi.index]=Date.now();Pi.records[Pi.index]=e;Pi.records.length=Pi.index+1;tt("triggerEvent",["history_change",Pi.records.length,Pi.index]);Pi.walkRecord(e,function(e){var t=Pi.ids2elems(e[1]);if(t&&t[0]){var r=e[0];"del"!=r&&"add"!=r||1===t.length&&!e[2]&&Gi.contains(t[0])&&(e[2]=ai.node.getRefId(t[0]));"del"==r?Mi.unlockMore(t,!1):"node"==r?Mi.updateOne(t[0]):Mi.updateMore(t)}})}else ai.reportError(new Error("History.save :: first argument is not an array"))};Pi.walkRecord=function(e,t){Array.isArray(e[0])?e.forEach(t):t(e)};Pi.startBatch=function(){Pi.batchState=Pi.batchState+1||1};Pi.saveBatch=function(){Pi.batchState>0&&(Pi.batchState-=1);if(!Pi.batchState&&Pi._queueBatchRecords.length){Pi.save(Pi._queueBatchRecords.slice(0));Pi._queueBatchRecords.length=0}};Pi.clear=function(e){Pi.logs.length=0;Pi.log("clear");Pi.timestamps.length=0;Pi.records.length=0;Pi.index=-1;Pi.savedIndex=e&&!1===e.saved?-2:Pi.index;Pi.batchState=void 0;tt("triggerEvent",["history_change",Pi.records.length,Pi.index,Pi.savedIndex]);for(;li.lastChild;)li.removeChild(li.lastChild)};Pi.goTo=function(e){var t;if(e>=-1&&e!==Pi.index&&e<Pi.records.length){if(e>Pi.index)for(t=Pi.index+1;t<=e;t++)Pi.doCmdBatch("redo",Pi.records[t]);else for(t=Pi.index;t>e;t--)Pi.doCmdBatch("undo",Pi.records[t]);Pi.index=e;tt("triggerEvent",["history_change",Pi.records.length,Pi.index,Pi.savedIndex]);tt("triggerEvent",["select_change"])}};Pi.go=function(e){try{Pi.log(1===e?"redo":-1===e?"undo":"go("+e+")");Pi.goTo(Pi.index+e)}catch(e){ai.reportError(e);Pi.clear()}};Pi.doCmdBatch=function(e,t){function r(e){if(e){var t=m(e,"net");t&&i.nets.indexOf(t)<0&&i.nets.push(t);for(var r=h("[net]",e),n=0;n<r.length;n++){t=m(r[n],"net");t&&i.nets.indexOf(t)<0&&i.nets.push(t)}}}function n(t){var o,s,l;if(t&&M(t)&&t.length)if(M(t[0]))for(o=0,s=t.length;o<s;o++)n(t[o]);else{var c=t[1].split(",");for(o=0,s=c.length;o<s;o++){"add"==t[0]&&"undo"==e||"del"==t[0]&&"redo"==e?i.removeIds.indexOf(c[o])<0&&i.removeIds.push(c[o]):i.updateIds.push(c[o]);if(a)if("add"==t[0]&&"redo"==e||"del"==t[0]&&"undo"==e){l=h("#"+c[o],li);l=l&&l.length&&l[l.length-1];r(l)}else if("node"==t[0]){l=u("#"+c[o],Gi);r(l);l="undo"==e?t[2]:t[3];r(l)}else{l=u("#"+c[o],Gi);r(l)}}}}var i={updateIds:[],removeIds:[],nets:[],copper:[]},a=Qi==Dn.PCB,o=Qi==Dn.PCB;n(t);!function(){var e,t,r;for(e=0,t=i.removeIds.length;e<t;e++){r=d(i.removeIds[e]);pi.removeOne(r)}}();"redo"==e?Pi.redoOne(t):Pi.undoOne(t);Ct();!function(){var e,t,r,n;for(e=0,t=i.updateIds.length;e<t;e++){r=d(i.updateIds[e]);if(Qi==Dn.PCB||Qi==Dn.PCBLIB){n=ai.getPCBCmdKey(r);"TEXT"==n&&r.parentNode!=Gi&&(r=r.parentNode)}else{n=ai.getSCHCmdKey(r);"text"==n&&r.parentNode!=Gi&&(r=r.parentNode)}r&&pi.updateOne(r)}}();a&&function(){Qi==Dn.PCB&&i.nets.length&&Ei.buildGroupNets(i.nets)}();o&&function(){Qi==Dn.PCB&&Ai.rebuildCopperArea("all")}()};Pi._undoRedos=[];Pi.defineUndoRedo=function(e,t){Pi._undoRedos[e]=t};Pi.undoOne=function(e){if(M(e))if(M(e[0])){for(var t=e.length-1;t>=0;t--)e[t]&&"del"==e[t][0]&&Pi.undoOne(e[t]);for(t=e.length-1;t>=0;t--)e[t]&&"del"!=e[t][0]&&Pi.undoOne(e[t])}else{var r=Pi._undoRedos[e[0]];r&&r.undo&&r.undo(e);Pi.walkRecord(e,function(e){var t=Pi.ids2elems(e[1]);if(t){var r=e[0];"add"==r?Mi.unlockMore(t,!1):"node"==r?Mi.updateOne(t[0]):Mi.updateMore(t)}})}};Pi.redoOne=function(e){if(M(e))if(M(e[0])){for(var t=0,r=e.length;t<r;t++)e[t]&&"add"==e[t][0]&&Pi.redoOne(e[t]);for(t=0,r=e.length;t<r;t++)e[t]&&"add"!=e[t][0]&&Pi.redoOne(e[t])}else{var n=Pi._undoRedos[e[0]];n&&n.redo&&n.redo(e);Pi.walkRecord(e,function(e){var t=Pi.ids2elems(e[1]);if(t){var r=e[0];"del"==r?Mi.unlockMore(t,!1):"node"==r?Mi.updateOne(t[0]):Mi.updateMore(t)}})}};Pi.ids2elems=function(e){return e&&e!=Gi.id&&"config.colors"!=e?h("#"+e.replace(/\,/g,",#"),Gi):[]};Pi.defineUndoRedo("add",{undo:function(e){var t,r,n;e[0];n=e[1].split(",");for(r=n.length;--r>=0;){t=d(n[r]);t&&li.appendChild(t)}},redo:function(e){var t,r,n,i,a,o,s;e[0];s=e[2]&&/^</.test(e[2]);o=(e[2]||"").replace(/^</,"");a=o?d(o):null;i=e[1].split(",");for(r=0,n=i.length;r<n;r++){t=h("#"+i[r],li);t=t&&t.length&&t[t.length-1];if(t){f(t,"active")&&p(t,"active",!1);a&&s?a.appendChild(t):a&&a.parentNode?a.parentNode.insertBefore(t,a):Qi==Dn.PCB||Qi==Dn.PCBLIB||Qi==Dn.WAVEFORM?zi.appendElement(t):Gi.appendChild(t);Pi.updateCache(t,m(t,"net")||"")}}}});Pi.defineUndoRedo("del",{undo:function(e){var t,r,n,i,a,o;e[0];o=e[2]&&/^</.test(e[2]);a=(e[2]||"").replace(/^</,"");i=a?d(a):null;n=e[1].split(",");for(r=n.length;--r>=0;){t=h("#"+n[r],li);t=t&&t.length&&t[t.length-1];if(t){f(t,"active")&&p(t,"active",!1);i&&o?i.appendChild(t):i&&i.parentNode?i.parentNode.insertBefore(t,i):Qi==Dn.PCB||Qi==Dn.PCBLIB||Qi==Dn.WAVEFORM?zi.appendElement(t):Gi.appendChild(t);Pi.updateCache(t,m(t,"net")||"")}}},redo:function(e){var t,r,n;e[0];n=e[1].split(",");for(r=n.length;--r>=0;){t=d(n[r]);t&&li.appendChild(t)}}});Pi.defineUndoRedo("attr",{undo:function(e){var t,r,n,i,a,o=(e[0],"\0");if(e[1]!=Gi.id){r=h("#"+e[1].replace(/\,/g,",#"),Gi);for(n=0;n<r.length;n++){t=r[n];if(t){if(Qi==Dn.PCB){i="net";a=m(t,i);a&&o.indexOf("\0"+a+"\0")<0&&(o+=a+"\0");A(e[2],i)&&o.indexOf("\0"+e[2][i]+"\0")<0&&(o+=e[2][i]+"\0");A(e[3],i)&&o.indexOf("\0"+e[3][i]+"\0")<0&&(o+=e[3][i]+"\0")}m(t,e[2]);Pi.updateCache(t,o)}}}else m(Gi,e[2])},redo:function(e){var t,r,n,i,a,o=(e[0],"\0");if(e[1]!=Gi.id){r=h("#"+e[1].replace(/\,/g,",#"),Gi);for(n=0;n<r.length;n++){t=r[n];if(t){if(Qi==Dn.PCB){i="net";a=m(t,i);a&&o.indexOf("\0"+a+"\0")<0&&(o+=a+"\0");A(e[2],i)&&o.indexOf("\0"+e[2][i]+"\0")<0&&(o+=e[2][i]+"\0");A(e[3],i)&&o.indexOf("\0"+e[3][i]+"\0")<0&&(o+=e[3][i]+"\0")}m(t,e[3]);Pi.updateCache(t,o)}}}else m(Gi,e[3])}});Pi.defineUndoRedo("attrpanel",{undo:function(e){var t,r,n,i,a,o=(e[0],"\0");if(e[1]==Gi.id){yn("canvas",e[2],"NotSaveHistory");tt("updateAttrPanel")}else if("config.colors"==e[1]){ai.extend(bi.colors,e[2]);for(n in bi.colors)A(bi.colors,n)&&!A(e[2],n)&&delete bi.colors[n]}else{r=h("#"+e[1].replace(/\,/g,",#"),Gi);for(n=0;n<r.length;n++){t=r[n];if(t){if(Qi==Dn.PCB){a=m(t,"net");a&&o.indexOf("\0"+a+"\0")<0&&(o+=a+"\0");for(i in e[2])if(A(e[2],i)&&"-net"==i.substr(i.length-4)){o.indexOf("\0"+e[2][i]+"\0")<0&&(o+=e[2][i]+"\0");o.indexOf("\0"+e[3][i]+"\0")<0&&(o+=e[3][i]+"\0")}}yn(t||e[1],e[2],"NotSaveHistory");t&&Pi.updateCache(t,o)}}}},redo:function(e){var t,r,n,i,a,o=(e[0],"\0");if(e[1]==Gi.id){yn("canvas",e[3],"NotSaveHistory");tt("updateAttrPanel")}else if("config.colors"==e[1]){ai.extend(bi.colors,e[3]);for(n in bi.colors)A(bi.colors,n)&&!A(e[3],n)&&delete bi.colors[n]}else{r=h("#"+e[1].replace(/\,/g,",#"),Gi);for(n=0;n<r.length;n++){t=r[n];if(t){if(Qi==Dn.PCB){a=m(t,"net");a&&o.indexOf("\0"+a+"\0")<0&&(o+=a+"\0");for(i in e[2])if(A(e[2],i)&&"-net"==i.substr(i.length-4)){o.indexOf("\0"+e[2][i]+"\0")<0&&(o+=e[2][i]+"\0");o.indexOf("\0"+e[3][i]+"\0")<0&&(o+=e[3][i]+"\0")}}yn(t,e[3],"NotSaveHistory");Pi.updateCache(t,o)}}}}});Pi.defineUndoRedo("node",{undo:function(e){var t,r=(e[0],"\0");t=d(e[1]);if(t){var n=Gi.id,i=e[2].cloneNode(!0);if(Qi==Dn.PCB&&t.id!==n){var a=m(i,"net"),o=m(t,"net");a&&r.indexOf("\0"+a+"\0")<0&&(r+=a+"\0");o&&r.indexOf("\0"+o+"\0")<0&&(r+=o+"\0")}t.parentNode.replaceChild(i,t);f(i,"active")&&p(i,"active",!1);t.id===n?Gi=d(n):Pi.updateCache(i,r)}},redo:function(e){var t,r=(e[0],"\0");t=d(e[1]);if(t){var n=Gi.id,i=e[3].cloneNode(!0);if(Qi==Dn.PCB&&t.id!==n){var a=m(i,"net"),o=m(t,"net");a&&r.indexOf("\0"+a+"\0")<0&&(r+=a+"\0");o&&r.indexOf("\0"+o+"\0")<0&&(r+=o+"\0")}f(i,"active")&&p(i,"active",!1);t.parentNode.replaceChild(i,t);t.id===n?Gi=d(n):Pi.updateCache(i,r)}}});Pi.defineUndoRedo("text",{undo:function(e){var t=d(e[1]);if(t&&e[2]){Te(t,e[2]);Pi.updateCache(t)}},redo:function(e){var t=d(e[1]);if(t&&e[3]){Te(t,e[3]);Pi.updateCache(t)}}});Pi.defineUndoRedo("move",{undo:function(e){var t;e[0];t=h("#"+e[1].replace(/\,/g,",#"),Gi);Oe(t,-e[2],-e[3]);Pi.updateCache(t)},redo:function(e){var t;e[0];t=h("#"+e[1].replace(/\,/g,",#"),Gi);Oe(t,e[2],e[3]);Pi.updateCache(t)}});Pi.defineUndoRedo("rotate",{undo:function(e){var t;e[0];t=h("#"+e[1].replace(/\,/g,",#"),Gi);Ht(t,oe(-e[2]));Pi.updateCache(t)},redo:function(e){var t;e[0];t=h("#"+e[1].replace(/\,/g,",#"),Gi);Dt(t,e[2]);Pi.updateCache(t)}});Pi.defineUndoRedo("copperArea",{undo:function(e){},redo:function(e){}});Pi.removeCache=function(e){};Pi.updateCache=function(e,t){};Pi.canRedo=function(){return Pi.index<Pi.records.length-1};Pi.canUndo=function(e){return Pi.index>=0};Pi.allRecordsToString=function(){for(var e=[],t=0,r=Pi.records,n=r.length;t<n;t++)e[t]=Pi.recordToString(r[t]);return e};Pi.recordToString=function(e){if(!e||!e[0])return"";if(Array.isArray(e[0]))return Pi.recordToString(e[0])+(e.length>1?"...["+e.length+"]":"");if("string"!=typeof e[1])return e[0];var t=e[0],r="#"+e[1].replace(/\,/g,",#"),n=t+" : "+r;switch(t){case"add":case"del":e[2]&&(n+=" ; next_sibling : #"+e[2]);break;case"attr":case"attrpanel":n+=" ; old:"+JSON.stringify(e[2])+"; new:"+JSON.stringify(e[3]);break;case"node":break;case"text":n+=" ; old: "+D(e[2])+"; new: "+D(e[3]);break;case"move":n+=" ; dx:"+e[2]+"; dy:"+e[3];break;case"rotate":n+=" ; degree : "+e[2]}return n};Pi.recordToPlainObject=function(e,t){function r(e){if(!e)return"<null/>";var t;if(e.children[0]){t=Pi.XMLSerializer.serializeToString(e.cloneNode(!1));t=t.replace(/\/?>.*/,">...</"+e.tagName+">")}else t=Pi.XMLSerializer.serializeToString(e);t=t.replace(/ xmlns="[^"]*"/g,"");return t}function n(e){return e.split(",").map(function(e){if(!e)return"<null/>";try{var t=e==Gi.id?Gi:Gi.querySelector("#"+e);return t?r(t):"<null/>"}catch(e){return"<ERROR/>"}})}function i(e){for(var t,n=e.split(","),i=[],a=0,o=n.length;a<o;a++)if(n[a]){t=h("#"+n[a],li);t=t&&t.length&&t[t.length-1];if(t)try{i.push(r(t))}catch(e){i.push("<null/>")}else i.push("<null/>")}else i.push("<null/>");return i}function a(e){if(Array.isArray(e[0]))return e.map(a);var t=e.slice(),o=t[0];if("node"==o){t[2]=r(t[2]);t[3]=r(t[3])}else"add"==o?t.push(n(t[1])):"del"==o&&t.push(i(t[1]));return t}return e&&e[0]&&Array.isArray(e)?a(e):""};je.prototype.deleteItemAt=function(e){this.hist.splice(e,1);this.nodes.splice(e,1)};je.prototype.update=function(){for(var e=this.hist,t=this.nodes,r=0,n=t.length;r<n;r++)e[r][3]=t[r].cloneNode(!0)};je.prototype.updateAndSave=function(){this.update();this.hist.length>0&&Pi.save(this.hist)};a.registerHook({getHistory:function(){return{index:Pi.index,records:Pi.allRecordsToString()}},getHistoryTimestamp:function(){var e=Pi.index,t={};e>=0&&(t.undo=Pi.timestamps[e]);e<Pi.records.length-1&&(t.redo=Pi.timestamps[e+1]);return t},consoleHistory:function(){},clearHistory:function(){Pi.clear()},cacheHistory:function(){Pi.startBatch()},flushHistory:function(){Pi.saveBatch()}});var Vi={makePArrFromStr:function(e){for(var t=[],r=e.replace(/ +/g,","),n=r.split(","),i=n.length/2,a=0;a<i;a++)t.push({x:+n[2*a],y:+n[2*a+1]});return t},makePArrToStr:function(e){if(e&&e.length>=2){for(var t=[],r=0;r<e.length;r++){t.push(e[r].x);t.push(e[r].y)}return t.join(" ")}return""},isPointInPoly:function(e,t){for(var r=!1,n=-1,i=e.length,a=i-1;++n<i;a=n)(e[n].y<=t.y&&t.y<e[a].y||e[a].y<=t.y&&t.y<e[n].y)&&t.x<(e[a].x-e[n].x)*(t.y-e[n].y)/(e[a].y-e[n].y)+e[n].x&&(r=!r);return r},isPointInBBox:function(e,t){for(var r=new c(1e4,1e5),n=new c(0,0),i=0,a=e.length;i<a;i++){r.x=+r.x>+e[i].x?e[i].x:r.x;r.y=+r.y>+e[i].y?e[i].y:r.y;n.x=+n.x<+e[i].x?e[i].x:n.x;n.y=+n.y<+e[i].y?e[i].y:n.y}r.x=r.x-2;r.y=r.y-2;n.x=+n.x+2;n.y=+n.y+2;return t.x>=r.x&&t.y>=r.y&&t.x<=n.x&&t.y<=n.y},isPointInCircle:function(e,t,r){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)<r*r},distancePointToPoint:function(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},ptOnLine:function(e,t,r){var n=Math.min,i=Math.max;return n(t.x,r.x)<=e.x&&e.x<=i(t.x,r.x)&&n(t.y,r.y)<=e.y&&e.y<=i(t.y,r.y)&&(e.x-t.x)*(r.y-t.y)==(r.x-t.x)*(e.y-t.y)},distancePointFromLine:function(e,t,r){return e.x==t.x&&t.x==r.x?Math.min(Math.abs(e.y-t.y),Math.abs(e.y-r.y)):e.y==t.y&&t.y==r.y?Math.min(Math.abs(e.x-t.x),Math.abs(e.x-r.x)):Math.abs(((r.x-t.x)*(t.y-e.y)-(t.x-e.x)*(r.y-t.y))/Math.sqrt((t.x-r.x)*(t.x-r.x)+(t.y-r.y)*(t.y-r.y)))},getPointToSegmentObj:function(e,t,r){var n,i,a,o={x:null,y:null};n=r.x-t.x;i=r.y-t.y;if(0===n&&0===i){n=e.x-t.x;i=e.y-t.y;o.x=t.x;o.y=t.y;return{d:Math.sqrt(n*n+i*i),point:o}}a=((e.x-t.x)*n+(e.y-t.y)*i)/(n*n+i*i);if(a<0){n=e.x-t.x;i=e.y-t.y;o.x=t.x;o.y=t.y}else if(a>1){n=e.x-r.x;i=e.y-r.y;o.x=r.x;o.y=r.y}else{o.x=t.x+a*n;o.y=t.y+a*i;n=e.x-o.x;i=e.y-o.y}return{d:Math.sqrt(n*n+i*i),point:o}},splitPloylineByPoint:function(e,t){var r=pi.gJsonCache.TRACK[t];if(!r||!r.pointArr)return!1;var n=r.pointArr,i=n.length;if(i<2)return!1;if(this.isPointInCircle(e,n[0],1)||this.isPointInCircle(e,n[i-1],1))return!1;for(var a="",o="",s=!1,l=0;l<i-1;l++){a+=n[l].x+" "+n[l].y+" ";if(Vi.getPointToSegmentObj(e,n[l],n[l+1]).d<.4){s=!0;break}}if(!s)return!1;a+=e.x+" "+e.y;o=e.x+" "+e.y+" ";for(l++;l<=i-1;l++)o+=n[l].x+" "+n[l].y+" ";return[V(a),V(o)]},getStartAndEndPointByDimensionElement:function(e){var t=e.pathSegList;if(!t)return[];var r=t.getItem(0),n=t.getItem(1),i=t.getItem(3),a=t.getItem(6),o=t.getItem(8);return a.x===n.x&&a.y===n.y?[r.x,r.y,n.x,n.y]:o.x===i.x&&o.y===i.y?[r.x,r.y,i.x,i.y]:[]},getDimensionPath:function(e,t,r){var n,i=t.x-e.x,a=e.y-t.y,o=r||10,s=[e.x+5,e.y+3,e.x,e.y,e.x+5,e.y-3],l=[t.x-5,t.y+3,t.x,t.y,t.x-5,t.y-3],c=te(e.x,e.y,t.x,t.y),d=Z(e.x,e.y,t.x,t.y),h=180/(Math.PI/d),u="",p="",f="";p=ai.toFixed(ai.units.convert(c,"pixel",bi.canvas.unit),2)+("inch"==bi.canvas.unit?'"':bi.canvas.unit);var g=tt("getFontsWidth",[p,o]),y=(c-g)/2-2,v=Math.abs(y)*Math.cos(d),m=Math.abs(y)*Math.sin(d),x=(i>0?e.x:t.x,+e.x+i/2),_=+e.y-a/2,P=0;if(g>0){if(y>0)if(i>0){x=+e.x+v;_=+e.y+m}else{x=+t.x-v;_=+t.y-m}else if(i>0){x=+e.x-v;_=+e.y-m}else{x=+t.x+v;_=+t.y+m}y-5<0&&(P+=3+o/2)}n={text:p,x:+x+2,y:+_-P,fontSize:o,degree:i>0?h:h+180,rotateOriginX:+x,rotateOriginY:+_};f=tt("getRotateStringPath",[n]);var S=y-5<0?h+180:h;s=re(s,S,e.x,e.y);l=re(l,S,t.x,t.y);u="M"+e.x+","+e.y+"L"+(y-5<0?t.x+","+t.y:e.x+v+","+(e.y+m)+"M"+(t.x-v)+","+(t.y-m)+"L"+t.x+","+t.y)+"M"+s[0]+","+s[1]+"L"+s[2]+","+s[3]+"L"+s[4]+","+s[5]+"M"+l[0]+","+l[1]+"L"+l[2]+","+l[3]+"L"+l[4]+","+l[5];return u+f},getProtractorPath:function(e,t,r,n){var i,a,o,s,l="",c=e[0],d=e[1],h=r[0],u=r[1];if(n){i=n.fontPoint;a=n.fontSize;o=n.canAdjustLineLength;s=isNaN(n.precision)?0:n.precision}angle=0;var p=h-c,f=u-d,g=Math.sqrt(Math.pow(p,2)+Math.pow(f,2)),y=p/g,v=Math.acos(y),m=180/(Math.PI/v);f>0&&(m=360-m);var x=t[0],_=t[1],P=x-c,S=_-d,b=Math.sqrt(Math.pow(P,2)+Math.pow(S,2)),C=P/b,A=Math.acos(C),I=180/(Math.PI/A);S>0&&(I=360-I);var L=Math.abs(I-m);angle=L;L>180&&(angle=360-L);angle=ai.toFixed(angle,s);if(isNaN(angle))return"";var E=g,O=g,T=ai.arc.getAngle(P,S),w=ai.arc.getDotByAngle(E,O,T),R=o?x:c+w.x,N=o?_:d+w.y;if(te(c,d,R,N)<=20){E=O=20;w=ai.arc.getDotByAngle(E,O,T);R=c+w.x;N=d+w.y}l+="M"+c+" "+d+" L"+R+" "+N;var k=h,B=u;if(te(c,d,k,B)<=20){E=O=20;T=ai.arc.getAngle(p,f);w=ai.arc.getDotByAngle(E,O,T);k=c+w.x;B=d+w.y}l+="M"+c+" "+d+" L"+k+" "+B;var V=ai.arc.getAngle(P,S),G=ai.arc.getAngle(p,f),F=ai.arc.getDotByAngle(10,10,V),D=ai.arc.getDotByAngle(10,10,G),H=c+F.x,j=d+F.y,U=c+D.x,Y=d+D.y,z=re(r,180,c,d),J=(R-z[0])*(e[1]-z[1])-(N-z[1])*(e[0]-z[0])>0?1:0;l+="M"+H+" "+j+" A10,10 0 0,"+J+" "+U+","+Y;var X=angle+"",K=a||4.5,W=tt("getFontsWidth",[X,K]),q=null,$=null;if(M(i)&&2===i.length){q=i[0];$=i[1]}else{var Q=Ue("path",{d:"M"+H+" "+j+" A10,10 0 0,"+J+" "+U+","+Y,fill:"none","stroke-width":1}),ee=Q.getTotalLength(),ne=Q.getPointAtLength(ee/2),ie=Z(e[0],e[1],ne.x,ne.y);q=e[0]+20*Math.cos(ie)-W/2;$=e[1]+20*Math.sin(ie)}var ae={text:X,x:q,y:$,fontSize:K,fontFamily:""};pathStr=tt("getFontPath",[ae]);l+="M"+(q-2)+" "+$+pathStr;return l},ptOnPolyline:function(e,t){for(var r=t.length,n=0;n<r-1;n++)if(this.ptOnLine(e,t[n],t[n+1]))return!0;return!1},getWireByXY:function(e,t){for(var r=h("#g1>polyline[c_etype=wire]",Gi),n=r.length,i=0;i<n;i++){var a={x:e,y:t};if(this.isPointOnPolyline(a,r[i]))return r[i]}},isPointOnPolyline:function(e,t){var r=t.getBBox(),n=e.x,i=e.y;if(n<r.x||n>r.x+r.width||i<r.y||i>r.y+r.height)return!1;var a=t.points;if(n==a.getItem(0).x&&i==a.getItem(0).y)return!0;for(var o=1,s=a.length||a.numberOfItems;o<s;o++)if(this.ptOnLine(e,a.getItem(o-1),a.getItem(o)))return!0;return!1},formatTrackPoints:function(e,t,r,n,i){function a(e,t){return Math.abs(e-t)}function o(e,t,r,n,i,o){var s,l,c,d=a(e,r),h=a(t,n);i=!1!==i;if(0===d||0===h)return"L";if(d==h){o=void 0===o?1:o;return"A"+d+" "+h+" 0 0 "+o+" "}l=Math.min(d,h);o=void 0===o?function(){var a=Math.atan2(n-t,r-e);a<0&&(a+=Math.PI+Math.PI);var o=4*a/Math.PI|0;return i==o%2>0?1:0}():o;s="A"+l+" "+l+" 0 0 "+o+" ";if(i){if(d>h){c=e<r?e+l:e-l;return s+c+" "+n+"L"}c=t<n?t+l:t-l;return s+r+" "+c+"L"}if(d>h){c=e<r?e+(d-h):e-(d-h);return"L"+c+" "+t+s}c=t<n?t+(h-d):t-(h-d);return"L"+e+" "+c+s}r=+r;n=+n;if("0"==t)return e.join(" ")+" "+r+" "+n;var s=e.length;if(!(s<2)){for(var l=0;l<s;l++)e[l]=+e[l];var d,h=new c(r,n),u=new c(e[s-2],e[s-1]),p=a(h.x,u.x),f=a(h.y,u.y);if("ARC"!=t&&(0===p||0===f))return e.join(" ")+" "+r+" "+n;if("90"==t){if(p>0&&f>0){d="h-v"==i?{x:h.x,y:u.y}:{x:u.x,y:h.y};return e.concat(ai.toFixed(d.x,3),ai.toFixed(d.y,3),r,n).join(" ")}return e.join(" ")+" "+r+" "+n}if("45"==t){var g="90-45"!=i;if(p==f||0===p||0===f)return e.join(" ")+" "+r+" "+n;d=g?p>f?{x:u.x+(h.x>u.x?f:-f),y:h.y}:{x:h.x,y:u.y+(h.y>u.y?p:-p)}:p>f?{x:h.x+(h.x>u.x?-f:f),y:u.y}:{x:u.x,y:h.y+(h.y>u.y?-p:p)};return e.concat(ai.toFixed(d.x,3),ai.toFixed(d.y,3),r,n).join(" ")}if("ARC"==t){var y="90-arc"!=i,v="M"+e[0]+" "+e[1];for(l=3;l<s;l+=2)v+=o(e[l-3],e[l-2],e[l-1],e[l],y)+e[l-1]+" "+e[l];v+=o(e[s-2],e[s-1],r,n,y)+r+" "+n;return v}}},getLengthOfTrackAndArc:function(e,t){if(!e||!e.d&&!e.pointArr)return 0;for(var r=e.d?Dr(e,!1):e.pointArr,n=0,i=0,a=r.length-1;i<a;i++)n+=this.distancePointToPoint(r[i],r[i+1]);return t?ai.toFixed(ai.units.convert(n,"pixel",bi.canvas.unit),3):n},getWholeNetLength:function(e){for(var t=pi.gJsonCache.SIGNALS[e]||[],r=0,n=0,i=t.length;n<i;n++)!t[n]||"TRACK"!=t[n].cmd&&"ARC"!=t[n].cmd||(r+=this.getLengthOfTrackAndArc(pi.gJsonCache[t[n].cmd][t[n].gId]));return ai.toFixed(ai.units.convert(r,"pixel",bi.canvas.unit),3)}};gt.data={clientX:null,clientY:null,lastUpX:null,lastUpY:null,uplock:!1};t.addEventListener("click",function(e){tt("triggerClick",[e])},!1);var Gi=d("g1"),Fi=d("selectBox1"),Di=d("gControlDots"),Hi=d("gControlRects"),ji=d("gControlLines");Yr.prototype={mdown:function(e){var r=Xn,n=gi,i=e.originalTarget||e.target||e.srcElement;if(e.button===Vn&&n&&"cdot"==m(i,"c_shapetype")){var a=Qe(e,!1);fi.style.cursor="move";r.ready=!0;r.target=n;r.x0=a.x;r.y0=a.y;r.dotIndex=+(m(i,"id")||"").substr(4);r.targetX0=+m(i,"cx");r.targetY0=+m(i,"cy");r.movedX=0;r.movedY=0;r.alwaysNotSnap=ki.alwaysNotSnap(n,r.dotIndex);r.effectD0=ki.get(n);r.pathD0=m(n,"d")||void 0;t.addEventListener("mousemove",r.mmove,!1);t.addEventListener("mouseup",r.mup,!1)}},mmove:function(e){var t,r,n,i,a,o,s,l,c=Xn,d=c.target;if(d&&c.ready){Bi.altKeyEnabled=e.altKey;var h=Qe(e,!1);t=h.x-c.x0;r=h.y-c.y0;if(c.start||!((t*t+r*r)*ci*ci<9)){var u,p=ai.getPCBCmdKey(d),f="TRACK"==p||"ARC"==p&&(0===c.dotIndex||1===c.dotIndex);if(f&&(u=pi.ifFind(t+c.targetX0,r+c.targetY0,"",zi.getActiveLayer(),"ALL"))&&u.type&&u.gId!=d.id){a=u.X-c.targetX0;o=u.Y-c.targetY0}else if(bi.adsorbGrid.enabled&&!c.alwaysNotSnap){n={x:t+c.targetX0,y:r+c.targetY0};i=Ie(n);a=i.x-c.targetX0;o=i.y-c.targetY0}else{a=t;o=r}s=a-c.movedX;l=o-c.movedY;if(s||l){c.movedX=a;c.movedY=o;if(!c.start){c.start=!0;c.ondragstart&&c.ondragstart()}ki.set(d,c.effectD0,c.dotIndex,c.movedX,c.movedY,c.pathD0);f&&Qi==Dn.PCB&&Ci.doRealtimeDRC(d,!0);it(d);c.ondrag&&c.ondrag()}}}},mup:function(e){var r=Xn;if(e.button===Vn&&r.ready){t.removeEventListener("mousemove",r.mmove,!1);t.removeEventListener("mouseup",r.mup,!1);r.ready=!1;fi.style.cursor="";if(r.start){r.start=!1;r.ondragend&&r.ondragend()}}}};zr.prototype={mdown:function(e){if(xi)return!1;if(!si.on&&e.button===Vn){var r=e.target,n=(Qi==Dn.PCB||Qi==Dn.PCBLIB)&&ai.getPCBCmdKey(r);if("TRACK"!=n&&"COPPERAREA"!=n||r.parentNode!=Gi){if(e.shiftKey||e.ctrlKey||e.metaKey)return}else if(!e.shiftKey||e.ctrlKey||e.metaKey)return;if(r!=t.documentElement&&!(e.target.tagName&&/^(input|textarea|button|a)/i.test(e.target.tagName)||"cdot"==m(r,"c_shapetype"))){var i=At(r),a=i;a&&"FOOTPRINT"==ai.getPCBCmdKey(a)&&"TEXT"==ai.getPCBCmdKey(r.parentNode)&&(a=e.target.parentNode);if(!a&&oi){a=oi.target;if("FOOTPRINT"==ai.getPCBCmdKey(a)){var o=oi.evtTarget.parentNode;"TEXT"==ai.getPCBCmdKey(o)&&(a=o)}}if(a){var s=Kn,l=Qe(e,!1);s.ready=!0;s.start=!1;s.target=a;s.evtTarget=r;s.selectedObjs=Xt().filter(function(e){return!!e&&("part_pcbtext"===m(e,"c_partid")||e.parentNode==Gi)});s.x0=l.x;s.y0=l.y;s.lastX=s.x0;s.lastY=s.y0;s.lastDX=0;s.lastDY=0;s.movedX=0;s.movedY=0;if(!s.onready||!1!==s.onready()){fi.style.cursor="move";s.atPartNoteText=Qi==Dn.PCB&&"TEXT"==ai.getPCBCmdKey(a);s.snapped=bi.adsorbGrid.enabled;s.originOffset=s.snapped&&function(e){var t;t="part_pcbtext"===m(r.parentNode,"c_partid")?Ae(r.parentNode):Ce(e);var n=t&&Ie(t);if(n&&(n.x!=t.x||n.y!=t.y))return{x:t.x-s.x0,y:t.y-s.y0}}(s.selectedObjs);t.addEventListener("mousemove",s.mmove,!1);t.addEventListener("mouseup",s.mup,!1)}}}}},mmove:function(e){var t=Kn;if(t.ready){var r=t.target,n=t.selectedObjs,i=(Qi==Dn.PCB||Qi==Dn.PCBLIB)&&ai.getPCBCmdKey(n[0]);Bi.altKeyEnabled=e.altKey;if(1!==n.length||n[0].parentNode!=Gi||"TRACK"!=i&&"COPPERAREA"!=i){if(e.shiftKey||e.ctrlKey||e.metaKey)return}else if(!e.shiftKey||e.ctrlKey||e.metaKey)return;var a,o,s,l,c,d,h,u,p=Qe(e,!1),f=p.x,g=p.y,y=f-t.x0,v=g-t.y0;if(!t.start){if(!y&&!v)return;if((y*y+v*v)*ci*ci<9)return;t.start=!0;if(t.ondragstart){a=t.ondragstart();if(!1===a){t.ready=!1;t.start=!1;return!1}}}t.lastX=f;t.lastY=g;t.lastDX=y;t.lastDY=v;if(t.snapped){o=t.originOffset;if(o){s={x:f+o.x,y:g+o.y};l=Ie(s);c=l.x-(t.x0+o.x);d=l.y-(t.y0+o.y)}else{l=Ie({x:y,y:v});c=l.x;d=l.y}}if(void 0===c){c=y;d=v}h=c-t.movedX;u=d-t.movedY;if(h||u){t.movedX=c;t.movedY=d;t.atPartNoteText?Ee(r,h,u):Oe(n,h,u);t.ondrag&&t.ondrag()}}},mup:function(e){if(e.button===Vn){var r=Kn;t.removeEventListener("mousemove",r.mmove,!1);t.removeEventListener("mouseup",r.mup,!1);if(r.ready){r.ready=!1;fi.style.cursor="";if(r.start){r.start=!1;r.ondragend&&r.ondragend()}}}}};Jr.prototype={mdown:function(e){if(e.button===Vn&&!(e.shiftKey||e.ctrlKey||e.altKey||e.metaKey||"cdot"==m(e.target,"c_shapetype")||oi)){var t,r=this;r.mouseIsDown=!0;if(!(r.strictMousedownTarget&&r.strictMousedownTarget!=e.target||r.mousedownTarget instanceof Function&&!0!==r.mousedownTarget(e,r))){if(r.onmousedown){t=r.onmousedown.call(r.mousedownTarget,e,r);if(!1===t)return!1}if(r.downcursor){r.oldDownCursor=r.mousedownTarget.style.cursor;r.mousedownTarget.style.cursor=r.downcursor}var n=Qe(e,!1);r.ready=!0;r.x0=n.x;r.y0=n.y;r.dx=0;r.dy=0;r.x1=r.x0;r.y1=r.y0;if(r.onready){t=r.onready.call(r.mousedownTarget,e,r);if(!1===t){r.ready=!1;return!1}}r.mousedownTarget instanceof Function?fi.addEventListener("mousemove",r.e.mmove,!1):r.mousemoveTarget.addEventListener("mousemove",r.e.mmove,!1);r.mousedownTarget instanceof Function?fi.addEventListener("mouseup",r.e.mup,!1):r.mouseupTarget.addEventListener("mouseup",r.e.mup,!1);r.bind=!0}}},mmove:function(e){var t=this;if(t.mouseIsDown&&t.ready){var r,n=Qe(e,!1),i=n.x,a=n.y,o=i-t.x0,s=a-t.y0;if(!t.start){if((o*o+s*s)*ci*ci<9)return;if(t.mousemoveTarget instanceof Function&&!0!==t.mousemoveTarget(e,t))return;if(t.ondragstart){r=t.ondragstart.call(t.mousedownTarget,e,t);if(!1===r){t.ready=!1;t.start=!1;return!1}}t.start=!0;if(t.cursor){t.oldMoveCursor=t.mousemoveTarget.style.cursor;t.mousemoveTarget.style.cursor=t.cursor}t.downcursor&&(t.mousedownTarget.style.cursor=t.oldDownCursor)}t.x1=i;t.y1=a;t.dx=o;t.dy=s;if(t.ondrag){if(t.mousemoveTarget instanceof Function&&!0!==t.mousemoveTarget(e,t))return;r=t.ondrag.call(t.mousedownTarget,e,t);if(!1===r){t.cursor&&(t.mousemoveTarget.style.cursor=t.oldMoveCursor);t.ready=!1;t.start=!1;return!1}}}},mup:function(e){var t=this;if(e.button===Vn){t.mouseIsDown=!1;if(t.bind){t.mousedownTarget instanceof Function?fi.removeEventListener("mousemove",t.e.mmove,!1):t.mousemoveTarget.removeEventListener("mousemove",t.e.mmove,!1);t.mousedownTarget instanceof Function?fi.removeEventListener("mouseup",t.e.mup,!1):t.mouseupTarget.removeEventListener("mouseup",t.e.mup,!1);t.bind=!1}if(t.ready&&t.start){t.ready=!1;t.start=!1;t.start&&t.downcursor&&(t.mousedownTarget.style.cursor=t.oldDownCursor);t.cursor&&(t.mousemoveTarget.style.cursor=t.oldMoveCursor);if(t.ondragend){t.ondragend.call(t.mousedownTarget,e,t)}}}},destroy:function(){var e=this;e.mousedownTarget instanceof Function?fi.removeEventListener("mousedown",e.e.mdown,!1):e.mousedownTarget.removeEventListener("mousedown",e.e.mdown,!1);if(e.bind){e.mousedownTarget instanceof Function?fi.removeEventListener("mousemove",e.e.mmove,!1):e.mousemoveTarget.removeEventListener("mousemove",e.e.mmove,!1);e.mousedownTarget instanceof Function?fi.removeEventListener("mouseup",e.e.mup,!1):e.mouseupTarget.removeEventListener("mouseup",e.e.mup,!1);e.bind=!1}}};tn.prototype={mdown:function(e){var r=e.button,n=qn?e.metaKey:e.ctrlKey;if(r==Vn&&!n){var i=e.target;if(!("polyline"!=i.tagName&&"polygon"!=i.tagName||i.parentNode!==Gi||i.points.numberOfItems<2)){var a=tn.instance,o=!1;if(Qi==Dn.PCB||Qi==Dn.PCBLIB){if(e.button!==Vn||e.shiftKey||a.ready)return;o=bi.adsorbGrid.enabled&&(Qi==Dn.PCB||Qi==Dn.PCBLIB)&&"TRACK"==ai.getPCBCmdKey(i)}else{if(e.button!==Vn||!e.shiftKey||a.ready)return;o=bi.adsorbGrid.enabled}var s=xe({x:e.clientX,y:e.clientY}),l=K(s,i);if(!(l<0||l%2==0)){a.target=i;a.startX=s.x;a.startY=s.y;a.ready=1;a.start=0;a.snap=o;a.pIndex=l;a.oldPoints=null;a.polylinePoints=m(i,"points");t.addEventListener("mousemove",a.mmove,!1);t.addEventListener("mouseup",a.mup,!1)}}}},mmove:function(e){var t=tn.instance,r=t.target;if(t.ready){var n=xe({x:e.clientX,y:e.clientY}),i=n.x,a=n.y,o=i-t.startX,s=a-t.startY;if(!t.start){if((o*o+s*s)*ci*ci<9)return;t.start=1;t.ondragstart&&t.ondragstart({target:r,x0:t.startX,y0:t.startY,x1:i,y1:a,dx:o,dy:s,originalEvent:e})}t.ondrag&&t.ondrag({target:r,x0:t.startX,y0:t.startY,x1:i,y1:a,dx:o,dy:s,originalEvent:e})}},mup:function(e){if(e.button===Vn){var r=tn.instance;if(r.ready){t.removeEventListener("mousemove",r.mmove,!1);t.removeEventListener("mouseup",r.mup,!1);var n=r.start;r.ready=0;r.start=0;n&&r.ondragend&&r.ondragend({target:r.target,originalEvent:e})}}},mover:function(e){var t=e.target;if("polyline"==t.tagName&&t===gi){if(Qi==Dn.PCB||Qi==Dn.PCBLIB){if(e.shiftKey||e.altKey||e.ctrlKey||e.metaKey){st();return}}else if(!e.shiftKey){st();return}var r=xe({x:e.clientX,y:e.clientY}),n=K(r,t);(n>0||n%2!=0)&&rn(t,n)}},mout:function(e){var t=e.target;"polyline"==t.tagName&&t===gi&&st()},dblclick:function(e){var t=e.target;if("polyline"==t.tagName&&t===gi){var r=m(t,"points");_e(t);var n=(m(t,"points"),xe({x:e.clientX,y:e.clientY})),i=K(n,t);if(i<0)m(t,"points",r);else{0===i?i=1:i%2==0&&(i-=1);m(t,"stroke-opacity","0.5");var a=i>>1,o=t.points.getItem(a),s=t.points.getItem(a+1),l=getComputedStyle(t)||{},c=l.stroke||m(t,"stroke")||"#ffff66",d=l.strokeWidth||m(t,"stroke-width")||"1";d=d.replace(/[\D]+$/,"");var h={x1:o.x,y1:o.y,x2:s.x,y2:s.y,stroke:c,"stroke-width":1.1*d},u=tn.instance;u.target=t;if(u.controlLine){h.visibility="visible";m(u.controlLine,h);m(u.controlLine2,h)}else{var p=Ue("line",h);p.style.stroke=c;p.style.strokeDasharray="none";p.style.cursor="row-resize";fi.appendChild(p);u.controlLine=p;p.addEventListener("mousedown",this.mdown,!1)}}}}};var Ui={clear:function(e){var t=!!Kt();xt();Ct();for(var r="NotSaveHistory"==e,n=Gi.childNodes,i=n.length,a=[];--i>=0;)if(n[i].id&&!zi.markers.hasOwnProperty(n[i].id))if(r)Gi.removeChild(n[i]);else{a.push(n[i].id);li.appendChild(n[i])}pi.removeAll();if(!r){a=a.join(",");Pi.save(["del",a])}Qi==Dn.PCB&&ui.clear();t&&tt("triggerEvent",["select_change"])},getCanvasAttrs:function(){var e,t,r,n={};e=Ui.getViewBox();r=e[2];t=e[3];n["attr-pcbcanvas-unit"]=bi.canvas.unit;n["attr-pcbcanvas-width"]=r;n["attr-pcbcanvas-height"]=t;n["attr-pcbcanvas-bgcolor"]=m(d("gridBg"),"fill")||"#000000";n["attr-pcbcanvas-grid-visible"]="none"==m(d("grid1"),"display")?"none":"yes";n["attr-pcbcanvas-grid-color"]=m(d("gridCell"),"fill");n["attr-pcbcanvas-grid-style"]="url(#gridPattern)"==m(d("grid1"),"fill")?"dot":"line";n["attr-pcbcanvas-grid-size"]=m(d("gridPattern"),"width");n["attr-pcbcanvas-snap-size"]=bi.adsorbGrid.distanceX;n["attr-pcbcanvas-alt-snap-size"]=bi.adsorbGrid.altSnapSize||.5;n["attr-pcbcanvas-snap"]=bi.adsorbGrid.enabled?"yes":"none";n["attr-pcbcanvas-routing-size"]=bi.canvas.routing;n["attr-pcbcanvas-angle"]=bi.canvas.angle;n["attr-pcbcanvas-copper-zone"]=bi.canvas.copperZone;n["attr-canvas-origin-x"]=bi.canvas.originX;n["attr-canvas-origin-y"]=bi.canvas.originY;var i=m(Gi,"c_para")||"",a=ai.c_paraToJson(i);if("pcblib"==ai.fileType.getAbstractFileType(Qi)){
A(a,"package")||(a.package="");A(a,"pre")||(a.pre="");A(a,"Contributor")||(a.Contributor="");i=ai.jsonToC_para(a)}n.c_para=i;return n},modify_canvas:function(e){var t,r;for(r in e)if(A(e,r)){t=e[r];if("attr-pcbcanvas-width"==r);else if("attr-pcbcanvas-height"==r);else if("attr-pcbcanvas-bgcolor"==r){m(d("gridBg"),{fill:t});pi.gJsonCache.systemColor.background=t}else if("attr-pcbcanvas-grid-visible"==r){bi.adsorbGrid.visible="none"!==t;m(d("grid1"),"display","none"==t?t:"")}else if("attr-pcbcanvas-grid-color"==r){m(d("gridCell"),{fill:t});m(d("gridCell2"),{stroke:t});pi.gJsonCache.systemColor.grid=t}else if("attr-pcbcanvas-grid-size"==r){if(+t<.1)continue;for(var n=+t;n*ci<5;)n*=n*ci*2>=5?2:n*ci*5>=5?5:10;m([d("gridPattern"),d("gridPattern2")],{width:n,height:n});m(d("gridCell2"),{d:"M10 0V10H-10".replace(/10/g,n)});bi.adsorbGrid.gridSize=+t}else if("attr-pcbcanvas-grid-style"==r)m(d("grid1"),"fill","dot"==t?"url(#gridPattern)":"url(#gridPattern2)");else if("attr-pcbcanvas-snap-size"==r){t=t||1;bi.adsorbGrid.distanceX=bi.adsorbGrid.distanceY=+t}else if("attr-pcbcanvas-snap"==r)bi.adsorbGrid.enabled="yes"==t;else if("attr-pcbcanvas-alt-snap-size"==r)bi.adsorbGrid.altSnapSize=+t||.1;else if("attr-pcbcanvas-routing-size"==r){bi.canvas.routing=t;+bi.canvas.routing<=.4&&(bi.canvas.routing=.4);"draw.track"===xi&&Yi.line&&m(Yi.line,"stroke-width",bi.canvas.routing)}else if("attr-pcbcanvas-angle"==r)bi.canvas.angle=t;else if("attr-pcbcanvas-unit"==r){bi.canvas.unit=t;Sr()}else if("attr-pcbcanvas-copper-zone"==r){if(Qi==Dn.PCB){bi.canvas.copperZone=t;Ai.showOrHideCopperZone(bi.canvas.copperZone)}}else if("c_para"==r)m(Gi,{c_para:t});else{if((r+t).indexOf(Un)>=0)continue;if(ai.fileType.isLib(Qi)&&"pre"==r&&!t.trim()){parent.$.messager.error("This field can't be removed!");continue}xn(Gi,r,t);tt("updateAttrPanel")}}A(e,"attr-pcbcanvas-unit")&&We();if(A(e,"attr-pcbcanvas-origin-x")||A(e,"attr-pcbcanvas-origin-y")){var i=bi.canvas.originX,o=bi.canvas.originY;A(e,"attr-pcbcanvas-origin-x")&&(i=+e["attr-pcbcanvas-origin-x"]);A(e,"attr-pcbcanvas-origin-y")&&(o=+e["attr-pcbcanvas-origin-y"]);isFinite(i)&&isFinite(o)&&a("setOriginXY",[{x:i,y:o}])}},getViewBox:function(){return m(fi,"viewBox").split(" ").map(parseFloat)},setViewBox:function(){var e=d("gridBg"),t=d("grid1"),r=d("gridOH"),n=d("gridOV");return function(i){m(fi,"viewBox",i.join(" "));var a={x:i[0],y:i[1],width:i[2],height:i[3]};m(e,a);m(t,a);m(r,{x1:i[0],x2:i[0]+i[2]});m(n,{y1:i[1],y2:i[1]+i[3]});tt("updateRuler",[{vbX:i[0],vbY:i[1]}])}}()},Yi={version:1,readyed:!1,started:!1,dots:[],line:null,mockX:null,mockY:null,fromPadId:null,routedRealRatLine:null,trackPreference:{0:"",45:"90-45",90:"h-v",ARC:"arc-90"},ready:function(){var e=xi;if(!Yi.readyed){Yi.readyed=!0;t.addEventListener("mousedown",Yi.mousedown,!1);t.addEventListener("mouseup",Yi.mouseup,!1);t.addEventListener("mousemove",Yi.mousemove,!1);p(Gi,"events-none",!0);st("cross-red");0===xi.indexOf("place.part_")&&(e="place.part");Yi[e]&&"function"==typeof Yi[e].ready&&Yi[e].ready()}},mousedown:function(e){},mouseup:function(e){var r,n,i,a=Yi;if((ti||e.target!=t.documentElement&&e.target!=t.body)&&(e.button!=Gn||!Yn.dragpanning)){Ct();if(e.button!=Gn){var o=a.dots;r=Qe(e);n=r.x;i=r.y;if(!a.started){a.started=!0;o.length=0}a.draw(n,i,!0)}else{if(a.started&&0!==xi.indexOf("place.part_"))if("draw.track"!==xi&&"draw.arc2"!==xi||0!==a.dots.length)if("draw.arcCenter"===xi){a.end();mt()}else if("draw.image"===xi){a.end();mt()}else if("draw.protractor"===xi){a.end();mt()}else if("draw.measureLine"===xi){a.end();mt()}else{r=Qe(e);n=r.x;i=r.y;a.next(n,i)}else{a.end();mt()}else{a.end();mt()}Yn.drawing=!0;setTimeout(function(){Yn.drawing=!1},5)}}},mousemove:function(e){var r=Yi;if(r.started&&("object"!=typeof zn||!zn||!zn.ready)){var n=Qe(e),i=n.x,a=n.y;if(!(r.dots.length>0&&r.mockX==i&&r.mockY==a))if(ti||e.target!=t.documentElement&&e.target!=t.body){r.draw(i,a,!1);r.mockX=i;r.mockY=a}else if(0===xi.indexOf("place.part_")){var o=xi.substr(6);dt(o)}}},draw:function(e,t,r){var n,i=Yi,a=xi;i.lastX=e;i.lastY=t;n=i.dots.length;if(!(n>=2&&e==i.dots[n-2]&&t==i.dots[n-1])){r&&i.dots.push(e,t);0===xi.indexOf("place.part_")&&(a="place.part");Yi[a]&&"function"==typeof Yi[a].draw&&Yi[a].draw(e,t,r)}},next:function(e,t){var r,n=Yi,i=(n.dots,[]),a=d("pdot0"),o=xi;n.started=!1;a&&"none"!=m(a,"display")&&m(a,"display","none");var s=n.line;if(n.line&&void 0!==e&&void 0!==t){n.draw(e,t,!0);n.line||(s=null)}0===xi.indexOf("place.part_")&&(o="place.part");Yi[o]&&"function"==typeof Yi[o].next&&Yi[o].next(e,t);n.line||(s=null);s&&zi.appendElement(s);n.line=null;n.dots.length=0;n.mockX=null;n.mockY=null;n.fromPadId=null;n.routedRealRatLine=null;if(s){r=s.id;i=["add",r,ai.node.getRefId(s)];i.length&&Pi.save(i)}},end:function(e){var r=Yi,n=(r.dots,xi);0===xi.indexOf("place.part_")&&(n="place.part");Yi[n]&&"function"==typeof Yi[n].end&&Yi[n].end(e);r.mockX=null;r.mockY=null;r.line=null;r.started=!1;r.dots.length=0;r.readyed=!1;t.removeEventListener("mousedown",r.mousedown,!1);t.removeEventListener("mouseup",r.mouseup,!1);t.removeEventListener("mousemove",r.mousemove,!1);p(Gi,"events-none",!1);st();var i=d("pdot0");i&&"none"!=m(i,"display")&&m(i,"display","none")},restart:function(e){var t=Yi,r=xi;Ci&&Ci.hideRealtimeDRCError&&Ci.hideRealtimeDRCError();if(xi){t.end(27);xi="";(t.started&&t.dots.length||"draw.connect"==r)&&yt(r)}},canBackStep:function(){var e=Yi,t=xi;return e.started&&("draw.polyline"==t||"draw.polygon"==t||"draw.bezier"==t||"draw.wire"==t||"draw.bus"==t||"draw.track"==t)&&e.dots.length>=4},backStep:function(){var e=Yi;if(e.canBackStep()){e.dots.length-=2;if("draw.track"==xi){var t=bi.canvas.angle;e.certainPath="ARC"==t?e.certainPath.replace(/[LA][^LA]+$/i,""):e.certainPath.replace(/(\s+\S+){2}\s*$/,"")}e.draw(e.lastX,e.lastY)}}};Yi.showSnapPoint=function(e,t){var r=zi.getActiveLayer(),n=Yi.line&&m(Yi.line,"c_auto_net"),i=n||!Yi.line?"":m(Yi.line,"net");pi.checkShow(e,t,i,r)};Yi["draw.arc2"]={ready:function(){Yi.started=!0},draw:function(e,t,r){var n,i,a,o,s,l,c,h,u,p,f=Yi,g="",y=f.dots,v=zi.getActiveLayer(),_=r?f.dots.length-2>0?f.dots.length-2:0:f.dots.length,P=!f.line;if(r){c=pi.ifFind(e,t,"",v,"ALL");var S;f.line&&(p=m(f.line,"c_auto_net"));if(c&&c.type){e=ai.toFixed(c.X,2);t=ai.toFixed(c.Y,2);st("cross-red",e,t);if(c.net&&f.line){var b=m(f.line,"net");if(b!==c.net&&b){p&&x(f.line,"c_auto_net");if(p){m(f.line,"net",c.net);S=Ei.mergeNets(c.net,b,!1)}else{S=Ei.mergeNets(b,c.net);if(!1===S){f.restart();return}}}}}if(0===_){f.startNet=c&&c.type?c.net:"";f.startNetId=c&&c.type?c.gId:""}if(c&&c.type&&_>=2){if(f.line){s=m(f.line,"net");if(!s){s=ft();m(f.line,"net",s)}l=[];if(void 0!==S){if(S instanceof Array&&S.length)for(;o=S.shift();)l.push(["attr",o[0],{net:o[1]},{net:o[2]}])}else{if(f.startNetId&&f.startNet!=s){l.push(["attr",f.startNetId,{net:f.startNet},{net:s}]);m(d(f.startNetId),"net",s);pi.updateOne(d(f.startNetId))}var C=c&&c.type?c.net:"",A=c&&c.type?c.gId:"";if(A&&C!=s){l.push(["attr",A,{net:C},{net:s}]);m(d(A),"net",s);pi.updateOne(d(A))}}l.length&&Pi.save(l);f.line=null}f.next();return}}0===_&&r&&(Yi.routedRealRatLine=Ei.findRatLineByPos(e,t,v));if(_>=2){c=pi.ifFind(e,t,"",v,"ALL");if(c&&c.type){e=ai.toFixed(c.X,2);t=ai.toFixed(c.Y,2);st("cross-red",e,t)}if(Yi.routedRealRatLine){var I=e,L=t;2==Yi.routedRealRatLine[1]?m(Yi.routedRealRatLine[0],{x2:I,y2:L}):m(Yi.routedRealRatLine[0],{x1:I,y1:L})}if(f.line){i=te(y[0],y[1],e,t)/2;n="M"+y[0]+","+y[1]+" A"+i+","+i+" 0 0 1 "+e+","+t;m(f.line,"d",n);if(r){pi.updateOne(f.line);f.next()}Qi==Dn.PCB&&f.line&&Ci.doRealtimeDRC(f.line,!0)}else{f.certainPath="";g=f.startNet||"";c&&c.type&&c.net&&(g?g&&g!==c.net&&Ei.mergeNets(g,c.net):g=c.net);h={"stroke-width":v==Fn.BOARDOUTLINE?1:bi.canvas.routing,fill:"none",id:ai.newId(),c_shapetype:"line",layerid:v,net:g};a="path";i=te(y[0],y[1],e,t)/2;n="M"+y[0]+","+y[1]+" A"+i+","+i+" 0 0 1 "+e+","+t;h.d=n;f.line=Ue(a,h);Gi.appendChild(f.line);or(g)}}if(f.line){f.line.id||m(f.line,{id:ai.newId()});if(P){u="ARC";m(f.line,"layerid",v);zi.updateElementLayerId(f.line,u);zi.appendElement(f.line,u)}}r||Yi.showSnapPoint(e,t)},next:function(e,t){var r,n=Yi,i=n.dots;if(n.line)if(i.length<=2){if(n.line){v(n.line);n.line=null}}else{if(n.line&&i.length<4){v(n.line);n.line=null}nt()}n.started=!0;or("");if(!m(n.line,"net")){r=m(n.line,"layerid");r&&Mr(r)&&m(n.line,"net",ft())}pi.updateOne(n.line);Ei.buildOneNet(m(n.line,"net"),!1)},end:function(e){var t=Yi;if(t.line){v(t.line);Ei.buildOneNet(m(t.line,"net"),!1)}or("");Yi.routedRealRatLine=null}};Yi["draw.arcCenter"]={ready:function(){Yi.started=!0},draw:function(e,t,r){var n,i,a,o,s,l,c,h,u,p,f=Yi,g="",y=f.dots,v=zi.getActiveLayer(),_=r?f.dots.length-2>0?f.dots.length-2:0:f.dots.length,P=!f.line;if(r){c=pi.ifFind(e,t,"",v,"ALL");var S;f.line&&(p=m(f.line,"c_auto_net"));if(c&&c.type){e=ai.toFixed(c.X,2);t=ai.toFixed(c.Y,2);st("cross-red",e,t);if(c.net&&f.line){var b=m(f.line,"net");if(b!==c.net&&b){p&&x(f.line,"c_auto_net");if(p){m(f.line,"net",c.net);S=Ei.mergeNets(c.net,b,!1)}else{S=Ei.mergeNets(b,c.net);if(!1===S){f.restart();return}}}}}if(2===_){f.startNet=c&&c.type?c.net:"";f.startNetId=c&&c.type?c.gId:""}if(c&&c.type&&_>=4){if(f.line){s=m(f.line,"net");if(!s){s=ft();m(f.line,"net",s)}l=[];if(void 0!==S){if(S instanceof Array&&S.length)for(;o=S.shift();)l.push(["attr",o[0],{net:o[1]},{net:o[2]}])}else{if(f.startNetId&&f.startNet!=s){l.push(["attr",f.startNetId,{net:f.startNet},{net:s}]);m(d(f.startNetId),"net",s);pi.updateOne(d(f.startNetId))}var C=c&&c.type?c.net:"",A=c&&c.type?c.gId:"";if(A&&C!=s){l.push(["attr",A,{net:C},{net:s}]);m(d(A),"net",s);pi.updateOne(d(A))}}l.length&&Pi.save(l);f.line=null}f.next();return}}if(_>=2){r&&(Yi.routedRealRatLine=Ei.findRatLineByPos(e,t,v));c=pi.ifFind(e,t,"",v,"ALL");if(c&&c.type){e=ai.toFixed(c.X,2);t=ai.toFixed(c.Y,2);st("cross-red",e,t)}if(Yi.routedRealRatLine){var I=e,L=t;if(f.arcCenterRadius){var E=Z(y[0],y[1],e,t);I=y[0]+f.arcCenterRadius*Math.cos(E);L=y[1]+f.arcCenterRadius*Math.sin(E)}2==Yi.routedRealRatLine[1]?m(Yi.routedRealRatLine[0],{x2:I,y2:L}):m(Yi.routedRealRatLine[0],{x1:I,y1:L})}if(r&&2===_){f.certainPath="";g=f.startNet||"";f.currNet=g;c&&c.type&&c.net&&(g?g&&g!==c.net&&Ei.mergeNets(g,c.net):g=c.net)}if(f.line){Yi.routedRealRatLine&&or(f.currNet);m(f.line,"net")||m(f.line,"net",f.currNet);if(y.length<4){var O=re([e,t],180,y[0],y[1]);i=te(O[0],O[1],e,t)/2;n="M"+O[0]+","+O[1]+" A"+i+","+i+" 0 0 1 "+e+","+t;n+="M"+e+","+t+" A"+i+","+i+" 0 0 1 "+O[0]+","+O[1];m(f.line,"d",n)}else if(y.length>=4&&!r&&f.arcCenterDots&&f.arcCenterOppositeDots){var T=Z(y[0],y[1],e,t),w=y[0]+f.arcCenterRadius*Math.cos(T),R=y[1]+f.arcCenterRadius*Math.sin(T),N=(w-f.arcCenterOppositeDots[0])*(f.arcCenterDots[1]-f.arcCenterOppositeDots[1])-(R-f.arcCenterOppositeDots[1])*(f.arcCenterDots[0]-f.arcCenterOppositeDots[0])>0?0:1;n="M"+f.arcCenterDots[0]+","+f.arcCenterDots[1]+" A"+f.arcCenterRadius+","+f.arcCenterRadius+" 0 "+N+" 0 "+w+","+R;m(f.line,"d",n)}if(r)if(y.length>=6){pi.updateOne(f.line);f.next()}else if(4===y.length){var k=re([e,t],180,y[0],y[1]);f.arcCenterDots=[e,t];f.arcCenterOppositeDots=k;f.arcCenterRadius=te(k[0],k[1],e,t)/2}Qi==Dn.PCB&&f.line&&Ci.doRealtimeDRC(f.line,!0)}else{h={"stroke-width":v==Fn.BOARDOUTLINE?1:bi.canvas.routing,fill:"none",id:ai.newId(),c_shapetype:"line",layerid:v,net:g};var B=re([e,t],180,y[0],y[1]);a="path";i=te(B[0],B[1],e,t)/2;n="M"+B[0]+","+B[1]+" A"+i+","+i+" 0 0 1 "+e+","+t;n+="M"+e+","+t+" A"+i+","+i+" 0 0 1 "+B[0]+","+B[1];h.d=n;f.line=Ue(a,h);Gi.appendChild(f.line)}}if(f.line){f.line.id||m(f.line,{id:ai.newId()});if(P){u="ARC";m(f.line,"layerid",v);zi.updateElementLayerId(f.line,u);zi.appendElement(f.line,u)}}r||Yi.showSnapPoint(e,t)},next:function(e,t){var r,n=Yi,i=n.dots;if(n.line)if(i.length<=2){if(n.line){v(n.line);n.line=null}}else{n.arcCenterDots=null;n.arcCenterOppositeDots=null;n.arcCenterRadius=null;Yi.routedRealRatLine=null;n.currNet=null}or("");if(!m(n.line,"net")){r=m(n.line,"layerid");r&&Mr(r)&&m(n.line,"net",ft())}pi.updateOne(n.line);Ei.buildOneNet(m(n.line,"net"),!1)},end:function(e){var t=Yi;t.arcCenterDots=null;t.arcCenterOppositeDots=null;t.arcCenterRadius=null;t.currNet=null;if(t.line){v(t.line);Ei.buildOneNet(m(t.line,"net"),!1)}or("");Yi.routedRealRatLine=null}};Yi["draw.circle"]={ready:null,draw:function(e,t,n){var i,a,o,s,l,c=Yi,d=n?c.dots.length-2>0?c.dots.slice(0,c.dots.length-2):[]:c.dots,h=zi.getActiveLayer(),u=d.length,p=!c.line;if(u>=2){e==d[u-2]||t==d[u-1]?(i=(e+d[u-2])/2,a=(t+d[u-1])/2,o=Math.abs(e-d[u-2])/2,s=Math.abs(t-d[u-1])/2,r=Math.max(o,s)):(i=(e+d[u-2])/2,a=(t+d[u-1])/2,o=Math.abs(e-d[u-2])/2,s=Math.abs(t-d[u-1])/2);r=Math.max(o,s);if(c.line)m(c.line,{cx:i,cy:a,r:r});else{c.line=Ue("circle",{cx:i,cy:a,r:r,"stroke-width":"1",fill:"none"});m(c.line,{c_shapetype:"line"});Gi.appendChild(c.line)}if(n){pi.updateOne(c.line);c.next()}if(c.line){c.line.id||m(c.line,{id:ai.newId()});if(p){l="draw.circle";m(c.line,"layerid",h);zi.updateElementLayerId(c.line,l);zi.appendElement(c.line,l)}}}},next:function(e,t){var r=Yi,n=r.dots;if(r.line&&n.length<=2&&r.line){v(r.line);r.line=null}},end:function(e){var t=Yi;t.line&&v(t.line)}};Yi["draw.connect"]={ready:function(){zi.show(Fn.RATLINES)},draw:function(e,t,r){var n,a,o,s,l=Yi,c=r?l.dots.length-2>0?l.dots.slice(0,l.dots.length-2):[]:l.dots,d=(zi.getActiveLayer(),c.length);if(0===d){if(r){o=pi.ifFind(e,t,"",Fn.ALL,"ALL");if(!o||!o.isFootprintPad){l.dots.splice(0,2);return}e=o.X;t=o.Y;Yi.fromPadId=o.gId}}else if(d>=2){if(r){o=pi.ifFind(e,t,"",Fn.ALL,"ALL");if(!o||!o.isFootprintPad){l.dots.splice(d-2,2);return}e=o.X;t=o.Y;if(e==c[d-2]&&t==c[d-1])return}if(l.line){m(l.line,{x2:e,y2:t});if(r){v(l.line);l.line=null;if(o.gId){var h=Ei.connect(l.fromPadId,o.gId);s=[];if(h&&h.length){for(;i=h.shift();)s.push(["attr",i[0],{net:i[1]},{net:i[2]}]);Pi.save(s)}}l.next()}}else{a="line";n={x1:c[0],y1:c[1],x2:e,y2:t,id:ai.newId(),c_shapetype:"line"};n.layerid=Fn.RATLINES;l.line=Ue(a,n);Gi.appendChild(l.line)}l.line&&(l.line.id||m(l.line,{id:ai.newId()}))}},next:function(e,t){var r=Yi,n=r.dots;e&&t&&(n=r.dots.length-2>0?r.dots.slice(0,r.dots.length-2):[]);if(r.line&&n.length<=2&&r.line){v(r.line);r.line=null}},end:function(e){var t=Yi;t.line&&v(t.line)}};Yi["draw.copperArea"]={ready:null,draw:function(e,t,r){var n,i=Yi,a=i.dots,o=zi.getActiveLayer(),l=a.length,c=!i.line;if(l>=2){s=a.join(" ")+" "+e+" "+t;if(i.line)m(i.line,{points:s});else{n="polygon";i.line=Ue(n,{points:s,"stroke-width":"2",clearanceWidth:"1",fillStyle:"solid",fill:"none",thermal:"spoke",keepIsland:"none","stroke-dasharray":"3,3",net:"GND",layerid:o});m(i.line,{c_shapetype:"line"});Gi.appendChild(i.line)}if(i.line){i.line.id||m(i.line,{id:ai.newId()});if(c){zi.updateElementLayerId(i.line,"COPPERAREA");zi.appendElement(i.line,"COPPERAREA")}}}},next:function(e,t){var r=Yi,n=r.dots;if(r.line)if(n.length<=2){if(r.line){v(r.line);r.line=null}}else{pi.updateOne(r.line);Ei.buildOneNet(m(r.line,"net"),!1)}},end:function(e){var t=Yi,r=t.dots;if(!e&&t.line&&r.length>=2){var n=r.join(" ");m(t.line,{points:n,c_shapetype:"line"})}else t.line&&v(t.line)}};Yi["draw.dimension"]={ready:null,draw:function(e,t,r){var n,i,a,o,s=Yi,l=r?s.dots.length-2>0?s.dots.slice(0,s.dots.length-2):[]:s.dots,c=zi.getActiveLayer(),d=l.length,h=!s.line;if(d>=2)if(s.line){var u=m(s.line,"c_fontSize");o=Vi.getDimensionPath({x:l[0],y:l[1]},{x:e,y:t},u);m(s.line,"d",o);if(r){pi.updateOne(s.line);s.next()}}else{o=Vi.getDimensionPath({x:l[0],y:l[1]},{x:e,y:t});i="path";n={d:o,"stroke-width":"1",fill:"none",id:ai.newId(),c_shapetype:"group"};s.line=Ue(i,n);Gi.appendChild(s.line)}if(s.line){s.line.id||m(s.line,{id:ai.newId()});if(h&&"draw.connect"!=xi){a="PROTRACTOR";m(s.line,"layerid",c);zi.updateElementLayerId(s.line,a);zi.appendElement(s.line,a)}}},next:function(e,t){var r=Yi,n=r.dots;if(r.line&&n.length<=2&&r.line){v(r.line);r.line=null}},end:function(e){var t=Yi;t.line&&v(t.line)}};Yi["draw.measureLine"]={ready:null,draw:function(e,t,r){var n,i,a,o,s,l=Yi,c=l.dots,d=c.length;if(d>=2)if("hidden"==m(Zi,"visibility"))m(Zi,{x1:c[0],y1:c[1],x2:e,y2:t,visibility:"yes","stroke-width":1/ci});else{m(Zi,{x2:e,y2:t});if(r){n=m(Zi,"x1");i=m(Zi,"y1");m(Zi,{visibility:"hidden"});var h=function(e){return ai.units.convert(e,"pixel",bi.canvas.unit)};a=Math.abs(n-e);o=Math.abs(i-t);var u=ai.toFixed(h(Math.sqrt(a*a+o*o)),2);s=ai.toFixed(h(180*Math.atan2(o,a)/Math.PI),2);tt("editorMsgbox",["unit:"+bi.canvas.unit+"<br/>dX:"+ai.toFixed(h(a),2)+"<br/>dY:"+ai.toFixed(h(o),2)+"<br/>length:"+u+"<br/>angle:"+s]);l.next()}}},next:null,end:function(e){m(Zi,{visibility:"hidden"})}};Yi["draw.origin"]={ready:null,draw:function(e,t,r){var n=Yi;if(r){a("setOriginXY",[{x:e,y:t}]);n.end();mt()}},next:null,end:null};Yi["place.part"]={ready:function(){Yi.started=!0;var e=+zi.getActiveLayer()||1,t=[Fn.BOTTOMLAYER,Fn.BOTTOMSILKLAYER,Fn.BOTTOMPASTERLAYER,Fn.BOTTOMSOLDERLAYER];if("place.part_pad"==xi)!function(e){var t,r,n=h("g[c_partid=part_pad]",Gi),i=n.length;for(t=0;t<n.length;t++){r=m(n[t],"number");if(r){r=parseInt(r,10);!isNaN(r)&&r>i&&(i=r)}}i++;m(e,{number:i})}(d("part_pad"));else if("place.part_pcbtext"==xi){var r=d("part_pcbtext"),n=m(r,"c_mirror"),i=m(r,"c_origin"),a=t.indexOf(e)>=0;if("h"==n!=a){m(r,"c_mirror",a?"h":"none");Ni.flipH(r,+i.split(",")[0])}m(r,"layerid",zi.getValidLayer("TEXT",e)||e)}},draw:function(e,t,r){var n,a,o=xi.substr(6),s=d(o);if(s)if(r){if(r&&!m(s,"c_module")){n=s.cloneNode(!0);m(n,{id:ai.newId(),c_shapetype:"group",c_etype:"pinpart"});x(n,"pointer-events");Fe(n);var l;if("place.part_via"==xi){l=Qi==Dn.PCB?Er(n,e,t):null;l&&(a=l.history)}zi.appendElement(n);Qi==Dn.PCB&&Tr(n);pi.updateOne(n);Ei.buildOneNet(m(n,"net"),!1);"place.part_pad"==xi&&wr();a?Pi.save(a.concat([["add",n.id]])):Pi.save(["add",n.id])}else if(r&&m(s,"c_module")){!function(e){for(var t=e.children.length-1;t>=0;t--){var r=e.children[t],n=ai.svg.getBBox(r);n.width||n.height||v(r)}}(s);n=s.cloneNode(!0);Fe(n);var c=[].slice.call(n.children),h=[];for(i=0;i<c.length;i++){var u=c[i],p=u.tagName;h[i]=u.id;zi.appendElement(u);"g"==p?Tr(u):"polyline"!=p&&"polygon"!=p||he(u,Se(u,1));pi.updateOne(u)}if(h.length){h=h.join(",");Ei.buildAllNet();Pi.save(["add",h])}}}else{"none"==m(s,"display")&&m(s,"display","");dt(s,e,t)}},next:function(e,t){THIS.started=!0},end:function(e){dt(xi.substr(6));mt()}};Yi["draw.protractor"]={ready:null,draw:function(e,t,r){var n,i=Yi,a=i.dots,o=zi.getActiveLayer(),s=a.length,l=!i.line;if(s>=2){var c=i.protractorTrackLinePath?i.protractorTrackLinePath:"",d=null,h=null;n="PROTRACTOR";if(r&&a.length>=6){pi.updateOne(i.line);i.next();return}if(2===a.length){d=a[0];h=a[1];c="M"+e+" "+t+" L"+d+" "+h}4===a.length&&(c=Vi.getProtractorPath(a.slice(0,2),[e,t],a.slice(2,4)));if(c)if(i.line)m(i.line,"d",c);else{i.line=Ue("path",{d:c,layerid:zi.getValidLayer(n,o),fill:"none","stroke-width":.7,c_shapetype:"protractor",c_fontSize:"4.5",c_precision:"0"});Gi.appendChild(i.line)}if(i.line){i.line.id||m(i.line,{id:ai.newId()});if(l){n="PROTRACTOR";m(i.line,"layerid",o);zi.updateElementLayerId(i.line,n);zi.appendElement(i.line,n)}}}},next:function(e,t){var r=Yi,n=r.dots;if(r.line&&n.length<=2&&r.line){v(r.line);r.line=null}},end:function(e){var t=Yi;t.line&&v(t.line)}};Yi["draw.rect"]={ready:null,draw:function(e,t,r){var n,i,a,o,s,l=Yi,c=r?l.dots.length-2>0?l.dots.slice(0,l.dots.length-2):[]:l.dots;zi.getActiveLayer();n=c.length;var d=!l.line;if(n>=2){o=Math.min(e,c[n-2]),s=Math.min(t,c[n-1]),i=Math.max(e,c[n-2])-o,a=Math.max(t,c[n-1])-s;0!==i&&0!==a||(i=a=Math.max(i,a));if(l.line)m(l.line,{x:o,y:s,width:i,height:a});else{l.line=Ue("rect",{x:o,y:s,width:i,height:a,"stroke-width":"0"});m(l.line,{c_shapetype:"line"});Gi.appendChild(l.line)}if(r){c.push(e,t);pi.updateOne(l.line);l.next()}if(l.line){l.line.id||m(l.line,{id:ai.newId()});if(d){zi.updateElementLayerId(l.line,void 0);zi.appendElement(l.line,void 0)}}}},next:function(e,t){var r=Yi,n=r.dots;if(r.line&&n.length<=2&&r.line){v(r.line);r.line=null}},end:function(e){var t=Yi;t.dots;t.line&&v(t.line)}};Yi["draw.solidRegion"]={ready:null,draw:function(e,t,r){var n,i,a=Yi,o=a.dots,s=zi.getActiveLayer(),l=o.length,c=!a.line;if(l>=2){i=o.join(" ")+" "+e+" "+t;if(a.line){m(a.line,{points:i});x(a.line,"stroke-width")}else{n="polygon";a.line=Ue(n,{points:i,"stroke-width":"0.2",type:"solid",layerid:s});m(a.line,{c_shapetype:"line"});Gi.appendChild(a.line)}if(a.line){a.line.id||m(a.line,{id:ai.newId()});if(c){zi.updateElementLayerId(a.line,"SOLIDREGION");zi.appendElement(a.line,"SOLIDREGION")}}}},next:function(e,t){var r=Yi,n=r.dots;if(r.line)if(n.length<=2){if(r.line){v(r.line);r.line=null}}else{pi.updateOne(r.line);Ei.buildOneNet(m(r.line,"net"),!1)}},end:function(e){var t=Yi,r=t.dots;if(!e&&t.line&&r.length>=2){var n=r.join(" ");m(t.line,{points:n,c_shapetype:"line"})}else t.line&&v(t.line)}};Yi["draw.track"]={ready:function(){Yi.started=!0},draw:function(e,t,r){var n,i,a,o,s,l,c,h,u,p,f=Yi,g="",y=f.dots,_=zi.getActiveLayer(),P=r?f.dots.length-2>0?f.dots.length-2:0:f.dots.length,S=!f.line;if(r){if(f.line&&m(f.line,"c_need_via")){if(m(f.line,"c_need_via")!=m(f.line,"layerid")){var b;if("polyline"==f.line.tagName)b=f.line.points.getItem(0);else if("path"==f.line.tagName){b=m(f.line,"d").split(/\s*[A-Z]\s*|[\s\,]+/i);b={x:b[1],y:b[2]}}if(b){var C=m(f.line,"net")||"",A=Or(b.x,b.y,C);pi.updateOne(A);Pi.save(["add",A.id,ai.node.getRefId(A)])}}x(f.line,"c_need_via")}c=pi.ifFind(e,t,"",_,"ALL");var I;f.line&&(p=m(f.line,"c_auto_net"));if(c&&c.type){e=ai.toFixed(c.X,2);t=ai.toFixed(c.Y,2);y[y.length-2>0?y.length-2:0]=e;y[y.length-1>0?y.length-1:1]=t;st("cross-red",e,t);if(c.net&&f.line){var L=m(f.line,"net");if(L!==c.net)if(L){p&&x(f.line,"c_auto_net");if(p){m(f.line,"net",c.net);I=Ei.mergeNets(c.net,L,!1)}else{I=Ei.mergeNets(L,c.net);if(!1===I){f.restart();return}}}else{if("draw.track"==xi&&"polyline"==f.line.tagName){var E=f.line.points.getItem(f.line.points.numberOfItems-1);E.x=e;E.y=t}m(f.line,"net",c.net)}}}if(0===P){f.startNet=c&&c.type?c.net:"";f.startNetId=c&&c.type?c.gId:""}if(c&&c.type&&P>=2){if(f.line){s=m(f.line,"net");if(!s){s=ft();m(f.line,"net",s)}l=[];if("path"==f.line.tagName){var O=ai.node.getRefId(f.line),T=Fr(f.line),w=T.map(function(e){return e.id}).join(",");pi.updateMore(T);Ei.buildOneNet(s,!1);l.push(["add",w,O]);f.line=T[T.length-1]}else{zi.appendElement(f.line);pi.updateOne(f.line);Ei.buildOneNet(s,!1);l.push(["add",f.line.id,ai.node.getRefId(f.line)])}if(void 0!==I){if(I instanceof Array&&I.length)for(;o=I.shift();)l.push(["attr",o[0],{net:o[1]},{net:o[2]}])}else{if(f.startNetId&&f.startNet!=s){l.push(["attr",f.startNetId,{net:f.startNet},{net:s}]);m(d(f.startNetId),"net",s);pi.updateOne(d(f.startNetId))}var N=c&&c.type?c.net:"",k=c&&c.type?c.gId:"";if(k&&N!=s){l.push(["attr",k,{net:N},{net:s}]);m(d(k),"net",s);pi.updateOne(d(k))}}if("polyline"==f.line.tagName){var B=f.line,M=Nr(B);if(M&&M.type)if("replace"==M.type){l.push(["del",M.track.id,ai.node.getRefId(M.track)]);pi.removeOne(M.track);li.appendChild(M.track);Ei.buildOneNet(m(M.track,"net"),!1)}else if("cancel"==M.type){pi.removeOne(B);Ei.buildOneNet(s,!1);v(B);l.shift()}else if("merge"==M.type){pi.removeOne(B);Ei.buildOneNet(s,!1);v(B);l.shift();var V=m(M.track,"points"),G=M.points;m(M.track,"points",G);_e(M.track);G=ai.toFixedString(m(M.track,"points"));m(M.track,"points",G);l.push(["attr",M.track.id,{points:V},{points:G}]);pi.updateOne(M.track);Ei.buildOneNet(m(M.track,"net"),!1)}}l.length&&Pi.save(l);f.line=null}f.next();return}}if(0===P)r&&(Yi.routedRealRatLine=Ei.findRatLineByPos(e,t,_));else if(P>=2){c=pi.ifFind(e,t,"",_,"ALL");if(c&&c.type){e=ai.toFixed(c.X,2);t=ai.toFixed(c.Y,2);st("cross-red",e,t)}if(Yi.routedRealRatLine){var F=e,D=t;2==Yi.routedRealRatLine[1]?m(Yi.routedRealRatLine[0],{x2:F,y2:D}):m(Yi.routedRealRatLine[0],{x1:F,y1:D})}if(f.line){var H=bi.canvas.angle;if(!r){var j=f.line.tagName;if("ARC"==H!=("path"==j)){var U=m(f.line,"net"),Y=m(f.line,"layerid");y=y.slice(-2);if(f.certainPath){"path"==j?m(f.line,"d",f.certainPath):m(f.line,"points",f.certainPath);f.certainPath="";f.next()}else v(f.line);f.started=!0;f.line=null;f.dots.length=0;f.draw(y[0],y[1],!0);f.draw(e,t,!1);if(f.line){U&&m(f.line,"net",U);if(Y){m(f.line,"layerid",Y);m(f.line,"c_need_via",Y)}}return}if("ARC"==H){n=Vi.formatTrackPoints(y.slice(-2),H,e,t,Yi.trackPreference[H]);f.certainPath&&(n=f.certainPath+n.replace(/^M[^ALM]+/,""));m(f.line,"d",n)}else if("45"==H||"90"==H){n=Vi.formatTrackPoints(y.slice(-2),H,e,t,Yi.trackPreference[H]);f.certainPath&&(n=f.certainPath+n.replace(/^\S+\s+\S+/,""));m(f.line,"points",n)}else{n=Vi.formatTrackPoints(y,H,e,t,Yi.trackPreference[H]);m(f.line,"points",n)}}if(r)if("ARC"==H){f.certainPath=m(f.line,"d");n=f.certainPath.substr(1).replace(/L/g," ").replace(/A\s*(\S+\s+){5}/g," ");n=n.trim().split(/\s+/).map(Number);y.length=0;y.push.apply(y,n)}else{f.certainPath=m(f.line,"points");i=R(f.certainPath);P=i.length;y.length+2==2*P&&y.splice(y.length-2,0,ai.toFixed(i[P-2].x,3),ai.toFixed(i[P-2].y,3))}Qi==Dn.PCB&&f.line&&Ci.doRealtimeDRC(f.line,!0)}else{f.certainPath="";g=f.startNet||"";c&&c.type&&c.net&&(g?g&&g!==c.net&&Ei.mergeNets(g,c.net):g=c.net);h={"stroke-width":_==Fn.BOARDOUTLINE?1:bi.canvas.routing,fill:"none",id:ai.newId(),c_shapetype:"line",layerid:_,net:g};if("ARC"==bi.canvas.angle){a="path";n=Vi.formatTrackPoints(y,bi.canvas.angle,e,t,Yi.trackPreference);h.d=n}else{a="polyline";n=y.join(" ")+" "+e+" "+t;h.points=n}h.c_etype="wire";f.line=Ue(a,h);Gi.appendChild(f.line);or(g)}}if(f.line){f.line.id||m(f.line,{id:ai.newId()});if(S){u="TRACK";m(f.line,"layerid",_);zi.updateElementLayerId(f.line,u);zi.appendElement(f.line,u)}}r||Yi.showSnapPoint(e,t)},next:function(e,t){var r,n=Yi;or("");n.started=!0;if(n.line){var i=n.line,a=ai.node.getRefId(i),o=m(i,"layerid"),s=m(i,"net");if("path"==n.line.tagName){var l=Fr(i),c=l.map(function(e){return e.id}).join(",");o&&!s&&m(l,"net",ft());pi.updateMore(l);Ei.buildOneNet(s,!1);r=["add",c,a];Pi.save(r);n.line=null;return}if("polyline"==n.line.tagName||"polygon"==n.line.tagName){_e(n.line);var d=n.line.points.numberOfItems;if("polyline"==n.line.tagName&&d<2||"polygon"==n.line.tagName&&d<3){v(n.line);n.line=null;return}}r=["add",i.id,a];Pi.save(r);n.line=null;o&&!s&&m(i,"net",ft());pi.updateOne(i);Ei.buildOneNet(m(i,"net"),!1)}},end:function(e){var t,r=Yi;if(!e&&r.line&&r.dots.length>=2)"polyline"==r.line.tagName&&m(r.line,{points:r.dots.join(" "),c_shapetype:"line"});else if(r.line){v(r.line);t=!0}if(r.line){t||pi.updateOne(r.line);Ei.buildOneNet(m(r.line,"net"),!1)}or("");Yi.routedRealRatLine=null}};pi.removeOne=function(e){if(e){var t=m(e,"id"),r=ai.getPCBCmdKey(e),n=pi.gJsonCache[r];if(n){pi.removeSignalsOfOneObject(e);if(Qi==Dn.PCB){Oi.removeFromRTree(n[t],r);Ci&&Ci.hideRealtimeDRCError&&Ci.hideRealtimeDRCError()}delete n[t]}"TRACK"!=r&&"PAD"!=r&&"ARC"!=r&&"FOOTPRINT"!=r||jr(e,"")}};pi.removeAll=function(e){for(var t=["TRACK","PAD","VIA","HOLE","TEXT","DIMENSION","FOOTPRINT","ARC","RECT","CIRCLE","IMAGE","COPPERAREA","SOLIDREGION","FABRICATION","SIGNALS","SVGNODE"],r=0;r<t.length;r++)pi.gJsonCache[t[r]]={};e&&!1===e.updateNetText||jr(void 0,"")};pi.updateOne=function(e){if(e&&(!e.parentNode||"gCurParts"!=e.parentNode.id)&&"gPre"!=e.id&&"gPad"!=e.id&&e.parentNode&&e.parentNode.tagName){for(;e&&e.parentNode!=Gi;)e=e.parentNode;if(e){var t=m(e,"id"),r=ai.getPCBCmdKey(e);if(r&&Ji[r]){var n=Ji[r](e);if(n){pi.gJsonCache[r]||(pi.gJsonCache[r]={});var i=pi.gJsonCache[r][t];pi.gJsonCache[r][t]=n;pi.updateSignal(n);"COPPERAREA"==r&&Qi==Dn.PCB&&Ai.rebuildCopperArea(n);"TRACK"==r&&Qi==Dn.PCB&&n.layerid==Fn.BOARDOUTLINE&&Ai.rebuildCopperArea("all");if(Qi==Dn.PCB){"ARC"==r&&(i&&i.d==n.d&&n.pointArr||(n.pointArr=Dr(e,!1)));Oi.addToRTree(n,r);Ci&&Ci.doRealtimeDRC&&Ci.doRealtimeDRC(e)}if("TRACK"==r||"PAD"==r||"ARC"==r||"FOOTPRINT"==r){var a=m(e,"layerid");if("FOOTPRINT"==r)for(var o=h("[id][layerid]",e),s=0;s<o.length;s++)o[s].netTextCache=null;else e.netTextCache=null;Mr(a)?jr(e):jr(e,"")}}}}}};pi.updateMore=function(e){if(e&&e.length)for(var t=0,r=e.length;t<r;t++)pi.updateOne(e[t])};pi.calAll=function(){Qi==Dn.PCB&&Ai.removeAllCopperPolygons();pi.removeAll({updateNetText:!1});for(var e,t=Gi.childNodes,r=[],n=0,i=t.length;n<i;n++){var a=t[n];if(a&&1===a.nodeType&&!(a.id.indexOf("layer_")>=0)){e=ai.getPCBCmdKey(a);"COPPERAREA"!=e?"RATLINE"!=e&&pi.updateOne(a):r.push(a)}}r.forEach(function(e){pi.updateOne(e)});Qi==Dn.PCB&&Ai.rebuildCopperArea("all")};pi.ifFind=function(e,t,r,n,i,a){if(Mr(n)&&Qi!=Dn.PCBLIB){var o,s,l=null;r=r||"";var c,d=[];n==Fn.ALL?Oi.signalLayers.forEach(function(r){d=d.concat(Oi.searchByPoint2(e,t,2,r))}):d=Oi.searchByPoint2(e,t,2,n);if("ALL"==i){var h=[],u=[];d.forEach(function(e){"PAD"==e[4].type||"VIA"==e[4].type?h.push(e):u.push(e)});d=h.concat(u)}else for(o=0,s=d.length;o<s;o++){c=d[o];c[4].type!=i&&(d[o]=null)}for(o=0,s=d.length;o<s;o++){var p=d[o];if(p&&p[4]&&p[4].node.gId!==a){var f=p[4].node,g=p[4].type;if(f.net==r||""===r){l=pi.searchPointOnObject(g,f,e,t);if(l.type)return l}}}return l||{}}};pi.searchPointOnObject=function(e,t,r,n){var i,a={type:!1,gId:null,X:0,Y:0,net:"",layerid:0},o=[],s=!1,l=new c(r,n);switch(e){case"PAD":case"VIA":var d="VIA"==e?t.diameter/2:t.width/2;if("PAD"==e&&"ELLIPSE"!=t.shape){o=t.pointArr;s=Vi.isPointInPoly(o,l)}else s=Vi.isPointInCircle({x:t.x,y:t.y},l,d);if(s){a.X=t.x;a.Y=t.y;a.type=e;a.net=t.net;a.gId=t.gId;a.isFootprintPad=!("PAD"!=e||pi.gJsonCache.PAD&&pi.gJsonCache.PAD[t.gId]);a.layerid=t.layerid;return a}break;case"TRACK":case"ARC":o=t.pointArr;var h=o.length;if(!o||h<2)return a;i=!1;if(Vi.isPointInCircle(o[0],l,1)){a.X=o[0].x;a.Y=o[0].y;i=!0}else if(Vi.isPointInCircle(o[h-1],l,1)){a.X=o[h-1].x;a.Y=o[h-1].y;i=!0}else{var u=q(l,o,+t.strokeWidth);if(u){a.X=u.point.x;a.Y=u.point.y;i=!0}}if(i){a.gId=t.gId;a.type=e;a.net=t.net;a.layerid=t.layerid;return a}}return a};pi.checkShow=function(e,t,r,n){if(Qi==Dn.PCBLIB)return!1;if(!Mr(n))return!1;var i=d("pdot0");m(i,"display","none");var a=pi.ifFind(e,t,r,n,"ALL");if(!a||!a.type)return!1;m(i,{display:"",cx:a.X,cy:a.Y})};pi.removeSignalsOfOneObject=function(e){if(Qi==Dn.PCBLIB)return!1;var t=m(e,"id");if(t){var r,n,i,a,o={PAD:!0,VIA:!0,COPPERAREA:!0,TRACK:!0,ARC:!0,SOLIDREGION:!0},s=ai.getPCBCmdKey(e),l=pi.gJsonCache.SIGNALS;if(o[s]){r=m(e,"net");g=+m(e,"layerid");if(!Mr(g))return;"COPPERAREA"==s&&Ai.resetActiveCopperPolygons(Ji.COPPERAREA(e));n=l[r]||[];for(i=0,a=n.length;i<a;i++)if(n[i]&&n[i].gId==t){delete n[i];Ei.buildOneNet(r,!0);return}}if("FOOTPRINT"==s){var c=pi.gJsonCache.FOOTPRINT[t];if(!c)return;var d=c.PAD,h={},u=[];for(var p in d)if(d.hasOwnProperty(p)){var f=d[p];t=f.gId;r=f.net;var g=+f.layerid;if(r&&!h[r]){u.push(r);h[r]=1}if(!Mr(g))continue;if(l[r]){n=l[r];for(i=0,a=n.length;i<a;i++)if(n[i]&&n[i].gId==t){delete n[i];break}}}Ei.buildGroupNets(u)}}};pi.buildSignals=function(){if(Qi==Dn.PCBLIB)return!1;for(var e,t,r,n,i=["PAD","VIA","COPPERAREA","TRACK","ARC","SOLIDREGION"],a={},o=0;o<i.length;o++){e=i[o];t=pi.gJsonCache[e];if(t)for(var s in t)if(t.hasOwnProperty(s)){r=t[s].net;n=+t[s].layerid;if(!Mr(n))continue;a[r]||(a[r]=[]);a[r].push({gId:s,cmd:e,layerid:n,fid:0})}}t=pi.gJsonCache.FOOTPRINT;for(var l in t)if(t.hasOwnProperty(l)){var c=t[l],d=c.PAD;for(var h in d)if(d.hasOwnProperty(h)){var u=d[h];r=u.net;n=+u.layerid;if(!Mr(n))continue;a[r]||(a[r]=[]);a[r].push({gId:h,cmd:"PAD",layerid:n,fid:l})}}pi.gJsonCache.SIGNALS=a};pi.getAllNetName=function(){var e=[],t=pi.gJsonCache.SIGNALS;for(var r in t)t.hasOwnProperty(r)&&r.length>0&&e.push(r);return e};pi.updateSignal=function(e){if(Qi==Dn.PCBLIB)return!1;var t=["PAD","VIA","COPPERAREA","TRACK","ARC","SOLIDREGION"],r=d(e.gId);if(r){var n=ai.getPCBCmdKey(r);if(-1!=t.indexOf(n)){var i=pi.gJsonCache.SIGNALS;e.net=void 0===e.net?"":e.net;i[e.net]||(i[e.net]=[]);var a,o,s,l=i[e.net],c=(pi.getNetName(e.gId),!1);if(l){for(o=0,s=l.length;o<s;o++){a=l[o];if("object"==typeof a&&a.gId==e.gId){c=!0;if(Mr(e.layerid)){l[o].layerid=e.layerid;break}
delete l[o];break}}if(!1===c&&Mr(e.layerid)){pi.deleteSignal(e.gId);l.push({gId:e.gId,cmd:n,layerid:e.layerid,fid:e.fid||0})}}else{pi.deleteSignal(e.gId);if(Mr(e.layerid)){i[e.net]||(i[e.net]=[]);i[e.net].push({gId:e.gId,cmd:n,layerid:e.layerid,fid:e.fid||0})}}}}};pi.deleteSignal=function(e){if(Qi==Dn.PCBLIB)return!1;if(e){var t,r,n=pi.gJsonCache.SIGNALS,i=!1;for(var a in n)if(n.hasOwnProperty(a)){t=n[a];for(var o=0,s=t.length;o<s;o++){r=t[o];if(void 0!==r&&(r.gId==e||r.fid==e)){delete t[o];i=!0}}}return i}};pi.getNetName=function(e){if(e){var t,r,n=pi.gJsonCache.SIGNALS;for(var i in n)if(n.hasOwnProperty(i)){t=n[i];for(var a=0,o=t.length;a<o;a++){r=t[a];if(void 0!==r&&r.gId==e)return i}}return!1}};pi.getElementByObj=function(e){var t=e.gId,r=e.cmd,n=e.fid;return n?pi.gJsonCache.FOOTPRINT[n]&&pi.gJsonCache.FOOTPRINT[n][r][t]:pi.gJsonCache[r][t]};pi.getRatLineInfoOfPCBLib=function(e){var t=pi.gJsonCache.FOOTPRINT[e.id],r=[];if(t){var n=t.PAD;for(var i in n)if(n.hasOwnProperty(i)){var a=n[i];if(!a.net)continue;var o=pi.findClosestPad(a);if(!o)continue;var s={net:a.net,from:{fid:e.id,gId:a.gId,x:a.x,y:a.y},to:{fid:null,gId:o.gId,x:o.x,y:o.y}};r.push(s)}}return r};pi.findClosestPad=function(e){if(!e.net)return!1;var t=pi.gJsonCache.SIGNALS[e.net],r=null,n=9999999999;if(t)for(var i=0,a=t.length;i<a;i++){var o=t[i]||{};if("PAD"==o.cmd&&o.gId!=e.gId){var s=pi.getElementByObj(o);if(s){var l=(e.x-s.x)*(e.x-s.x)+(e.y-s.y)*(e.y-s.y);if(l<n){r=s;n=l}}}}return r};pi.findClosestSignalPoint=function(e,t,r){};pi.getAllObjsOf=function(e,t,r){function n(e){for(var t in e)if(e.hasOwnProperty(t)){if(r&&!Mr(e[t].layerid))continue;i.push(e[t])}}var i=[];pi.gJsonCache[e]&&n(pi.gJsonCache[e]);if(t&&-1==parent.$.inArray(e,["COPPERAREA","RECT"])){var a=pi.gJsonCache.FOOTPRINT;for(var o in a)if(a.hasOwnProperty(o))for(var s in a[o])a[o].hasOwnProperty(s)&&s==e&&n(a[o][e])}return i};var zi,Ji={ARC:function(e){var t=we(e);return{gId:t.id,layerid:t.layerid,net:t.net||"",d:t.d,c_helper_dots:"",strokeWidth:+t["stroke-width"],locked:t.locked||0}},COPPERAREA:function(e){var t=we(e);return{gId:t.id,layerid:t.layerid,net:t.net||"",pointArr:me(e.points),clearanceWidth:+t.clearanceWidth||1,fillStyle:t.fillStyle||"solid",strokeWidth:t["stroke-width"],thermal:t.thermal||"spoke",keepIsland:t.keepIsland||"none",locked:t.locked||0}},CIRCLE:function(e){var t=we(e);return{gId:t.id,layerid:t.layerid,cx:+t.cx,cy:+t.cy,r:+t.r,strokeWidth:+t["stroke-width"],locked:t.locked||0}},DIMENSION:function(e){var t=we(e);return{gId:t.id,layerid:t.layerid,d:t.d,fontSize:t.c_fontSize,locked:t.locked||0}},PROTRACTOR:function(e){var t=we(e);return{gId:t.id,layerid:t.layerid,d:t.d,strokeWidth:parseFloat(e.getAttribute("stroke-width"),10),fontSize:t.c_fontSize,precision:t.c_precision,locked:t.locked||0}},IMAGE:function(e){var t=we(e);return{gId:t.id,layerid:t.layerid,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.c_rotation,href:t["xlink:href"],locked:t.locked||0}},RECT:function(e){var t=we(e);return{gId:t.id,layerid:t.layerid,net:t.net||"",x:t.x,y:t.y,width:+t.width,height:+t.height,locked:t.locked||0}},SOLIDREGION:function(e){var t=we(e);return{gId:t.id,layerid:t.layerid,net:t.net||"",pointArr:me(e.points),type:t.type,locked:t.locked||0}},TRACK:function(e){var t=we(e);return{gId:t.id,layerid:t.layerid,net:t.net||"",pointArr:me(e.points),strokeWidth:+t["stroke-width"],locked:t.locked||0}},FOOTPRINT:function(e){var t=we(e),r={TRACK:{},PAD:{},VIA:{},HOLE:{},TEXT:{},SOLIDREGION:{},DIMENSION:{},ARC:{},RECT:{},CIRCLE:{},IMAGE:{},COPPERAREA:{},SVGNODE:{},gId:t.id,itemOrder:[]};t.c_origin||(t.c_origin=",");r.head={x:t.c_origin.split(",")[0],y:t.c_origin.split(",")[1],c_para:t.c_para,rotation:t.c_rotation,gId:t.id,layerid:t.layerid,locked:t.locked,uuid:t.uuid,utime:t.utime,locked:t.locked||0};for(var n,i,a,o=e.childNodes,s=0,l=o.length;s<l;s++){a=o[s];if(3!=a.nodeType){n=m(a,"id");i=ai.getPCBCmdKey(a);if(Ji[i]){var c=Ji[i](a);if(c){r[i][n]=c;if("PAD"==i){c.fid=e.id;pi.updateSignal(c)}r.itemOrder.push(n)}}}}return r},PAD:function(e){var t=we(e),r=we(e.childNodes[0]),n=we(e.childNodes[1]);if(!n){var i=t.c_origin.split(",");n={r:ai.toFixed(Math.min(+t.c_width,+t.c_height)/2,2),cx:+i[0],cy:+i[1]}}if("slot"==Gr(e)){n.r=m(e.childNodes[1],"stroke-width")/2;var a=R(m(e.childNodes[1],"points"));n.holeLength=+(Vi.distancePointToPoint(a[0],a[1])+2*n.r);n.slotPointArr=a}else{n.holeLength=0;n.slotPointArr=[]}return{gId:t.id,layerid:t.layerid,shape:t.c_shape,x:ai.toFixed(+t.c_origin.split(",")[0],2),y:ai.toFixed(+t.c_origin.split(",")[1],2),net:t.net||"",width:+t.c_width,height:+t.c_height,number:t.number,holeR:+n.r,pointArr:"OVAL"==t.c_shape?Ai.transformLineToOutlineBox(R(r.points),r["stroke-width"]/2):R(r.points),pointArr2:"OVAL"==t.c_shape?R(r.points):"",rotation:t.c_rotation||0,holeLength:n.holeLength,slotPointArr:n.slotPointArr,plated:t.plated,locked:t.locked||0}},TEXT:function(e){var t=we(e),r=we(e.firstChild),n="L";"note_pre"==r.c_note?n="P":"note_name"==r.c_note&&(n="N");return{gId:t.id,layerid:t.layerid,type:n,x:ai.toFixed(t.c_origin.split(",")[0],2),y:ai.toFixed(t.c_origin.split(",")[1],2),rotation:t.c_rotation||"0",mirror:t.c_mirror,fontSize:r.c_fontSize,fontFamily:r.c_fontFamily,text:r.c_text,pathStr:r.d,display:t.display,strokeWidth:r["stroke-width"],locked:t.locked||0}},VIA:function(e){var t=we(e),r=we(e.childNodes[0]),n=we(e.childNodes[1]);if(!n){var i=t.c_origin.split(",");n={cx:+i[0],cy:+i[1],r:0}}return{gId:t.id,x:ai.toFixed(+n.cx,2),y:ai.toFixed(+n.cy,2),net:t.net||"",diameter:2*r.r,layerid:Fn.ALL,holeR:n.r,locked:t.locked||0}},HOLE:function(e){var t=we(e),r=we(e.childNodes[1]);return{gId:t.id,x:ai.toFixed(+r.cx,2),y:ai.toFixed(+r.cy,2),holeR:+r.r,layerid:Fn.ALL,locked:t.locked||0}},SVGNODE:function(e){if(1===e.nodeType){var t=we(e),r={gId:t.id,nodeName:e.nodeName,nodeType:e.nodeType};t.layerid&&(r.layerid=t.layerid);delete t.class;delete t.xmlns;r.attrs=t;var n=0,i=e.childNodes,a=i.length;if(a){r.childNodes=[];for(;n<a;n++)r.childNodes[n]=Ji.SVGNODE(i[n])}return r}return{nodeName:e.nodeName,nodeType:e.nodeType,nodeValue:e.nodeValue}}};!function(){function r(e){if(!e.match(/#?([\da-f]{6})/i))return e;var t=parseInt(RegExp.$1,16);return"#"+("00000"+((Math.min(255,Math.round(.5*(t>>16)))<<16)+(Math.min(255,Math.round(.5*(t>>8&255)))<<8)+Math.min(255,Math.round(.5*(255&t)))).toString(16)).substr(-6).toUpperCase()}var n=Fn.RATLINES,i={};i[n]=1;i.pad=1;zi={prefix:"layer_",front:"",cache:null,markers:{},getLayersCache:function(){this.cache=pi.gJsonCache.layers;for(var e in Fn){var t=Fn[e];if(A(Fn,e)&&!this.cache[t]){this.cache[t]=pi.gJsonCache.layers[t];this.cache[t].config=!1;this.cache[t].visible=!1}}return this.cache},getActiveLayer:function(){return this.front},setActiveLayer:function(t){if(this.cache[t]&&this.cache[t].config){if("place.part_import"==xi){var r=d("part_import");if(r&&"FOOTPRINT"==ai.getPCBCmdKey(r)){var n=+m(r,"layerid"),i=zi.getValidLayer("FOOTPRINT",t),a=[Fn.BOTTOMLAYER,Fn.BOTTOMSILKLAYER,Fn.BOTTOMPASTERLAYER,Fn.BOTTOMSOLDERLAYER];i&&(n&&a.indexOf(n)<0!=a.indexOf(i)<0?Sn(r,i,!0):!n&&a.indexOf(i)>=0&&Sn(r,i,!0))}}tt("setActivePCBLayer",[t,e]);zi.showAtFront(t)}},add:function(e){var t=this.prefix+e;if(d(t))return d(t);var r=Ue("g");r.id=t;this.markers[t]=r;return Gi.appendChild(r)},get:function(e){var t=this.prefix+e,r=d(t);r||(r=zi.add(e));return r},_attr:function(e,t,r){if(1==arguments.length)return e.getAttribute(this.prefix+t);e.setAttribute(this.prefix+t,r)},_removeAttr:function(e,t){e.removeAttribute(this.prefix+t)},_setElementShow:function(e,t){this._attr(e,"show",!1===t?"0":"1")},_each:function(e,t){var r,n,i,a,o=["TRACK","PAD","VIA","TEXT","DIMENSION","ARC","RECT","CIRCLE","IMAGE","COPPERAREA","SOLIDREGION"],s=pi.gJsonCache;for(a=0;a<o.length;a++){r=o[a];n=s[r];for(i in n)n.hasOwnProperty(i)&&e.call(this,n[i])}s=pi.gJsonCache.FOOTPRINT;if(s)for(a=0;a<o.length;a++){r=o[a];n=s[r];for(i in n)n.hasOwnProperty(i)&&e.call(this,i)}},_showElement:function(e){this._setElementShow(d(e.gId),!0)},_hideElement:function(e){this._setElementShow(d(e.gId),!1)},show:function(e,t){t=!1!==t;this.cache[e]&&(this.cache[e].visible=t);var r=d("pcblayerStyle").sheet.cssRules[+e];r&&(r.style.display=t?"":"none");t||gi&&m(gi,"layerid")==e&&Ct();e!=Fn.RATLINES&&Mr(e)&&_r(e)},hide:function(e){this.show(e,!1)},isVisible:function(e){var t=this.cache||this.getLayersCache();return t&&t[e]&&t[e].visible},isSignalLayer:function(e){e=+e;return e<Fn.TOPSILKLAYER||e>=Fn.INNER1||e==Fn.ALL},_setElementFront:function(e,t){this._attr(e,"front",!1===t?"0":"1")},showAtFront:function(e){function r(e,t,i,a){var o=ai.node.children(t);(i||a)&&(o=[].filter.call(o,function(e){return(!i||n(i,e))&&(!a||n(e,a))}));for(var s,l=a||null,c=o.length-1;c>=0;c--){s=o[c];if(m(s,"layerid")==e){s.nextSibling==l||l&&l.parentNode!=t||t.insertBefore(s,l);l=s}s.childNodes.length&&r(e,s)}e!=Fn.ALL&&r(Fn.ALL,t,i,a)}function n(e,t){return 4==e.compareDocumentPosition(t)}var i=this.front;if(this.front!=e){for(var a in this.cache)this.cache.hasOwnProperty(a)&&(this.cache[a].active=a==e);if(""!==this.front){var o=d("pcblayerStyle").sheet.cssRules[+this.front];if(o){o.style.stroke=this.cache[+this.front].darkColor;o.style.fill=this.cache[+this.front].darkColor}}this.front=e;o=d("pcblayerStyle").sheet.cssRules[+e];if(o){o.style.stroke=this.cache[+e].color;o.style.fill=this.cache[+e].color;o.style.pointerEvents=""}r(e,Gi,d("layer_track_begin"),d("layer_track_end"));r(e,Gi,d("layer_other_begin"),d("layer_other_end"));if("place.part_import"==xi){var s=d("part_import");s&&"FOOTPRINT"==ai.getPCBCmdKey(s)&&r(e,s)}if("place.part_pcbtext"==xi){var l=+e,c=d("part_pcbtext"),h=m(c,"c_mirror"),u=m(c,"c_origin"),p=[Fn.BOTTOMLAYER,Fn.BOTTOMSILKLAYER,Fn.BOTTOMPASTERLAYER,Fn.BOTTOMSOLDERLAYER].indexOf(l)>=0;if("h"==h!=p){m(c,"c_mirror",p?"h":"none");Ni.flipH(c,+u.split(",")[0])}m(c,"layerid",l)}var f=C("afterActiveLayerChange",{detail:{layeridOld:i||"",layeridNew:e}});t.dispatchEvent(f)}},moveElementToLayer:function(e,t){this.moveElementsToLayer([e],t)},moveElementsToLayer:function(e,t){var r,n,i,a,o=this.cache[t];if(o){n=o.active;i=o.visible;for(a=0;a<e.length;a++){r=e[a];this._setElementFront(r,n);this._setElementShow(r,i);m(r,"layerid",t)}}},calLayerId:function(e){if(!e)throw"Layer.calLayerId error!";var t=Li[e.toUpperCase()];if(!t)throw"Layer.calLayerId error!";for(var r=0;r<t.length;r++)if(t[r]+""==this.front)return this.front;return t[0]+""},updateElementLayerId:function(e,t){t=t||ai.getPCBCmdKey(e);if(t){var r=m(e,"layerid"),n=zi.getActiveLayer(),i=zi.getValidLayer(t,r||n);r!=i&&m(e,"layerid",i)}},appendElement:function(e,t){var r=t||ai.getPCBCmdKey(e);m(e,"layerid")||this.updateElementLayerId(e);var n=m(e,"layerid");if("TRACK"==r||"SOLIDREGION"==r)if(n==Fn.BOARDOUTLINE)Gi.insertBefore(e,zi.get("other_end"));else{var i=h('#g1 > polyline[layerid="'+n+'"]');i.length&&i[i.length-1].nextSibling?Gi.insertBefore(e,i[i.length-1].nextSibling):Gi.insertBefore(e,zi.get("track_end"))}else"ARC"==r?n==Fn.BOARDOUTLINE?Gi.insertBefore(e,zi.get("other_end")):Gi.insertBefore(e,zi.get("track_end")):"RATLINE"==r?Gi.insertBefore(e,zi.get("ratline_end")):"IMAGE"==r?Gi.insertBefore(e,zi.get("image_end")):Gi.insertBefore(e,zi.get("other_end"))},updateFront:function(){var e,t=d("pcblayerStyle").sheet.cssRules,n=this.getLayersCache();for(e in n)if(t[e]&&n[e].color){n[e].darkColor||(n[e].darkColor=r(n[e].color));if(n[e].active){this.front=e;t[e].style.stroke=n[e].color;t[e].style.fill=n[e].color}else{t[e].style.stroke=n[e].darkColor;t[e].style.fill=n[e].darkColor}}var i=(pi.gJsonCache.systemColor||{}).hole;if(i&&d("padHoleStyle")){t=d("padHoleStyle").sheet.cssRules;t[0].style.fill=i;t[1].style.fill=i;t[2].style.fill=i;t[3].style.stroke=i}},initLayerSplitter:function(){this.add("image_begin");this.add("image_end");this.add("track_begin");this.add("track_end");this.add("other_begin");this.add("other_end");this.add("ratline_begin");this.add("ratline_end")},setActivePCBLayer:function(e){zi.setActiveLayer(e)},initByCache:function(){var e=this.getLayersCache();for(var t in e)if(e.hasOwnProperty(t)){zi.show(t,e[t].visible);e[t].active&&(this.front=t)}var r,n,i=h('#g1 > polyline[layerid="'+this.front+'"]');if(i.length){r=zi.get("track_end");for(n=i.length-1;n>=0;n--)if(i[n].nextSibling!==r){Gi.insertBefore(i[n],r);r=i[n]}}var a=h('#g1 > path[layerid="'+this.front+'"]');if(a.length){r=zi.get("track_end");for(n=a.length-1;n>=0;n--)if(a[n].nextSibling!==r){Gi.insertBefore(a[n],r);r=a[n]}}},getValidLayer:function(e,t){var r=Li[e];if(r){var n,i=zi.getLayersCache();t=+t;if(i){if(t&&i[t]&&i[t].config&&r.indexOf(t)>=0)return t;r.some(function(e){if(i[e]&&i[e].config){n=e;return!0}});return n}}}};t.addEventListener("DOMContentLoaded",function(){zi.initLayerSplitter();zi.updateFront()},!1);a.registerHook({layer_show:function(e){zi.show(e)},layer_hide:function(e){zi.show(e,!1)},layer_front:function(e){zi.setActivePCBLayer(e)},layer_cfg:function(){return zi.getLayersCache()},layer_cfg_update:function(e,t){var n,i,a;for(var o in e)if(e.hasOwnProperty(o))if("_hole"==o){pi.gJsonCache.systemColor.hole=e[o].color;if(d("padHoleStyle")){a=d("padHoleStyle").sheet.cssRules;a[0].style.fill=e[o].color;a[1].style.fill=e[o].color;a[2].style.fill=e[o].color;a[3].style.stroke=e[o].color}}else if("_DRCError"==o)pi.gJsonCache.systemColor.DRCError=e[o].color;else{n=pi.gJsonCache.layers[o];if(n){i=n.color;n.config=e[o].config;e[o].visible&&(n.visible=e[o].visible);if(i!==e[o].color){n.color=e[o].color;n.darkColor=r(e[o].color);a=d("pcblayerStyle").sheet.cssRules;if(a[o]){a[o].style.stroke=n.active?n.color:n.darkColor;a[o].style.fill=n.active?n.color:n.darkColor}}}}t&&Oi.rebuild()},toplayer:function(){zi.setActivePCBLayer(Fn.TOPLAYER)},bottomlayer:function(){zi.setActivePCBLayer(Fn.BOTTOMLAYER)},inner1:function(){zi.setActivePCBLayer(Fn.INNER1)},inner2:function(){zi.setActivePCBLayer(Fn.INNER2)},inner3:function(){zi.setActivePCBLayer(Fn.INNER3)},inner4:function(){zi.setActivePCBLayer(Fn.INNER4)},getUsedLayerCount:function(){var e=0,r=0,n=0;if(t.querySelector('[layerid="'+Fn.ALL+'"]:not([display="none"])')){e=1;r=1}(t.querySelector('[layerid="'+Fn.TOPLAYER+'"]:not([display="none"])')||t.querySelector('[layerid="'+Fn.TOPSILKLAYER+'"]:not([display="none"])'))&&(e=1);(t.querySelector('[layerid="'+Fn.BOTTOMLAYER+'"]:not([display="none"])')||t.querySelector('[layerid="'+Fn.BOTTOMSILKLAYER+'"]:not([display="none"])'))&&(r=1);t.querySelector('[layerid="'+Fn.INNER1+'"]:not([display="none"])')&&n++;t.querySelector('[layerid="'+Fn.INNER2+'"]:not([display="none"])')&&n++;t.querySelector('[layerid="'+Fn.INNER3+'"]:not([display="none"])')&&n++;t.querySelector('[layerid="'+Fn.INNER4+'"]:not([display="none"])')&&n++;return e+r+n}})}();Ei._createGraph=function(e){var t=[];if(!e)return!1;var r=pi.gJsonCache.SIGNALS[e];if("object"==typeof r){for(var n,i=0,a=r.length;i<a;i++)r[i]&&"PAD"==r[i].cmd&&r[i].fid&&r[i].fid.length>3&&t.push({gId:r[i].gId,fid:r[i].fid});Ei.nodeCount=t.length;if(Ei.nodeCount<2){delete Ei.ratLineArr[e];var o=Ei.realRatLineArr[e]||[];for(i=0;i<o.length;i++){v(d(o[i].gId))}delete Ei.realRatLineArr[e];return!1}Ei.graph=[];for(i=0;i<Ei.nodeCount;i++)Ei.graph[i]=[];Ei.PADMap=t;a=Ei.nodeCount;for(i=0;i<a;i++)for(n=i;n<a;n++)Ei.graph[i][n]=i!=n?Ei.graph[n][i]=Ei.getWeight(i,n):0}};Ei.getWeight=function(e,t){var r=pi.gJsonCache.FOOTPRINT,n=Ei.PADMap[e],i=Ei.PADMap[t],a=n&&n.fid,o=i&&i.fid,s=n&&n.gId,l=i&&i.gId;if(!(a&&o&&r&&r[a]&&r[o])){ai.reportError(new Error("Error in ratLineMgr.getWeight()"));return 0}var c=r[a].PAD[s],d=r[o].PAD[l];if(!c||!d){ai.reportError(new Error("Error in ratLineMgr.getWeight()"));return 0}return(c.x-d.x)*(c.x-d.x)+(c.y-d.y)*(c.y-d.y)};Ei._doPrim=function(e){var t,r=0,n=0;if(Ei.nodeCount<2){if(!Ei.realRatLineArr[e])return!1;for(r=0,t=Ei.realRatLineArr[e].length;r<t;r++)v(d(Ei.realRatLineArr[e][r].gId));return!1}var i=[];for(r=1;r<Ei.nodeCount;r++)i.push(!1);i[0]=!0;var a,o;Ei.ratLineArr[e]=[];for(;n<Ei.nodeCount-1;){var s=Number.MAX_VALUE;r=0;for(;r<Ei.nodeCount;)if(i[r]){for(var l=0;l<Ei.nodeCount;++l)if(!i[l]&&s>Ei.graph[r][l]){s=Ei.graph[r][l];a=r;o=l}++r}else++r;i[o]=!0;var c={from:Ei.PADMap[a],to:Ei.PADMap[o],weight:s,bTracked:!1};Ei._insertOneRatLine(e,c);n++}};Ei.buildAllNet=function(){Ei.realRatLineArr={};var e=pi.getAllNetName();Ei.buildGroupNets(e)};Ei._lineInVertexs=function(e,t){return e&&t&&t.from&&t.to&&t.from.gId in e&&t.to.gId in e};Ei._insertOneRatLine=function(e,t){Ei.ratLineArr[e]||(Ei.ratLineArr[e]=[]);Ei.ratLineArr[e].push(t)};Ei.buildOneNet=function(e,t){if(e){if(Qi==Dn.PCBLIB)return!1;if(!0===t){Ei._createGraph(e);if(!1===Ei._doPrim(e))return!1}else{var r=Ei.ratLineArr[e];r&&r.length>0&&r.forEach(function(e){e.bTracked=!1})}var n=ii.buildOneNet(e);for(var i in n)if(n.hasOwnProperty(i)){var a=n[i],o=0;for(var s in a)a.hasOwnProperty(s)&&o++;if(o>=2){var l=Ei.ratLineArr[e];for(var c in l)l.hasOwnProperty(c)&&Ei._lineInVertexs(a,l[c])&&!1===l[c].bTracked&&(l[c].bTracked=!0)}}Ei._createRealRatLinesOfOneNet(e)}};Ei._createRealRatLinesOfOneNet=function(e){var t=[],r=Ei.realRatLineArr[e]||[],n=Ei.ratLineArr[e];if(!n)return!1;var i=0,a=0,o=n.length;Ei.realRatLineArr[e]&&(a=Ei.realRatLineArr[e].length);var s,l,c,h,u,p,f=pi.gJsonCache.FOOTPRINT;for(u=0;u<a;u++)for(;i<o;){if(n[i]&&!1===n[i].bTracked){if(!(n[i].from&&n[i].to&&f[n[i].from.fid]&&f[n[i].to.fid]))continue;s=f[n[i].from.fid].PAD[n[i].from.gId];l=f[n[i].to.fid].PAD[n[i].to.gId];c=r[u].gId;h=d(c);if(!h)return;m(h,{x1:s.x,x2:l.x,y1:s.y,y2:l.y});t.push({gId:c,dataId:i});i++;break}i++}var g=[];if(a>t.length){var y={};for(u=0,p=t.length;u<p;u++)y[t[u].gId]=1;for(u=0;u<a;u++){c=r[u].gId;c in y||g.push(v(d(c)))}}if(i<o)for(var x=d("layer_ratline_end");i<o;i++)if(!1===n[i].bTracked){if(!f[n[i].from.fid]||!f[n[i].to.fid])continue;s=f[n[i].from.fid].PAD[n[i].from.gId];l=f[n[i].to.fid].PAD[n[i].to.gId];for(var _,P=null;!P&&g.length;)P=g.pop();if(P){c=P.id;_={x1:s.x,x2:l.x,y1:s.y,y2:l.y,net:e};m(P,_)}else{c=ai.newId();_={id:c,stroke:pi.gJsonCache.layers[Fn.RATLINES].color,fill:"none",x1:s.x,x2:l.x,y1:s.y,y2:l.y,net:e,c_shapetype:"line",layerid:Fn.RATLINES};_.class="events-none";P=Ue("line",_)}t.push({gId:c,dataId:i});Gi.insertBefore(P,x)}Ei.realRatLineArr[e]=t};Ei.buildGroupNets=function(e){for(var t=0,r=e.length;t<r;t++)e[t]&&Ei.buildOneNet(e[t],!0)};Ei.buildRatLinesOfPCBLib=function(e){var t;if(e&&(e.tagName||[0])){if(e[0]&&e[0].tagName)t=nr(e);else{if(!e.tagName)return;t=nr([e])}t&&t.length&&Ei.buildGroupNets(t)}};Ei.highlightNets=function(e){for(var t=0;t<e.length;t++){var r=e[t],n=Ei.realRatLineArr[r];if(n)for(var i=0;i<n.length;i++)g(d(n[i].gId),"highlight")}};Ei.cancelHighlightNets=function(){for(var e=h("line.highlight",Gi),t=0;t<e.length;t++)y(e[t],"highlight")};Ei.findRatLineByPos=function(e,t,r){if(!Mr(r)||Qi==Dn.PCBLIB)return!1;var n=pi.ifFind(e,t,"",r,"ALL");return n&&n.net?ii.findRatLine(n.net,n.gId,e,t):void 0};Ei.isRoutedOfOneNet=function(e){var t=!0;if(Ei.ratLineArr.hasOwnProperty(e))for(var r,n=Ei.ratLineArr[e],i=0,a=n.length;i<a;i++){r=n[i];if(r&&!r.bTracked){t=!1;break}}return t};Ei.connect=function(e,t){var r=d(e),n=d(t);if(!r||!n)return!1;var i=V(m(r,"net")||""),a=V(m(n,"net")||""),o=i,s=[];if(a||i)if(a&&i)if(a==i&&a);else{var l=Ei.mergeNets(i,a);if(!1===l)return!1;l instanceof Array&&(s=l)}else if(a){o=a;m(r,"net",a);pi.updateOne(r.parentNode)}else{m(n,"net",o);pi.updateOne(n.parentNode)}else{o="N$"+ ++hi;m(r,"net",o);m(n,"net",o);pi.updateOne(r.parentNode);pi.updateOne(n.parentNode)}Ei.buildOneNet(o,!0);if(a==i&&a)return"";i!=o&&s.unshift([e,i,o]);a!=o&&s.unshift([t,a,o]);return s};Ei.mergeNets=function(e,t,r){if(!1!==r&&!parent.confirm("Are you sure merge net "+e+" and net "+t+"?"))return!1;var n,i,a=pi.gJsonCache.SIGNALS[t]||[],o=e,s=null,l=[];for(n=0,i=a.length;n<i;n++)if(a[n]){s=d(a[n].gId);l.push([s.id,m(s,"net")||"",o]);m(s,"net",o);s.parentNode&&"g1"==s.parentNode.id?pi.updateOne(s):"g"==s.tagName&&"FOOTPRINT"==ai.getPCBCmdKey(s.parentNode)&&pi.updateOne(s.parentNode)}delete pi.gJsonCache.SIGNALS[t];delete Ei.ratLineArr[t];if(Ei.realRatLineArr[t])for(n=0,i=Ei.realRatLineArr[t].length;n<i;n++)v(d(Ei.realRatLineArr[t][n].gId));return l};Ei.removeAllRatline=function(){function e(e){v(d(e.gId))}for(var t in Ei.realRatLineArr)A(Ei.realRatLineArr,t)&&Ei.realRatLineArr[t].forEach(e);Ei.ratLineArr={}};ii.ini=function(){ii.currentNet=1;ii.nodes={};ii.nets={};ii.routedGroup={}};ii.createNewNet=function(){return ii.currentNet++};ii.buildOneNet=function(e){if(ii._solveOneNet(e))return ii.createRoutedGroup()};ii.findRatLine=function(e,t,r,n){if(ii._solveOneNet(e)){var i,a,o,s=null,l=!1;for(o in ii.nets)if(ii.nets.hasOwnProperty(o)){var c=ii.nets[o];l=!1;s={};for(i=0,a=c.length;i<a;i++)if(c[i]){var h=c[i].obj;h&&h.gId==t&&(l=!0);h&&"PAD"==h.cmd&&h.fid&&(s[h.gId]=h)}if(l)break}if(l){var u,p=Ei.ratLineArr[e]||[],f={};for(i=0,a=p.length;i<a;i++){u=p[i];if(u&&!u.bTracked){u.from.gId in s&&(f[u.to.gId]=1);u.to.gId in s&&(f[u.from.gId]=1)}}var g=1e10,y=null;for(o in f)if(f.hasOwnProperty(o)){var v=d(o),x=m(v.childNodes[1],"cx"),_=m(v.childNodes[1],"cy"),P=(x-r)*(x-r)+(_-n)*(_-n);if(P<g){y=o;g=P}}if(y){var S=-1,b=0;for(i=0,a=p.length;i<a;i++){u=p[i];if(u&&!u.bTracked){if(u.from.gId==y&&u.to.gId in s){S=i;b=2;break}if(u.to.gId==y&&u.from.gId in s){S=i;b=1;break}}}if(S>-1){var C=Ei.realRatLineArr[e]||[];for(i=0,a=C.length;i<a;i++){var A=C[i];if(A&&A.dataId==S)return[d(A.gId),b]}}}}}};ii._solveOneNet=function(e){ii.ini();var t=pi.gJsonCache.SIGNALS[e];if(!t||!e)return!1;ii.solveNodeByLayer(t,Fn.TOPLAYER,e);ii.solveNodeByLayer(t,Fn.BOTTOMLAYER,e);for(var r=Fn.INNER1,n=Fn.INNER4;r<=n;r++)pi.gJsonCache.layers[r]&&pi.gJsonCache.layers[r].config&&ii.solveNodeByLayer(t,r,e);ii._mergeLayer(t);return!0};ii._mergeLayer=function(e){var t,r=[],n={};for(t in ii.nets)if(ii.nets.hasOwnProperty(t)){r.push(t);for(var i in ii.nets[t])ii.nets[t].hasOwnProperty(i)&&(n[i]=ii.nets[t][i])}for(var a=0,o=e.length;a<o;a++){var s=e[a];if(s&&s.layerid==Fn.ALL&&("PAD"==s.cmd||"VIA"==s.cmd)){var l=pi.getElementByObj(s);if(!l)continue;for(var c=_({x:l.x,y:l.y}),d=[],h=0,u=r.length;h<u;h++)ii.nodes[r[h]][c]&&d.push(ii.nodes[r[h]][c]);var p=[],f={};if(d.length>=2){for(var g=d[0],y=0,v=d.length;y<v;y++){p=p.concat(n[d[y]]);f[d[y]]=1;delete n[d[y]]}n[g]=p;for(var m=0,x=r.length;m<x;m++){var P=r[m];for(t in ii.nodes[P])ii.nodes[P].hasOwnProperty(t)&&ii.nodes[P][t]in f&&(ii.nodes[P][t]=g)}}}}ii.nets=n};ii.createRoutedGroup=function(){for(var e in ii.nets)if(ii.nets.hasOwnProperty(e)){ii.routedGroup[e]={};for(var t=ii.nets[e],r=0,n=t.length;r<n;r++)if(t[r]){var i=t[r].obj;i&&"PAD"==i.cmd&&i.fid&&(ii.routedGroup[e][i.gId]=1)}}return ii.routedGroup};ii.findNetlist=function(e,t){};ii.addNode=function(e){var t,r=e.layerid;if(-1==e.m_Netlist){t=ii.nodes[r][_(e.m_a)];if(void 0!==t)e.m_Netlist=t;else{e.m_Netlist=ii.createNewNet();ii.nodes[r][_(e.m_a)]=e.m_Netlist}ii.nets[r][e.m_Netlist]||(ii.nets[r][e.m_Netlist]=[]);ii.nets[r][e.m_Netlist].push(e);return e.m_Netlist}t=ii.nodes[r][_(e.m_a)];if(void 0!==t&&t!=e.m_Netlist){for(var n=e.m_Netlist,i=t,a=ii.nets[r][i],o=0,s=a.length;o<s;o++){var l=a[o];l.m_Netlist=n;ii.nodes[r][_(l.m_a)]=n}for(var c in ii.nodes[r])ii.nodes[r].hasOwnProperty(c)&&ii.nodes[r][c]==i&&(ii.nodes[r][c]=n);var d=ii.nets[r][i].concat(ii.nets[r][n]);ii.nets[r][n]=d;delete ii.nets[r][i];e.m_Netlist=n}ii.nets[r][e.m_Netlist]||(ii.nets[r][e.m_Netlist]=[]);ii.nets[r][e.m_Netlist].push(e);ii.nodes[r][_(e.m_a)]=e.m_Netlist;return e.m_Netlist};ii._solveCopperAreaByLayer=function(e,t){var r=e+"_"+t,n=null,i=[],a=function(e){e.connectedPadOrViaArr.length>0&&i.push(e.connectedPadOrViaArr)};if(!(r in Ai.copperPolygons))return!1;n=Ai.copperPolygons[r];if(pi.gJsonCache.COPPERAREA)for(var o in n)n.hasOwnProperty(o)&&o in pi.gJsonCache.COPPERAREA&&n[o].length>0&&n[o].forEach(a);i.forEach(function(e){var r=null;e.forEach(function(e){var n={m_a:{x:e.x,y:e.y},obj:e,layerid:t,m_Netlist:null===r?-1:r};r=ii.addNode(n)})})};ii._solveSolidRegionByLayer=function(e,t){function r(e,t){return e==t||t==Fn.ALL}var n=[],i=pi.getAllObjsOf("SOLIDREGION"),a=0,o=0;for(o=i.length;a<o;a++){var s=i[a];s.net==e&&s.layerid==t&&"solid"==s.type&&n.push(s)}if(n.length>0){var l=pi.getAllObjsOf("PAD",!0),c=pi.getAllObjsOf("VIA",!0);n.forEach(function(e){var t=[],n=Ai.createPolygonFromPointArr(e.pointArr);if(n){l.forEach(function(i){r(e.layerid,i.layerid)&&e.net==i.net&&Ai.testSimplyPolygonContainsPoint(n,Ai.zoomInPoint({x:i.x,y:i.y}))&&t.push(i)});c.forEach(function(r){e.net==r.net&&Ai.testSimplyPolygonContainsPoint(n,Ai.zoomInPoint({x:r.x,y:r.y}))&&t.push(r)});var i=null;t.forEach(function(t){var r={m_a:{x:t.x,y:t.y},obj:t,layerid:e.layerid,m_Netlist:null===i?-1:i};i=ii.addNode(r)})}})}};ii.solveNodeByLayer=function(e,t,r){var n=[];ii.nodes[t]={};ii.nets[t]={};var i,a,o,s;if(!(e.length<1)){ii._solveSolidRegionByLayer(r,t);ii._solveCopperAreaByLayer(r,t);for(i=0,a=e.length;i<a;i++){var l=e[i];if(l&&(l.layerid==t||l.layerid==Fn.ALL)){var c=pi.getElementByObj(l);if(!c)continue;var d={m_a:{x:0,y:0},obj:l,layerid:t,m_Netlist:-1},h=null;switch(l.cmd){case"PAD":case"VIA":d.m_a.x=c.x,d.m_a.y=c.y;ii.addNode(d);h={x:c.x,y:c.y};"PAD"==l.cmd?h.r=Math.min(c.width,c.height)/2:h.r=c.diameter/2;n.push(h);break;case"TRACK":o=c.pointArr;var u=o?o.length:0;if(u>=2){d.m_a.x=o[0].x,d.m_a.y=o[0].y;s=ii.addNode(d);d.m_a.x=o[u-1].x,d.m_a.y=o[u-1].y;d.m_Netlist=s;ii.addNode(d);h={gId:c.gId,x:o[0].x,y:o[0].y,r:c.strokeWidth/2};n.push(h);h={gId:c.gId,x:o[u-1].x,y:o[u-1].y,r:c.strokeWidth/2};n.push(h)}break;case"ARC":o=ve(c.d);d.m_a.x=o[0].x,d.m_a.y=o[0].y;s=ii.addNode(d);d.m_a.x=o[1].x,d.m_a.y=o[1].y;d.m_Netlist=s;ii.addNode(d);h={gId:c.gId,x:o[0].x,y:o[0].y,r:c.strokeWidth/2};n.push(h);h={gId:c.gId,x:o[1].x,y:o[1].y,r:c.strokeWidth/2};n.push(h)}}}for(i=0,a=n.length;i<a;i++)ii.addJunctionNode(n[i],e,t)}};ii.isSamePoint=function(e,t){return e.x==t.x&&e.y==t.y};ii.addJunctionNode=function(e,t,r){var n,i=ii.nodes[r][_(e)];if(r!=Fn.ALL)for(var a=0,o=t.length;a<o;a++){var s=t[a];if(s&&(s.layerid==r||s.layerid==Fn.ALL)&&("TRACK"==s.cmd||"ARC"==s.cmd)){var l=pi.getElementByObj(s);if("ARC"==s.cmd){l.pointArr||(l.pointArr=Dr(l,!1));if(!Array.isArray(l.pointArr)||l.pointArr.length<2)continue}if(l&&l.pointArr&&l.pointArr.length){var c=l.pointArr,d=+l.strokeWidth/2+e.r;if(e.gId!=l.gId&&!ii.isSamePoint(e,c[0])&&!ii.isSamePoint(e,c[c.length-1])&&q(e,c,d)){n={m_a:{x:c[0].x,y:c[0].y},obj:null,layerid:r,m_Netlist:i};i=ii.addNode(n)}}}}else{n={m_a:{x:e.x,y:e.y},obj:null,m_Netlist:i};ii.addNode(n)}};ii.addJunctionNode2=function(e,t,r){var n,i=ii.nodes[r][_(e)];if(r!=Fn.ALL)for(var a=Oi.searchByPoint(e,r),o=0,s=a.length;o<s;o++){var l=a[o],c=l[4].node,d=l[4].type;if(("ARC"==d||"TRACK"==d)&&c.net==t){var h=pi.gJsonCache[d][c.gId];if(!h)continue;var u=h.pointArr||[],p=+h.strokeWidth/2+e.r;if("ARC"==d){u=Dr(h,!1);if(!Array.isArray(u)||u.length<2)continue}if(e.gId!=h.gId&&!ii.isSamePoint(e,u[0])&&!ii.isSamePoint(e,u[u.length-1])&&q(e,c.pointArr,p)){n={m_a:{x:u[0].x,y:u[0].y},obj:null,layerid:r,m_Netlist:i};i=ii.addNode(n)}}}else{n={m_a:{x:e.x,y:e.y},obj:null,m_Netlist:i};ii.addNode(n)}};Ci.init=function(){this._rules=pi.gJsonCache.DRCRULE||{};this._errorA=[]};Ci.doDRC=function(){Ci.hideErrorSymbols();Ci._testTrackSize();Ci._testHole();Ci._testBoardOutline();Ci._testClearance();return Ci._errorTree()};Ci.doRealtimeDRC=function(e,t){if(e&&pi.gJsonCache.DRCRULE&&pi.gJsonCache.DRCRULE.isRealtime){var r,n=ai.getPCBCmdKey(e);if(n){t&&Ji[n]?r=Ji[n](e):pi.gJsonCache[n]&&(r=pi.gJsonCache[n][e.id]);if(r){Ci._errorA=[];var i=[];"FOOTPRINT"==n?Ci.checkedKeys.forEach(function(e){for(var t in r[e])A(r[e],t)&&Mr(r[e][t].layerid)&&i.push(Oi.createNode(r[e][t],e))}):Mr(r.layerid)&&i.push(Oi.createNode(r,n));i.forEach(function(e){if(e&&e.treeNodes&&e.treeNodes.length){Ci._testHoleSize(e.treeNodes[0][4]);Ci._testOneNode(e.treeNodes,e.layerid)}});Ci._showRealtimeDRCError(Ci._errorA)}}}};Ci._createXPathErrorFlag=function(e,t){var r=t||2;return"M"+(e.x-r)+" "+(e.y-r)+"L"+(e.x+r)+" "+(e.y+r)+"M"+(e.x+r)+" "+(e.y-r)+"L"+(e.x-r)+" "+(e.y+r)};Ci._showRealtimeDRCError=function(e){var t=d("gDrcDots");if(t){for(var r,n=t.childNodes,i=n.length,a=0,o=e.length;a<o;a++)if(a<i){r=n[a];m(r,{d:Ci._createXPathErrorFlag(e[a].pos),visibility:"yes","stroke-width":1.2/ci})}else{r=n[0].cloneNode(!0);m(r,{d:Ci._createXPathErrorFlag(e[a].pos),visibility:"yes","stroke-width":1.2/ci});t.appendChild(r)}for(;a<i;a++){r=n[a];m(r,{visibility:"hidden"})}}};Ci.hideRealtimeDRCError=function(){var e=d("gDrcDots");if(e)for(var t=e.childNodes,r=t.length,n=0;n<r;n++)m(t[n],{visibility:"hidden"})};Ci._addError=function(e){for(var t=!1,r=0,n=Ci._errorA.length;r<n;r++)Ci._errorA[r].pos.x==e.pos.x&&Ci._errorA[r].pos.y==e.pos.y&&(t=!0);isNaN(e.pos.x)||isNaN(e.pos.y);!t&&Ci._errorA.push(e)};Ci._errorTree=function(){for(var e=[],t=0,r=Ci._errorA.length;t<r;t++)e.push({text:Ci._errorA[t].errorStr,id:t,checked:!0,iconCls:"icon-no"});return{treeData:e,errorData:Ci._errorA}};Ci._markError=function(e){if(e){Wt(Xt());for(var t=0;t<e.ids.length;t++)if(e.ids[t]){var r=d(e.ids[t]);r&&p(r,"selected",!0)}ke(e.pos.x,e.pos.y);Ci.showErrorSymbols(e.pos)}};Ci.showErrorSymbols=function(e){var t=Ci._createXPathErrorFlag(e,5);m(d("gDrcDots").childNodes[0],{d:t,visibility:"yes","stroke-width":2/ci})};Ci.hideErrorSymbols=function(){m(d("gDrcDots").childNodes[0],{visibility:"hidden","stroke-width":1.2/ci})};Ci._testTrack2Track=function(){var e=Ci._trackA.length;if(e>=2&&Ci._rules.track2Track>0)for(var t=0;t<e;t++)for(var r=t+1;r<e;r++)Ci._track2Track(Ci._trackA[t],Ci._trackA[r])};Ci._testTrackSize=function(){for(var e in Oi.nodeIndex)if(A(Oi.nodeIndex,e)){var t=Oi.nodeIndex[e].treeNodes;if(!t[0][4])continue;var r=t[0][4].type,n=t[0][4].node;"TRACK"!=r&&"ARC"!=r||+n.strokeWidth<Ci._rules.trackWidth&&Ci._addError({errorStr:"trackWidth",ids:[e],pos:n.pointArr[0]})}};Ci._testHole=function(){var e,t,r=[];for(t in Oi.nodeIndex)if(A(Oi.nodeIndex,t)){var n=Oi.nodeIndex[t].treeNodes;e=Ci._testHoleSize(n[0][4]);e&&r.push(e)}pi.getAllObjsOf("HOLE",!0).forEach(function(t){e=Ci._checkHole(t);e&&r.push(e)});Ci._testHole2Hole(r)};Ci._checkHole=function(e){var t=(Ci._rules.holeSize||1.6)/2,r=parseFloat(e.holeR);if(r>.01){r<t&&Ci._addError({errorStr:"holeSize",ids:[e.gId],pos:{x:+e.x,y:+e.y}});return e}return null};Ci._testHoleSize=function(e){var t=(Ci._rules.holeSize,e.type),r=e.node;return"PAD"==t||"VIA"==t?Ci._checkHole(r):null};Ci._testOneNode=function(e,t){if(e&&e.length)for(var r=t==Fn.ALL?Oi.signalLayers:[t],n=0,i=e.length;n<i;n++)for(var a=0,o=r.length;a<o;a++){t=r[a];if(Oi.trees[t])for(var s=Oi.trees[t].search(e[n]),l=0,c=s.length;l<c;l++)Ci._testObj2Obj(e[n],s[l])}};Ci._testClearance=function(){for(var e in Oi.nodeIndex)A(Oi.nodeIndex,e)&&Ci._testOneNode(Oi.nodeIndex[e].treeNodes,Oi.nodeIndex[e].layerid)};Ci._convertItem=function(e,t){var r=null;if("ARC"==t||"TRACK"==t||"PAD"==t)return e;if("VIA"==t)r={gId:e.gId,holeR:e.holeR,net:e.net,layerid:Fn.ALL,width:e.diameter,height:e.diameter,x:e.x,y:e.y,shape:"ELLIPSE"};else{if("SOLIDREGION"!=t)return{};var n=ai.svg.getBBox(d(e.gId)),i=n.x+n.width/2,a=n.y+n.height/2;r={gId:e.gId,layerid:e.layerid,holeR:0,net:e.net,pointArr:e.pointArr,x:i,y:a,shape:"RECT"}}return r};Ci._testObj2Obj=function(e,t){function r(e){return"TRACK"==e||"ARC"==e?"TRACK":"PAD"==e||"VIA"==e||"SOLIDREGION"==e?"PAD":""}var n=e[4].type,i=Ci._convertItem(e[4].node,n),a=t[4].type,o=Ci._convertItem(t[4].node,a),s=r(n),l=r(a);i.gId!=o.gId&&i.net!=o.net&&i.net&&o.net&&("TRACK"==s&&"TRACK"==l?Ci._track2Track(i,o):"PAD"==s&&"PAD"==l?Ci._testPad2Pad(i,o):"TRACK"==s?Ci._testTrack2Pad(i,o):Ci._testTrack2Pad(o,i))};Ci._testBoardOutline=function(){function e(e){var t=pi.getAllObjsOf(e,!0),r=[];t.forEach(function(t){if(t.layerid==Fn.BOARDOUTLINE){t.net="$BoardOutlineNet";r=r.concat(Oi.createNode(t,e))}});return r}e("TRACK").concat(e("ARC")).forEach(function(e){Ci._testOneNode(e.treeNodes,Fn.ALL)})};Ci._track2Track=function(e,t){if(e.net!=t.net){
var r=parseFloat(e.strokeWidth)/2+parseFloat(t.strokeWidth)/2+Ci._rules.track2Track,n=Ci._distanceBetweenSegments(e.pointArr[0],e.pointArr[1],t.pointArr[0],t.pointArr[1]);n.d<r&&Ci._addError({errorStr:"track2Track",ids:[e.gId,t.gId],pos:n.point})}};Ci._polygon2Segments=function(e){for(var t=e.length-1,r=[],n=0;n<t;n++)r.push({fromP:e[n],toP:e[n+1]});r.push({fromP:e[t],toP:e[0]});return r};Ci._pad2PadFilter=function(e,t){return!e||!t||!(e.net!=t.net||!e.net)};Ci._testPad2Pad=function(e,t){if(!Ci._pad2PadFilter(e,t)){var r={},n={d:Number.MAX_VALUE},i={x:(+e.x+ +t.x)/2,y:(+e.y+ +t.y)/2},a=!1;if(parent.$.inArray(e.shape,["RECT","OVAL","POLYGON"])>-1&&parent.$.inArray(t.shape,["RECT","OVAL","POLYGON"])>-1){for(var o=Ci._polygon2Segments(e.pointArr),s=0,l=o.length;s<l;s++){r=Ci._getDistanceBetweenSegmentWithPolygon(t.pointArr,o[s].fromP,o[s].toP);r.d<n.d&&(n=r)}n.d<Ci._rules.pad2Pad&&(a=!0)}else if("ELLIPSE"==e.shape&&"ELLIPSE"==t.shape){var c=Vi.distancePointToPoint({x:e.x,y:e.y},{x:t.x,y:t.y});c<(+e.width+ +t.width)/2+Ci._rules.pad2Pad&&(a=!0)}else{if("ELLIPSE"!=t.shape){var d=e;e=t;t=d}var h={x:+t.x,y:+t.y};r=Ci._getDistanceBetweenSegmentWithPolygon(e.pointArr,h,h);r.d<+t.width/2+Ci._rules.pad2Pad&&(a=!0)}a&&Ci._addError({errorStr:"pad2pad",ids:[e.gId,t.gId],pos:i})}};Ci._getDistanceBetweenSegmentWithPolygon=function(e,t,r){for(var n=Ci._polygon2Segments(e),i={},a={d:Number.MAX_VALUE},o=0,s=n.length;o<s;o++){i=Ci._distanceBetweenSegments(n[o].fromP,n[o].toP,t,r);i.d<a.d&&(a=i)}return a};Ci._track2PadFilter=function(e,t){return!e||!t||!(e.net!=t.net||!t.net)};Ci._testTrack2Pad=function(e,t){if(!Ci._track2PadFilter(e,t)){var r,n=parseFloat(e.strokeWidth)/2+Ci._rules.track2Pad;if("ELLIPSE"==t.shape){n=parseFloat(e.strokeWidth)/2+Ci._rules.track2Pad+t.width/2;r=Q({x:t.x,y:t.y},e.pointArr[0],e.pointArr[1]);r.d<n&&Ci._addError({errorStr:"track2pad",ids:[t.gId,e.gId],pos:{x:t.x,y:t.y}})}else{r=Ci._getDistanceBetweenSegmentWithPolygon(t.pointArr,e.pointArr[0],e.pointArr[1]);r.d<n&&Ci._addError({errorStr:"track2pad",ids:[t.gId,e.gId],pos:r.point})}}};Ci._testHole2Hole=function(e){var t=e.length;if(t>=2&&Ci._rules.hole2Hole>0)for(var r=0;r<t;r++)for(var n=r+1;n<t;n++)Ci._hole2Hole(e[r],e[n])};Ci._hole2Hole=function(e,t){var r=parseFloat(e.holeR)+parseFloat(t.holeR)+Ci._rules.hole2Hole;Vi.distancePointToPoint({x:e.x,y:e.y},{x:t.x,y:t.y})<r&&Ci._addError({errorStr:"hole2Hole",ids:[e.gId,t.gId],pos:{x:(+e.x+ +t.x)/2,y:(+e.y+ +t.y)/2}})};Ci._testHole2Track=function(){};Ci._hole2Track=function(e,t){};Ci._testHole2Pad=function(){};Ci._hole2Pad=function(e,t){};Ci._distanceBetweenSegments=function(e,t,r,n){var i,a,o={x:null,y:null},s=null;s=Ci._checkSegmentsIntersect(e,t,r,n);if(s)return s;s=Q(e,r,n);a=s.d;i=1e38;if(a<i){i=a;o.x=s.point.x;o.y=s.point.y;e}s=Q(t,r,n);a=s.d;if(a<i){i=a;o.x=s.point.x;o.y=s.point.y;t}s=Q(r,e,t);a=s.d;if(a<i){i=a;o.x=s.point.x;o.y=s.point.y;r}s=Q(n,e,t);a=s.d;if(a<i){i=a;o.x=s.point.x;o.y=s.point.y;n}return{d:i,point:o}};Ci._checkSegmentsIntersect=function(e,t,r,n){var i,a,o,s,l,c;i=t.x-e.x;a=t.y-e.y;o=n.x-r.x;s=n.y-r.y;if(o*a-s*i==0)return!1;c=(i*(r.y-e.y)+a*(e.x-r.x))/(o*a-s*i);l=(o*(e.y-r.y)+s*(r.x-e.x))/(s*i-o*a);return c>=0&&c<=1&&l>=0&&l<=1&&{d:0,point:{x:e.x+l*i,y:e.y+l*a}}};var Xi=function(){function e(e){var t,r=ai.getPCBCmdKey(e),n=r&&pi.gJsonCache[r]?pi.gJsonCache[r][e.id]:0,i=[];if(n)if("FOOTPRINT"==r&&n.PAD){for(r in n.PAD)if(n.PAD.hasOwnProperty(r)){t=n.PAD[r];t.net&&i.push({x:t.x,y:t.y,net:t.net})}}else"PAD"!=r&&"VIA"!=r||n.net&&i.push({x:n.x,y:n.y,net:n.net});return i}function t(e,t){for(var r=0,n=t.length;r<n;r++)if(ce(t[r].x,e.x)&&ce(t[r].y,e.y))return r;return-1}function r(e){var r,n,i,a=pi.gJsonCache.TRACK,o={};for(n in a)if(a.hasOwnProperty(n)){r=a[n];if(r.net==e.net){i=t(e,r.pointArr);i>-1&&(o[n]=i)}}return o}function n(t){var n,i,a,o,s,l,c,d,h={},u=[],p={},f=[];for(n=0,a=t.length;n<a;n++){o=t[n];s=ai.getPCBCmdKey(o);"TRACK"==s?h[o.id]=1:"FOOTPRINT"!=s&&"PAD"!=s&&"VIA"!=s||u.push(o)}for(n=0,a=u.length;n<a;n++){o=u[n];l=e(o);for(i=0;i<l.length;i++){c=r(l[i]);for(d in c)if(A(c,d)&&!A(h,d)&&(!A(p,d)||!function(e,t,r){for(var n=0,i=e.length;n<i;n++){var a=e[n];if(a[0]==t&&a[1]==r)return!0}return!1}(f,d,c[d]))){p[d]=1;f.push([d,c[d],l[i]])}}}return{followingWires:f,followingWireIds:p}}function i(e,t,r,n){var i,a,o,l,c,h,u=bi.canvas.angle+"";if(e){i=e.followingWires||[];for(c=0,h=i.length;c<h;c++){a=i[c];if(a&&a[0]){o=d(a[0]);if(o&&o.points){var p=ai.toFixed(a[2].x+t,3),f=ai.toFixed(a[2].y+r,3);if("45"===u||"90"===u)m(o,"points",function(e){var t=[].slice.call(n[e].points),r=[],i=[],o=[],l=n[e][0===a[1]?"start":"end"];-1===l.indexOf("45")&&(t=function(e){for(var t,r=[],n=0;n<e.length/2;n++){t=2*n;r.push([e[t],e[t+1]])}t=r.length;for(;t;){t--;if(t<3)break;t>r.length-2||function(e){return r[e][0]===r[e-1][0]&&r[e-1][0]===r[e-2][0]||r[e][1]===r[e-1][1]&&r[e-1][1]===r[e-2][1]}(t)&&r.splice(t-1,1)}return r.join().split(",")}(t));if(0===a[1]){r=t.splice(0,6);i=[p,f];o=r.slice(-2)}else{r=t.splice(-6);i=r.slice(0,2);o=[p,f]}s=Vi.formatTrackPoints(i,l.indexOf("45")>=0?"45":"90",o[0],o[1],l);var c=s.split(" ");return(0===a[1]?c.concat(t):t.concat(c)).join(" ")}(a[0]));else{l=o.points.getItem(a[1]);l.x=p;l.y=f}}}}}}return{calFollowing:n,moveFollowing:i}}();Oi.init=function(e){if(Qi!=Dn.PCBLIB){Oi.clear();Ci.init();[Fn.TOPLAYER,Fn.BOTTOMLAYER,Fn.INNER1,Fn.INNER2,Fn.INNER3,Fn.INNER4].forEach(function(e){Oi.signalLayers.push(e);Oi.trees[e]=rbush(9);Oi._bulkPatch[e]=[]});Ci.maxClearance=Math.max(pi.gJsonCache.DRCRULE.pad2Pad,pi.gJsonCache.DRCRULE.track2Track);Ci.maxClearance=Math.max(Ci.maxClearance,pi.gJsonCache.DRCRULE.track2Pad)/2}};Oi.bbox2bbCoordinates=function(e){return[e.x-Ci.maxClearance,e.y-Ci.maxClearance,e.x+e.width+Ci.maxClearance,e.y+e.height+Ci.maxClearance]};Oi.line2bbCoordinates=function(e,t,r){var n=Ci.maxClearance+r/2;return[Math.min(e.x,t.x)-n,Math.min(e.y,t.y)-n,Math.max(e.x,t.x)+n,Math.max(e.y,t.y)+n]};Oi.createNode=function(e,t){var r=[];if("TRACK"==t||"ARC"==t){if("ARC"==t&&!e.pointArr){var n=Dr(e,!1);e.pointArr=n}for(var i=0,a=e.pointArr.length;i<a-1;i++){var o=Oi.line2bbCoordinates(e.pointArr[i],e.pointArr[i+1],e.strokeWidth),s={gId:e.gId,layerid:e.layerid,net:e.net,pointArr:[e.pointArr[i],e.pointArr[i+1]],strokeWidth:e.strokeWidth};r[i]=o;r[i].push({type:t,node:s})}}else{var l=d(e.gId);if(!l)return!1;var c={};if("PAD"==t&&"OVAL"==e.shape)r[0]=Oi.line2bbCoordinates(e.pointArr2[0],e.pointArr2[1],Math.min(e.width,e.height));else{c=ai.svg.getBBox(l);r[0]=Oi.bbox2bbCoordinates(c)}r[0].push({type:t,node:e})}return!!r.length&&{layerid:e.layerid,treeNodes:r}};Oi._cacheToNodeIndex=function(e,t){Oi.nodeIndex[e]=t};Oi.insertNode=function(e,t){function r(e,t){Oi._isBulkMode?Oi._bulkPatch[e]=(Oi._bulkPatch[e]||[]).concat(t):Oi.trees[e]&&Oi.trees[e].load(t)}if(Qi!=Dn.PCBLIB){Oi.removeNode(e);if(!Mr(e.layerid))return!1;var n=Oi.createNode(e,t),i=n.treeNodes;if(!n||!i)return!1;if(n&&n.treeNodes.length){Oi._cacheToNodeIndex(e.gId,n);n.layerid==Fn.ALL?Oi.signalLayers.forEach(function(e){r(e,i)}):r(n.layerid,i)}}};Oi.insertNodes=function(e,t){if(Array.isArray(e))e.forEach(function(e){Oi.insertNode(e,t)});else for(var r in e)A(e,r)&&Oi.insertNode(e[r],t)};Oi.removeNode=function(e){function t(e,t){e.forEach(function(e){Oi.trees[t]&&Oi.trees[t].remove(e)})}if(e&&A(Oi.nodeIndex,e.gId)){var r=Oi.nodeIndex[e.gId],n=r.treeNodes;r.layerid==Fn.ALL?Oi.signalLayers.forEach(function(e){t(n,e)}):t(n,r.layerid);delete Oi.nodeIndex[e.gId];return!0}return!1};Oi.removeNodes=function(e){if(Array.isArray(e))e.forEach(function(e){Oi.removeNode(e)});else for(var t in e)A(e,t)&&Oi.removeNode(e[t])};Oi.clear=function(){Oi.nodeIndex={};Oi.trees={};Oi.signalLayers=[];Oi._bulkPatch={};Oi._isBulkMode=!1};Oi.searchByPoint=function(e,t){var r=[e.x-e.r,e.y-e.r,e.x+e.r,e.y+e.r];return Oi.trees[t]?Oi.trees[t].search(r):[]};Oi.searchByPoint2=function(e,t,r,n){var i=[e-r,t-r,e+r,t+r];return Oi.trees[n]?Oi.trees[n].search(i):[]};Oi.rebuild=function(){if(Qi!=Dn.PCBLIB){Oi.init();Oi._isBulkMode=!0;for(var e=0,t=Ci.checkedKeys.length;e<t;e++)for(var r in pi.gJsonCache[Ci.checkedKeys[e]])A(pi.gJsonCache[Ci.checkedKeys[e]],r)&&Oi.addToRTree(pi.gJsonCache[Ci.checkedKeys[e]][r],Ci.checkedKeys[e]);Oi.signalLayers.forEach(function(e){Oi.trees[e].load(Oi._bulkPatch[e])});Oi._isBulkMode=!1}};Oi.addToRTree=function(e,t){e&&("FOOTPRINT"==t?Ci.checkedKeys.forEach(function(t){Oi.insertNodes(e[t],t)}):Oi.insertNode(e,t))};Oi.removeFromRTree=function(e,t){e&&("FOOTPRINT"==t?Ci.checkedKeys.forEach(function(t){Oi.removeNodes(e[t])}):Oi.removeNode(e))};Ai.zoomInPoint=function(e){return{x:Math.round(e.x*Ai._scaleFactor),y:Math.round(e.y*Ai._scaleFactor)}};Ai.zoomOutPoint=function(e){return{x:e.x/Ai._scaleFactor,y:e.y/Ai._scaleFactor}};Ai.zoomInOffsetVal=function(e){return parseInt(e*Ai._scaleFactor,10)};Ai._isOnCopperLayer=function(e){return Ai._copperLayerId==e||e==Fn.ALL};Ai._fetchCopperAreaOfThisLayer=function(e){var t=pi.gJsonCache.COPPERAREA,r=[];for(var n in t)t.hasOwnProperty(n)&&t[n].layerid==e&&r.push(t[n]);return r};Ai._markError=function(e){ke(e.x,e.y);if(Ci&&Ci.showErrorSymbols){Ci.showErrorSymbols(e);setTimeout(Ci.hideErrorSymbols,8e3)}};Ai.setUpFromJsonCache=function(){Ai.copperPolygons={};var e=pi.gJsonCache.COPPERAREA;for(var t in e)e.hasOwnProperty(t)&&e[t]&&e[t].polygon};Ai.rebuildCopperArea=function(e){var t,r=null,n=[];if("object"==typeof e){r=e;Ai.processOneCopperArea(r);n.push(r.net);t=r.layerid}else if("selected"==e){var i=Xt();if(1!=i.length||"COPPERAREA"!=ai.getPCBCmdKey(i[0]))return;r=Ji.COPPERAREA(i[0]);Ai.processOneCopperArea(r);n.push(r.net);t=r.layerid}else{if("all"!=e)return;t=zi.getActiveLayer();var a=pi.gJsonCache.COPPERAREA;for(var o in a)if(a.hasOwnProperty(o)){r=a[o];r.net&&Ai.processOneCopperArea(r);n.push(r.net)}}zi.setActivePCBLayer(t);return n};Ai.clearOldCopperPolygons=function(){var e=pi.gJsonCache.COPPERAREA,t=Ai.copperPolygons;for(var r in t)if(t.hasOwnProperty(r)){var n=t[r],i=!1;if(!n)continue;for(var a in n)if(n.hasOwnProperty(a)){i=!0;e&&a in e&&Ai.copperPolygons[r][a].length||delete Ai.copperPolygons[r][a]}i||delete Ai.copperPolygons[r]}};Ai.getCompressData=function(e){var t=e.net+"_"+e.layerid,r=Ai.copperPolygons,n=[];if(r[t]&&r[t][e.gId]){r[t][e.gId].forEach(function(e){var t=[],r=e.polygon;t.push(Ai._convertContourPointsToPath(r.outer));for(var i=0,a=r.holes.length;i<a;i++)t.push(Ai._convertContourPointsToPath(r.holes[i]));n.push(t)})}return JSON.stringify(n)};Ai.removeAllCopperPolygons=function(){var e=pi.gJsonCache.COPPERAREA;for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];Ai.resetActiveCopperPolygons(r)}Ai.clearOldCopperPolygons()};Ai._checkOutlineConflict=function(e){for(var t=Ai._fetchCopperAreaOfThisLayer(e.layerid),r=!1,n=0,i=t.length;n<i;n++){var a=t[n];if(a.net&&a.net!=e.net){var o=Ai.createPolygonFromPointArr(e.pointArr),s=Ai.createPolygonFromPointArr(a.pointArr),l=new ClipperLib.Polygons,c=new ClipperLib.Clipper,d=ClipperLib.PolyFillType.pftNonZero,h=ClipperLib.PolyFillType.pftNonZero;c.AddPolygons([o],ClipperLib.PolyType.ptSubject);c.AddPolygons([s],ClipperLib.PolyType.ptClip);c.Execute(ClipperLib.ClipType.ctIntersection,l,d,h);if(l.length>0){var u=Ai.zoomOutPoint(l[0][0]);parent.$.messager.show({title:"error",width:"400",msg:"CopperArea conflict: copper area outlines in same layer with different net names must not overlap",timeout:5e3,showType:"slide"});Ai._markError(u);r=!0;break}}}return r};Ai.resetActiveCopperPolygons=function(e){if(!e.net)return!1;Ai._clearanceWidth=e.clearanceWidth||1;Ai._copperNet=e.net;Ai._copperLayerId=e.layerid||Fn.TOPLAYER;Ai._padOrViaHasSameNetNameWithCopperArr=[];Ai._attachedCopperId=e.gId;Ai._copperThermal=e.thermal;Ai._copperKeepIsland=e.keepIsland;Ai._copperOutline=Ai.createPolygonFromPointArr(e.pointArr);var t=e.net+"_"+e.layerid;t in Ai.copperPolygons||(Ai.copperPolygons[t]={});Ai.copperPolygons[t][e.gId]=[];Ai._activeCopperPolygons=Ai.copperPolygons[t][e.gId];Ai._removeCopperZone();Ei.buildOneNet(Ai._copperNet,!1)};Ai.processOneCopperArea=function(e){!e.net&&e.gId&&Ai._removeCopperZone(e.gId);if(!e.net||Ai._checkOutlineConflict(e))return!1;Ai._boardOutlines=[];Ai.clearOldCopperPolygons();Ai.resetActiveCopperPolygons(e);if("none"==e.fillStyle){Ei.buildOneNet(Ai._copperNet,!1);return!1}var t=Ai._connectBoardOutlinesAsPolygon();if(!t)return!1;var r=Ai._buildCopperZoneOutline(Ai._copperOutline,t);if(!r)return!1;Ai._buildCopperZonesByClipper(r);Ai._showActiveCopperPolygons();Ei.buildOneNet(Ai._copperNet,!1)};Ai._addItemsToClipPolygons=function(){var e=[];Ai._boardOutlinesInFootprint=[];var t=pi.getAllObjsOf("PAD",!0),r=pi.getAllObjsOf("VIA",!0),n=pi.getAllObjsOf("HOLE",!0),i=pi.getAllObjsOf("TRACK",!0,!0),a=pi.getAllObjsOf("ARC",!0,!0),o=pi.getAllObjsOf("SOLIDREGION",!0,!0),s=pi.getAllObjsOf("TEXT",!0,!0),l=pi.getAllObjsOf("RECT",!0,!0),c=0,h=0;for(c=0,h=i.length;c<h;c++){var u=i[c];u.net!=Ai._copperNet&&Ai._isOnCopperLayer(u.layerid)&&e.push(Ai._transformTrackWithClearanceToPolygon(u))}for(c=0,h=a.length;c<h;c++){var p=a[c];p.net!=Ai._copperNet&&Ai._isOnCopperLayer(p.layerid)&&e.push(Ai._transformArcWithClearanceToPolygon(p))}for(c=0,h=s.length;c<h;c++){var f=s[c];if(Ai._isOnCopperLayer(f.layerid)){var g=ai.svg.getBBox(d(f.gId));e.push(Ai._transformRectWithClearanceToPolygon(g))}}for(c=0,h=l.length;c<h;c++){var y=l[c];Ai._isOnCopperLayer(y.layerid)&&e.push(Ai._transformRectWithClearanceToPolygon(y))}for(c=0,h=o.length;c<h;c++){var v=o[c];Ai._isOnCopperLayer(v.layerid)&&v.net!=Ai._copperNet&&e.push(Ai._transformPolygonWithClearanceToPolygon(v.pointArr))}var m=null;Ai._padOrViaHasSameNetNameWithCopperArr=[];for(c=0,h=r.length;c<h;c++){var x=r[c];if(x.net!=Ai._copperNet){m=Ai._transformPadOrViaWithClearanceToPolygon(x);m&&e.push(m)}else{var _={cmd:"VIA",fid:0,gId:x.gId,layerid:x.layerid,x:x.x,y:x.y};Ai._padOrViaHasSameNetNameWithCopperArr.push(_)}}var P=[];for(c=0,h=n.length;c<h;c++){m=Ai._transformHoleWithClearanceToPolygon(n[c]);m&&e.push(m)}for(c=0,h=t.length;c<h;c++){var S=t[c];!function(e,t,r,n){if(r.net==Ai._copperNet&&Ai._isOnCopperLayer(r.layerid)){var i={cmd:"PAD",fid:n,gId:r.gId,layerid:r.layerid,x:r.x,y:r.y};e.push(i)}Ai._isOnCopperLayer(r.layerid)&&t.push(r)}(Ai._padOrViaHasSameNetNameWithCopperArr,P,S)}P.forEach(function(t){m=Ai._transformPadOrViaWithClearanceToPolygon(t);"object"==typeof m&&m.forEach(function(t){e.push(t)})});return e};Ai._buildCopperZonesByClipper=function(e){var t=Ai._addItemsToClipPolygons(),r=new ClipperLib.Polygons,n=new ClipperLib.ExPolygons,i=new ClipperLib.Clipper;r.push(e);var a=ClipperLib.PolyFillType.pftNonZero,o=ClipperLib.PolyFillType.pftNonZero;i.AddPolygons(r,ClipperLib.PolyType.ptSubject);i.AddPolygons(t,ClipperLib.PolyType.ptClip);i.Execute(ClipperLib.ClipType.ctDifference,n,a,o);Ai._fixExPolygonsSolutions(n);Ai._createCopperPolygons(n)};Ai._fixExPolygonsSolutions=function(e){function t(e){for(var t=e[0].x,r=e[0].x,n=e[0].y,i=e[0].y,a=1;a<e.length;a++){var o=e[a];t=Math.min(o.x,t);r=Math.max(o.x,r);n=Math.min(o.y,n);i=Math.max(o.y,i)}return{minX:t,minY:n,maxX:r,maxY:i,w:r-t,h:i-n}}function r(e,t){return e.w<t.w||e.h<t.h?-1:1}function n(e,n,a,o){a=a||t(e);o=o||t(n);if(r(a,o)>0)return!1;for(var s=0,l=e.length;s<l;s++)if(i(e[s],n,o))return!0;return!1}function i(e,r,n){n=n||t(r);if(e.x<n.minX||e.x>n.maxX||e.y<n.minY||e.y>n.maxY)return!1;var i=!1,a=0,o=r.length-1;for(o;a<r.length;o=a++)r[a].y>e.y!=r[o].y>e.y&&e.x<(r[o].x-r[a].x)*(e.y-r[a].y)/(r[o].y-r[a].y)+r[a].x&&(i=!i);return i}if(!(e.length<2)){var a=e.map(function(e){return e.outer}),o=e.map(function(e){return t(e.outer)}),s=[].concat.apply([],e.map(function(e){return e.holes})),l=s.map(function(e){return t(e)}),c=[];s.forEach(function(e,t){if(e&&!(e.length<3)){for(var i=l[t],s=c[t],d=0,h=o.length;d<h;d++){var u=o[d];n(e,a[d],i,u)&&(void 0===s||r(u,o[s])<0)&&(s=d)}c[t]=s}});e.forEach(function(e,t){e.holes=[]});s.forEach(function(t,r){var n=c[r];void 0!==n&&e[n].holes.push(t)})}};Ai._createCopperPolygons=function(e){e.forEach(function(e){for(var t=[],r=0,n=Ai._padOrViaHasSameNetNameWithCopperArr.length;r<n;r++){var i=Ai._padOrViaHasSameNetNameWithCopperArr[r];if(i&&Ai.testPolygonContainsPoint(e,Ai.zoomInPoint(i))){t.push(i);delete Ai._padOrViaHasSameNetNameWithCopperArr[r]}}("yes"==Ai._copperKeepIsland||"none"==Ai._copperKeepIsland&&t.length>0)&&Ai._activeCopperPolygons.push({connectedPadOrViaArr:t,polygon:e})})};Ai.createPolygonFromPointArr=function(e){return e.map(Ai.zoomInPoint)};Ai.transformLineToOutlineBox=function(e,t){var r=null;r=ClipperLib.OffsetPolyline(e.map(Ai.zoomInPoint),Ai.zoomInOffsetVal(t));var n=[];if(r[0]&&r[0].length)for(var i=0,a=r[0].length;i<a;i++){var o=Ai.zoomOutPoint(r[0][i]);n.push(new c(o.x,o.y))}return n};Ai._transformTrackWithClearanceToPolygon=function(e){var t=null;t=ClipperLib.OffsetPolyline(e.pointArr.map(Ai.zoomInPoint),Ai.zoomInOffsetVal(Ai._clearanceWidth+e.strokeWidth/2));return t[0]};Ai._transformArcWithClearanceToPolygon=function(e){var t=Dr(e,!0),r=null;r=ClipperLib.OffsetPolyline(t,Ai.zoomInOffsetVal(Ai._clearanceWidth+e.strokeWidth/2));return r[0]};Ai._transformRectWithClearanceToPolygon=function(e){var t=ai.convertRect2Polygon(e.x,e.y,e.width,e.height).join(" ");return ClipperLib.OffsetPolygon(R(V(t)).map(Ai.zoomInPoint),Ai.zoomInOffsetVal(Ai._clearanceWidth))[0]};Ai._transformPolygonWithClearanceToPolygon=function(e){return ClipperLib.OffsetPolygon(e.map(Ai.zoomInPoint),Ai.zoomInOffsetVal(Ai._clearanceWidth))[0]};Ai._transformHoleWithClearanceToPolygon=function(e){var t=null;t=ClipperLib.OffsetPoint(Ai.zoomInPoint(e),Ai.zoomInOffsetVal(Ai._clearanceWidth+e.holeR));return t[0]};Ai._transformPadOrViaWithClearanceToPolygon=function(e){var t=!e.shape,r=null;if("ELLIPSE"==e.shape||t){var n=t?e.diameter/2:e.width/2;r=ClipperLib.OffsetPoint(Ai.zoomInPoint(e),Ai.zoomInOffsetVal(Ai._clearanceWidth+n))}else r=ClipperLib.OffsetPolygon((e.pointArr||[]).map(Ai.zoomInPoint),Ai.zoomInOffsetVal(Ai._clearanceWidth));return t?r[0]:"direct"==Ai._copperThermal?e.net==Ai._copperNet?[]:r:e.net==Ai._copperNet?Ai._createThermalReliefPadHoles(r,e):r};Ai._createThermalReliefPadHoles=function(e,t){var r=[];r.push(t.x-t.width/2-Ai._clearanceWidth,t.y,t.x+t.width/2+Ai._clearanceWidth,t.y,t.x,t.y-t.height/2-Ai._clearanceWidth,t.x,t.y+t.height/2+Ai._clearanceWidth);r=re(r,360-t.rotation,t.x,t.y);var n=ClipperLib.OffsetPolyline([{x:r[0],y:r[1]},{x:r[2],y:r[3]}].map(Ai.zoomInPoint),Ai.zoomInOffsetVal(.25*t.height)),i=ClipperLib.OffsetPolyline([{x:r[4],y:r[5]},{x:r[6],y:r[7]}].map(Ai.zoomInPoint),Ai.zoomInOffsetVal(.25*t.width)),a=[n[0],i[0]],o=e,s=new ClipperLib.Polygons,l=ClipperLib.PolyFillType.pftNonZero,c=ClipperLib.PolyFillType.pftNonZero,d=new ClipperLib.Clipper;d.AddPolygons(o,ClipperLib.PolyType.ptSubject);d.AddPolygons(a,ClipperLib.PolyType.ptClip);d.Execute(ClipperLib.ClipType.ctDifference,s,l,c);return s};Ai._createSimplePolygon=function(e,t,r){if(!e)return"";r=r||1;var n=Ue("polygon",{points:function(e){function t(e){return e*r}e=e.trim().replace(/[, ]+/g," ");e=e.split(" ").map(t).join(" ");return e}(e),"stroke-width":0,c_shapetype:"line",layerid:t});zi.appendElement(n);sentElementToBack(n)};Ai._convertContourPointsToPath=function(e){function t(e){return[e.x/Ai._scaleFactor,e.y/Ai._scaleFactor].join(",")}return"M"+e.map(t).join(" ")+"z"};Ai.showOrHideCopperZone=function(e){for(var t="invisible"==e?"none":"",r=h("path[attachedcopperid]",Gi),n=0,i=r.length;n<i;n++)m(r[n],"display",t)};Ai._showActiveCopperPolygons=function(){var e=Ai._activeCopperPolygons,t=[];e.forEach(function(e){var r=e.polygon;if(r){for(var n=Ai._convertContourPointsToPath(r.outer),i=0,a=r.holes.length;i<a;i++)r.holes[i]&&r.holes[i].length>=3&&(n+=Ai._convertContourPointsToPath(r.holes[i]));for(var o=Ai._copperLayerId,s=Ue("path",{id:ai.newId(),d:n,"stroke-width":0,layerid:o,attachedcopperid:Ai._attachedCopperId,c_shapetype:"line",display:"invisible"==bi.canvas.copperZone?"none":""}),l=d("layer_track_begin"),c=l,h=l.nextSibling;c=c.nextSibling;)if("layer_track_end"==c.id||m(c,"layerid")==o){h=c;break}Gi.insertBefore(s,h);var u=h.id;u?t.push(["add",s.id,u]):t.push(["add",s.id])}});zi.setActivePCBLayer(Ai._copperLayerId);t.length};Ai._removeCopperZone=function(e){e=e||Ai._attachedCopperId;for(var t=h('path[attachedcopperid="'+Ai._attachedCopperId+'"]',Gi),r=0,n=t.length;r<n;r++)Gi.removeChild(t[r])};Ai.switchDisplayCoppersAndOthers=function(e){for(var t=0,r=Gi.childNodes.length;t<r;t++){var n=Gi.childNodes[t];"all"==e?m(n,"display",""):m(n,"attachedcopperid")?m(n,"display","copper"==e?"":"none"):m(n,"display","copper"!=e?"":"none")}};Ai.testSimplyPolygonContainsPoint=function(e,t){for(var r=0,n=e.length,i=0,a=n-1;i<n;a=i++){var o=e[i].x,s=e[i].y,l=e[a].x,c=e[a].y;if(!(s>t.y&&c>t.y)&&!(s<=t.y&&c<=t.y)){l-=o;c-=s;t.x-o<(t.y-s)*l/c&&r++}}return r>0&&r%2==1};Ai.testPolygonContainsPoint=function(e,t){var r=Ai.testSimplyPolygonContainsPoint(e.outer,t);if(r){var n=e.holes.length;if(n>0)for(var i=0,a=n;i<a;i++)if(Ai.testSimplyPolygonContainsPoint(e.holes[i],t)){r=!1;break}}return r};Ai._collectionBoardOutlines=function(e){if(e.d){var t=Dr(e,!1);t&&Ai._boardOutlines.push({id:e.gId,pointArr:t,isConnected:!1})}else Ai._boardOutlines.push({id:e.gId,pointArr:e.pointArr,isConnected:!1})};Ai._connectBoardOutlinesAsPolygon=function(){function e(e){for(var t,r=null,n={d:1e5},i=0,o=a.length;i<o;i++){t=a[i];if(!t.isConnected){var s=Vi.distancePointToPoint(e,t.pointArr[0]);s<n.d&&(n={d:s,index:i,point:"start"});s=Vi.distancePointToPoint(e,t.pointArr[t.pointArr.length-1]);s<n.d&&(n={d:s,index:i,point:"end"})}}if(n.d<=p){t=a[n.index];t.isConnected=!0;r="start"==n.point?t.pointArr:t.pointArr.reverse()}return r}var t=pi.getAllObjsOf("TRACK",!0),r=pi.getAllObjsOf("ARC",!0);Ai._boardOutlines=[];var n=0,i=0;for(n=0,i=t.length;n<i;n++)t[n].layerid==Fn.BOARDOUTLINE&&Ai._collectionBoardOutlines(t[n]);for(n=0,i=r.length;n<i;n++)r[n].layerid==Fn.BOARDOUTLINE&&Ai._collectionBoardOutlines(r[n]);var a=Ai._boardOutlines;if(a.length<1){parent.$.messager.error("Please create board outline first.");return!1}!function(){for(var e={l:0},t=0,r=a.length;t<r;t++){var n=Vi.getLengthOfTrackAndArc(a[t],!1);if(n>e.l){e.l=n;e.index=t}}if(e.index>0){a.unshift(a[e.index]);a.splice(e.index+1,1)}}();var o=a[0].pointArr;a[0].isConnected=!0;for(var s,l,c=o,d=o[0],u=o[o.length-1],p=5,f=h('[layerid="'+Fn.BOARDOUTLINE+'"]').length;!function(){for(var e=!0,t=0,r=a.length;t<r;t++)if(!a[t].isConnected){e=!1;break}return e}();){s=e(u);s||(l=e(d));if(s){c=c.concat(s);u=s[s.length-1]}else{if(!l)break;c=l.reverse().concat(c);d=c[0]}}if(!(s||f>0&&a.length<f||1===a.length&&o.length>=4&&Vi.distancePointToPoint(o[0],o[o.length-1])<=p)){var g=u;if(Vi.distancePointToPoint(c[0],c[c.length-1])>p||1===a.length&&o.length>=4&&Vi.distancePointToPoint(o[0],o[o.length-1])>p){parent.$.messager.show({title:"Warning",width:"200",msg:"Board outlines are not closed",timeout:15e3,showType:"slide"});Ai._markError(g)}else parent.$.messager.show({title:"Warning",width:"250",msg:"EasyEDA does not allow inner board outlines to form cut-outs, please use Solid Region or Hole",timeout:15e3,showType:"slide"})}var y=new ClipperLib.Clipper,v=y.SimplifyPolygons([c.map(Ai.zoomInPoint)],ClipperLib.PolyFillType.pftNonZero);return Ai._findMaxPolygons(v,y)};Ai._findMaxPolygons=function(e,t){function r(e,r){return t.Area(e)>t.Area(r)?-1:1}return e.length<2?e[0]:e.sort(r)[0]};Ai.getPolygonBoardOutline=function(){var e=Ai._connectBoardOutlinesAsPolygon();if(e.length>0){var t,r,n=new ClipperLib.Polygons,i=[],a=pi.getAllObjsOf("SOLIDREGION",!0,!0);n.push(e);for(t=0,r=a.length;t<r;t++){var o=a[t];"npth"==o.type&&i.push(Ai._transformPolygonWithClearanceToPolygon(o.pointArr))}if(i.length>0){var s=new ClipperLib.ExPolygons,l=new ClipperLib.Clipper,c=ClipperLib.PolyFillType.pftNonZero,d=ClipperLib.PolyFillType.pftNonZero;l.AddPolygons(n,ClipperLib.PolyType.ptSubject);l.AddPolygons(i,ClipperLib.PolyType.ptClip);l.Execute(ClipperLib.ClipType.ctDifference,s,c,d);s=s[0];var h=Ai._convertContourPointsToPath(s.outer);for(t=0,r=s.holes.length;t<r;t++)h+=Ai._convertContourPointsToPath(s.holes[t]);return h}return Ai._convertContourPointsToPath(n[0])||""}return!1};Ai._buildCopperZoneOutline=function(e,t){var r=new ClipperLib.ExPolygons,n=new ClipperLib.Clipper,i=ClipperLib.PolyFillType.pftNonZero,a=ClipperLib.PolyFillType.pftNonZero;n.AddPolygons([e],ClipperLib.PolyType.ptSubject);n.AddPolygons([t],ClipperLib.PolyType.ptClip);n.Execute(ClipperLib.ClipType.ctIntersection,r,i,a);return!!r.length&&r[0].outer};Ai.isBuiltCopperArea=function(){for(var e in pi.gJsonCache.COPPERAREA)if(A(pi.gJsonCache.COPPERAREA,e)){var t=pi.gJsonCache.COPPERAREA[e],r=t.net+"_"+t.layerid;if(!Ai.copperPolygons[r]||!Ai.copperPolygons[r][t.gId]||!Ai.copperPolygons[r][t.gId].length)return!1}return!0};ui.ini=function(e){e=V(e);this.data[e]=1};ui.clear=function(){ui.data={}};ui.getNewPre=function(e){e=V(e);for(var t,r=e.toUpperCase(),n=1;;){t=r.replace("?",n++);if(!this.data[t]){this.data[t]=1;return t}}};a.registerHook({photoView:function(){return Ii.reset.apply(null,arguments)},getPhotoviewConfig:function(){return{side:Ii._side,silk:Ii._silk,color:Ii._color,solder:Ii._solder}}});Ii._colors={};Ii._side="topSide";Ii._silk="yes";Ii._color="green";Ii._solder="gold";Ii.init=function(){Gi.style.pointerEvents="none";Ii._colors.green={};Ii._colors.green[Fn.TOPLAYER]="#00BE00";Ii._colors.green[Fn.BOTTOMLAYER]="#00BE00";Ii._colors.green[Fn.BOARDOUTLINE]="#0B3B0B";Ii._colors.red={};Ii._colors.red[Fn.TOPLAYER]="#D90305";Ii._colors.red[Fn.BOTTOMLAYER]="#D90305";Ii._colors.red[Fn.BOARDOUTLINE]="#940300";Ii._colors.blue={};Ii._colors.blue[Fn.TOPLAYER]="#005CB6";Ii._colors.blue[Fn.BOTTOMLAYER]="#005CB6";Ii._colors.blue[Fn.BOARDOUTLINE]="#002966";Ii._colors.yellow={};Ii._colors.yellow[Fn.TOPLAYER]="#EEEE00";Ii._colors.yellow[Fn.BOTTOMLAYER]="#EEEE00";Ii._colors.yellow[Fn.BOARDOUTLINE]="#B8AC00";Ii._colors.black={};Ii._colors.black[Fn.TOPLAYER]="#000000";Ii._colors.black[Fn.BOTTOMLAYER]="#000000";Ii._colors.black[Fn.BOARDOUTLINE]="#101010";Ii._colors.purple={};Ii._colors.purple[Fn.TOPLAYER]="#7A0956";Ii._colors.purple[Fn.BOTTOMLAYER]="#7A0956";Ii._colors.purple[Fn.BOARDOUTLINE]="#19001E";Ii._colors.copper={};Ii._colors.copper[Fn.TOPLAYER]="#F7A456";Ii._colors.copper[Fn.BOTTOMLAYER]="#F7A456";Ii._colors.copper[Fn.BOARDOUTLINE]="#686048";pi.gJsonCache.layers[Fn.TOPSOLDERLAYER].color="#DCAA14";pi.gJsonCache.layers[Fn.TOPSOLDERLAYER].config=!0;pi.gJsonCache.layers[Fn.TOPSOLDERLAYER].darkColor="";pi.gJsonCache.layers[Fn.TOPSOLDERLAYER].visible=!0;pi.gJsonCache.layers[Fn.BOTTOMSOLDERLAYER].color="#DCAA14";pi.gJsonCache.layers[Fn.BOTTOMSOLDERLAYER].config=!0;pi.gJsonCache.layers[Fn.BOTTOMSOLDERLAYER].darkColor="";pi.gJsonCache.layers[Fn.BOTTOMSOLDERLAYER].visible=!0;pi.gJsonCache.layers[Fn.TOPSILKLAYER].color="#FFFFFF";pi.gJsonCache.layers[Fn.BOTTOMSILKLAYER].color="#FFFFFF";pi.gJsonCache.systemColor.hole="#111111";pi.gJsonCache.systemColor.background="#111111";m(d("gridBg"),{fill:"#111111"});zi.updateFront();zi.show(Fn.TOPSOLDERLAYER);zi.show(Fn.BOTTOMSOLDERLAYER);Ii._changeColorConfig("green")};Ii._changeColorConfig=function(e){for(var t in Ii._colors[e])if(A(Ii._colors[e],t)){pi.gJsonCache.layers[t].color=Ii._colors[e][t];pi.gJsonCache.layers[t].darkColor=""}zi.updateFront();zi.initByCache()};Ii.reset=function(e){if(e){var t="_"+e.split("_")[0],r=e.split("_")[1];Ii[t]&&Ii[t](r)}};Ii._changeSide=function(e){for(var t=Gi.getBBox()||{};Gi.firstChild;)li.appendChild(Gi.firstChild);var r,n,i="topSide"==e?[Fn.BOARDOUTLINE,Fn.TOPLAYER,Fn.TOPSILKLAYER,Fn.TOPSOLDERLAYER]:[Fn.BOARDOUTLINE,Fn.BOTTOMLAYER,Fn.BOTTOMSILKLAYER,Fn.BOTTOMSOLDERLAYER],a=[];i.forEach(function(e){for(r=0,n=li.childNodes.length;r<n;r++)m(li.childNodes[r],"layerid")==e&&a.push(li.childNodes[r])});for(r=0,n=a.length;r<n;r++)Gi.appendChild(a[r]);var o;if("topSide"==e){o="";Ii._side="topSide"}else{o="matrix(-1, 0, 0, 1, "+(2*t.x+t.width)+", 0)";Ii._side="bottomSide"}m(Gi,"transform",o);Ii._activeSilkLayer();jr()};Ii._activeSilkLayer=function(){zi.setActivePCBLayer("topSide"==Ii._side?Fn.TOPSILKLAYER:Fn.BOTTOMSILKLAYER)};Ii._changeSilk=function(e){Ii._silk=e;pi.gJsonCache.layers[Fn.TOPSILKLAYER].visible="yes"==e;pi.gJsonCache.layers[Fn.BOTTOMSILKLAYER].visible="yes"==e;zi.initByCache();Ii._activeSilkLayer()};Ii._changeColor=function(e){Ii._color=e;Ii._changeColorConfig(e);Ii._activeSilkLayer()};Ii._changeSolder=function(e){Ii._solder=e;pi.gJsonCache.layers[Fn.BOTTOMSOLDERLAYER].darkColor="";pi.gJsonCache.layers[Fn.TOPSOLDERLAYER].darkColor="";if("silver"==e){pi.gJsonCache.layers[Fn.TOPSOLDERLAYER].color="#D2D2D2";pi.gJsonCache.layers[Fn.BOTTOMSOLDERLAYER].color="#D2D2D2"}else{pi.gJsonCache.layers[Fn.TOPSOLDERLAYER].color="#DCAA14";pi.gJsonCache.layers[Fn.BOTTOMSOLDERLAYER].color="#DCAA14"}zi.updateFront();zi.initByCache();Ii._activeSilkLayer()};var Ki="    ",Wi="\n",qi="      ",$i={};$i.jointPoints=function(e){var t=0,r=0,n=[];for(t=0,r=e.length;t<r;t++){n.push(ai.toFixed(e[t].x*$i.scale,0));n.push(ai.toFixed(e[t].y*$i.scale,0))}return n.join(" ")};$i.init=function(){$i.layers=$i.config.routerLayers.length?$i.config.routerLayers:[Fn.TOPLAYER];$i.scale=100;$i.pads=pi.getAllObjsOf("PAD",!0);$i.vias=pi.getAllObjsOf("VIA",!0);$i.tracks=pi.getAllObjsOf("TRACK",!0,!0);var e=pi.getAllObjsOf("TEXT",!0,!0);if(e.length)for(i=0,l=e.length;i<l;i++){var t=e[i],r=ai.svg.getBBox(d(t.gId)),n=+t.strokeWidth;$i.pads.push({gId:t.gId,shape:"POLYGON",pointArr:R(ai.convertRect2Polygon(r.x-n/2,r.y-n/2,r.width+n,r.height+n).join(",")),layerid:t.layerid,net:""})}$i.pads=$i.pads.concat(pi.getAllObjsOf("SOLIDREGION",!0,!0));$i.tracks=$i.tracks.concat(pi.getAllObjsOf("ARC",!0,!0));pi.getAllObjsOf("HOLE",!0).forEach(function(e){e.diameter=2*e.holeR;$i.vias.push(e)});$i.viaStack={}};$i.exportDSN=function(e){pi.gJsonCache;$i.config=e||{};$i.init();var t=ai.units.convert(parseFloat($i.config.width,10)||6,Hr($i.config.width,bi.canvas.unit),"mil")*($i.scale/10),r=ai.units.convert(parseFloat($i.config.clearance,10)||10,Hr($i.config.clearance,bi.canvas.unit),"mil")*($i.scale/10),n=ai.units.convert(parseFloat($i.config.smdClearance,10)||6,Hr($i.config.smdClearance,bi.canvas.unit),"mil")*($i.scale/10);if(!$i.isOKPCBForAutorouter()){parent.$.messager.error("Please make sure all components are inside the board outline!");return!1}var i=$i.createStructure(r,t,n);return!(!i||!$i.pads.length)&&"(PCB ''"+Wi+"  (resolution mil 10)"+Wi+i+Wi+$i.createPlace()+Wi+$i.createLibrary()+Wi+$i.createNetwork()+Wi+$i.createWiring()+Wi+")"};$i.createPlace=function(){var e="  (placement"+Wi;e+=$i.createComponent()+Wi;e+="  )";return e};$i.createComponent=function(){var e=Ki+"(component u1"+Wi;e+=qi+"(place u1 0 0 front 0"+Wi;e+=qi+")"+Wi;e+=Ki+")"+Wi;return e};$i.createLibrary=function(){var e=ai.units.convert(parseFloat($i.config.viaDiameter,10)||3.2,Hr($i.config.viaDiameter,bi.canvas.unit),"mil")/($i.scale/10),t="  (library"+Wi;t+=$i.createImage()+Wi;t+=$i.createViaStack(e)+Wi;t+=$i.createAllPadStack()+Wi;t+="  )";return t};$i.createImage=function(){var e=Ki+"(image u1"+Wi;$i.pads.forEach(function(t){if(t.layerid==Fn.ALL||-1!=$i.layers.indexOf(+t.layerid)){var r=$i.remove_gge(t.gId);e+=qi+"(pin p"+r+" "+r+" 0 0)"+Wi}});e+=Ki+")"+Wi;return e};$i.createAllPadStack=function(){var e=[];$i.pads.forEach(function(t){t.layerid!=Fn.ALL&&-1==$i.layers.indexOf(+t.layerid)||e.push($i.createPadStack(t))});return e.join(Wi)};$i.createPadStack=function(e){var t=Ki+"(padstack p"+$i.remove_gge(e.gId)+Wi;if("ELLIPSE"==e.shape){var r=" "+e.x*$i.scale+" "+e.y*$i.scale;e.layerid==Fn.ALL?$i.layers.forEach(function(n){t+=qi+"(shape(circle "+n+" "+e.width*$i.scale+r+"))"+Wi}):t+=qi+"(shape(circle "+e.layerid+" "+e.width*$i.scale+r+"))"+Wi}else{var n=$i.jointPoints(e.pointArr);e.layerid==Fn.ALL?$i.layers.forEach(function(e){t+=qi+"(shape(polygon "+e+" 10 "+n+"))"+Wi}):t+=qi+"(shape(polygon "+e.layerid+" 10 "+n+"))"+Wi}return t+Ki+")"};$i.netClass=function(){var e=""
;"object"==typeof $i.config.netClass&&$i.config.netClass.forEach(function(t){var r=ai.units.convert(parseFloat(t.width,10)||6,Hr(t.width,bi.canvas.unit),"mil"),n=ai.units.convert(parseFloat(t.clearance,10)||10,Hr(t.clearance,bi.canvas.unit),"mil");e+=Ki+"(class "+t.net+" "+t.net+Wi+qi+"(rule "+Wi+"        (width "+r*$i.scale/10+")"+Wi+"        (clearance "+n*$i.scale/10+")"+Wi+qi+")"+Wi+Ki+")"+Wi});return e};$i.createNetwork=function(){var e,t=pi.gJsonCache.SIGNALS,r=new RegExp("[^\0-]","g"),n="",i=[],a=$i.config.skipNets.split(" ")||[];for(var o in t)if(A(t,o)&&o){if(-1!=a.indexOf(o))continue;e=o;-1!==o.indexOf("(")&&(e=e.replace("(","%LPAREN%"));-1!==o.indexOf(")")&&(e=e.replace(")","%RPAREN%"));r.test(e)&&(e=e.replace(r,function(e){return"%U"+e.codePointAt().toString(16)+"%"}));n=Ki+"(net "+e+Wi;n+=qi+"(pins "+$i.connectPins(o)+")"+Wi;n+=Ki+")";i.push(n)}return"  (network"+Wi+i.join(Wi)+Wi+$i.netClass()+Wi+"  )"+Wi};$i.connectPins=function(e){var t=[];$i.pads.forEach(function(r){r.net==e&&t.push("u1-"+$i.remove_gge(r.gId))});return t.join(" ")};$i.createWiring=function(){function e(e){var t=Ki+"(wire(path "+e.layerid+" "+$i.scale*e.strokeWidth+" "+$i.jointPoints(e.pointArr)+" )"+Wi;t+=qi+"(net "+e.net+")"+Wi;t+=qi+"(type protect)"+Wi;t+=Ki+")"+Wi;return t}function t(e){var t="via"+$i.viaStack[e.diameter];return Ki+"(via "+t+" "+$i.jointPoints([e])+Wi+qi+"(net "+e.net+")"+Wi+qi+"(type protect)"+Wi+Ki+")"+Wi}var r="   (wiring"+Wi;$i.tracks.forEach(function(t){for(var n=t.pointArr,i=0,a=1;a<n.length;a++){i+=Math.sqrt(Math.pow(n[a].x-n[a-1].x,2)+Math.pow(n[a].y-n[a-1].y,2));if(i>=1&&-1!=$i.layers.indexOf(+t.layerid)){r+=e(t);break}}});$i.vias.forEach(function(e){r+=t(e)});r+=Ki+")"+Wi;return r};$i.remove_gge=function(e){return(e||"").replace("gge","")};$i.createViaStack=function(e){var t="",r=0;e?$i.viaStack[e]=r:$i.viaStack[2.8]=r;r++;for(var n=0,i=$i.vias.length;n<i;n++)void 0===$i.viaStack[$i.vias[n].diameter]&&($i.viaStack[$i.vias[n].diameter]=r++);r=0;for(var a in $i.viaStack)A($i.viaStack,a)&&(t+=Ki+"(padstack via"+$i.viaStack[a]+Wi+function(e){var t="";$i.layers.forEach(function(r){t+=qi+"(shape(circle "+r+" "+$i.scale*e+"))"+Wi});return t}(a)+Ki+")"+Wi);return t};$i._getBoardOutlinePointStr=function(){var e=Ai.getPolygonBoardOutline();if(e){e=e.split("zM")[0];return e.replace(/[^0-9\- ,\.]/g,"")}return""};$i.createStructure=function(e,t,r){var n=$i._getBoardOutlinePointStr();if(!n)return!1;r=r||62;var i=R(n),a=Ki+"(boundary(path signal 0 "+$i.jointPoints(i)+" )"+Wi;a+=Ki+")"+Wi;return"  (structure"+Wi+a+Ki+"(via  via0"+Wi+Ki+")"+Wi+Ki+"(grid via   25)"+Wi+Ki+"(grid wire   25)"+Wi+Ki+"(grid place   25)"+Wi+Ki+"(rule(clear "+e+"))"+Wi+Ki+"(rule(clear "+r+" (type default_smd)))"+Wi+Ki+"(rule(clear "+r+" (type smd_smd)))"+Wi+Ki+"(rule(width "+t+"))"+Wi+function(){var e="";$i.layers.forEach(function(t){e+=Ki+"(layer "+t+Wi+qi+"(type signal)"+Wi+Ki+")"+Wi});return e}()+Wi+"  )"+Wi};$i.isOKPCBForAutorouter=function(){var e=Rr();if(e.width<1||e.height<1)return!1;for(var t=pi.getAllObjsOf("PAD",!0),r=0;r<t.length;r++)if(!function(t){return t.x>e.x&&t.x<e.x+e.width&&t.y>e.y&&t.y<e.y+e.height}(t[r]))return!1;return!0};$i.importSession=function(){function e(){pi.calAll();pi.buildSignals();Ei.removeAllRatline();a=setTimeout(function(){a=0;Ei.buildAllNet();o=setTimeout(function(){o=0;Ai.rebuildCopperArea();zi.setActivePCBLayer(Fn.TOPLAYER);i=!1;h=null;c.length&&Pi.save(c);Pi.saveBatch()},0)},0)}function t(e){var t;for(var r in e)if(A(e,r)){var n=(e[r].net,e[r].wires),i=e[r].vias;for(var a in n)if(A(n,a)){var o=n[a];t=o.id&&v(d(o.id));t&&s.push(t)}for(a in i)if(A(i,a)){var c=i[a];t=c.id&&v(d(c.id));t&&l.push(t)}}}function r(e){h&&t(h);var r=e.viaObj||{};delete e.viaObj;r.viaDiameter=ai.units.convert(parseFloat(r.viaDiameter,10)||28,Hr(r.viaDiameter,bi.canvas.unit),"pixel");r.viaHoleD=ai.units.convert(parseFloat(r.viaHoleD,10)||14,Hr(r.viaHoleD,bi.canvas.unit),"pixel");var n=r.viaDiameter/2,i=r.viaHoleD/2,a=d("part_via").cloneNode(!0);m(a.childNodes[0],"r",n);m(a.childNodes[1],"r",i);m(a,"display","");var o=zi.get("other_end"),p=zi.get("track_end"),f={},g=new RegExp("%U[0-9a-f]{1,5}%","g");for(var y in e)if(A(e,y)){var v=e[y].net,x=e[y].wires||{},_=e[y].vias||{};-1!==v.indexOf("%LPAREN%")&&(v=v.replace("%LPAREN%","("));-1!==v.indexOf("%RPAREN%")&&(v=v.replace("%RPAREN%",")"));g.test(v)&&(v=v.replace(g,function(e){var t,r=e.replace("%","").replace("U","");try{t=String.fromCodePoint(parseInt(r,16))}catch(e){t=""}return t}));for(var P in x)if(A(x,P)){var S=x[P],b={id:ai.newId(),fill:"none","stroke-width":S.width,layerid:S.layerid,c_shapetype:"line",c_etype:"wire",net:v,points:S.points.join(" ")},C=s.pop()||Ue("polyline");m(C,b);var I=S.layerid;f[I]||(f[I]=u('#g1 > polyline[layerid="'+I+'"]'));if(f[I]){Gi.insertBefore(C,f[I]);c.push(["add",C.id,f[I].id])}else{f[I]=C;Gi.insertBefore(C,p);c.push(["add",C.id,p.id])}S.id=C.id}for(P in _)if(A(_,P)){var L=_[P],E=l.pop();if(E){m(E.childNodes[0],"r",n);m(E.childNodes[1],"r",i)}else E=a.cloneNode(!0);m(E.childNodes[0],{cx:L.x,cy:L.y});m(E.childNodes[1],{cx:L.x,cy:L.y});m(E,"net",v);m(E,"id",ai.newId());Gi.insertBefore(E,o);L.id=E.id;c.push(["add",E.id,o.id])}}h=e}function n(t,n,a){if(i){if("start"==n){parent.$.messager.error("Cannot start again before previous activity is stopped");return}}else{if("start"!=n)return;i=!0;h=null;Pi.startBatch();cr(a);Ei.removeAllRatline()}c.length=0;var o="string"==typeof t?I(t):t;o&&r(o);"end"==n&&e()}var i=!1,a=0,o=0,s=[],l=[],c=[],h=null;return n}();var Qi=e.frameElement?e.frameElement.getAttribute("c_doctype"):"3",Zi=d("gMeasureLine");d("gMark");!function(){a.registerHook({gCanvas:function(){return Gi},getLogs:function(){return Pi.getLogs()},selectedObj:function(){return Kt()},setCustomPara:function(e,t){var r=Xt();return Ge(1===r.length?r[0]:Gi,e,t)},setPinMap:function(){return setPinMap.apply(null,arguments)},importDocEdit:function(){return an.apply(null,arguments)},importPart:function(){return on.apply(null,arguments)},importModule:function(){return sn.apply(null,arguments)},importShape:function(){return ln.apply(null,arguments)},placePart:function(e){return En(e)},drawShape:function(e){return On(e)},updateShape:function(){return Tn.apply(null,arguments)},setToolbarCmd:function(){return yt.apply(null,arguments)},zoom:function(){return St.apply(null,arguments)},getDocStatus:function(){return bt.apply(null,arguments)},getViewStatus:function(){return $e()},getCanvas:function(){return fn()},getBBox:function(){var t;try{t=Gi.getBBox()}catch(n){var r=e.frameElement.parentNode;if("none"!=r.style.display)throw"getBBox error";r.style.display="";try{t=Gi.getBBox()}catch(e){}r.style.display="none"}if(t)return{x:ai.toFixed(t.x,1),y:ai.toFixed(t.y,1),width:ai.toFixed(t.width,1),height:ai.toFixed(t.height,1)}},getPackage:function(){return ai.c_paraToJson(m(Gi,"c_para")).package},getComponents:function(){return It()},findComponent:function(e){Lt(e)},getPadsByFootprintId:function(e){return tr(e)},updateSaveIndex:function(){Pi.savedIndex=Pi.index},checkPrefixNames:function(e,t){if(!e||!e.length)return!1;var r,n,i,a,o=t||pi.gJsonCache;if(o.schlib){r=o.schlib;n="annotation";i="mark";a=Dn.SCH}else{if(!o.FOOTPRINT)return;r=o.FOOTPRINT;n="TEXT";i="type";a=Dn.PCB}for(var s in r)if(A(r,s)){var l=r[s][n];for(var c in l)if(A(l,c)){var d=l[c];if("P"==d[i]&&-1!==e.indexOf(a===Dn.PCB?d.text:d.string.split(".")[0]))return!0}}return!1},setSymbolInfo:function(e){ze(e)},groupSymbol:function(){return zt.apply(null,arguments)},saveHistory:function(e){Pi.save(e)},undo:function(){Yi.started&&Yi.dots.length||si.on&&si.waitingSave||Xr()||(Qi==Dn.SCH||Qi==Dn.SUBCKT?tt("project_undo"):Pi.go(-1))},redo:function(){Yi.started&&Yi.dots.length||si.on&&si.waitingSave||Xr()||(Qi==Dn.SCH||Qi==Dn.SUBCKT?tt("project_redo"):Pi.go(1))},sheet_undo:function(){Yi.started&&Yi.dots.length||si.on&&si.waitingSave||Xr()||Pi.go(-1)},sheet_redo:function(){Yi.started&&Yi.dots.length||si.on&&si.waitingSave||Xr()||Pi.go(1)},cut:function(){!Xr()&&Rt()},copy:function(){!Xr()&&Nt()},paste:function(){!Xr()&&Bt()},paste_xdoc:function(){!Xr()&&Bt()},clone:function(){var e=arguments[0];if("object"==typeof e&&e.ids){var t=e.ids;if(!Array.isArray(t))return;var r=t.map(function(e){return d(e)});r=r.filter(function(e){return e&&e.parentNode==Gi});if(r.length)return Vt(r)}},select_all:function(){!Xr()&&qt()},select_none:function(){Ct()},getSelectedIds:function(){return ht()},select:function(){var e=arguments[0];if("object"==typeof e&&e.ids){var t=e.ids;if(!Array.isArray(t))return;var r=t.map(function(e){return d(e)});r=r.filter(function(e){return e&&e.parentNode==Gi});if(r.length)return selectObjs(r)}},clear_canvas:function(){Ui.clear()},move:function(){Ot.apply(null,arguments)},moveTo:function(){Tt.apply(null,arguments)},drag:function(){},bring_to_front:function(){jt()},send_to_back:function(){Ut()},align_left:function(e){Ft("align_left",e)},align_right:function(e){Ft("align_right",e)},align_top:function(e){Ft("align_top",e)},align_bottom:function(e){Ft("align_bottom",e)},align_horizontal_center:function(e){Ft("align_horizontal_center",e)},align_vertical_center:function(e){Ft("align_vertical_center",e)},align_horizontal_equidistant:function(e){Ft("align_horizontal_equidistant",e)},align_vertical_equidistant:function(e){Ft("align_vertical_equidistant",e)},align_left_side_edge_equidistant:function(e){Ft("align_left_side_edge_equidistant",e)},align_top_side_edge_equidistant:function(e){Ft("align_top_side_edge_equidistant",e)},align_grid:function(e){Ft("align_grid",e)},rotate_left:function(){var e=arguments[0];"object"==typeof e&&e.ids?a("rotate",[{ids:e.ids,degree:270}]):a("rotate",[270])},rotate_right:function(){var e=arguments[0];"object"==typeof e&&e.ids?a("rotate",[{ids:e.ids,degree:90}]):a("rotate",[90])},fliph:function(){var e,t=arguments[0];if("object"==typeof t&&t.ids){e=t.ids;if(!Array.isArray(e))return;var r=e.map(function(e){return d(e)});r=r.filter(function(e){return e&&e.parentNode==Gi});r.length&&Gt(1,r)}else Gt(1)},flipv:function(){var e,t=arguments[0];if("object"==typeof t&&t.ids){e=t.ids;if(!Array.isArray(e))return;var r=e.map(function(e){return d(e)});r=r.filter(function(e){return e&&e.parentNode==Gi});r.length&&Gt(0,r)}else Gt(0)},lock:function(){Mi.lockSelectedObjs.apply(null,arguments)},fitview:function(){Ve()},cross_cursor:function(e){!1===e&&lt(!1)},canvas_config:function(){return L(bi.canvas)},getConfig:function(){return L(bi)},attrpanel_apply:function(e,t,r,n){yn(e,t,r,n)},attrpanel_data:function(){return mn()},getCanvasAttr:function(){return Ui.getCanvasAttrs()},size:function(){return{width:+m(fi,"width"),height:+m(fi,"height")}},currZoom:function(){return di},getSelected:function(){return Xt()},getSelectedObjs:function(){return Xt(!0)},deletePathNode:function(e){e&&$t(e.targetId)},editorShowAttrDialog:function(){pt()},updatePackageUuid:function(e,t){if(e&&Object.keys(e).length){var r,n,i,a=pi.gJsonCache,o=a.schlib||a.FOOTPRINT;for(i in e)if(A(e,i))for(r in o)if(A(o,r)&&!r.match(/frame_lib_/)){n=ai.c_paraToJson(o[r].head.c_para);if(n.package==i)if(t==Dn.PCB||t==Dn.PCBMODULE){o[r].head.uuid=e[i].uuid;o[r].head.utime=e[i].updateTime||"";m(d(r),{uuid:e[i].uuid,utime:e[i].updateTime||""})}else{o[r].head.puuid=e[i].uuid;m(d(r),{puuid:e[i].uuid})}}a.head.hasIdFlag=!0}},getNearestGridPoint:function(){return W(arguments[0],arguments[1])},dragMoveSwitch:Wr,dragMoveCheck:qr,getSnappedPoint:Ie});e.addEventListener("error",ai.reportError,!1);tt("triggerEvent",["history_change",0,-1]);Ur()}();a.registerHook({getSVG:function(){var e=pi.gJsonCache.systemColor.background,t=pi.gJsonCache.systemColor.hole,r=pi.gJsonCache.layers,n=a("getBBox"),i=n.x-50|0,o=n.y-50|0,s=0|Math.max(n.width+100,100),l=0|Math.max(n.height+100,100);return'<?xml version="1.0" encoding="utf-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+s+'" height="'+l+'" viewBox="'+i+" "+o+" "+s+" "+l+'"><title>'+D(tt("getTitle"))+'</title><style type="text/css">\npath, polyline, polygon {stroke-linejoin:round;}\npath, polyline, polygon, line {stroke-linecap:round;}\nrect, circle, ellipse, polyline, polygon, line, path {shape-rendering:crispEdges;}\n'+function(e){for(var t=[],r=0;r<=24;r++)9!=r?e[r]&&e[r].color?t.push('*[layerid="'+r+'"] {stroke:'+e[r].color+"; fill:"+e[r].color+";}"):t.push('*[layerid="'+r+'"] {stroke:#FFFFFF; FILL:#FFFFFF;}'):t.push('*[layerid="'+r+'"] {display:none}');return t.join("")}(r)+'*[fill="none"] {fill: none;}\n*[stroke="none"] {stroke: none;}\ng[c_partid="part_pad"] > * + circle {fill: '+t+';}\ng[c_partid="part_via"] > * + circle {fill: '+t+';}\ng[c_partid="part_pad"] > polyline:nth-child(2) {stroke: '+t+';}</style>\n<rect x="'+i+'" y="'+o+'" width="'+s+'" height="'+l+'" fill="'+e+'" stroke="none"/>'+function(){if("undefined"!=typeof XMLSerializer){var e=(new XMLSerializer).serializeToString(Gi);e.search(/[^\x00-\x7f]/)>=0&&(e=e.replace(/[^\x00-\x7f]/g,function(e){return"&#"+e.charCodeAt(0)+";"}));e=e.replace(/<circle [^>]*c_pindot="true"[^>]*(?:\/>|><\/circle>)/g,"").replace(/<rect [^>]*class="hitbox"[^>]*(?:\/>|><\/rect>)/g,"").replace(/<g(\s[^>]*)?\/>/g,"").replace(/ xmlns="http:\/\/www\.w3\.org\/2000\/svg"/g,"").replace(/ xmlns:xlink="http:\/\/www\.w3\.org\/1999\/xlink"/g,"");for(var t=["id","class","title","net","number"],r=0;r<t.length;r++)for(var n=new RegExp("(<\\w+[^>]*)\\s"+t[r]+'=\\"[^\\"]*\\"',"g");n.test(e);)e=e.replace(n,"$1");e=e.replace(/<g\s*>\s*<\/g>/g,"");e=e.replace(/( xlink:href=")(\/\/)/g,"$1"+location.protocol+"$2");e=e.replace(/( xlink:href=")(\/[^\/"][^"]*)/g,"$1"+location.protocol+"//"+location.host+"$2");return e}return"gCanvasToXML error! "}()+"</svg>"},updateLibCanvasAttr:function(e){m(d("g1"),"c_para",e)},updateJsonCache:function(e){pi.gJsonCache=e},gJsonCache:function(e){if(e&&(e.id||e.gId)){var t=d(e.id||e.gId);if(!t)return;var r=e.cmdKey||ai.getPCBCmdKey(t),n=pi.gJsonCache[r];return n&&n[e.id]}pi.gJsonCache.head.docType=Qi;pi.gJsonCache.head.c_para=m(Gi,"c_para");pi.gJsonCache.BBox=a("getBBox");pi.gJsonCache.canvas=fn();pi.gJsonCache.itemOrder=O();return L(pi.gJsonCache)},highlightItems:function(){return at.apply(null,arguments)},crossProbe:function(e,r){if(e&&0!==e.length){Ct();for(var n=[],i=[],o=0;o<e.length;o++){for(var s,l,c=e[o].pre,d=h("#g1>g>g path[c_note]",Gi),u=0;u<d.length;u++){l=m(d[u],"c_text");if(V(l||"").toUpperCase()==c.toUpperCase()){s=d[u].parentNode.parentNode;if(-1!==n.indexOf(s))break;n.push(s);i.push({rotation:e[o].rotation,x:e[o].x,y:e[o].y});break}}s&&p(s,"selected",!0)}if(r){Ve();if(!n.length)return;t.addEventListener("mousemove",function e(r){t.removeEventListener("mousemove",e,!1);var o,s,l=n.map(function(e,t){return{x:Number(i[t].x),y:Number(i[t].y),rotation:Number(i[t].rotation)||0,node:e}}),c=Qe(r,!1),d=0,h=0,u=0,p=0,f=0,g=0,y=[];for(s=0;s<i.length;s++){d+=Number(i[s].x);h+=Number(i[s].y)}d/=i.length;h/=i.length;for(s=0;s<l.length;s++){o=Ce(l[s].node);p=Number(m(l[s].node,"c_rotation"))||0;if(p!=l[s].rotation){u=oe(360-(parseInt(l[s].rotation,10)-parseInt(p,10)));Ri.rotate(l[s].node,u)}f=l[s].x-d+c.x;g=l[s].y-h+c.y;Ee(l[s].node,f-o.x,g-o.y);y.push({id:l[s].node.id,offsetX:f-o.x,offsetY:g-o.y})}si.crossProbePlaceMoves=y;Wr(!0);a("dragMoveCheck",[r,n])},!1)}else{if(1==n.length)Re(s);else if(n.length>1){var f=n.map(function(e){return ai.svg.getBBox(e)}),g=ai.combineMultiBox(f);g&&Ne(g)}tt("triggerEvent",["select_change"])}}},globalDelete:function(e){var t,r=[];e.deleteCopperArea&&(t=pi.gJsonCache.COPPERAREA)&&(r=r.concat(Object.keys(t).map(function(e){return d(e)})));e.deleteText&&(t=pi.gJsonCache.TEXT)&&(r=r.concat(Object.keys(t).map(function(e){return d(e)})));if(e.deleteBoardOutlines){var n=h('[layerid="'+Fn.BOARDOUTLINE+'"]');0!==n.length&&(r=r.concat(Array.prototype.slice.call(n)))}if(e.deleteDrawings){var i=pi.gJsonCache.ARC,a=pi.gJsonCache.CIRCLE,o=pi.gJsonCache.DIMENSION,s=pi.gJsonCache.HOLE,l=pi.gJsonCache.PAD,c=pi.gJsonCache.RECT,u=pi.gJsonCache.SOLIDREGION,p=pi.gJsonCache.SVGNODE,f=pi.gJsonCache.VIA;i&&(r=r.concat(Object.keys(i).map(function(e){return d(e)}).filter(function(e){var t=m(e,"layerid");return t!=Fn.BOARDOUTLINE&&!Mr(t)})));a&&(r=r.concat(Object.keys(a).map(function(e){return d(e)})));o&&(r=r.concat(Object.keys(o).map(function(e){return d(e)})));s&&(r=r.concat(Object.keys(s).map(function(e){return d(e)})));l&&(r=r.concat(Object.keys(l).map(function(e){return d(e)})));c&&(r=r.concat(Object.keys(c).map(function(e){return d(e)})));u&&(r=r.concat(Object.keys(u).map(function(e){return d(e)})));p&&(r=r.concat(Object.keys(p).map(function(e){return d(e)})));f&&(r=r.concat(Object.keys(f).map(function(e){return d(e)}).filter(function(e){return""===m(e,"net")})))}e.deleteFootprints&&(t=pi.gJsonCache.FOOTPRINT)&&(r=r.concat(Object.keys(t).map(function(e){return d(e)})));if(e.deleteTracks&&(t=pi.gJsonCache.TRACK)){r=r.concat(Object.keys(t).map(function(e){return d(e)}).filter(function(e){return m(e,"layerid")!=Fn.BOARDOUTLINE}));var g=pi.gJsonCache.VIA;g&&(r=r.concat(Object.keys(g).filter(function(e){return Mr(g[e].layerid)&&""!==g[e].net}).map(function(e){return d(e)})));var y=pi.gJsonCache.ARC;y&&(r=r.concat(Object.keys(y).filter(function(e){return Mr(y[e].layerid)}).map(function(e){return d(e)})))}r.length&&wt(r)},getSelectPrefixNames:function(){var e=Xt(),t=pi.gJsonCache.FOOTPRINT,r=[];if(t)for(var n=0;n<e.length;n++){var i=e[n].id,a=t[i],o=a?a.TEXT:"";if(o)for(var s in o)if(A(o,s)){var l=o[s];"P"==l.type&&r.push({pre:l.text})}}return r},delete:function(){if(Yi.started&&Yi.canBackStep())Yi.backStep();else if(!Xr()){var e,t=arguments[0];if("object"==typeof t&&t.ids){e=t.ids;if(!Array.isArray(e))return;var r=e.map(function(e){return d(e)});r=r.filter(function(e){return e&&e.parentNode==Gi});r.length&&wt(r);return}if(gi){var n=gi,i=ai.getPCBCmdKey(n);if("PAD"==i&&n.parentNode!=Gi){n.parentNode.parentNode==Gi&&wt([n.parentNode]);return}if("TEXT"==i&&n.parentNode!=Gi){n.parentNode.parentNode==Gi&&wt([n.parentNode]);return}}wt()}},rotate:function(){var e=Kn&&Kn.start,t=e;if(!Xr()||e){var r,n,i,a,o=arguments[0];if("number"==typeof o)n=o;else if("string"==typeof o)isNaN(+o)||(n=+o);else if("object"==typeof o&&o.ids){i=o.ids;n=o.degree;if(!Array.isArray(i))return}void 0===n&&(n=270);if(i){r=i.map(function(e){return d(e)});r=r.filter(function(e){return e&&e.parentNode==Gi});if(r.length){a=new je(r);Ht(r,n);a.update();Pi.save(a.hist)}tt("updateAttrPanel")}else if("draw.image"==xi&&Yi.line)ge(Yi.line,n);else if(_i&&xi&&0===xi.indexOf("place.part_")){var s=xi.substr(6),l=d(s);if(l)return Dt([l],n)}else if("draw.track"==xi&&Yi.line)kr();else{if(gi){var c=gi,h=ai.getPCBCmdKey(c);if("PAD"==h&&c.parentNode!=Gi){if(c.parentNode.parentNode==Gi){c=c.parentNode;Ht([c],n);!t&&Pi.save(["rotate",c.id,n]);tt("updateAttrPanel")}return}if("TEXT"==h){p(c,"active",!1);Ht([c],n);!t&&Pi.save(["rotate",c.id,n]);p(c,"active",!0);tt("updateAttrPanel");return}}r=Xt();if(r.length){if(t)Ht(r,n);else{a=new je(r);Ht(r,n);a.update();Pi.save(a.hist)}tt("updateAttrPanel")}}}},visible_grid:function(){var e=m(d("grid1"),"display")||"";e="none"==e?"":"none";m(d("grid1"),{display:e});bi.adsorbGrid.visible=!e},snap_grid:function(){bi.adsorbGrid.enabled=!bi.adsorbGrid.enabled},setOriginXY:function(e){if(Qi==Dn.PCBLIB&&e.x<=0&&e.y<=0){e.x=400;e.y=300}e.x=isFinite(e.x)&&null!==e.x?+e.x:bi.canvas.originX;e.y=isFinite(e.y)&&null!==e.y?+e.y:bi.canvas.originY;e.x=Math.round(e.x);e.y=Math.round(e.y);bi.canvas.originX=e.x;bi.canvas.originY=e.y;var t=.5/ci,r=ai.toFixed(1/ci+1e-5,5);m(d("gridOH"),{y1:e.y+t,y2:e.y+t});m(d("gridOV"),{x1:e.x+t,x2:e.x+t});m(d("gridPattern"),{x:e.x,y:e.y});m(d("gridPattern2"),{x:e.x+r,y:e.y+r});We()}});a.registerHook({PCBNetlist:function(){return sr.apply(null,arguments)},PCBPreferences:function(){},autoRouterConfig:function(e){return Ir(e)},buildPCB:function(){return gr.apply(null,arguments)},drawBoardOutlineRoundrect:function(e,t,r,n,i){var a=h('[layerid="'+Fn.BOARDOUTLINE+'"]');Pi.startBatch();wt(a);var o,s,l=" ",c="A"+i+l+i+" 0 0 1 ",d={"stroke-width":"1",fill:"none",c_shapetype:"line",layerid:Fn.BOARDOUTLINE};if(i&&i>0){o=[e+i+l+t,e+r-i+l+t,e+r+l+(t+i),e+r+l+(t+n-i),e+r-i+l+(t+n),e+i+l+(t+n),e+l+(t+n-i),e+l+(t+i)];s=[Ue("polyline",{id:ai.newId(),points:o[0]+l+o[1]}),Ue("path",{id:ai.newId(),d:"M"+o[1]+c+o[2]}),Ue("polyline",{id:ai.newId(),points:o[2]+l+o[3]}),Ue("path",{id:ai.newId(),d:"M"+o[3]+c+o[4]}),Ue("polyline",{id:ai.newId(),points:o[4]+l+o[5]}),Ue("path",{id:ai.newId(),d:"M"+o[5]+c+o[6]}),Ue("polyline",{id:ai.newId(),points:o[6]+l+o[7]}),Ue("path",{id:ai.newId(),d:"M"+o[7]+c+o[0]})]}else{o=[e,t,e+r,t,e+r,t+n,e,t+n,e,t];s=[Ue("polyline",{id:ai.newId(),points:o.join(l)})]}m(s,d);for(var u=0;u<s.length;u++){zi.appendElement(s[u]);pi.updateOne(s[u]);Pi.save(["add",s[u].id])}Pi.saveBatch()},exportDSN:function(e){return $i.exportDSN(e)},fixPretextAngle:function(){var e=h('#g1 > g[c_shapetype="group"]:not([locked]):not([display="none"])',Gi);Pi.startBatch();for(var t=0;t<e.length;t++)xr(e[t],!0);Pi.saveBatch()},getBOMFromPCBEditor:function(){return er()},getBoardBBox:function(){return Rr()},getBoardOutlines:function(){return Br()},getCmdFilter:function(){return Li},getCopperAreaCompressData:function(e){return void 0!==Ai.getCompressData?Ai.getCompressData(e):""},getDRCRuleInfo:function(){return dr()},getHighLightNet:function(){return ir()},getOvalPadPoints:function(){return An.apply(null,arguments)},getPolygonBoardOutline:function(){return Ai.getPolygonBoardOutline()},getSelectedPadPoints:function(){return Cr()},hideErrorSymbols:function(){Ci&&Ci.hideErrorSymbols&&Ci.hideErrorSymbols()},highlightNet:function(){return br.apply(null,arguments)},importByPathD:function(){return un.apply(null,arguments)},importChanges:function(){return vr.apply(null,arguments)},importSession:function(e,t,r){return $i.importSession(e,t,r)},isBuiltCopperArea:function(){return Ai.isBuiltCopperArea()},layerColor:function(){return zi.getLayersCache()},markDRCError:function(){return pr.apply(null,arguments)},modifyPackage:function(e){var t=m(Gi,"c_para")||"",r=t?t.split("`"):[];""===r[0]&&r.shift();r.length%2&&r.push("");e=e||"";e=e.replace(/[`~]/gi,"");for(var n=0;n<r.length-1;n+=2)if("package"==r[n]){r[n+1]=e;break}n>r.length-1&&r.push("package",e);var i=r.join("`");m(Gi,"c_para",i);Pi.save(["attr",Gi.id,{c_para:t},{c_para:i}])},pcb_generates_pick_and_place_file:function(){var e=Rr();if(e.width<1||e.height<1)return"NOBOARDOUTLINE";var t=e.x,r=e.y+e.height,n=[],i=pi.gJsonCache.FOOTPRINT||{};for(var a in i)if(A(i,a)){for(var o,s=function(e){function n(e){return ai.toFixed(ai.units.convert(e,"pixel","inch"===bi.canvas.unit?"mil":bi.canvas.unit),2)+("inch"===bi.canvas.unit?"mil":bi.canvas.unit)}var i=e.PAD||{};if(!Object.keys(i).length)return!1;var a={centroidX:0,centroidY:0,padX:0,padY:0,padNumber:"~"},o=-9999999,s=9999999,l=o,c=s;for(var d in i)if(A(i,d)){var h=i[d];if(h.number+""<a.padNumber){a.padNumber=h.number+"";a.padX=h.x;a.padY=h.y}h.x>o&&(o=h.x);h.y>l&&(l=h.y);h.x<s&&(s=h.x);h.y<c&&(c=h.y)}a.centroidX=(o+s)/2;a.centroidY=(l+c)/2;a.centroidX=n(a.centroidX-t);a.centroidY=n(r-a.centroidY);a.padX=n(a.padX-t);a.padY=n(r-a.padY);a.refX=n(e.head.x-t);a.refY=n(r-e.head.y);return a}(i[a]),l=i[a].TEXT,c=i[a].itemOrder,d=0;d<c.length;d++)if(A(l,c[d])){o=c[d];break}if(s&&o){s.pre=i[a].TEXT[o].text||"";var h=i[a].head||{};s.TB="1"==h.layerid?"T":"B";s.rotation=+h.rotation;s.rotation=isNaN(s.rotation)?0:s.rotation;s.footprint=ai.c_paraToJson(h.c_para).package||"";s.comment=ai.c_paraToJson(h.c_para).value||"";n.push(s)}}return n},pcbnettext_toggle:function(e){if("boolean"!=typeof e){e=!(!1!==Yn.pcbNetTextVisible)}Yn.pcbNetTextVisible=e;jr();tt("triggerEvent",["pcbnettext_toggle",e])},reDrawBoardOutlineRect:function(e){var t=h('[layerid="'+Fn.BOARDOUTLINE+'"]');Pi.startBatch();wt(t);var r={c_shapetype:"line",layerid:"10",fill:"none","stroke-width":"1",id:ai.newId(),points:e},n=Ue("polyline",r);Gi.appendChild(n);pi.updateOne(n);Pi.save(["add",n.id]);Pi.saveBatch()},reDrawBoardOutlineRound:function(e){if(e||!(e.length<2)){var t=h('[layerid="'+Fn.BOARDOUTLINE+'"]');Pi.startBatch();wt(t);var r={c_shapetype:"line",layerid:"10",fill:"none","stroke-width":"1",d:e[0],id:ai.newId()},n={c_shapetype:"line",layerid:"10",fill:"none","stroke-width":"1",d:e[1],id:ai.newId()},i=Ue("path",r),a=Ue("path",n);Gi.appendChild(i);pi.updateOne(i);Gi.appendChild(a);pi.updateOne(a);Pi.save([["add",i.id],["add",a.id]]);Pi.saveBatch()}},rebuildAllCopperArea:function(){Ai.rebuildCopperArea("all")},rebuildSelectedCopperArea:function(){Ai.rebuildCopperArea("selected")},removeAllCopperArea:function(){Ai.removeAllCopperPolygons()},deleteAllNet:function(){return cr()},wireToLine:function(e){return lr(e)},runDRC:function(){return ur()},setAutoRouterInfo:function(e){"object"==typeof e?pi.gJsonCache.autoRouter=e||{}:delete pi.gJsonCache.autoRouter},setDRCRuleInfo:function(e){return hr(e)},setSelectedPadPoints:function(e){return Ar(e)},showHideItems:function(e,t){return ar(e,t)},systemColor:function(){return mr()},unit:function(){return bi.canvas.unit}});e.addEventListener("load",function(){var r=H(navigator.userAgent);p(fi,"bw-"+r,!0);e.addEventListener("resize",function(){var e=t.documentElement.clientWidth||9,r=t.documentElement.clientHeight||9,n=Ui.getViewBox(),i=[n[0]+.5*n[2]-.5*e/ci,n[1]+.5*n[3]-.5*r/ci,e/ci,r/ci];m(fi,{width:e,height:r});Ui.setViewBox(i)},!1);!function(){var e=t.documentElement.clientWidth||9,r=t.documentElement.clientHeight||9,n=bi.canvas.originX,i=bi.canvas.originY;if(ai.fileType.isLib(Qi)){n-=e/ci/2;i-=r/ci/2}m(fi,{width:e,height:r,viewBox:[n,i,e/ci,r/ci].join(" ")})}();t.addEventListener("mouseover",_t,!1);t.addEventListener("mouseout",_t,!1);t.addEventListener("mousedown",_t,!1);t.addEventListener("mouseup",_t,!1);t.addEventListener("contextmenu",Ze,!1);t.addEventListener(!ri||"onwheel"in t?"wheel":"MozMousePixelScroll",et,!1);t.addEventListener("mousemove",qe,!1);t.addEventListener("mousemove",gt,!1);t.addEventListener("mouseup",gt,!1);t.addEventListener("mouseout",function(){gt.data.uplock=!0},!1);t.addEventListener("drop",function(e){tt("editor_drop",[e]);e.preventDefault()},!1);ot();Ke(fi);Kr();nn();Jn();wn();Xe();We();Jt();tt("buildVersionCheck",[Yn.version+","+Yn.buildDate]);if(Qi==Dn.PCB){if(pi.gJsonCache.layers[Fn.RATLINES]&&!1===pi.gJsonCache.layers[Fn.RATLINES].visible){zi.hide(Fn.RATLINES);pi.gJsonCache.DRCRULE.isRealtime=!1;tt("triggerEvent",["layer_update"])}Oi.rebuild()}else Qi==Dn.PCBLIB&&(bi.canvas.unit="mm");Sr();e.loaded=!0;tt("triggerEvent",["select_change"]);tt("triggerEvent",["editor_load"])},!1);!function(){var e;t.addEventListener("dblclick",function(r){if(""!==xi)return!1;var n=ai.node.children(r.target.parentNode)[0],i=n.tagName;if("path"!=i||!m(n,"c_text")){pt(gi||n);return!1}var a="path"==i&&"note_pre"==m(n,"c_note"),o=m(n,"c_fontFamily"),s=d("textInputBox");if(!s){s=t.createElement("textarea");t.body.appendChild(s);s.id="textInputBox";s.className="textInputBox";s.style.width="200px";s.style.height="100px";m(s,"min-ofw",s.offsetWidth);m(s,"min-ofh",s.offsetHeight);s.addEventListener("change",function(t){var r=e,n=this.value.replace(/^\s+|\s+$/g,""),i=this.oldValue;n=n.replace(/\r\n/g,"\n").replace(/\r/g,"\n");n=n.replace(/^[ \t\f\v]+\n[ \t\f\v]*|\n[ \t\f\v]+$/g,"\n");a&&(n=n.replace(/\n+/g," "));if(!n){if(a)return;n="void"}/[^\x20-\x7E\n]+/.test(n)&&!o&&(n=n.replace(/[^\x20-\x7E\n]+/g,""));if(!(a&&n.indexOf(" ")>=0)){n=G(n);n=V(n);if(n!=i){n=n.replace(/\n/g,"\\n");r.id||(r.id=ai.newId());var s=r.parentNode,l=s.cloneNode(!0);_n(s,{text:n});var c=s.cloneNode(!0);Pi.save(["node",s.id,l,c]);s.parentNode==Gi?pi.updateOne(s):pi.updateOne(s.parentNode)}}},!1);s.addEventListener("blur",function(e){this.style.display="none"},!1);s.addEventListener("keydown",function(e){32==e.keyCode&&e.stopPropagation()},!1);void 0!==s.style.resize||function(e){function r(r){if(r.button===Vn){c&&i();if(r.offsetX>e.offsetWidth-16&&r.offsetY>e.offsetHeight-16){r.preventDefault();e.style.cursor="nwse-resize";t.addEventListener("mousemove",n,!1);t.addEventListener("mouseup",i,!1);c=!0;a=r.pageX;o=r.pageY;s=parseInt(e.style.width,10);l=parseInt(e.style.height,10)}}}function n(t){var r=s+t.pageX-a,n=l+t.pageY-o;e.style.width=Math.min(Math.max(r,100),1200)+"px";e.style.height=Math.min(Math.max(n,100),1e3)+"px"}function i(r){if(c){e.style.cursor="";t.removeEventListener("mousemove",n,!1);t.removeEventListener("mouseup",i,!1);c=!1}}var a=0,o=0,s=0,l=0,c=!1;e.addEventListener("mousedown",r,!1);e.addEventListener("blur",i,!1)}(s)}var l=r.pageX,c=r.pageY;s.style.display="";s.style.top=Math.max(c-5,5)+"px";s.style.left=Math.max(l-5,5)+"px";var h=m(n,"c_text");s.value=V(h);s.oldValue=h;s.focus();e=n;!function(e){for(var t=e.value.replace(/[^\x00-\xff]/g,"**").split(/\r\n|\r|\n/),r=t.length,n=0,i=0;i<t.length;i++)n=Math.max(t[i].length,n);m(s,"rows",r);m(s,"cols",n);s.style.width="";s.style.height="";s.style.width=200+Math.max(0,s.offsetWidth-m(s,"min-ofw"))+"px";s.style.height=100+Math.max(0,s.offsetHeight-m(s,"min-ofh"))+"px"}(s)},!1)}();t.addEventListener("dblclick",function(e){if(""===xi){var t=e.target,r=(t.tagName,e.shiftKey);if(t.parentNode==Gi&&"TRACK"==ai.getPCBCmdKey(t)){r&&e.preventDefault();var n=Qe(e,!1),i=new je([t]),a=m(t,"net");if(!r&&De(t,n)){it(t);pi.updateOne(t);a&&Ei.buildOneNet(a,!1);i.updateAndSave()}if(r){var o=He(t,n);if(o){var s=Array.isArray(o)&&o[1];s&&Pi.startBatch();it(t);pi.updateOne(t);i.updateAndSave();if(s){var l=o[1];pi.updateOne(l);Pi.save(["add",l.id,ai.node.getRefId(l)]);Pi.saveBatch()}a&&Ei.buildOneNet(a,!1)}}}}},!1);t.addEventListener("dblclick",function(e){if(""===xi){var t=e.target;e.ctrlKey||e.altKey||e.shiftKey||t.parentNode==Di&&$t(t.id)}},!1);t.addEventListener("afterActiveLayerChange",Lr,!1)}(window,document);
//# sourceMappingURL=editorPCB.min.map